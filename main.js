!function(t){function e(e){for(var s,o,h=e[0],l=e[1],a=e[2],c=0,d=[];c<h.length;c++)o=h[c],n[o]&&d.push(n[o][0]),n[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);for(u&&u(e);d.length;)d.shift()();return r.push.apply(r,a||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],s=!0,h=1;h<i.length;h++){var l=i[h];0!==n[l]&&(s=!1)}s&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var s={},n={1:0},r=[];function o(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=s,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var h=window.webpackJsonp=window.webpackJsonp||[],l=h.push.bind(h);h.push=e,h=h.slice();for(var a=0;a<h.length;a++)e(h[a]);var u=l;r.push([25,0]),i()}([,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);class n{constructor(t=new s.Vector(0,0)){this.origin=t,this.name="(default structure name)",this.description="(default structure description)",this.view="<add a default structure (room) view>",this.width=10,this.height=10,this.zoom=2}}e.Structure=n,e.MissionControl=class extends n{constructor(){super(...arguments),this.name="Mission Control",this.description="Keeping everything on track",this.view="MissionControlView",this.width=90,this.height=24,this.zoom=.5}},e.MainTunnel=class extends n{constructor(){super(...arguments),this.name="Main Tunnel",this.description="Elevating",this.view="TunnelView",this.width=30,this.height=100,this.zoom=.25}},e.Dome=class extends n{constructor(){super(...arguments),this.name="Biodome",this.description="Biome sweet biome",this.view="DomeView",this.width=60,this.height=50,this.zoom=.2}},e.AccessTunnel=class extends n{constructor(){super(...arguments),this.name="Access Tunnel",this.description="in the hallway",this.view="AccessTunnelView",this.width=10,this.height=9}},e.CommonArea=class extends n{constructor(){super(...arguments),this.name="Common Area",this.description="hallway cap",this.view="CommonAreaView",this.width=120,this.height=70}},e.LivingQuarters=class extends n{constructor(){super(...arguments),this.name="Living Quarters",this.description="sleepy time",this.view="LivingQuartersView",this.width=80,this.height=60}},e.SurfaceRoad=class extends n{constructor(){super(...arguments),this.name="Surface Road",this.description="go for a walk",this.view="SurfaceRoadView",this.width=20,this.height=8}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=(t,e,i)=>t.reduce(function(t,s){var n=[e(s),s];return t&&i.apply(null,[t[0],n[0]])==t[0]?t:n},null)[1];function n(t,e,i){for(var s=[],n=0;n<i;n++)s.push(t[e+n]);return s}e.minBy=((t,e)=>s(t,e,Math.min)),e.maxBy=((t,e)=>s(t,e,Math.max)),e.sample=(t=>t[Math.floor(Math.random()*t.length)]),e.range=(t=>Array(t).fill(0).map((t,e)=>e)),e.closest=function(t,i,s,n){let r=i;if(n&&(i=i.filter(n)),r){let i=e=>t.distance(s(e));return e.minBy(r,i)}},e.flatSingle=(t=>[].concat(...t)),e.deleteByValue=((t,e)=>t.filter(t=>t!==e)),e.eachCons=function(t,e){for(var i=[],s=0;s<t.length-e+1;s++)i.push(n(t,s,e));return i},e.measureDistance=((t,e)=>t.distance(e))},function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Left=0]="Left",t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Down=3]="Down"}(s=e.Orientation||(e.Orientation={})),e.flip=function(t){switch(t){case s.Left:return s.Right;case s.Right:return s.Left;case s.Up:return s.Down;case s.Down:return s.Up}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(0),r=i(3),o=i(2),h=i(6);e.Building=class extends s.Actor{constructor(t,e){super(t.origin.x,t.origin.y,t.width,t.height,e.color),this.structure=t,this.planet=e,this.built=!1,this.hover=!1,this.facing=r.Orientation.Right,this.edgeWidth=4,this.hideBox=!1,this.childrenBuildings=[],this.step=0,this.product=[],this.capacity=4,this.anchor=new n.Vector(0,0),console.log(`CREATE NEW ${t.name}`,{origin:t.origin,width:t.width,height:t.height}),this.setup(),this.traits=this.traits.filter(t=>!(t instanceof n.Traits.OffscreenCulling)),this.on("pointerenter",()=>{this.hover=!0}),this.on("pointerleave",()=>{this.hover=!1}),this.collisionType=s.CollisionType.PreventCollision,this.add(new s.Label(this.structure.name))}setup(){}constrainCursor(t){return t.clone()}reshape(t){this.pos=t.clone()}handleClick(t){return!0}slots(){return[]}nodes(){let t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight();return[new s.Vector(Math.floor(t),Math.floor(e)-4)]}graph(t=new h.Graph){let e=t,i=this.nodes(),s=e.findOrCreate(i[0],o.measureDistance);for(let t of this.childrenBuildings){let i=e.findOrCreate(t.parentSlot.pos,o.measureDistance);e.edge(s,i);let n=e.findOrCreate(t.nodes()[0],o.measureDistance);e.edge(i,n),t.graph(e)}return e}interact(t){return!0}draw(t,e){this.hideBox||this.drawRect(t,this.aabb(),this.edgeWidth)}update(t,e){super.update(t,e),this.built&&this.step%10==0&&this.product.length<this.capacity&&this.produce(this.step),this.step+=1}produce(t){}drawRect(t,e,i=5,s=null){let{x:n,y:r,width:o,height:h}=e,l=s||this.edgeColor();t.fillStyle=l.toRGBA(),t.fillRect(n,r,o,h);let a=s||this.mainColor();t.fillStyle=a.toRGBA(),t.fillRect(n+i,r+i,o-2*i,h-2*i)}aabb(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}}overlaps(t){let e=this.aabb(),i=t.aabb();return!!(e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y)}overlapsAny(){return!!this.planet.buildings.find(t=>t!==this&&this.overlaps(t))}edgeColor(){return this.processedColor().lighten(.5)}mainColor(){return this.processedColor().darken(.08)}colorBase(){return this.color}processedColor(){let t=this.colorBase().clone();return this.built||(this.overlapsAny()&&(t=s.Color.Red),t.a=.8),this.hover&&(t.a=.5),t}validConnectingStructures(){return[]}findSlot(t){let e=this.validConnectingStructures().map(e=>this.planet.closestBuildingByType(t,e)),i=o.flatSingle(e.map(t=>t?t.slots():[]));if((i=i.filter(t=>this.slots().some(e=>t.facing===r.flip(e.facing)))).length>0)return o.closest(t,i,t=>t.pos)}alignToSlot(t){let e=this.findSlot(t);if(e){let t=this.slots().find(t=>t.facing==r.flip(e.facing));if(t){let i=e.pos.sub(t.pos);return this.pos.addEqual(i),this.parentSlot=e,e}}}buildSlot(t,e,i=r.Orientation.Right){return{pos:new s.Vector(t,e),facing:i,parent:this}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4);e.Building=s.Building;const n=i(15);e.AccessTunnelView=n.AccessTunnelView;const r=i(14);e.CommonAreaView=r.CommonAreaView;const o=i(13);e.DomeView=o.DomeView;const h=i(12);e.MissionControlView=h.MissionControlView;const l=i(11);e.TunnelView=l.TunnelView;const a=i(10);e.LivingQuartersView=a.LivingQuartersView},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.Graph=class{constructor(){this.empty=!0,this.nodes=[],this.edges={},this.edgesInverse={}}isEmpty(){return this.empty}get size(){return this.nodes.length}node(t){this.empty=!1,this.contains(t)||(console.log("create new node",{newNode:t}),this.nodes.push(t))}contains(t){return this.nodes.includes(t)}findOrCreate(t,e,i=5){let n=this.dfs(),r=s.minBy(n,i=>e(t,i));return r&&e(r,t)<i?r:t}edge(t,e){console.log("edge from",{src:t,dst:e}),this.node(t),this.node(e);let i=this.indexOf(t),s=this.indexOf(e);this.edges[i]=this.edges[i]||[],this.edges[i].push(s),this.edgesInverse[s]=this.edgesInverse[s]||[],this.edgesInverse[s].push(i)}union(t){t.edgeList().forEach(([t,e])=>this.edge(t,e))}edgeList(){let t=[];for(let e of this.nodes){let i=this.indexOf(e);if(this.edges[i])for(let s of this.edges[i]){let i=this.nodes[s];t.includes([i,e])||t.push([e,i])}}return t}adjacent(t){let e=this.indexOf(t);return this.adjacentIndices(e).map(t=>this.nodes[t])}adjacentIndices(t){let e=this.edges[t]||[],i=this.edgesInverse[t]||[];return[...e,...i]}dfs(t=null,e=[]){let i=t?this.indexOf(t):0;return this.dfsIndex(i).map(t=>this.nodes[t])}dfsIndex(t=0,e=[]){return e.push(t),this.adjacentIndices(t).forEach(t=>{e.includes(t)||this.dfsIndex(t,e)}),e}bfs(t=null,e=(()=>!0)){let i=t?this.indexOf(t):0;return this.bfsIndex(i,e).map(t=>this.nodes[t])}bfsIndex(t=null,e=(()=>!0)){let i=!1,s=[];for(s.push(t);s.length<this.nodes.length;){for(let t of s){let n=this.adjacentIndices(t);for(let r of n)if(!s.includes(r)){if(!e(t,r)){i=!0;break}s.push(r)}if(i)break}if(i)break}return s}shortestPath(t,e,i=256){let s={},n=this.indexOf(e);this.bfs(t,(t,e)=>(s[e]=t,e!==n));let r=[],o=n,h=0,l=this.indexOf(t);for(;!r.includes(l)&&h<i;)r.push(o),o=s[o],h+=1;return r.map(t=>this.nodes[t]).reverse()}indexOf(t){return this.nodes.indexOf(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),n=i(1);e.SurfaceRoadView=class extends s.AccessTunnelView{validConnectingStructures(){return[n.MissionControl,n.Dome]}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function h(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,h)}l((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);e.Citizen=class extends n.Actor{constructor(t,e){super(t.nodes()[0].x,t.nodes()[0].y,4,10,n.Color.White),this.planet=e,this.walkSpeed=150,this.carrying=null,this.path=[],this.traits=this.traits.filter(t=>!(t instanceof n.Traits.OffscreenCulling))}draw(t,e){super.draw(t,e),this.carrying&&(t.fillStyle=this.carrying.toRGBA(),t.fillRect(this.x+4,this.y-3,5,5))}carry(t){this.carrying=t}drop(){if(this.carrying){let t=this.carrying.clone();return this.carrying=null,t}return!0}glideTo(t){return this.actions.moveTo(t.x,t.y,this.walkSpeed).asPromise()}walkTo(t,e){return s(this,void 0,void 0,function*(){let i=this.planet.closestBuildingByType(this.pos,t);console.log("walking to",{building:i});let s=this.planet.pathBetween(this.pos.clone(),i);return console.log("lookup path",s),s.length>0&&(this.path=s,yield Promise.all(s.map(t=>this.glideTo(t))),this.path=null,e(i)),!0})}patrol(t,e,i){return s(this,void 0,void 0,function*(){yield this.walkTo(t,i),yield this.walkTo(e,i),this.patrol(t,e,i)})}work(t,e){this.patrol(t,e,t=>{console.log("arrived at",{building:t}),t.interact(this)})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1);e.Hud=class extends s.UIActor{constructor(t="welcome to osiris",e=null){super(0,0),this.onBuildingSelect=e,this.label=new s.Label(t,10,32,"Helvetica"),this.label.fontSize=32,this.label.color=s.Color.White,this.add(this.label),this._makePalette(e)}_makePalette(t){this._paletteElement=document.createElement("div"),this._paletteElement.style.position="absolute",document.body.appendChild(this._paletteElement),[n.Dome,n.AccessTunnel,n.CommonArea,n.LivingQuarters,n.SurfaceRoad].forEach(e=>{let i=new e,s=this.buttonFactory(i);this._paletteElement.appendChild(s),s.onclick=(e=>{t(i),e.stopPropagation()})})}buttonFactory(t){let e=document.createElement("button");return e.textContent=`${t.name}`,e.style.display="block",e.style.fontSize="13pt",e.style.fontFamily="Helvetica",e.style.padding="8px",e.style.width="100px",e.style.background=s.Color.White.darken(.08).toRGBA(),e.style.color=s.Color.Black.lighten(.16).toRGBA(),e}message(t){this.label.text=t}draw(t,e){if(super.draw(t,e),this._paletteElement){let e=t.canvas.offsetLeft,i=t.canvas.offsetTop;this._paletteElement.style.left=`${e+20}px`,this._paletteElement.style.top=`${i+100}px`}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5);e.LivingQuartersView=class extends s.CommonAreaView{constructor(){super(...arguments),this.edgeWidth=2}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(4),r=i(1),o=i(2),h=i(3),l=i(6);e.TunnelView=class extends n.Building{constructor(){super(...arguments),this.pickingOrigin=!0}nodes(){let t=this.pos.x+this.getWidth()/2,e=this.pos.y;return[new s.Vector(Math.floor(t),e)]}graph(t=new l.Graph){let e=t,i=this.getWidth()/2,n=this.pos.x+i,r=e.findOrCreate(this.nodes()[0],o.measureDistance),h=e.findOrCreate(new s.Vector(n,this.slotHeights()[0]),o.measureDistance);e.edge(r,h),o.eachCons(this.slotHeights(),2).forEach(([t,i])=>{let r=e.findOrCreate(new s.Vector(n,t),o.measureDistance),h=e.findOrCreate(new s.Vector(n,i),o.measureDistance);e.edge(r,h)}),this.slotHeights().forEach(t=>{let r=e.findOrCreate(new s.Vector(n,t),o.measureDistance),h=e.findOrCreate(new s.Vector(n-i,t),o.measureDistance);e.edge(h,r);let l=e.findOrCreate(new s.Vector(n+i,t),o.measureDistance);e.edge(r,l)});for(let t of this.childrenBuildings){let i=e.findOrCreate(t.parentSlot.pos,o.measureDistance),s=e.findOrCreate(t.nodes()[0],o.measureDistance);e.edge(s,i),t.graph(e)}return e}slotHeights(){let t=Math.floor((this.getHeight()-60)/40),e=[];for(let i of o.range(t))e.push(100+this.pos.y+40*i);return e}slots(){let t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,h.Orientation.Up));for(let e of this.slotHeights())t.push(this.buildSlot(this.pos.x,e,h.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),e,h.Orientation.Right));return t}validConnectingStructures(){return[r.MissionControl]}handleClick(t){return!this.pickingOrigin||(this.pickingOrigin=!1,!1)}constrainCursor(t){return this.pickingOrigin?this.alignToSlot(t):t.y=Math.max(this.planet.getTop()+100,t.y),t}reshape(t){this.pos.y=this.planet.getTop()+2,this.pickingOrigin||this.setHeight(t.y-this.planet.getTop())}colorBase(){return this.color.darken(.2)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(4),r=i(3);e.MissionControlView=class extends n.Building{constructor(){super(...arguments),this.hideBox=!0}slots(){let t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),r.Orientation.Down));let e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,r.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,r.Orientation.Right)),t}constrainCursor(t){return t.y=this.planet.getTop(),t}reshape(t){this.pos=t,this.pos.y-=this.getHeight()-2}interact(t){return t.drop(),!0}draw(t,e){let i=this.mainColor();t.fillStyle=i.toRGBA(),t.fillRect(this.pos.x,this.pos.y,this.getWidth(),this.getHeight());let s=this.pos.x+this.getWidth()/4*3,n=this.pos.y-18;t.fillRect(s,n,2,18),t.fillRect(s,n,10,5),super.draw(t,e)}colorBase(){return s.Color.White}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(4),r=i(3),o=i(1);e.DomeView=class extends n.Building{constructor(){super(...arguments),this.hideBox=!0}slots(){let t=[],e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,r.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,r.Orientation.Right)),t}reshape(t){this.alignToSlot(t)}interact(t){return this.product.length>0&&(t.carry(s.Color.Green),this.product.pop()),!0}produce(t){t%100==0&&this.product.push(s.Color.Green)}draw(t,e){let i=this.mainColor();t.beginPath(),t.arc(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),this.getHeight()/1.5,0,Math.PI,!0),t.closePath(),t.fillStyle=i.toRGBA(),t.fill(),this.product.forEach((e,i)=>{t.fillStyle=e.toRGBA(),t.fillRect(this.x+20*i,this.y-20,18,18)}),super.draw(t,e)}colorBase(){return s.Color.White.darken(.05)}validConnectingStructures(){return[o.SurfaceRoad]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4),n=i(3),r=i(1);e.CommonAreaView=class extends s.Building{constructor(){super(...arguments),this.floorHeight=5,this.edgeWidth=2}slots(){let t=[],e=this.getHeight()-this.floorHeight,i=this.buildSlot(this.pos.x,this.pos.y+e,n.Orientation.Left);t.push(i);let s=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,n.Orientation.Right);return t.push(s),t}reshape(t){this.alignToSlot(t)}validConnectingStructures(){return[r.AccessTunnel]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4),n=i(3),r=i(1);e.AccessTunnelView=class extends s.Building{constructor(){super(...arguments),this.edgeWidth=1,this.pickingOrigin=!0,this.facing=n.Orientation.Left,this.originX=0}slots(){let t=[],e=this.getHeight()/2;return t.push(this.buildSlot(this.pos.x,this.pos.y+e,n.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,n.Orientation.Right)),t}handleClick(t){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(t)),!1)}constrainCursor(t){let e=t.clone();return this.pickingOrigin||(e.y=this.pos.y),e}reshape(t){if(this.pickingOrigin){let e=this.alignToSlot(t);this.facing=e.facing,e&&this.facing===n.Orientation.Left&&(this.originX=e.pos.x)}else this.facing===n.Orientation.Left?(this.setWidth(Math.abs(this.originX-t.x)),this.pos.x=this.originX-this.getWidth()):this.setWidth(Math.abs(this.pos.x-t.x))}validConnectingStructures(){return[r.MainTunnel,r.CommonArea,r.LivingQuarters]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Player=class extends s.Actor{constructor(){super(),this.setWidth(5),this.setHeight(5),this.x=5,this.y=5,this.color=new s.Color(255,255,255)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.NavigationTree=class{constructor(t){this.graph=t.graph()}seekPath(t,e){return this.graph.shortestPath(t,e)}closestNode(t){let e=this.graph.dfs();return s.minBy(e,e=>Math.abs(t.distance(e)))||!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2);e.Mountains=class extends class extends s.Actor{constructor(t,e,i){super(0,t,e,500,i)}}{constructor(){super(...arguments),this.peaks=[]}onInitialize(){let t=this.getWidth()/2,e=this.getWidth()/30;for(let i of n.range(10)){let s=100*i,r=3*i*(e/2);for(let i of n.range(30))this.peaks.push({x:i*e-t+(Math.random()*r-r/2),height:Math.max(10,Math.random()*s-s/2+1e3)})}console.log({peaks:this.peaks})}draw(t,e){let i=this.color.desaturate(.25),s=this.color.saturate(.2).lighten(.5);t.fillStyle=i.toRGBA();let n=this.pos.y-3;this.peaks.forEach(e=>{let r=n-e.height,o=3.4*e.height;t.beginPath(),t.moveTo(e.x,r),t.lineTo(e.x-o,n),t.lineTo(e.x+o,n),t.fillStyle=i.toRGBA(),t.fill(),t.beginPath(),t.moveTo(e.x,r),t.lineTo(e.x+o/4*3,n),t.lineTo(e.x+o,n),t.fillStyle=s.toRGBA(),t.fill()})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(0),r=i(2),o=i(18),h=i(1),l=i(17);e.Planet=class extends n.Actor{constructor(t,e=2e6,i=1e5){super(0,i/2,e,i,t),this.color=t,this.width=e,this.depth=i,this.buildings=[],this.traits=this.traits.filter(t=>!(t instanceof s.Traits.OffscreenCulling));let n=-i/2;this.createLayer(n,20,this.color.lighten(.25));let h=i/20;for(let t of r.range(20))this.createLayer(n+20+h/2+h*(t+1),h,this.color.darken(.05+.01*t));this.add(new o.Mountains(-i/2,this.getWidth(),this.color.lighten(.15)))}createLayer(t,e,i){let s=new n.Actor(0,t,this.getWidth(),e,i);this.add(s)}draw(t,e){super.draw(t,e)}placeBuilding(t){t.built=!0,t.parentSlot&&(t.parentSlot.parent.childrenBuildings.push(t),this.buildNavTree()),this.buildings.push(t)}closestBuildingByType(t,e){let i=this.buildings.filter(t=>t.structure instanceof e);if(i&&i.length>0){let e=e=>t.distance(e);return r.minBy(i,e)}}pathBetween(t,e){this.navTree||this.buildNavTree();let i=this.navTree.closestNode(t),s=e.nodes()[0],n=this.navTree.closestNode(s);return this.navTree.seekPath(i,n)}buildNavTree(){let t=this.buildings.find(t=>t.structure instanceof h.MissionControl);t&&(this.navTree=new l.NavigationTree(t))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(19),r=i(16),o=i(1),h=i(5),l=i(9),a=i(8),u=i(2),c=i(7);class d extends s.Scene{constructor(){super(...arguments),this.currentBuildingListIndex=0,this.buildings=[],this.people=[],this.dragging=!1}onInitialize(t){this.game=t,this.planet=new n.Planet(t.world.color),this.add(this.planet),this.player=new r.Player,this.add(this.player),this.hud=new l.Hud("hi",t=>{this.currentlyBuilding&&this.remove(this.currentlyBuilding),this.startConstructing(t)}),this.add(this.hud),this.prepareNextBuilding()}onActivate(){this.game.input.pointers.primary.on("move",t=>{if(this.dragging)this.camera.pos=this.camera.pos.add(this.dragOrigin.sub(t.pos));else{this.player.pos=t.pos;let e=this.currentlyBuilding;if(e){let t=e.constrainCursor(this.player.pos);this.player.pos=t,e.reshape(this.player.pos)}}}),this.game.input.pointers.primary.on("up",t=>{this.dragging&&(this.dragging=!1)}),this.game.input.pointers.primary.on("down",t=>{if(t.button==s.Input.PointerButton.Left){const e=this.currentlyBuilding;if(e){let i=!e.overlapsAny();e&&i&&e.handleClick(t.pos)&&(this.planet.placeBuilding(e),this.prepareNextBuilding(t.pos))}}else t.button===s.Input.PointerButton.Middle&&(this.dragging=!0,this.dragOrigin=t.pos)}),this.game.input.pointers.primary.on("wheel",t=>{let e=this.camera.getZoom();t.deltaY<0?this.camera.zoom(Math.min(e+.05,8)):t.deltaY>0&&this.camera.zoom(Math.max(e-.05,.05))}),this.game.input.keyboard.on("press",t=>{t.key===s.Input.Keys.H&&this.planet.buildings&&this.planet.buildings[0]&&(this.camera.move(this.planet.buildings[0].pos,500),this.camera.zoom(.5,1e3))})}onDeactivate(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")}nextMissingRequiredStructure(){let t=d.requiredStructureList,e=this.buildings.map(t=>t.structure.name);return t.find(t=>!e.includes(t.name))}prepareNextBuilding(t=new s.Vector(0,0)){let e=d.structureList[this.currentBuildingListIndex%d.structureList.length],i=this.nextMissingRequiredStructure();i?e=i:this.currentBuildingListIndex+=1,this.startConstructing(e,t)}startConstructing(t,e=new s.Vector(0,0)){if(this.currentlyBuilding=null,t){t.origin=e,this.hud.message(`Place ${t.name}`);let i=this.spawnBuilding(t);this.currentlyBuilding=i,this.camera.pos=i.pos,this.camera.zoom(t.zoom,250)}else{this.hud.message("Welcome to OSIRIS");for(let t in u.range(1))this.spawnCitizen()}}spawnCitizen(){let t=this.planet.closestBuildingByType(this.player.pos,o.LivingQuarters),e=new a.Citizen(t,this.planet);e.work(o.Dome,o.MissionControl),this.people.push(e),this.add(e)}spawnBuilding(t){console.log("spawn",{structure:t});let e=this.assembleBuildingFromStructure(t);return e.reshape(e.constrainCursor(e.pos)),this.add(e),this.buildings.push(e),e}assembleBuildingFromStructure(t){return new(0,d.structureViews[t.view])(t,this.planet)}}d.structureViews={TunnelView:h.TunnelView,MissionControlView:h.MissionControlView,DomeView:h.DomeView,AccessTunnelView:h.AccessTunnelView,CommonAreaView:h.CommonAreaView,LivingQuartersView:h.LivingQuartersView,SurfaceRoadView:c.SurfaceRoadView},d.firstStructure=new o.MissionControl,d.secondStructure=new o.MainTunnel,d.requiredStructureList=[new o.MissionControl,new o.SurfaceRoad,new o.Dome,new o.MainTunnel,new o.AccessTunnel,new o.LivingQuarters],d.structureList=[],e.Construct=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2);class r{constructor(){this.structures=[]}}e.Colony=r;class o{constructor(){this.color=n.sample(o.colors).darken(.1).desaturate(.8),this.skyColor=n.sample([s.Color.Cyan,s.Color.Vermillion]).lighten(.15).desaturate(.65),this.colony=new r}}o.colors=[s.Color.Red,s.Color.Blue,s.Color.Green],e.World=o},function(t,e,i){t.exports=i.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(22);let r={Sword:new s.Texture(n)};e.Resources=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(23);e.Game=class extends s.Engine{constructor(t){super({width:800,height:600,displayMode:s.DisplayMode.FullScreen,backgroundColor:t.skyColor}),this.world=t}start(){let t=new s.Loader;for(let e in n.Resources)t.addResource(n.Resources[e]);return super.start(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(24),n=i(21),r=i(20),o=new n.World,h=new s.Game(o),l=new r.Construct(h);h.add("construct",l),h.start().then(()=>{h.goToScene("construct")})}]);
//# sourceMappingURL=main.js.map