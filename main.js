!function(e){function t(t){for(var r,s,a=t[0],c=t[1],u=t[2],p=0,h=[];p<a.length;p++)s=a[p],o[s]&&h.push(o[s][0]),o[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);h.length;)h.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={1:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;i.push([65,0]),n()}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(11),i=o.Scale.major;o.Scale.minor,function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.Huge=3]="Huge"}(r=t.DeviceSize||(t.DeviceSize={})),t.getVisibleDeviceSize=function(e){var t=10;switch(e){case r.Small:t=i.third;break;case r.Medium:t=i.fifth;break;case r.Large:t=i.eighth+i.third;break;case r.Huge:t=6*i.eighth}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(e,t,n){return e.reduce(function(e,r){var o=[t(r),r];return e&&n.apply(null,[e[0],o[0]])==e[0]?e:o},null)[1]};function i(e,t,n){for(var r=[],o=0;o<n;o++)r.push(e[t+o]);return r}t.minBy=function(e,t){return o(e,t,Math.min)},t.maxBy=function(e,t){return o(e,t,Math.max)},t.sample=function(e){return e[Math.floor(Math.random()*e.length)]},t.range=function(e){return Array(e).fill(0).map(function(e,t){return t})},t.closest=function(e,n,r,o){var i=n;if(o&&(n=n.filter(o)),i)return t.minBy(i,function(t){return e.distance(r(t))})},t.flatSingle=function(e){return[].concat.apply([],e)},t.deleteByValue=function(e,t){return e.filter(function(e){return e!==t})},t.deleteByValueOnce=function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)},t.eachCons=function(e,t){for(var n=[],r=0;r<e.length-t+1;r++)n.push(i(e,r,t));return n},t.measureDistance=function(e,t){return e.distance(t)},t.drawLine=function(e,t,n,o,i){void 0===o&&(o=r.Color.White),void 0===i&&(i=1),o.a=.5,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.strokeStyle=o.toRGBA(),e.lineWidth=i,e.stroke()},t.drawRect=function(e,t,n,o,i){void 0===n&&(n=0),void 0===o&&(o=r.Color.White),void 0===i&&(i=!0);var s=t.x,a=t.y,c=t.width,u=t.height;if(i){var l=o;e.fillStyle=l.toRGBA(),e.fillRect(s,a,c,u)}if(n>0){var p=r.Color.White;e.strokeStyle=p.toRGBA(),e.lineWidth=n,e.strokeRect(s,a,c,u)}},t.sleep=function(e){return new Promise(function(t){return setTimeout(t,e)})},t.shuffle=function(e){return e.sort(function(){return Math.random()>.5?1:-1})},t.zip=function(e,t){return e.map(function(e,n){return[e,t[n]]})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4);t.Building=r.Building;var o=n(39);t.CorridorView=o.CorridorView;var i=n(38);t.CommonAreaView=i.CommonAreaView;var s=n(37);t.DomeView=s.DomeView;var a=n(36);t.MissionControlView=a.MissionControlView;var c=n(35);t.TunnelView=c.TunnelView;var u=n(34);t.ArcologyView=u.ArcologyView;var l=n(33);t.LadderView=l.LadderView;var p=n(32);t.SurfaceRoadView=p.SurfaceRoadView;var h=n(31);t.SmallDomeThreeView=h.SmallDomeThreeView;var f=n(30);t.MidDomeView=f.MidDomeView;var d=n(29);t.BigDomeView=d.BigDomeView;var y=n(28);t.SmallRoomThreeView=y.SmallRoomThreeView;var v=n(27);t.MediumRoomView=v.MediumRoomView;var m=n(26);t.LargeRoomView=m.LargeRoomView;var g=n(25);t.HugeRoomView=g.HugeRoomView;var w=n(24);t.MediumRoomThreeView=w.MediumRoomThreeView;var b={CorridorView:o.CorridorView,LadderView:l.LadderView,TunnelView:c.TunnelView,SurfaceRoadView:p.SurfaceRoadView,DomeView:s.DomeView,SmallDomeThreeView:h.SmallDomeThreeView,MidDomeView:f.MidDomeView,BigDomeView:d.BigDomeView,MissionControlView:a.MissionControlView,SmallRoomThreeView:y.SmallRoomThreeView,CommonAreaView:i.CommonAreaView,MediumRoomView:v.MediumRoomView,MediumRoomThreeView:w.MediumRoomThreeView,LargeRoomView:m.LargeRoomView,HugeRoomView:g.HugeRoomView,ArcologyView:u.ArcologyView};t.structureViews=b},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(7),a=n(2),c=n(12),u=n(9),l=n(1),p=function(){function e(e,t){this.pos=e,this.size=t}return Object.defineProperty(e.prototype,"position",{get:function(){return this.pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleSize",{get:function(){return l.getVisibleDeviceSize(this.size)},enumerable:!0,configurable:!0}),e}();t.DevicePlace=p;var h=function(e){function t(t,n,r){var o=e.call(this,t.x,t.y,n.width,n.height,r.color)||this;return o.structure=n,o.planet=r,o.edgeWidth=0,o.built=!1,o.hover=!1,o.showLabel=!1,o.facing=s.Orientation.Right,o.hideBox=!1,o.childrenBuildings=[],o.level=1,o.devices=[],o.step=0,o.anchor=new i.Vector(0,0),o.setup(),o.traits=o.traits.filter(function(e){return!(e instanceof i.Traits.OffscreenCulling)}),o.on("pointerenter",function(){o.hover=!0,o.planet.currentlyViewing=o}),o.on("pointerleave",function(){o.hover=!1}),o.collisionType=i.CollisionType.PreventCollision,o.nameLabel=new i.Label(o.structure.name,0,0,"Helvetica"),o.nameLabel.color=i.Color.White,o.levelLabel=new i.Label("Lvl. "+o.level,0,0,"Helvetica"),o.levelLabel.fontSize=6,o.levelLabel.color=i.Color.White.darken(.2),o}return o(t,e),t.prototype.levelUp=function(){this.level+=1,this.levelLabel.text="Lvl. "+this.level},Object.defineProperty(t.prototype,"name",{get:function(){return this.spaceFunction?this.spaceFunction.name:this.structure.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.spaceFunction?this.spaceFunction.description:this.structure.description},enumerable:!0,configurable:!0}),t.prototype.draw=function(e,t){this.hideBox||a.drawRect(e,this.aabb(),this.edgeWidth,this.processedColor()),this.devices.forEach(function(n){return n.draw(e,t)}),this.showLabel&&(this.nameLabel.pos=this.getCenter(),this.nameLabel.pos.x-=e.measureText(this.structure.name).width/2,this.nameLabel.draw(e,t))},t.prototype.update=function(t,n){var r=this;e.prototype.update.call(this,t,n),this.built&&this.devices.forEach(function(e){return e.produce(r.step)}),this.step+=1},t.prototype.setup=function(){},t.prototype.constrainCursor=function(e){return e.clone()},t.prototype.reshape=function(e){this.pos=e.clone()},t.prototype.afterConstruct=function(){},t.prototype.handleClick=function(e){return!0},t.prototype.slots=function(){return[]},t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y+this.getHeight();return[new i.Vector(Math.floor(e),Math.floor(t)-4)]},t.prototype.devicePlaces=function(){return[]},t.prototype.graph=function(e){void 0===e&&(e=new c.Graph);for(var t=e,n=this.nodes(),r=t.findOrCreate(n[0],a.measureDistance),o=0,i=this.childrenBuildings;o<i.length;o++){var s=i[o],u=t.findOrCreate(s.parentSlot.pos,a.measureDistance);t.edge(r,u);var l=t.findOrCreate(s.nodes()[0],a.measureDistance);t.edge(u,l),s.graph(t)}return t},t.prototype.redeem=function(e){this.planet.gather(e)},t.prototype.populate=function(e){this.planet.populate(e)},t.prototype.aabb=function(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}},t.prototype.overlaps=function(e){var t=this.aabb(),n=e.aabb();return!!(t.x<n.x+n.width&&t.x+t.width>n.x&&t.y<n.y+n.height&&t.y+t.height>n.y)},t.prototype.overlapsAny=function(){var e=this;return!!this.planet.colony.buildings.find(function(t){return t!==e&&e.overlaps(t)})},t.prototype.edgeColor=function(){return this.processedColor().lighten(.85)},t.prototype.mainColor=function(){return this.processedColor().darken(.08)},t.prototype.colorBase=function(){return this.color},t.prototype.processedColor=function(){var e=this.colorBase().clone();return this.built||(this.overlapsAny()&&(e=i.Color.Red),e.a=.8),this.hover&&(e.a=.5),e},Object.defineProperty(t.prototype,"connections",{get:function(){return this.structure.connections},enumerable:!0,configurable:!0}),t.prototype.findSlot=function(e,t){var n=this;void 0===t&&(t=this.connections);for(var r=[],o=function(o){var i=t[o],a=s.flip(o);i.map(function(t){return n.planet.closestBuildingByType(e,[t])}).forEach(function(e){e&&e.slots().filter(function(e){return e.facing===a}).forEach(function(e){r.push(e)})})},i=0,c=s.compass;i<c.length;i++)o(c[i]);if(r.length>0)return a.closest(e,r,function(e){return e.pos})},t.prototype.alignToSlot=function(e,t){void 0===t&&(t=this.connections);var n=this.findSlot(e,t);if(n){var r=this.slots().find(function(e){return e.facing==s.flip(n.facing)});if(r){var o=n.pos.sub(r.pos);return this.pos.addEqual(o),this.parentSlot=n,n}}},t.prototype.buildSlot=function(e,t,n){return void 0===n&&(n=s.Orientation.Right),{pos:new i.Vector(e,t),facing:n,parent:this}},t.prototype.addDevice=function(e){e.building!==this&&(e.building=this),this.devices.push(e),this.updateName()},t.prototype.hasPlaceForDevice=function(){return this.devices.length<this.devicePlaces().length},t.prototype.nextDevicePlace=function(){return this.devicePlaces()[this.devices.length]},t.prototype.getDevices=function(){return this.devices},t.prototype.updateName=function(){var e=this,t=u.allSpaceFunctions.find(function(t){var n=!0,r=e.devices.slice();return(new t).machines.forEach(function(e){var t=r.find(function(t){return t.machine instanceof e});t||(n=!1),r=a.deleteByValue(r,t)}),n});if(t){var n=new t;this.spaceFunction=n,this.nameLabel.text=n.name}},t}(i.Actor);t.Building=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(0);!function(e){e.Power="Power",e.Oxygen="Oxygen",e.Water="Water",e.Shelter="Shelter",e.Hope="Hope",e.Joy="Joy",e.Wisdom="Wisdom",e.Wealth="Wealth",e.Beauty="Beauty",e.Wonder="Wonder"}(r=t.PureValue||(t.PureValue={})),t.allValues=[r.Power,r.Oxygen,r.Water,r.Shelter,r.Hope,r.Wisdom,r.Wealth,r.Beauty,r.Wonder],t.emptyMarket=function(){return{Power:{supply:0,demand:0},Oxygen:{supply:0,demand:0},Water:{supply:0,demand:0},Shelter:{supply:0,demand:0},Hope:{supply:0,demand:0},Joy:{supply:0,demand:0},Wealth:{supply:0,demand:0},Wisdom:{supply:0,demand:0},Beauty:{supply:0,demand:0},Wonder:{supply:0,demand:0}}},t.availableCapacity=function(e,t){return Math.floor(e[t].supply-e[t].demand)},t.sumMarkets=function(e,t){var n={Power:{supply:0,demand:0},Oxygen:{supply:0,demand:0},Water:{supply:0,demand:0},Shelter:{supply:0,demand:0},Hope:{supply:0,demand:0},Joy:{supply:0,demand:0},Wealth:{supply:0,demand:0},Wisdom:{supply:0,demand:0},Beauty:{supply:0,demand:0},Wonder:{supply:0,demand:0}};for(var o in r){var i=e[o],s=i.supply,a=i.demand,c=t[o],u=s+c.supply,l=a+c.demand;n[o]={supply:u,demand:l}}return n},function(e){e.Biomass="Biomass",e.Ore="Ore",e.Data="Data",e.Meal="Meal",e.Idea="Idea",e.Mineral="Mineral",e.Bioplasma="Bioplasma",e.Alloy="Alloy",e.Algorithm="Algorithm",e.Argent="Argent",e.Aurum="Aurum"}(t.ResourceBlock||(t.ResourceBlock={}));var i={Biomass:o.Color.Green,Data:o.Color.Blue.lighten(.3),Mineral:o.Color.Red,Meal:o.Color.Yellow.darken(.3),Idea:o.Color.Blue.lighten(.6),Ore:o.Color.Red.darken(.3),Bioplasma:o.Color.Viridian,Alloy:o.Color.DarkGray.darken(.3),Algorithm:o.Color.Blue.darken(.3),Argent:o.Color.LightGray.lighten(.3),Aurum:o.Color.Orange.lighten(.3)};t.blockColor=function(e){return i[e].desaturate(.1)}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),a=n(0),c=n(1),u=n(57),l=n(2),p={bookshelf:n(56),vat:n(55),bench:n(54),stove:n(53),cabin:n(52),fire:n(51),bed:n(50),fridge:n(49),server:n(48),plant:n(47),workstation:n(46)},h=a.Color.Red,f=a.Color.Green,d=a.Color.Blue,y=a.Color.Orange,v=a.Color.Violet,m=a.Color.Yellow,g=u.mechanicalOperations.store,w=u.mechanicalOperations.generate,b=u.mechanicalOperations.recipe,_=u.mechanicalOperations.spawn,O=function(){function e(){this.name="(machine name)",this.description="(machine description)",this.color=a.Color.LightGray,this.size=c.DeviceSize.Small,this.operation={type:"noop"},this.image=p.vat,this.prereqs=[],this.economy=s.emptyMarket(),this.forDome=!1}return e.prototype.concretize=function(){return this},e}();t.Machine=O;var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Command Console",t.description="gather resources...",t.operation=g([s.ResourceBlock.Data,s.ResourceBlock.Ore]),t.image=p.bench,t.size=c.DeviceSize.Medium,t.economy=i({},s.emptyMarket(),{Power:{supply:1,demand:0},Oxygen:{supply:1,demand:0},Hope:{supply:1,demand:0}}),t}return o(t,e),t}(O);t.CommandCenter=P;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="O2 Extractor",t.description="breathe deep",t.image=p.vat,t.prereqs=[M,k],t.forDome=!0,t.economy=i({},s.emptyMarket(),{Oxygen:{supply:3,demand:0},Power:{supply:0,demand:1}}),t}return o(t,e),t}(O);t.OxygenExtractor=S;var k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Solar Cell",t.description="feel the warmth",t.forDome=!0,t.economy=i({},s.emptyMarket(),{Power:{supply:5,demand:0}}),t}return o(t,e),t}(O);t.SolarCell=k;var M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="H20 Condenser",t.description="have a drink",t.prereqs=[k],t.forDome=!0,t.economy=i({},s.emptyMarket(),{Water:{supply:4,demand:0},Power:{supply:0,demand:1}}),t}return o(t,e),t}(O);t.WaterCondensingMachine=M;var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.operation=b([s.ResourceBlock.Idea,s.ResourceBlock.Idea,s.ResourceBlock.Idea],s.ResourceBlock.Data),t}return o(t,e),t.prototype.concretize=function(){return new(l.shuffle([C,B])[0])},t}(O);t.StudyMachine=x;var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Desk",t.description="get to work",t.image=p.bench,t.prereqs=[S],t}return o(t,e),t.prototype.concretize=function(){return this},t}(x);t.Desk=B;var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Workstation",t.description="hackety hack",t.prereqs=[D],t.color=d,t.image=p.workstation,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return o(t,e),t.prototype.concretize=function(){return this},t}(x);t.Workstation=C;var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Shelf",t.description="brainstorm",t.operation=w(s.ResourceBlock.Idea),t.image=p.bookshelf,t.prereqs=[S,B],t.color=d,t}return o(t,e),t}(O);t.Bookshelf=D;var R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Fridge",t.description="store meals",t.operation=g([s.ResourceBlock.Meal],6),t.image=p.fridge,t.prereqs=[D],t.color=m,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return o(t,e),t}(O);t.Fridge=R;var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Stove",t.description="make a meal",t.operation=b([s.ResourceBlock.Biomass,s.ResourceBlock.Biomass],s.ResourceBlock.Meal),t.image=p.stove,t.prereqs=[D,R],t.color=m,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return o(t,e),t}(O);t.Stove=V;var j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Bed",t.description="sweet dreams",t.image=p.bed,t.prereqs=[S],t.color=y,t.economy=i({},s.emptyMarket(),{Shelter:{supply:2,demand:0}}),t}return o(t,e),t}(O);t.Bed=j;var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="House Plant",t.description="so nice",t.prereqs=[j],t.operation=w(s.ResourceBlock.Biomass),t.capacity=1,t.color=f,t.image=p.plant,t.economy=i({},s.emptyMarket(),{Oxygen:{supply:1,demand:0},Water:{supply:0,demand:.1}}),t}return o(t,e),t}(O);t.Houseplant=A;var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Metal Storage",t.description="contain minerals and alloys?",t.operation=g([s.ResourceBlock.Mineral,s.ResourceBlock.Alloy],8),t.prereqs=[D],t.color=h,t.size=c.DeviceSize.Medium,t}return o(t,e),t}(O);t.MetalStorage=L;var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Research Server",t.description="hold data",t.operation=g([s.ResourceBlock.Data,s.ResourceBlock.Algorithm],10),t.image=p.server,t.prereqs=[D],t.size=c.DeviceSize.Medium,t.color=d,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:4}}),t}return o(t,e),t}(O);t.ResearchServer=z;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Orchard",t.description="grow some food",t.operation=w(s.ResourceBlock.Biomass),t.size=c.DeviceSize.Medium,t.prereqs=[F],t.color=f,t.forDome=!0,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1},Water:{supply:0,demand:1},Oxygen:{supply:2,demand:0}}),t}return o(t,e),t}(O);t.Orchard=T;var W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Cabin",t.description="home on the plains",t.operation=b([s.ResourceBlock.Biomass,s.ResourceBlock.Biomass],s.ResourceBlock.Meal),t.image=p.cabin,t.prereqs=[T],t.size=c.DeviceSize.Medium,t.color=y,t.forDome=!0,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1},Water:{supply:0,demand:1},Shelter:{supply:4,demand:0}}),t}return o(t,e),t}(O);t.Cabin=W;var H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Arbor",t.description="arbor around the clock",t.operation=w(s.ResourceBlock.Biomass),t.prereqs=[T],t.size=c.DeviceSize.Medium,t.color=f,t.forDome=!0,t}return o(t,e),t}(O);t.Arbor=H;var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Algae Vat",t.description="where there is a will",t.operation=w(s.ResourceBlock.Biomass),t.prereqs=[S,D,R],t.size=c.DeviceSize.Medium,t.color=v,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:2}}),t}return o(t,e),t}(O);t.AlgaeVat=F;var E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Botany",t.description="plant lab",t.operation=w(s.ResourceBlock.Biomass),t.prereqs=[S,D],t.size=c.DeviceSize.Medium,t.color=f,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return o(t,e),t}(O);t.Botany=E;var q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Cloning Vat",t.description="we all grow",t.operation=_(),t.productionTime=1500,t.image=p.vat,t.prereqs=[F],t.size=c.DeviceSize.Medium,t.color=v,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:2}}),t}return o(t,e),t}(O);t.CloningVat=q;var I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Dissolution Vat",t.description="back to basics",t.operation=b([s.ResourceBlock.Biomass,s.ResourceBlock.Biomass],s.ResourceBlock.Bioplasma),t.productionTime=1500,t.image=p.vat,t.prereqs=[G],t.size=c.DeviceSize.Medium,t.color=v,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return o(t,e),t}(O);t.DissolutionVat=I;var G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Bioplasm Bank",t.description="hold on",t.operation=g([s.ResourceBlock.Bioplasma]),t.prereqs=[F],t.color=f,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return o(t,e),t}(O);t.PlasmaBank=G;var U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Fabricator",t.description="you made that",t.operation=b([s.ResourceBlock.Mineral,s.ResourceBlock.Mineral],s.ResourceBlock.Alloy),t.size=c.DeviceSize.Medium,t.color=h,t.prereqs=[C],t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:3}}),t}return o(t,e),t}(O);t.Fabricator=U;var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Refinery",t.description="wheat from the chaff",t.operation=b([s.ResourceBlock.Ore,s.ResourceBlock.Ore,s.ResourceBlock.Ore],s.ResourceBlock.Mineral),t.size=c.DeviceSize.Medium,t.color=h,t.prereqs=[C,U],t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:2}}),t}return o(t,e),t}(O);t.OreRefinery=N;var J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mining Drill",t.description="ore away",t.operation=w(s.ResourceBlock.Ore),t.size=c.DeviceSize.Large,t.prereqs=[U],t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:5}}),t}return o(t,e),t}(O);t.MiningDrill=J;var X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mega-Fabricator",t.size=c.DeviceSize.Large,t.prereqs=[U],t.color=h,t.operation=b([s.ResourceBlock.Alloy,s.ResourceBlock.Algorithm],s.ResourceBlock.Argent),t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:8}}),t}return o(t,e),t}(O);t.Megafabricator=X;var Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mainframe",t.size=c.DeviceSize.Large,t.color=d,t.prereqs=[z],t.operation=b([s.ResourceBlock.Data,s.ResourceBlock.Data],s.ResourceBlock.Algorithm),t.image=p.server,t.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:6}}),t}return o(t,e),t}(O);t.Mainframe=Y;var K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Preserve",t.size=c.DeviceSize.Large,t.prereqs=[H],t.color=f,t.forDome=!0,t.economy=i({},s.emptyMarket(),{Water:{supply:0,demand:4},Oxygen:{supply:12,demand:0}}),t}return o(t,e),t}(O);t.Preserve=K;var Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Microcity",t.size=c.DeviceSize.Huge,t.prereqs=[X],t.color=y,t.forDome=!0,t.economy=i({},s.emptyMarket(),{Water:{supply:0,demand:2},Power:{supply:0,demand:2},Joy:{supply:5,demand:0},Hope:{supply:5,demand:0},Beauty:{supply:1,demand:0},Wonder:{supply:1,demand:0}}),t}return o(t,e),t}(O);t.Microcity=Q;var Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Logic Crystal",t.size=c.DeviceSize.Huge,t.prereqs=[X],t.color=d,t}return o(t,e),t}(O);t.LogicCrystal=Z,t.allMachines=[F,H,j,D,W,q,B,U,R,A,X,J,T,S,K,z,k,V,M,C,Q,Z,E,N,G,I,L,Y]},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Left=0]="Left",e[e.Up=1]="Up",e[e.Right=2]="Right",e[e.Down=3]="Down"}(r=t.Orientation||(t.Orientation={})),t.compass=[r.Left,r.Right,r.Up,r.Down],t.flip=function(e){switch(e){case r.Left:return r.Right;case r.Right:return r.Left;case r.Up:return r.Down;case r.Down:return r.Up}throw new Error("Don't know orientation "+e)}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(11),a=n(7),c=n(6),u=n(1),l=s.Scale.major,p=s.Scale.minor,h=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Small}),f=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Medium}),d=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Large}),y=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Huge}),v=h.filter(function(e){return(new e).forDome}),m=h.filter(function(e){return!(new e).forDome}),g=f.filter(function(e){return(new e).forDome}),w=f.filter(function(e){return!(new e).forDome}),b=d.filter(function(e){return(new e).forDome}),_=d.filter(function(e){return!(new e).forDome}),O=y.filter(function(e){return(new e).forDome}),P=y.filter(function(e){return!(new e).forDome}),S=function(){var e;this.name="(structure name)",this.description="(structure description)",this.view="<structure (room) view>",this.width=10,this.height=10,this.zoom=1,this.color=i.Color.Gray,this.connections=((e={})[a.Orientation.Left]=[x],e[a.Orientation.Right]=[x],e[a.Orientation.Up]=[B],e[a.Orientation.Down]=[B],e),this.machines=[],this.prereqs=[]};t.Structure=S;var k=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Main Tunnel",n.description="Elevating",n.view="TunnelView",n.width=l.second,n.height=l.eighth,n.zoom=.25,n.connections=((t={})[a.Orientation.Left]=[x],t[a.Orientation.Right]=[x],t[a.Orientation.Up]=[q],t[a.Orientation.Down]=[],t),n}return o(t,e),t}(S);t.MainTunnel=k;var M=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Road",n.description="go for a walk",n.view="SurfaceRoadView",n.width=p.fifth,n.height=p.first,n.connections=((t={})[a.Orientation.Left]=[C,q],t[a.Orientation.Right]=[C,q],t[a.Orientation.Up]=[],t[a.Orientation.Down]=[],t),n}return o(t,e),t}(S);t.SurfaceRoad=M;var x=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Corridor",n.description="in the hallway",n.view="CorridorView",n.width=p.fifth,n.height=p.third,n.zoom=.5,n.connections=((t={})[a.Orientation.Left]=[k,D],t[a.Orientation.Right]=[k,D],t[a.Orientation.Up]=[],t[a.Orientation.Down]=[],t),n.prereqs=[M],n}return o(t,e),t}(S);t.Corridor=x;var B=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Ladder",n.description="connect vertically",n.view="LadderView",n.width=p.third,n.height=100+l.third,n.zoom=.5,n.connections=((t={})[a.Orientation.Up]=[D],t[a.Orientation.Down]=[D],t[a.Orientation.Left]=[],t[a.Orientation.Right]=[],t),n.prereqs=[x,V],n}return o(t,e),t}(S);t.Ladder=B;var C=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.description="Biome sweet biome",n.view="DomeView",n.width=2*l.eighth,n.height=l.eighth,n.zoom=.2,n.connections=((t={})[a.Orientation.Left]=[M],t[a.Orientation.Right]=[M],t[a.Orientation.Up]=[],t[a.Orientation.Down]=[],t),n.machines=[c.SolarCell,c.OxygenExtractor,c.WaterCondensingMachine],n}return o(t,e),t}(S),D=function(e){function t(){var n,r=null!==e&&e.apply(this,arguments)||this;return r.name="Commons",r.description="hallway cap",r.view="CommonAreaView",r.width=l.eighth,r.height=l.fifth,r.connections=((n={})[a.Orientation.Left]=[x,t],n[a.Orientation.Right]=[x,t],n[a.Orientation.Up]=[B],n[a.Orientation.Down]=[B],n),r.machines=[],r.prereqs=[],r}return o(t,e),t}(S),R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Room (2)",t.width=l.eighth,t.prereqs=[T],t.machines=m,t}return o(t,e),t}(D);t.SmallRoomTwo=R;var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Room (3)",t.prereqs=[R],t.view="SmallRoomThreeView",t.width=2*l.eighth,t.machines=m,t}return o(t,e),t}(D);t.SmallRoomThree=V;var j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mid Room",t.prereqs=[V],t.view="MediumRoomView",t.width=2*l.eighth,t.height=2*l.third,t.machines=w,t}return o(t,e),t}(D);t.MediumRoom=j;var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mid Room (3)",t.prereqs=[j],t.view="MediumRoomThreeView",t.width=3*l.eighth,t.height=2*l.third,t.machines=w,t}return o(t,e),t}(D);t.MediumRoomThree=A;var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Lg. Room",t.view="LargeRoomView",t.prereqs=[j],t.width=4*l.eighth,t.height=3*l.fifth,t.machines=_,t}return o(t,e),t}(D);t.LargeRoom=L;var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Huge Room",t.view="HugeRoomView",t.width=10*l.eighth,t.height=8*l.eighth,t.prereqs=[L],t.machines=P,t}return o(t,e),t}(D);t.HugeRoom=z;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Dome",t.width=3*l.eighth,t.height=2*l.eighth,t.machines=v,t}return o(t,e),t}(C);t.SmallDome=T;var W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Dome (3)",t.view="SmallDomeThreeView",t.width=4*l.seventh,t.height=3*l.seventh,t.machines=v,t}return o(t,e),t}(C);t.SmallDomeThree=W;var H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mid Dome",t.view="MidDomeView",t.width=6*l.eighth,t.height=5*l.eighth,t.prereqs=[T,j],t.machines=g,t}return o(t,e),t}(C);t.MidDome=H;var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Lg. Dome",t.view="BigDomeView",t.width=8*l.eighth,t.height=6*l.eighth,t.prereqs=[H,L],t.machines=b,t}return o(t,e),t}(C);t.LargeDome=F;var E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Arcology",t.view="ArcologyView",t.width=12*l.eighth,t.height=36*l.eighth,t.prereqs=[F,z],t.machines=O,t}return o(t,e),t}(C);t.Arcology=E;var q=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Mission Control",n.description="Keeping everything on track",n.view="MissionControlView",n.width=6*l.eighth,n.height=1*l.sixth,n.zoom=.1,n.connections=((t={})[a.Orientation.Left]=[M],t[a.Orientation.Right]=[M],t[a.Orientation.Up]=[k],t[a.Orientation.Down]=[k],t),n.machines=[c.CommandCenter],n}return o(t,e),t}(S);t.MissionControl=q,t.allStructures=[T,W,H,F,E,R,V,j,A,L,z]},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),s=n(0),a=function(){this.name="(generic)",this.description="(generic description)",this.machines=[],this.color=s.Color.Gray,this.prereqs=[]};t.SpaceFunction=a;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Living Quarters",t.description="good night",t.machines=[i.Bed],t}return o(t,e),t}(a);t.LivingQuarters=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Barracks",t.description="sleep tight",t.machines=[i.Bed,i.Bed,i.Bed],t}return o(t,e),t}(a),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Kitchen",t.description="stay together",t.machines=[i.Stove,i.Fridge],t}return o(t,e),t}(a);t.Kitchen=l;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Life Support",t.description="keep it going",t.machines=[i.OxygenExtractor,i.WaterCondensingMachine],t}return o(t,e),t}(a);t.LifeSupportPod=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Retreat",t.description="take it easy",t.machines=[i.Cabin,i.Cabin],t}return o(t,e),t}(a),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Clone Matrix",t.description="clone home",t.machines=[i.CloningVat,i.CloningVat],t}return o(t,e),t}(a);t.CloneMatrix=f;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Reading Room",t.description="butterflies in the sky",t.machines=[i.Bookshelf,i.Bookshelf],t}return o(t,e),t}(a),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Library",t.description="take a look",t.machines=[i.Bookshelf,i.Bookshelf,i.Bookshelf],t}return o(t,e),t}(a);t.Library=y;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Study",t.description="plan it out",t.machines=[i.StudyMachine,i.Bookshelf],t}return o(t,e),t}(a),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Lab",t.description="make it happen",t.machines=[i.Workstation,i.Workstation,i.Workstation],t}return o(t,e),t}(a),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Archive",t.description="write it down",t.machines=[i.ResearchServer,i.ResearchServer],t}return o(t,e),t}(a);t.Archive=g;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Arboretum",t.description="walk it out",t.machines=[i.Arbor,i.Arbor],t}return o(t,e),t}(a),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Algae Farm",t.description="make do",t.machines=[i.AlgaeVat,i.AlgaeVat],t}return o(t,e),t}(a),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Solar Array",t.description="warm up",t.machines=[i.SolarCell,i.SolarCell],t}return o(t,e),t}(a),O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Workshop",t.description="take form",t.machines=[i.Fabricator,i.Fabricator],t}return o(t,e),t}(a),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Nursery",t.description="quiet please",t.machines=[i.Houseplant,i.Houseplant,i.Houseplant],t}return o(t,e),t}(a),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Farm",t.description="food for the masses",t.machines=[i.Orchard,i.Orchard],t}return o(t,e),t}(a),k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Factory",t.description="production lines",t.machines=[i.Megafabricator,i.Megafabricator],t}return o(t,e),t}(a),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Computer Core",t.description="let us calculate",t.machines=[i.Mainframe,i.Mainframe],t}return o(t,e),t}(a);t.ComputerCore=M,t.allSpaceFunctions=[y,u,p,f,c,l,b,g,w,_,h,v,O,d,P,S,k,m,M]},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),c=n(5),u=n(8),l=n(1),p=n(2);t.retrieveResource=function(e){return{type:"retrieve",resource:e}};var h=function(e){function t(t,n){var r=e.call(this,n.x,n.y,l.getVisibleDeviceSize(t.size),l.getVisibleDeviceSize(t.size),t.color)||this;return r.machine=t,r.product=[],r.inUse=!1,r.imageLoaded=!1,r.nameLabel=new a.Label(r.machine.name,0,0,"Helvetica"),r.nameLabel.fontSize=6,r.nameLabel.color=a.Color.White,r.image=new Image,r.image.onload=function(){r.imageLoaded=!0},r.image.src=t.image,r}return o(t,e),Object.defineProperty(t.prototype,"imageX",{get:function(){return this.pos.x-this.getWidth()/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageY",{get:function(){return this.pos.y-this.getHeight()/2-10},enumerable:!0,configurable:!0}),t.prototype.draw=function(e,t){this.imageLoaded&&e.drawImage(this.image,this.imageX,this.imageY,this.getWidth(),this.getHeight());var n=new a.Vector(this.imageX,this.imageY);this.nameLabel.pos=n,this.nameLabel.draw(e,t);var r=n.x,o=n.y,i=this.nameLabel.fontSize;this.product.forEach(function(t,n){e.fillStyle=c.blockColor(t).toRGBA(),e.fillRect(r+5*n,o-5+i,4,4)})},Object.defineProperty(t.prototype,"operation",{get:function(){return this.machine.operation},enumerable:!0,configurable:!0}),t.prototype.interact=function(e,t){return i(this,void 0,void 0,function(){var n,r,o,i,a;return s(this,function(s){switch(s.label){case 0:return this.inUse?[2,!1]:(n=!1,"recipe"!==(r=this.operation).type||"work"!==t.type?[3,5]:(o=r,e.carrying.some(function(e){return o.consumes.includes(e)})?(this.inUse=!0,e.isCarryingUnique(o.consumes)?(o.consumes.forEach(function(t){return e.drop(t)}),[4,e.progressBar(o.workTime)]):[3,2]):[3,4]));case 1:return s.sent(),e.carry(o.produces),n=!0,[3,3];case 2:console.warn("not carrying all requirements?",{requires:o.consumes,has:e.carrying}),s.label=3;case 3:this.inUse=!1,s.label=4;case 4:return[3,13];case 5:return"store"!==r.type?[3,10]:(i=r,t&&"retrieve"===t.type?(this.inUse=!0,(n=this.dispense(e,t))?[4,e.progressBar(500)]:[3,7]):[3,8]);case 6:s.sent(),s.label=7;case 7:return this.inUse=!1,[3,9];case 8:t&&"store"===t.type&&e.carrying.some(function(e){return i.stores.includes(e)})&&(this.product.length<i.capacity?(a=null,i.stores.some(function(t){return a=e.drop(t)})&&a&&(this.product.push(a),this.building.redeem(a),n=!0)):(console.warn("no capacity in this store!!"),n=!1)),s.label=9;case 9:return[3,13];case 10:return"generator"!==r.type?[3,13]:(this.inUse=!0,(n=this.dispense(e,t))?[4,e.progressBar(500)]:[3,12]);case 11:s.sent(),s.label=12;case 12:this.inUse=!1,s.label=13;case 13:return[2,n]}})})},t.prototype.dispense=function(e,t){return!(!t||"retrieve"!==t.type||!this.product.find(function(e){return e===t.resource}))&&(p.deleteByValueOnce(this.product,t.resource),e.carry(t.resource),!0)},t.prototype.produce=function(e){var t=this;"generator"===this.machine.operation.type?e%this.machine.operation.generationTime==0&&this.product.length<this.machine.operation.capacity&&this.product.push(this.machine.operation.generates):"spawn"===this.machine.operation.type&&setTimeout(function(){return t.building.populate(t.pos)},100)},t.prototype.snap=function(e,t){var n=this;void 0===t&&(t=this.pos);var r=e.colony.closestBuildingByType(t,u.allStructures,function(e){return e.hasPlaceForDevice()&&e.structure.machines.some(function(e){return n.machine instanceof e})}),o=!1;return r&&(o=r.nextDevicePlace().position.distance(t)<150),o?(this.building=r,this.pos=this.building.nextDevicePlace().position):this.pos=t,o;//!!bldg;
},t}(a.Actor);t.Device=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Scale={major:{first:16,second:32,third:48,fourth:64,fifth:80,sixth:96,seventh:112,eighth:128},minor:{first:4,second:8,third:12,fourth:16,fifth:20,sixth:24,seventh:28,eighth:32}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(){this.empty=!0,this.nodes=[],this.edges={},this.edgesInverse={}}return e.prototype.isEmpty=function(){return this.empty},Object.defineProperty(e.prototype,"size",{get:function(){return this.nodes.length},enumerable:!0,configurable:!0}),e.prototype.node=function(e){this.empty=!1,this.contains(e)||this.nodes.push(e)},e.prototype.contains=function(e){return this.nodes.includes(e)},e.prototype.findOrCreate=function(e,t,n){void 0===n&&(n=5);var o=this.dfs(),i=r.minBy(o,function(n){return t(e,n)});return i&&t(i,e)<n?i:e},e.prototype.edge=function(e,t){this.node(e),this.node(t);var n=this.indexOf(e),r=this.indexOf(t);this.edges[n]=this.edges[n]||[],this.edges[n].push(r),this.edgesInverse[r]=this.edgesInverse[r]||[],this.edgesInverse[r].push(n)},e.prototype.union=function(e){var t=this;e.edgeList().forEach(function(e){var n=e[0],r=e[1];return t.edge(n,r)})},e.prototype.edgeList=function(){for(var e=[],t=0,n=this.nodes;t<n.length;t++){var r=n[t],o=this.indexOf(r);if(this.edges[o])for(var i=0,s=this.edges[o];i<s.length;i++){var a=s[i],c=this.nodes[a];e.includes([c,r])||e.push([r,c])}}return e},e.prototype.adjacent=function(e){var t=this,n=this.indexOf(e);return this.adjacentIndices(n).map(function(e){return t.nodes[e]})},e.prototype.adjacentIndices=function(e){var t=this.edges[e]||[],n=this.edgesInverse[e]||[];return t.concat(n)},e.prototype.dfs=function(e,t){var n=this;void 0===e&&(e=null),void 0===t&&(t=[]);var r=e?this.indexOf(e):0;return this.dfsIndex(r).map(function(e){return n.nodes[e]})},e.prototype.dfsIndex=function(e,t){var n=this;return void 0===e&&(e=0),void 0===t&&(t=[]),t.push(e),this.adjacentIndices(e).forEach(function(e){t.includes(e)||n.dfsIndex(e,t)}),t},e.prototype.bfs=function(e,t){var n=this;void 0===e&&(e=null),void 0===t&&(t=function(){return!0});var r=e?this.indexOf(e):0;return this.bfsIndex(r,t).map(function(e){return n.nodes[e]})},e.prototype.bfsIndex=function(e,t){void 0===e&&(e=null),void 0===t&&(t=function(){return!0});var n=!1,r=[];for(r.push(e);r.length<this.nodes.length;){for(var o=0,i=r;o<i.length;o++){for(var s=i[o],a=0,c=this.adjacentIndices(s);a<c.length;a++){var u=c[a];if(!r.includes(u)){if(!t(s,u)){n=!0;break}r.push(u)}}if(n)break}if(n)break}return r},e.prototype.shortestPath=function(e,t,n){var r=this;void 0===n&&(n=256);var o={},i=this.indexOf(t);this.bfs(e,function(e,t){return o[t]=e,t!==i});for(var s=[],a=i,c=0,u=this.indexOf(e);!s.includes(u)&&c<n;)s.push(a),a=o[a],c+=1;return s.map(function(e){return r.nodes[e]}).reverse()},e.prototype.indexOf=function(e){return this.nodes.indexOf(e)},e}();t.Graph=o},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(64),a=function(e){function t(t){var n=e.call(this,{width:800,height:600,displayMode:i.DisplayMode.FullScreen,backgroundColor:t.skyColor})||this;return n.world=t,n}return o(t,e),t.prototype.start=function(){var t=new i.Loader;for(var n in s.Resources)t.addResource(s.Resources[n]);return e.prototype.start.call(this,t)},t.citizenSpeed=100,t}(i.Engine);t.Game=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r,o,i){void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=!0),this.x=e,this.y=t,this.all=n,this.onButtonClick=r,this.onButtonEnter=o,this.comprehend=i,this.built=[],this.comprehended=[],this.makePalette()}return e.prototype.draw=function(e){if(this._element){var t=e.canvas.offsetLeft,n=e.canvas.offsetTop;this._element.style.left=t+this.x+"px",this._element.style.top=n+this.y+"px"}},e.prototype.updateBuilt=function(e){var t=this;this.built=e,this.comprehend?this.comprehended=this.all.filter(function(e){return(new e).prereqs.every(function(e){return t.built.some(function(t){return t===e})})}):this.comprehended=this.built,this.makePalette()},e.prototype.makePalette=function(){var e=this;this._element&&this._element.parentElement.removeChild(this._element),this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.border="1px solid white",document.body.appendChild(this._element),this.comprehended.map(function(e){return new e}).sort(function(e,t){return e.color>t.color?-1:1}).forEach(function(t){var n=t.name;e.built.map(function(e){return(new e).name}).includes(t.name)||(n+=" *");var r=t.color,o=e.buttonFactory(n,r);e._element.appendChild(o),e.onButtonEnter&&(o.onmouseenter=function(){e.onButtonEnter(t)}),e.onButtonClick&&(o.onclick=function(){e.onButtonClick(t)})})},e.prototype.buttonFactory=function(e,t){var n=t.darken(.6).desaturate(.5).clone();n.a=.8;var r=t.lighten(.8).desaturate(.4).clone(),o=document.createElement("button");return o.textContent=e,o.style.display="block",o.style.fontSize="9pt",o.style.fontFamily="Helvetica",o.style.fontWeight="600",o.style.padding="2px",o.style.width="160px",o.style.textTransform="uppercase",o.style.border="1px solid rgba(255,255,255,0.08)",o.style.background=n.toRGBA(),o.style.color=r.toRGBA(),o.onmouseover=function(){o.style.background=n.saturate(.5).lighten(.95).toRGBA(),o.style.color=r.lighten(.9).toRGBA()},o.onmouseleave=function(){o.style.background=n.toRGBA(),o.style.color=r.toRGBA()},o},e}();t.Palette=r},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(6),a=n(5),c=function(e){function t(t,n,r){var o=e.call(this,n,r,0,0)||this;return o.entity=t,o.values=new i.Label(""),o.values.fontSize=10,o.add(o.values),o.notes=new i.Label("behavioral notes",0,30),o.notes.fontSize=11,o.add(o.notes),o.description=new i.Label("description",0,60),o.description.fontSize=12,o.description.fontStyle=i.FontStyle.Italic,o.add(o.description),o.show(t),o}return o(t,e),t.prototype.show=function(e){if(e)if(this.description.text=e.description,e instanceof s.Machine){var t=[],n=e.economy;for(var r in a.PureValue){var o=n[r],i=o.supply-o.demand;i>0?t.push("+"+i+" "+r):i<0&&t.push(i+" "+r)}this.values.text=t.join(" | "),this.notes.text="";var c=e.operation;c&&("recipe"===c.type?this.notes.text="Turns "+c.consumes.join(" + ")+" -> "+c.produces+".":"generator"===c.type?this.notes.text="Generates "+c.generates+".":"store"===c.type?this.notes.text="Stores "+c.stores.join(" + "):"spawn"===c.type&&(this.notes.text="Decants clones."))}else this.values.text="",this.notes.text=""},t}(i.Actor);t.CardBody=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(8),a=n(6),c=n(1),u=n(9),l=n(3),p=function(e){function t(t,n,r){var o=e.call(this,n,r,14,32,t&&t.color||i.Color.Gray)||this;return o.entity=t,o.name=new i.Label(t&&t.name||"..",20,16),o.name.fontSize=28,o.name.color=i.Color.Black,o.add(o.name),o.type=new i.Label("..",232,16),o.type.fontSize=10,o.type.color=i.Color.Gray,o.type.fontStyle=i.FontStyle.Italic,o.add(o.type),t&&o.announce(t),o}return o(t,e),t.prototype.announce=function(e){this.name.text=e.name,this.color=e.color.desaturate(.5).darken(.2),e instanceof a.Machine&&(this.type.text=c.DeviceSize[e.size]+" Machine"),e instanceof s.Structure&&(this.type.text="Structure"),e instanceof u.SpaceFunction&&(this.type.text="Function"),e instanceof l.Building&&(this.type.text="Building")},t}(i.Actor);t.CardTitle=p},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(6),a=n(16),c=n(15),u=function(e){function t(t,n,r){var o=e.call(this,n+160,r+90,320,180,i.Color.White)||this;return o.entity=t,o.title=new a.CardTitle(t,-153,-50),o.add(o.title),o.cardBody=new c.CardBody(t,-136,-10),o.add(o.cardBody),o.image=new Image,o}return o(t,e),t.prototype.draw=function(t,n){if(e.prototype.draw.call(this,t,n),this.entity&&this.entity instanceof s.Machine){var r=this.pos.x+48,o=this.pos.y-16;t.drawImage(this.image,r,o,92,92)}},t.prototype.present=function(e){this.title.announce(e),this.cardBody.show(e),this.entity=e,this.entity instanceof s.Machine&&(this.image.src=this.entity.image)},t}(i.Actor);t.Card=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=function(e){function t(t,n,r){var o=e.call(this,n,r,0,0)||this;return o.nameLabel=new i.Label(t,n,r),o.nameLabel.fontSize=10,o.nameLabel.color=i.Color.White.darken(.2),o.add(o.nameLabel),o.valueLabel=new i.Label("0",n+40,r),o.valueLabel.fontSize=10,o.valueLabel.color=i.Color.White.darken(.2),o.add(o.valueLabel),o}return o(t,e),t.prototype.setCount=function(e){this.valueLabel.text=""+e;var t=i.Color.Gray;e>0?t=i.Color.Green:e<0&&(t=i.Color.Red),this.valueLabel.color=t},t}(i.Actor);t.EconomicValue=s},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(5),a=n(18),c=function(e){function t(t,n,r){var o=e.call(this,n,r,0,0)||this;o.valueLabels={Power:null,Oxygen:null,Water:null,Shelter:null,Hope:null,Joy:null,Wisdom:null,Wealth:null,Beauty:null,Wonder:null};for(var i=0,c=0,u=s.allValues;c<u.length;c++){var l=u[c],p=new a.EconomicValue(l,34*i++,0);o.valueLabels[l]=p,o.add(p)}return o.updateView(t),o}return o(t,e),t.prototype.updateView=function(e){for(var t=e,n=0,r=s.allValues;n<r.length;n++){var o=r[n];this.valueLabels[o].setCount(s.availableCapacity(t,o))}},t}(i.Actor);t.EconomyView=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(5),a=function(e){function t(t,n,r,o){var a=e.call(this,t,n,10,10)||this;a.value=o;var c=new i.Actor(t,n,10,10,s.blockColor(r));return a.add(c),a.count=new i.Label("x"+o,t+10,n+6,"Helvetica"),a.count.fontSize=10,a.count.color=i.Color.White,a.add(a.count),a}return o(t,e),t.prototype.credit=function(e){this.value+=e,this.count.text="x"+this.value},t}(i.Actor);t.ResourceListEntry=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(5),a=n(20),c=function(e){function t(t,n){var r,o=e.call(this,t,n,0,0,i.Color.DarkGray.darken(.8))||this;return o.entries=((r={})[s.ResourceBlock.Biomass]=null,r[s.ResourceBlock.Idea]=null,r[s.ResourceBlock.Ore]=null,r[s.ResourceBlock.Meal]=null,r[s.ResourceBlock.Mineral]=null,r[s.ResourceBlock.Data]=null,r[s.ResourceBlock.Alloy]=null,r[s.ResourceBlock.Bioplasma]=null,r[s.ResourceBlock.Algorithm]=null,r[s.ResourceBlock.Argent]=null,r[s.ResourceBlock.Aurum]=null,r),[s.ResourceBlock.Meal,s.ResourceBlock.Data,s.ResourceBlock.Mineral,s.ResourceBlock.Bioplasma,s.ResourceBlock.Alloy,s.ResourceBlock.Algorithm].forEach(function(e,t){var n=0+16*t,r=0*t-2.5,i=new a.ResourceListEntry(n,r,e,0);o.add(i),o.entries[e]=i}),o}return o(t,e),t.prototype.increment=function(e){var t=this.entries[e];t&&t.credit(1)},t}(i.Actor);t.ResourcesList=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(21),a=n(19),c=function(e){function t(t,n,r){void 0===n&&(n=1e4),void 0===r&&(r=36);var o=e.call(this,0,0,n,r,i.Color.DarkGray.darken(.8))||this,c=new i.Label("OSIRIS",5,16);c.fontSize=12,c.color=i.Color.Gray,c.fontStyle=i.FontStyle.Italic,o.add(c);var u=new i.Label("v0.0.1",48,16);return u.fontSize=7,u.color=i.Color.Gray.darken(.4),o.add(u),o.resources=new s.ResourcesList(80,14),o.add(o.resources),o.economy=new a.EconomyView(t,300,14),o.add(o.economy),o.popLabel=new i.Label("",900,14,"Helvetica"),o.popLabel.fontSize=10,o.popLabel.color=i.Color.White,o.add(o.popLabel),o.messageLabel=new i.Label("hi",1e3,14,"Helvetica"),o.messageLabel.fontSize=10,o.messageLabel.color=i.Color.White,o.messageLabel.fontStyle=i.FontStyle.Italic,o.add(o.messageLabel),o}return o(t,e),t.prototype.incrementResource=function(e){this.resources.increment(e)},t.prototype.setMessage=function(e){this.messageLabel.text=e},t.prototype.showEconomy=function(e){this.economy.updateView(e)},t.prototype.showPopCap=function(e,t){this.popLabel.text="Pop: "+e+"/"+t},t}(i.Actor);t.StatusAnalysisView=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(8),a=n(5),c=n(6),u=n(2),l=n(22),p=n(17),h=n(9),f=n(14),d=function(e){function t(n,r,o,i){void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=null);var s=e.call(this,0,0,n.canvasWidth,n.canvasHeight)||this;s.game=n,s.onBuildingSelect=r,s.onMachineSelect=o,s.onFunctionSelect=i,s.status=new l.StatusAnalysisView(a.emptyMarket()),s.add(s.status);var u=function(e){return s.showCard(e)};return s.structurePalette=new f.Palette(20,35,t.structuresForPalette,r,u),s.machinePalette=new f.Palette(20,300,c.allMachines,o,u),s.functionPalette=new f.Palette(220,35,t.functionsForPalette,i,u,!1),s.card=new p.Card(null,20,800),s.add(s.card),s}return o(t,e),t.prototype.setMessage=function(e){this.status.setMessage(e)},t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.structurePalette.draw(t),this.machinePalette.draw(t),this.functionPalette.draw(t)},t.prototype.resourceGathered=function(e){this.status.incrementResource(e)},t.prototype.updateDetails=function(e,t){void 0===t&&(t=!0),t&&this.updatePalettes(e.colony),this.updateEconomy(e),this.updateMaxPop(e.economy[a.PureValue.Shelter].demand,e.maxPop)},t.prototype.showCard=function(e){this.card.present(e)},t.prototype.updateMaxPop=function(e,t){this.status.showPopCap(e,t)},t.prototype.updateEconomy=function(e){this.status.showEconomy(e.economy)},t.prototype.updatePalettes=function(e){this.updateBuildingPalette(e),this.updateMachinePalette(e),this.updateFunctionPalette(e)},t.prototype.updateBuildingPalette=function(e){var n=t.structuresForPalette.filter(function(t){return e.buildings.some(function(e){return e.structure instanceof t})});this.structurePalette.updateBuilt(n)},t.prototype.updateMachinePalette=function(e){var n=e.findAllDevices(),r=t.machinesForPalette.filter(function(e){return n.some(function(t){return t.machine instanceof e})});this.machinePalette.updateBuilt(r)},t.prototype.updateFunctionPalette=function(e){var n=u.flatSingle(e.buildings.map(function(e){return e.spaceFunction})),r=t.functionsForPalette.filter(function(e){return n.some(function(t){return t instanceof e})});this.functionPalette.updateBuilt(r)},t.structuresForPalette=[s.SurfaceRoad,s.Corridor,s.Ladder].concat(s.allStructures),t.machinesForPalette=c.allMachines,t.functionsForPalette=h.allSpaceFunctions,t}(i.UIActor);t.Hud=d},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(1),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=s.DeviceSize.Medium,t.devicePlaceCount=3,t}return o(t,e),t}(i.CommonAreaView);t.MediumRoomThreeView=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(4),c=n(1),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=c.DeviceSize.Huge,t}return o(t,e),t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-this.floorHeight-c.getVisibleDeviceSize(c.DeviceSize.Huge)/2;return[new s.Vector(t-e/3,n),new s.Vector(t+e/3,n)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Huge)})},t}(i.CommonAreaView);t.HugeRoomView=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(4),c=n(1),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=c.DeviceSize.Large,t}return o(t,e),t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-c.getVisibleDeviceSize(c.DeviceSize.Large)/2;return[new s.Vector(t-e/3,n),new s.Vector(t+e/3,n)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Large)})},t}(i.CommonAreaView);t.LargeRoomView=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(1),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=s.DeviceSize.Medium,t.devicePlaceCount=2,t}return o(t,e),t}(i.CommonAreaView);t.MediumRoomView=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceCount=3,t}return o(t,e),t}(n(3).CommonAreaView);t.SmallRoomThreeView=i},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),s=n(4),a=n(0),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-20;return[new a.Vector(t-e/3,n),new a.Vector(t+e/3,n)].map(function(e){return new s.DevicePlace(e,i.DeviceSize.Large)})},t}(n(3).DomeView);t.BigDomeView=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(4),c=n(1),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-20;return[new s.Vector(t-e/3,n),new s.Vector(t+e/3,n)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Medium)})},t}(i.DomeView);t.MidDomeView=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(4),c=n(1),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-6;return[new s.Vector(t-e/3,n),new s.Vector(t,n),new s.Vector(t+e/3,n)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Small)})},t}(i.DomeView);t.SmallDomeThreeView=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.colorBase=function(){return this.color.lighten(.1)},t}(n(3).CorridorView);t.SurfaceRoadView=i},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(7),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.originSlot=null,t}return o(t,e),t.prototype.constrainCursor=function(e){return this.pickingOrigin||(e.x=this.pos.x),e},t.prototype.reshape=function(e){if(this.pickingOrigin){var t=this.alignToSlot(e);t&&(this.facing=t.facing,t&&(this.originSlot=t))}else if(this.facing===s.Orientation.Up){var n=this.originSlot.pos.y-this.planet.getTop()-25,r=Math.min(n,Math.max(100,this.originSlot.pos.y-e.y));this.setHeight(r/50*50),this.pos.y=this.originSlot.pos.y-this.getHeight()}else r=Math.max(100,e.y-this.originSlot.pos.y),this.setHeight(r/50*50)},t}(i.TunnelView);t.LadderView=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(4),c=n(1),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.devicePlaces=function(){var e=3*this.getWidth()/5,t=this.pos.x+e,n=this.pos.y+this.getHeight()/2;return[new s.Vector(t,n-800),new s.Vector(t,n),new s.Vector(t,n+800)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Huge)})},t.prototype.draw=function(e,t){this.drawShape(e,this.pos.x,this.pos.y),this.getDevices().forEach(function(n){return n.draw(e,t)})},t.prototype.drawShape=function(e,t,n){var r=this.getHeight(),o=this.getWidth();e.beginPath(),e.moveTo(0+t,r+n),e.bezierCurveTo(1+t,r-150+n,121+t,70+n,o-80+t,8+n),e.bezierCurveTo(o-40+t,2+n,o-5+t,11+n,o-10+t,25+n),e.bezierCurveTo(o-5+t,10+n,o+t,r-10+n,o+t,r+n),e.lineTo(0+t,r+n),e.fillStyle=this.mainColor().toRGBA(),e.fill()},t}(i.DomeView);t.ArcologyView=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(4),a=n(2),c=n(7),u=n(12),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pickingOrigin=!0,t.hideBox=!0,t}return o(t,e),t.prototype.colorBase=function(){return this.color.darken(.2)},t.prototype.draw=function(t,n){var r=this.aabb();a.drawRect(t,r,0,this.color.darken(.1)),r.x=r.x+this.getWidth()/5,r.width-=this.getWidth()/5*2,a.drawRect(t,r,0,this.color.darken(.2)),e.prototype.draw.call(this,t,n)},t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y;return[new i.Vector(Math.floor(e),t)]},t.prototype.graph=function(e){void 0===e&&(e=new u.Graph);var t=e,n=this.getWidth()/2,r=this.pos.x+n,o=t.findOrCreate(this.nodes()[0],a.measureDistance),s=t.findOrCreate(new i.Vector(r,this.slotHeights()[0]),a.measureDistance);t.edge(o,s);var c=this.slotHeights();a.eachCons(c,2).forEach(function(e){var n=e[0],o=e[1],s=t.findOrCreate(new i.Vector(r,n),a.measureDistance),c=t.findOrCreate(new i.Vector(r,o),a.measureDistance);t.edge(s,c)});var l=t.findOrCreate(new i.Vector(r,this.pos.y+this.getHeight()),a.measureDistance),p=t.findOrCreate(new i.Vector(r,c[c.length-1]),a.measureDistance);t.edge(l,p),c.forEach(function(e){var o=t.findOrCreate(new i.Vector(r,e),a.measureDistance),s=t.findOrCreate(new i.Vector(r-n,e),a.measureDistance);t.edge(s,o);var c=t.findOrCreate(new i.Vector(r+n,e),a.measureDistance);t.edge(o,c)});for(var h=0,f=this.childrenBuildings;h<f.length;h++){var d=f[h],y=t.findOrCreate(d.parentSlot.pos,a.measureDistance),v=t.findOrCreate(d.nodes()[0],a.measureDistance);t.edge(v,y),t.edge(y,v),d.graph(t)}return t},t.prototype.slotHeights=function(){for(var e=Math.floor(this.getHeight()/50),t=[],n=0,r=a.range(e);n<r.length;n++){var o=r[n];t.push(50+this.pos.y+50*o)}return t},t.prototype.slots=function(){var e=[];e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,c.Orientation.Up));for(var t=0,n=this.slotHeights();t<n.length;t++){var r=n[t];e.push(this.buildSlot(this.pos.x,r,c.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth(),r,c.Orientation.Right))}return e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),c.Orientation.Down)),e},t.prototype.handleClick=function(e){return!this.pickingOrigin||(this.pickingOrigin=!1,!1)},t.prototype.constrainCursor=function(e){return this.pickingOrigin?this.alignToSlot(e):e.y=Math.max(this.planet.getTop()+100,e.y),e},t.prototype.reshape=function(e){this.pos.y=this.planet.getTop()+2,this.pickingOrigin||this.setHeight(e.y-this.planet.getTop())},t}(s.Building);t.TunnelView=l},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(4),a=n(7),c=n(10),u=n(1),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hideBox=!0,t}return o(t,e),t.prototype.devicePlaces=function(){return this.nodes().map(function(e){return e.y-=20,new s.DevicePlace(e,u.DeviceSize.Medium)})},t.prototype.afterConstruct=function(){var e=this,t=this.structure.machines;if(t&&t.length>0){var n=new t[0];this.devicePlaces().forEach(function(t){var r=new c.Device(n,t.position);e.addDevice(r)})}},t.prototype.slots=function(){var e=[];e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),a.Orientation.Down));var t=this.getHeight();return e.push(this.buildSlot(this.pos.x,this.pos.y+t,a.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+t,a.Orientation.Right)),e},t.prototype.constrainCursor=function(e){return e.y=this.planet.getTop(),e},t.prototype.reshape=function(e){this.pos=e,this.pos.y-=this.getHeight()-2},t.prototype.draw=function(t,n){var r=this.mainColor();t.fillStyle=r.toRGBA(),t.fillRect(this.pos.x,this.pos.y,this.getWidth(),this.getHeight());var o=this.pos.x+this.getWidth()/4*3,i=this.pos.y-18;t.fillRect(o,i,2,18),t.fillRect(o,i,10,5),e.prototype.draw.call(this,t,n)},t.prototype.colorBase=function(){return i.Color.White},t}(s.Building);t.MissionControlView=l},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(4),a=n(7),c=n(1),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hideBox=!0,t.showLabel=!0,t}return o(t,e),t.prototype.slots=function(){var e=[],t=this.getHeight();return e.push(this.buildSlot(this.pos.x,this.pos.y+t,a.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+t,a.Orientation.Right)),e},t.prototype.reshape=function(e){this.alignToSlot(e)},t.prototype.draw=function(t,n){var r=this.mainColor();t.beginPath(),t.arc(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),this.getHeight()/1.5,0,Math.PI,!0),t.closePath(),t.fillStyle=r.toRGBA(),t.fill(),e.prototype.draw.call(this,t,n)},t.prototype.colorBase=function(){return i.Color.White.darken(.05)},t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-6;return[new i.Vector(t-e/3,n),new i.Vector(t+e/3,n)].map(function(e){return new s.DevicePlace(e,c.DeviceSize.Small)})},t}(s.Building);t.DomeView=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),s=n(7),a=n(0),c=n(1),u=n(2),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.floorHeight=12,t.edgeWidth=.5,t.showLabel=!0,t.hideBox=!0,t.devicePlaceSize=c.DeviceSize.Small,t.devicePlaceCount=2,t}return o(t,e),t.prototype.colorBase=function(){return this.color.darken(.3)},t.prototype.draw=function(t,n){var r=this.processedColor(),o=this.processedColor().darken(.4);u.drawRect(t,this.aabb(),.5,r),u.drawRect(t,{x:this.x,y:this.y+this.getHeight()-this.floorHeight,width:this.getWidth(),height:this.floorHeight},.2,o),e.prototype.draw.call(this,t,n)},t.prototype.slots=function(){var e=[],t=this.getHeight()-this.floorHeight,n=this.buildSlot(this.pos.x,this.pos.y+t,s.Orientation.Left);e.push(n);var r=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+t,s.Orientation.Right);return e.push(r),e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,s.Orientation.Up)),e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),s.Orientation.Down)),e},t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y+this.getHeight()-this.floorHeight;return[new a.Vector(Math.floor(e),Math.floor(t))]},t.prototype.reshape=function(e){this.alignToSlot(e)},t.prototype.devicePlaces=function(){var e=this,t=this.getWidth()/2,n=this.pos.x+t,r=this.pos.y+this.getHeight()-this.floorHeight;return r-=c.getVisibleDeviceSize(this.devicePlaceSize)/3.5,[new a.Vector(n-t/2,r)].concat(this.devicePlaceCount>2?[new a.Vector(n,r)]:[],[new a.Vector(n+t/2,r)]).map(function(t){return new i.DevicePlace(t,e.devicePlaceSize)})},t}(i.Building);t.CommonAreaView=l},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),s=n(7),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edgeWidth=0,t.pickingOrigin=!0,t.facing=s.Orientation.Left,t.originX=0,t}return o(t,e),t.prototype.colorBase=function(){return this.color.darken(.2)},t.prototype.slots=function(){var e=[],t=this.getHeight()/2;return e.push(this.buildSlot(this.pos.x,this.pos.y+t,s.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+t,s.Orientation.Right)),e},t.prototype.handleClick=function(e){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(e)),!1)},t.prototype.constrainCursor=function(e){var t=e.clone();return this.pickingOrigin||(t.y=this.pos.y),t},t.prototype.reshape=function(e){if(this.pickingOrigin){var t=this.alignToSlot(e);t&&(this.facing=t.facing,t&&this.facing===s.Orientation.Left&&(this.originX=t.pos.x))}else this.facing===s.Orientation.Left?(this.setWidth(Math.abs(this.originX-e.x)),this.pos.x=this.originX-this.getWidth()):this.setWidth(Math.abs(this.pos.x-e.x))},t}(i.Building);t.CorridorView=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=function(e){function t(){var t=e.call(this)||this;return t.setWidth(5),t.setHeight(5),t.x=5,t.y=5,t.color=new i.Color(255,255,255),t}return o(t,e),t}(i.Actor);t.Player=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),s=n(2),a=function(){function e(e){this.pawn=e,this.isActive=!1,this.sleepInterval=250}return Object.defineProperty(e.prototype,"planet",{get:function(){return this.pawn.currentPlanet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"devices",{get:function(){return this.planet.colony.findAllDevices()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"operations",{get:function(){return this.devices.map(function(e){return e.operation})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recipes",{get:function(){var e=[];return this.operations.forEach(function(t){"recipe"===t.type&&e.push(t)}),e},enumerable:!0,configurable:!0}),e.prototype.attempt=function(){return r(this,void 0,void 0,function(){var e=this;return o(this,function(t){switch(t.label){case 0:return this.isActive?[2]:this.isActive?[3,2]:[4,this.apply()];case 1:t.sent(),t.label=2;case 2:return[4,this.pause()];case 3:return t.sent(),setInterval(function(){e.attempt()},this.sleepInterval),[2]}})})},e.prototype.pause=function(){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,s.sleep(this.sleepInterval)];case 1:return e.sent(),[2]}})})},e.prototype.workRecipe=function(e){return r(this,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){switch(o.label){case 0:t=0,n=e.consumes,o.label=1;case 1:return t<n.length?(r=n[t],[4,this.gatherBlock(r)]):[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return i=function(t){return t.operation===e},(s=this.planet.colony.closestDeviceByType(this.pawn.pos,[],i))?[4,this.visitDevice(s)]:[3,7];case 5:return o.sent(),[4,this.performRecipeTask(s,e)];case 6:return o.sent(),[3,10];case 7:return[4,this.pause()];case 8:return o.sent(),[4,this.workRecipe(e)];case 9:o.sent(),o.label=10;case 10:return[2]}})})},e.prototype.performRecipeTask=function(e,t){return r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,e.interact(this.pawn,{type:"work",recipe:t})];case 1:return n.sent()?[3,4]:[4,this.pause()];case 2:return n.sent(),console.warn("waiting for machine to become available..."),[4,this.performRecipeTask(e,t)];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.storeBlock=function(e){return r(this,void 0,void 0,function(){var t,n,r;return o(this,function(o){switch(o.label){case 0:return t=function(t){return"store"===t.operation.type&&t.product.length<t.operation.capacity&&t.operation.stores.includes(e)},n=this.planet.colony.closestDeviceByType(this.pawn.pos,[],t),r=!1,n?[4,this.visitDevice(n)]:[3,3];case 1:return o.sent(),[4,n.interact(this.pawn,{type:"store",resource:e})];case 2:o.sent()&&(r=!0),o.label=3;case 3:return r?[3,6]:[4,this.pause()];case 4:return o.sent(),[4,this.storeBlock(e)];case 5:o.sent(),o.label=6;case 6:return[2]}})})},e.prototype.gatherBlock=function(e){return r(this,void 0,void 0,function(){var t,n,r,s;return o(this,function(o){switch(o.label){case 0:return t=!1,n=function(t){return"generator"===t.operation.type&&t.product.some(function(t){return e===t})},(r=this.planet.colony.closestDeviceByType(this.pawn.pos,[],n))?[4,this.visitDevice(r)]:[3,3];case 1:return o.sent(),[4,r.interact(this.pawn,i.retrieveResource(e))];case 2:return o.sent()&&(t=!0),[3,5];case 3:return(s=this.recipes.find(function(t){return t.produces===e}))?[4,this.workRecipe(s)]:[3,5];case 4:o.sent(),t=!0,o.label=5;case 5:return t?[3,8]:[4,this.pause()];case 6:return o.sent(),[4,this.gatherBlock(e)];case 7:o.sent(),o.label=8;case 8:return[2]}})})},e.prototype.visitDevice=function(e){return r(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.pawn.pathTo(e.building)];case 1:return t.sent(),[4,this.pawn.glideTo(e.pos)];case 2:return t.sent(),[2]}})})},e}();t.ProductionStrategy=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(){return i(this,void 0,void 0,function(){var e,t,n,r,o;return s(this,function(i){switch(i.label){case 0:return this.isActive?[2]:(this.isActive=!0,e=function(e){return"store"===e.operation.type&&e.product.length<e.operation.capacity},(t=a.shuffle(this.devices).find(e))&&"store"===t.operation.type?(n=t.operation,r=function(e){return n.stores.some(function(t){return e.produces===t})},(o=a.shuffle(this.recipes).find(r))?[4,this.workRecipe(o)]:[3,3]):[3,3]);case 1:return i.sent(),[4,this.storeBlock(o.produces)];case 2:i.sent(),i.label=3;case 3:return[4,this.pause()];case 4:return i.sent(),this.isActive=!1,[2]}})})},t}(n(41).ProductionStrategy);t.CapacityBasedProduction=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),c=n(5),u=n(13),l=n(2),p=n(11),h=n(42),f=function(e){function t(t,n){var r=e.call(this,t.x,t.y,p.Scale.minor.first,p.Scale.minor.third,a.Color.White)||this;return r.device=t,r.planet=n,r.walkSpeed=u.Game.citizenSpeed,r.carrying=[],r.path=[],r.workInProgress=!1,r.traits=r.traits.filter(function(e){return!(e instanceof a.Traits.OffscreenCulling)}),r.productionStrategy=new h.CapacityBasedProduction(r),r}return o(t,e),Object.defineProperty(t.prototype,"isWorking",{get:function(){return this.isWorking},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPlanet",{get:function(){return this.planet},enumerable:!0,configurable:!0}),t.prototype.update=function(t,n){if(e.prototype.update.call(this,t,n),this.work(),this.workInProgress){var r=(new Date).getTime();this.progress=(r-this.workStarted)/this.workDuration}},t.prototype.draw=function(t,n){var r=this;if(e.prototype.draw.call(this,t,n),this.carrying&&this.carrying.forEach(function(e,n){t.fillStyle=c.blockColor(e).toRGBA(),t.fillRect(r.x+4,r.y-3*n,5,5)}),this.workInProgress){t.lineWidth=1;var o=this.x-5,i=this.y-10;t.strokeStyle=a.Color.White.toRGBA(),t.strokeRect(o,i,10,3),t.fillStyle=a.Color.Violet.darken(.9).toRGBA(),t.fillRect(o,i,10,3),t.fillStyle=a.Color.Violet.toRGBA(),t.fillRect(o,i,10*this.progress,3)}this.path},t.prototype.carry=function(e){this.carrying.push(e)},t.prototype.isCarryingUnique=function(e){var t=!0,n=this.carrying.slice();return this.carrying.length>0&&e.forEach(function(e){n.find(function(t){return t===e})?l.deleteByValueOnce(n,e):t=!1}),t},t.prototype.drop=function(e){return this.carrying.length>0&&this.carrying.find(function(t){return t===e})?(l.deleteByValueOnce(this.carrying,e),e):null},t.prototype.glideTo=function(e){return this.actions.moveTo(e.x,e.y,this.walkSpeed).asPromise()},t.prototype.progressBar=function(e){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.workInProgress=!0,this.workStarted=(new Date).getTime(),this.workDuration=e,[4,new Promise(function(t,n){return setTimeout(t,e)})];case 1:return t.sent(),this.workInProgress=!1,[2]}})})},t.prototype.pathTo=function(e){return i(this,void 0,void 0,function(){var t,n=this;return s(this,function(r){switch(r.label){case 0:if(this.path.length>0)throw new Error("Already pathing!!");return(t=this.planet.pathBetween(this.pos.clone(),e)).length>0?(this.path=t,t.pop(),t.shift(),[4,Promise.all(t.map(function(e){return n.glideTo(e)}))]):[3,2];case 1:r.sent(),this.path=[],r.label=2;case 2:return[2,!0]}})})},t.prototype.work=function(){this.productionStrategy.attempt()},t}(a.Actor);t.Citizen=f},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(43),a=function(e){function t(t){var n=e.call(this,0,-t.getHeight()/2,0,0)||this;return n.planet=t,n.citizens=[],n.traits=n.traits.filter(function(e){return!(e instanceof i.Traits.OffscreenCulling)}),n}return o(t,e),t.prototype.increase=function(e){var t=new s.Citizen(e,this.planet);t.work(),this.citizens.push(t),this.add(t)},t}(i.Actor);t.Population=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.graph=e.graph()}return e.prototype.seekPath=function(e,t){return this.graph.shortestPath(e,t)},e.prototype.closestNode=function(e){var t=this.graph.dfs();return r.minBy(t,function(t){return Math.abs(e.distance(t))})||!1},e}();t.NavigationTree=o},function(e,t,n){e.exports=n.p+"9ed5e1137b47b9fc3d2bbf4534777307.svg"},function(e,t,n){e.exports=n.p+"3aeb9dd24809ba3fbd4eeb31a28c3b19.svg"},function(e,t,n){e.exports=n.p+"6cc6f6773bb6eb26fcef87b9629f7b87.svg"},function(e,t,n){e.exports=n.p+"43062e54318df93f49e2be9a4281eb4a.svg"},function(e,t,n){e.exports=n.p+"24611230ec712ba7ee38b99561aedd87.svg"},function(e,t,n){e.exports=n.p+"c4ab2ceb2f61e18493fc776770c65654.svg"},function(e,t,n){e.exports=n.p+"bbd50a175546bd70d21c5eadbc30d479.svg"},function(e,t,n){e.exports=n.p+"7441c2ab240d0f733451d75204ac0792.svg"},function(e,t,n){e.exports=n.p+"91a8cce06c3c05ce6e4b176afafd7b0a.svg"},function(e,t,n){e.exports=n.p+"0ce4f9c3384680565b6bb16495b64233.svg"},function(e,t,n){e.exports=n.p+"1db542acabeb82ec8da785e77afd4dca.svg"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mechanicalOperations={store:function(e,t){return void 0===t&&(t=10),{type:"store",stores:e,capacity:t}},generate:function(e){return{type:"generator",generates:e,generationTime:1e3,capacity:4}},recipe:function(e,t){return{type:"recipe",consumes:e,produces:t,workTime:1e3}},spawn:function(){return{type:"spawn"}}}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(2),a=n(8),c=n(45),u=function(e){function t(t,n){var r=e.call(this,t,n,0,0)||this;return r.buildings=[],r.currentlyConstructing=null,r.traits=r.traits.filter(function(e){return!(e instanceof i.Traits.OffscreenCulling)}),r}return o(t,e),t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.navTree},t.prototype.placeBuilding=function(e){e.built=!0,e.parentSlot&&(e.parentSlot.parent.childrenBuildings.push(e),this.buildNavTree()),this.buildings.push(e),e.afterConstruct(),this.add(e)},t.prototype.closestBuildingByType=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=function(){return!0});var r=this.buildings.filter(function(e){return(!(t.length>0)||t.some(function(t){return e.structure instanceof t}))&&n(e)});if(r&&r.length>0)return s.minBy(r,function(t){return e.distance(t.nodes()[0])})},t.prototype.pathBetween=function(e,t){this.navTree||this.buildNavTree();var n=this.navTree.closestNode(e),r=t.nodes()[0],o=this.navTree.closestNode(r);return this.navTree.seekPath(n,o)},t.prototype.closestDeviceByType=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=function(){return!0});var r=this.findAllDevices();if((r=r.filter(function(e){return(!(t.length>0)||t.some(function(t){return e.machine instanceof t}))&&n(e)}))&&r.length>0)return s.minBy(r,function(t){return e.distance(t)})},t.prototype.buildNavTree=function(){var e=this.buildings.find(function(e){return e.structure instanceof a.MissionControl});e&&(this.navTree=new c.NavigationTree(e))},t.prototype.findAllDevices=function(){return s.flatSingle(this.buildings.map(function(e){return e.getDevices()}))},t}(i.Actor);t.Colony=u},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(2),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.peaks=[],t}return o(t,e),t.prototype.onInitialize=function(){for(var e=this.getWidth()/2,t=this.getWidth()/20,n=0,r=s.range(5);n<r.length;n++)for(var o=r[n],i=100*o,a=3*o*(t/2),c=0,u=s.range(20);c<u.length;c++){var l=u[c];this.peaks.push({x:l*t-e+(Math.random()*a-a/2),height:Math.max(10,1e3+3e3*Math.random()+(Math.random()*i-i/2))})}},t.prototype.draw=function(e,t){var n=this.color.desaturate(.25),r=this.color.saturate(.2).lighten(.5);e.fillStyle=n.toRGBA();var o=this.pos.y-3;this.peaks.forEach(function(t){var i=o-t.height,s=3.4*t.height;e.beginPath(),e.moveTo(t.x,i),e.lineTo(t.x-s,o),e.lineTo(t.x+s,o),e.fillStyle=n.toRGBA(),e.fill(),e.beginPath(),e.moveTo(t.x,i),e.lineTo(t.x+s/4*3,o),e.lineTo(t.x+s,o),e.fillStyle=r.toRGBA(),e.fill()})},t}(function(e){function t(t,n,r){return e.call(this,0,t,n,500,r)||this}return o(t,e),t}(i.Actor));t.Mountains=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(0),a=n(2),c=n(59),u=n(5),l=n(58),p=n(44),h=n(6),f=function(e){function t(t,n,r,o,s){void 0===o&&(o=2e6),void 0===s&&(s=1e7);var u=e.call(this,0,s/2,o,s,n)||this;u.hud=t,u.color=n,u.onBuildingHover=r,u.w=o,u.depth=s,u.traits=u.traits.filter(function(e){return!(e instanceof i.Traits.OffscreenCulling)});var h=-s/2;u.createLayer(h,20,u.color.lighten(.25));for(var f=s/10,d=0,y=a.range(10);d<y.length;d++){var v=y[d];u.createLayer(h+20+f/2+f*(v+1),f,u.color.darken(.05+.01*v))}return u.add(new c.Mountains(-s/2,u.getWidth(),u.color.lighten(.15))),u.colony=new l.Colony(0,-s/2),u.add(u.colony),u.population=new p.Population(u),u.add(u.population),u}return o(t,e),Object.defineProperty(t.prototype,"currentlyViewing",{set:function(e){this.onBuildingHover(e)},enumerable:!0,configurable:!0}),t.prototype.createLayer=function(e,t,n){var r=new s.Actor(0,e,this.getWidth(),t,n);this.add(r)},t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.currentlyConstructing&&this.currentlyConstructing.draw(t,n)},Object.defineProperty(t.prototype,"economy",{get:function(){var e=this.colony.findAllDevices().map(function(e){return e.machine.economy}).reduce(u.sumMarkets,u.emptyMarket()),t=this.population.citizens.length;return e.Shelter.demand=t,e.Oxygen.demand+=t,e.Water.demand+=t,e},enumerable:!0,configurable:!0}),t.prototype.update=function(t,n){e.prototype.update.call(this,t,n),this.colony.buildings.forEach(function(e){return e.update(t,n)}),this.population.citizens.forEach(function(e){return e.update(t,n)})},Object.defineProperty(t.prototype,"currentlyConstructing",{get:function(){return this.colony.currentlyConstructing},enumerable:!0,configurable:!0}),t.prototype.gather=function(e){this.hud.resourceGathered(e)},t.prototype.placeBuilding=function(e){this.colony.placeBuilding(e)},t.prototype.populate=function(e){if(this.population.citizens.length<this.maxPop){var t=this.closestDevice(e,[h.CloningVat]);this.population.increase(t)}},Object.defineProperty(t.prototype,"maxPop",{get:function(){var e=this.colony.findAllDevices().map(function(e){return e.machine.economy}).reduce(u.sumMarkets,u.emptyMarket()),t=[u.PureValue.Shelter,u.PureValue.Water,u.PureValue.Oxygen];return Math.max(0,Math.min.apply(Math,t.map(function(t){return u.availableCapacity(e,t)})))},enumerable:!0,configurable:!0}),t.prototype.closestBuildingByType=function(e,t,n){return void 0===n&&(n=function(){return!0}),this.colony.closestBuildingByType(e,t,n)},t.prototype.closestDevice=function(e,t,n){return void 0===t&&(t=[]),void 0===n&&(n=function(){return!0}),this.colony.closestDeviceByType(e,t,n)},t.prototype.pathBetween=function(e,t){return this.colony.pathBetween(e,t)},t}(s.Actor);t.Planet=f},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(60),a=n(40),c=n(8),u=n(3),l=n(23),p=n(10),h=n(6),f=n(9),d=n(2),y=n(1),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dragging=!1,t.defaultMessage="Welcome to the Colony, Commander.",t.placingFunction=null,t}return o(t,e),t.prototype.update=function(t,n){e.prototype.update.call(this,t,n),this.hud.updateDetails(this.planet,!1)},t.prototype.onInitialize=function(e){var t=this;this.game=e;var n=function(e){return t.startConstructing(e)};this.hud=new l.Hud(e,n,n,n),this.add(this.hud),this.planet=new s.Planet(this.hud,e.world.color,function(e){return t.hud.showCard(e)}),this.add(this.planet),this.player=new a.Player,this.add(this.player),this.prepareNextBuilding(),this.camera.zoom(.001),this.camera.zoom(2,1e4)},t.prototype.onActivate=function(){var e=this;this.game.input.pointers.primary.on("move",function(t){if(e.dragging)e.camera.pos=e.camera.pos.add(e.dragOrigin.sub(t.pos));else{e.player.pos=t.pos;var n=e.planet.currentlyConstructing;if(n instanceof u.Building){var r=n.constrainCursor(e.player.pos);e.player.pos=r,n.reshape(e.player.pos)}else n instanceof p.Device&&n.snap(e.planet,e.player.pos)}}),this.game.input.pointers.primary.on("up",function(){e.dragging&&(e.dragging=!1)}),this.game.input.pointers.primary.on("down",function(t){if(t.button==i.Input.PointerButton.Left){var n=e.planet.currentlyConstructing;if(n)if(n instanceof u.Building){var r=n,o=!r.overlapsAny();if(r&&o&&r.handleClick(t.pos)){if(e.planet.placeBuilding(r),e.placingFunction){var s=e.placingFunction;d.zip(s.machines,r.devicePlaces()).forEach(function(e){var t=e[0],n=e[1],o=(new t).concretize(),i=new p.Device(o,n.position);r.addDevice(i)}),e.placingFunction=null}e.hud.setMessage(e.defaultMessage),e.planet.colony.currentlyConstructing=null,e.prepareNextBuilding(t.pos),e.hud.updateDetails(e.planet)}}else{var a=n;a.snap(e.planet)&&(a.building.addDevice(a),e.planet.colony.currentlyConstructing=null,e.hud.setMessage(e.defaultMessage),e.hud.updateDetails(e.planet))}}else t.button===i.Input.PointerButton.Middle&&(e.dragging=!0,e.dragOrigin=t.pos)}),this.game.input.pointers.primary.on("wheel",function(t){var n=e.camera.getZoom();t.deltaY<0?e.camera.zoom(Math.min(n+.05,8)):t.deltaY>0&&e.camera.zoom(Math.max(n-.05,.05))}),this.game.input.keyboard.on("press",function(t){t.key===i.Input.Keys.H?e.buildings&&e.buildings[0]&&(e.camera.move(e.buildings[0].pos,500),e.camera.zoom(.5,1e3)):t.key===i.Input.Keys.Esc&&(e.planet.colony.currentlyConstructing=null)})},t.prototype.onDeactivate=function(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")},Object.defineProperty(t.prototype,"buildings",{get:function(){return this.planet.colony.buildings},enumerable:!0,configurable:!0}),t.prototype.nextMissingStructureOrFunction=function(){var e=t.requiredStructuresAndFunctions.map(function(e){return new e}),n=this.buildings.map(function(e){return e.structure.name}),r=d.flatSingle(this.buildings.map(function(e){return e.spaceFunction&&e.spaceFunction.name})),o=n.concat(r);return e.find(function(e){return!o.includes(e.name)})},t.prototype.prepareNextBuilding=function(e){void 0===e&&(e=new i.Vector(0,0));var t=null,n=this.nextMissingStructureOrFunction();n&&(t=n),t&&this.startConstructing(t,e)},t.prototype.startConstructing=function(e,t){void 0===t&&(t=new i.Vector(0,0)),this.hud.showCard(e);var n=null;if(e instanceof c.Structure){var r=e;this.hud.setMessage("Place "+r.name+" ("+r.description+")"),n=this.spawnBuilding(r,t),this.camera.zoom(r.zoom,250),this.camera.pos=n.pos}else if(e instanceof h.Machine){var o=e;this.hud.setMessage("Install "+o.name+" ("+o.description+")"),n=this.spawnDevice(o,t)}else if(e instanceof f.SpaceFunction){var s=e;this.hud.setMessage("Place "+s.name+" ("+s.description+")"),n=this.spawnFunction(s,t),this.placingFunction=s}this.planet.colony.currentlyConstructing=null,n&&(this.planet.colony.currentlyConstructing=n)},t.prototype.spawnDevice=function(e,t){var n=new p.Device(e,t);return n.snap(this.planet)&&(this.camera.pos=n.pos),n},t.prototype.spawnBuilding=function(e,t){var n=this.assembleBuildingFromStructure(e,t);return n.reshape(n.constrainCursor(n.pos)),n},t.prototype.assembleBuildingFromStructure=function(e,t){return new(0,u.structureViews[e.view])(t,e,this.planet)},t.prototype.spawnFunction=function(e,t){var n=new c.SmallRoomThree,r=e.machines.map(function(e){return new e});r.some(function(e){return e.size===y.DeviceSize.Medium})&&(n=new c.MediumRoomThree),r.some(function(e){return e.size===y.DeviceSize.Large})&&(n=new c.LargeRoom),r.some(function(e){return e.size===y.DeviceSize.Huge})&&(n=new c.HugeRoom),r.some(function(e){return e.forDome})&&(n=new c.SmallDome);var o=this.assembleBuildingFromStructure(n,t);return o.reshape(o.constrainCursor(o.pos)),o},t.requiredStructureList=[c.MissionControl,c.SurfaceRoad,c.SmallDomeThree,c.MainTunnel,c.Corridor,c.SmallRoomTwo],t.requiredStructuresAndFunctions=[c.MissionControl,c.SurfaceRoad,f.LifeSupportPod,c.MainTunnel,c.Corridor,f.Kitchen,f.LivingQuarters,f.CloneMatrix,f.Library,f.Archive,f.ComputerCore],t}(i.Scene);t.Construct=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(2),i=function(){function e(){this.color=o.sample(e.colors).darken(.1).desaturate(.8),this.skyColor=o.sample([r.Color.Cyan,r.Color.Vermillion]).lighten(.15).desaturate(.65)}return e.bestowName=function(){return o.sample(["Aragorn","Anodyne","Carolyn","Exeter","Colwreath","India","Comma","Terabithia"])},e.colors=[r.Color.Orange],e}();t.World=i},function(e,t,n){e.exports=n.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(63),i={Sword:new r.Texture(o)};t.Resources=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=n(62),i=n(61),s=new o.World,a=new r.Game(s),c=new i.Construct(a);a.add("construct",c),a.start().then(function(){a.goToScene("construct")})}]);
//# sourceMappingURL=main.js.map