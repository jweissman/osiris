!function(t){function e(e){for(var s,o,h=e[0],l=e[1],a=e[2],u=0,d=[];u<h.length;u++)o=h[u],r[o]&&d.push(r[o][0]),r[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);for(c&&c(e);d.length;)d.shift()();return n.push.apply(n,a||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,h=1;h<i.length;h++){var l=i[h];0!==r[l]&&(s=!1)}s&&(n.splice(e--,1),t=o(o.s=i[0]))}return t}var s={},r={1:0},n=[];function o(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=s,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var h=window.webpackJsonp=window.webpackJsonp||[],l=h.push.bind(h);h.push=e,h=h.slice();for(var a=0;a<h.length;a++)e(h[a]);var c=l;n.push([36,0]),i()}([,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(6),n=i(29);n.Scale.minor.first,n.Scale.major.first;const{major:o,minor:h}=n.Scale;class l{constructor(t=new s.Vector(0,0)){this.origin=t,this.name="(structure name)",this.description="(structure description)",this.view="<structure (room) view>",this.width=10,this.height=10,this.zoom=1,this.consumes=null,this.produces=null,this.productionTime=500}}e.Structure=l,e.MissionControl=class extends l{constructor(){super(...arguments),this.name="Mission Control",this.description="Keeping everything on track",this.view="MissionControlView",this.width=o.third,this.height=h.third,this.zoom=.1}},e.MainTunnel=class extends l{constructor(){super(...arguments),this.name="Main Tunnel",this.description="Elevating",this.view="TunnelView",this.width=o.second,this.height=o.eighth,this.zoom=.25}},e.Dome=class extends l{constructor(){super(...arguments),this.name="Biodome",this.description="Biome sweet biome",this.produces=r.ResourceBlock.Food,this.view="DomeView",this.width=o.sixth,this.height=o.third,this.zoom=.2}},e.AccessTunnel=class extends l{constructor(){super(...arguments),this.name="Corridor",this.description="in the hallway",this.view="AccessTunnelView",this.width=h.fifth,this.height=h.third,this.zoom=.5}},e.CommonArea=class extends l{constructor(){super(...arguments),this.name="Commons",this.description="hallway cap",this.view="CommonAreaView",this.width=o.eighth,this.height=o.fifth}},e.LivingQuarters=class extends l{constructor(){super(...arguments),this.name="Quarters",this.description="sleepy time",this.view="LivingQuartersView",this.width=o.third,this.height=o.fifth}},e.SurfaceRoad=class extends l{constructor(){super(...arguments),this.name="Road",this.description="go for a walk",this.view="SurfaceRoadView",this.width=h.fifth,this.height=h.first}},e.Laboratory=class extends l{constructor(){super(...arguments),this.name="Lab",this.description="learn some things",this.consumes=r.ResourceBlock.Hypothesis,this.produces=r.ResourceBlock.Data,this.view="LabView",this.width=o.sixth,this.height=o.fifth,this.productionTime=6500}},e.Kitchen=class extends l{constructor(){super(...arguments),this.name="Kitchen",this.description="veg -> meals",this.consumes=r.ResourceBlock.Food,this.produces=r.ResourceBlock.Meal,this.view="KitchenView",this.width=o.fourth,this.height=o.fifth,this.productionTime=2e3}},e.Mess=class extends l{constructor(){super(...arguments),this.name="Mess",this.description="consume meals",this.view="MessView",this.width=o.sixth,this.height=o.fifth}},e.Mine=class extends l{constructor(){super(...arguments),this.name="Mine",this.description="ore else",this.produces=r.ResourceBlock.Ore,this.view="MineView",this.width=o.eighth,this.height=3*o.sixth}},e.Study=class extends l{constructor(){super(...arguments),this.name="Study",this.description="reflect",this.view="StudyView",this.width=o.third,this.height=o.fifth,this.produces=r.ResourceBlock.Hypothesis,this.productionTime=1e3}},e.Refinery=class extends l{constructor(){super(...arguments),this.name="Refinery",this.description="flotate",this.consumes=r.ResourceBlock.Ore,this.produces=r.ResourceBlock.Mineral,this.view="RefineryView",this.width=o.fifth,this.height=o.fifth,this.productionTime=9e3}},e.PowerPlant=class extends l{constructor(){super(...arguments),this.name="Power Plant",this.description="sunny day",this.view="PowerPlantView",this.width=o.eighth,this.height=o.eighth}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5);e.Building=s.Building;const r=i(25);e.AccessTunnelView=r.AccessTunnelView;const n=i(24);e.CommonAreaView=n.CommonAreaView;const o=i(23);e.DomeView=o.DomeView;const h=i(22);e.MissionControlView=h.MissionControlView;const l=i(21);e.TunnelView=l.TunnelView;const a=i(20);e.LivingQuartersView=a.LivingQuartersView},function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Left=0]="Left",t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Down=3]="Down"}(s=e.Orientation||(e.Orientation={})),e.flip=function(t){switch(t){case s.Left:return s.Right;case s.Right:return s.Left;case s.Up:return s.Down;case s.Down:return s.Up}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=(t,e,i)=>t.reduce(function(t,s){var r=[e(s),s];return t&&i.apply(null,[t[0],r[0]])==t[0]?t:r},null)[1];function r(t,e,i){for(var s=[],r=0;r<i;r++)s.push(t[e+r]);return s}e.minBy=((t,e)=>s(t,e,Math.min)),e.maxBy=((t,e)=>s(t,e,Math.max)),e.sample=(t=>t[Math.floor(Math.random()*t.length)]),e.range=(t=>Array(t).fill(0).map((t,e)=>e)),e.closest=function(t,i,s,r){let n=i;if(r&&(i=i.filter(r)),n){let i=e=>t.distance(s(e));return e.minBy(n,i)}},e.flatSingle=(t=>[].concat(...t)),e.deleteByValue=((t,e)=>t.filter(t=>t!==e)),e.eachCons=function(t,e){for(var i=[],s=0;s<t.length-e+1;s++)i.push(r(t,s,e));return i},e.measureDistance=((t,e)=>t.distance(e))},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{l(s.next(t))}catch(t){n(t)}}function h(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,h)}l((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=i(0),n=i(0),o=i(3),h=i(4),l=i(7),a=i(6);e.Building=class extends r.Actor{constructor(t,e){super(t.origin.x,t.origin.y,t.width,t.height,e.color),this.structure=t,this.planet=e,this.built=!1,this.hover=!1,this.showLabel=!1,this.facing=o.Orientation.Right,this.edgeWidth=4,this.hideBox=!1,this.childrenBuildings=[],this.product=[],this.capacity=4,this.step=0,this.anchor=new n.Vector(0,0),this.setup(),this.traits=this.traits.filter(t=>!(t instanceof n.Traits.OffscreenCulling)),this.on("pointerenter",()=>{this.hover=!0}),this.on("pointerleave",()=>{this.hover=!1}),this.collisionType=r.CollisionType.PreventCollision,this.label=new r.Label(this.structure.name,0,0,"Helvetica"),this.label.color=r.Color.White}draw(t,e){this.hideBox||this.drawRect(t,this.aabb(),this.edgeWidth),this.product.forEach((e,i)=>{t.fillStyle=a.blockColor(e).desaturate(.3).lighten(.2).toRGBA(),t.fillRect(this.x+20*i,this.y-20,18,18)}),this.showLabel&&(this.label.pos=this.getCenter(),this.label.pos.x-=t.measureText(this.structure.name).width/2,this.label.draw(t,e))}update(t,e){super.update(t,e),this.built&&this.produces&&this.product.length<this.capacity&&this.produce(this.step),this.step+=1}setup(){}constrainCursor(t){return t.clone()}reshape(t){this.pos=t.clone()}afterConstruct(){}handleClick(t){return!0}slots(){return[]}nodes(){let t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight();return[new r.Vector(Math.floor(t),Math.floor(e)-4)]}graph(t=new l.Graph){let e=t,i=this.nodes(),s=e.findOrCreate(i[0],h.measureDistance);for(let t of this.childrenBuildings){let i=e.findOrCreate(t.parentSlot.pos,h.measureDistance);e.edge(s,i);let r=e.findOrCreate(t.nodes()[0],h.measureDistance);e.edge(i,r),t.graph(e)}return e}get produces(){return this.structure.produces}get consumes(){return this.structure.consumes}get productionTime(){return this.structure.productionTime}interact(t){return s(this,void 0,void 0,function*(){this.product.length>0?(t.carry(this.produces),this.product.pop()):this.consumes&&t.carrying===this.consumes&&(yield t.progressBar(this.productionTime),t.carry(this.produces))})}produce(t){this.produces&&!this.consumes&&t%this.productionTime==0&&(this.product.push(this.produces),console.log("PRODUCE",{produces:this.produces,product:this.product}))}drawRect(t,e,i=5,s=null){let{x:r,y:n,width:o,height:h}=e,l=s||this.edgeColor();t.fillStyle=l.toRGBA(),t.fillRect(r,n,o,h);let a=s||this.mainColor();t.fillStyle=a.toRGBA(),t.fillRect(r+i,n+i,o-2*i,h-2*i)}aabb(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}}overlaps(t){let e=this.aabb(),i=t.aabb();return!!(e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y)}overlapsAny(){return!!this.planet.buildings.find(t=>t!==this&&this.overlaps(t))}edgeColor(){return this.processedColor().lighten(.85)}mainColor(){return this.processedColor().darken(.08)}colorBase(){return this.color}processedColor(){let t=this.colorBase().clone();return this.built||(this.overlapsAny()&&(t=r.Color.Red),t.a=.8),this.hover&&(t.a=.5),t}validConnectingStructures(){return[]}validConnectingDirections(){return[o.Orientation.Up,o.Orientation.Down,o.Orientation.Left,o.Orientation.Right]}findSlot(t){let e=this.validConnectingStructures().map(e=>this.planet.closestBuildingByType(t,[e])),i=h.flatSingle(e.map(t=>t?t.slots():[]));if((i=i.filter(t=>this.validConnectingDirections().includes(t.facing)&&this.slots().some(e=>t.facing===o.flip(e.facing)))).length>0)return h.closest(t,i,t=>t.pos)}alignToSlot(t){let e=this.findSlot(t);if(e){let t=this.slots().find(t=>t.facing==o.flip(e.facing));if(t){let i=e.pos.sub(t.pos);return this.pos.addEqual(i),this.parentSlot=e,e}}}buildSlot(t,e,i=o.Orientation.Right){return{pos:new r.Vector(t,e),facing:i,parent:this}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);!function(t){t.Food="Food",t.Ore="Ore",t.Data="Data",t.Meal="Meal",t.Hypothesis="Hypothesis",t.Mineral="Mineral"}(e.ResourceBlock||(e.ResourceBlock={}));const r={Food:s.Color.Green,Data:s.Color.Blue,Mineral:s.Color.Red,Meal:s.Color.Yellow.darken(.2),Hypothesis:s.Color.Violet.darken(.4),Ore:s.Color.Red.darken(.5)};e.blockColor=function(t){return r[t].desaturate(.25).lighten(.125)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4);e.Graph=class{constructor(){this.empty=!0,this.nodes=[],this.edges={},this.edgesInverse={}}isEmpty(){return this.empty}get size(){return this.nodes.length}node(t){this.empty=!1,this.contains(t)||this.nodes.push(t)}contains(t){return this.nodes.includes(t)}findOrCreate(t,e,i=5){let r=this.dfs(),n=s.minBy(r,i=>e(t,i));return n&&e(n,t)<i?n:t}edge(t,e){this.node(t),this.node(e);let i=this.indexOf(t),s=this.indexOf(e);this.edges[i]=this.edges[i]||[],this.edges[i].push(s),this.edgesInverse[s]=this.edgesInverse[s]||[],this.edgesInverse[s].push(i)}union(t){t.edgeList().forEach(([t,e])=>this.edge(t,e))}edgeList(){let t=[];for(let e of this.nodes){let i=this.indexOf(e);if(this.edges[i])for(let s of this.edges[i]){let i=this.nodes[s];t.includes([i,e])||t.push([e,i])}}return t}adjacent(t){let e=this.indexOf(t);return this.adjacentIndices(e).map(t=>this.nodes[t])}adjacentIndices(t){let e=this.edges[t]||[],i=this.edgesInverse[t]||[];return[...e,...i]}dfs(t=null,e=[]){let i=t?this.indexOf(t):0;return this.dfsIndex(i).map(t=>this.nodes[t])}dfsIndex(t=0,e=[]){return e.push(t),this.adjacentIndices(t).forEach(t=>{e.includes(t)||this.dfsIndex(t,e)}),e}bfs(t=null,e=(()=>!0)){let i=t?this.indexOf(t):0;return this.bfsIndex(i,e).map(t=>this.nodes[t])}bfsIndex(t=null,e=(()=>!0)){let i=!1,s=[];for(s.push(t);s.length<this.nodes.length;){for(let t of s){let r=this.adjacentIndices(t);for(let n of r)if(!s.includes(n)){if(!e(t,n)){i=!0;break}s.push(n)}if(i)break}if(i)break}return s}shortestPath(t,e,i=256){let s={},r=this.indexOf(e);this.bfs(t,(t,e)=>(s[e]=t,e!==r));let n=[],o=r,h=0,l=this.indexOf(t);for(;!n.includes(l)&&h<i;)n.push(o),o=s[o],h+=1;return n.map(t=>this.nodes[t]).reverse()}indexOf(t){return this.nodes.indexOf(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(35);class n extends s.Engine{constructor(t){super({width:800,height:600,displayMode:s.DisplayMode.FullScreen,backgroundColor:t.skyColor}),this.world=t}start(){let t=new s.Loader;for(let e in r.Resources)t.addResource(r.Resources[e]);return super.start(t)}}n.citizenSpeed=100,e.Game=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),r=i(1);e.RefineryView=class extends s.CommonAreaView{validConnectingStructures(){return[r.AccessTunnel,r.Mine,r.Refinery]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.StudyView=class extends s.CommonAreaView{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),r=i(1),n=i(3),o=i(0);e.PowerPlantView=class extends s.Building{constructor(){super(...arguments),this.showLabel=!0}validConnectingStructures(){return[r.AccessTunnel]}draw(t,e){super.draw(t,e)}slots(){let t=[],e=this.getHeight()/2,i=this.buildSlot(this.pos.x,this.pos.y+e,n.Orientation.Left);t.push(i);let s=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,n.Orientation.Right);return t.push(s),t}nodes(){let t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()/2;return[new o.Vector(Math.floor(t),Math.floor(e))]}reshape(t){this.alignToSlot(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.KitchenView=class extends s.CommonAreaView{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.MessView=class extends s.CommonAreaView{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),r=i(0),n=i(1);e.MineView=class extends s.CommonAreaView{constructor(){super(...arguments),this.floorHeight=150}nodes(){let t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new r.Vector(Math.floor(t),Math.floor(e)-4)]}validConnectingStructures(){return[n.AccessTunnel,n.Mine,n.Refinery]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.LabView=class extends s.CommonAreaView{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),r=i(1);e.SurfaceRoadView=class extends s.AccessTunnelView{validConnectingStructures(){return[r.MissionControl,r.Dome]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(6);e.ResourceListEntry=class extends s.Actor{constructor(t,e,i,n){super(t,e,10,10),this.value=n;let o=new s.Actor(t,e,10,10,r.blockColor(i));this.add(o),this.count=new s.Label(`x${n}`,t+10,e+8,"Helvetica"),this.count.fontSize=12,this.count.color=s.Color.White,this.add(this.count)}credit(t){this.value+=t,this.count.text=`x${this.value}`}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(6),n=i(17);e.ResourcesList=class extends s.Actor{constructor(t,e){super(t,e,60,60,s.Color.DarkGray.darken(.8)),this.entries={[r.ResourceBlock.Food]:null,[r.ResourceBlock.Hypothesis]:null,[r.ResourceBlock.Ore]:null,[r.ResourceBlock.Meal]:null,[r.ResourceBlock.Mineral]:null,[r.ResourceBlock.Data]:null},[r.ResourceBlock.Meal,r.ResourceBlock.Data,r.ResourceBlock.Mineral].forEach((t,e)=>{let i=10*e-10,s=new n.ResourceListEntry(-8,i,t,0);this.add(s),this.entries[t]=s})}increment(t){this.entries[t].credit(1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(1),n=i(18);class o extends s.UIActor{constructor(t,e="welcome to osiris",i=null){super(0,0),this.onBuildingSelect=i,this.label=new s.Label(e,20,t.canvasHeight-64,"Helvetica"),this.label.fontSize=32,this.label.color=s.Color.White,this.add(this.label),this._makePalette(i),this.resources=new n.ResourcesList(50,40),this.add(this.resources)}message(t){this.label.text=t}draw(t,e){if(super.draw(t,e),this._paletteElement){let e=t.canvas.offsetLeft,i=t.canvas.offsetTop;this._paletteElement.style.left=`${e+20}px`,this._paletteElement.style.top=`${i+100}px`}}resourceGathered(t){this.resources.increment(t)}_makePalette(t){this._paletteElement=document.createElement("div"),this._paletteElement.style.position="absolute",this._paletteElement.style.border="1px solid white",document.body.appendChild(this._paletteElement),o.structuresForPalette.forEach(e=>{let i=new e,s=this.buttonFactory(i);this._paletteElement.appendChild(s),s.onclick=(e=>{t(i)})})}buttonFactory(t){let e=s.Color.DarkGray.darken(.8);e.a=.6;let i=s.Color.Blue.lighten(.8).desaturate(.55),r=document.createElement("button");return r.textContent=`${t.name}`,r.style.display="block",r.style.fontSize="10pt",r.style.fontFamily="Helvetica",r.style.fontWeight="600",r.style.padding="8px",r.style.width="130px",r.style.textTransform="uppercase",r.style.border="none",r.style.background=e.toRGBA(),r.style.color=i.toRGBA(),r.onmouseover=(()=>{r.style.background=e.lighten(.4).toRGBA(),r.style.color=i.lighten(.9).toRGBA()}),r.onmouseleave=(()=>{r.style.background=e.toRGBA(),r.style.color=i.toRGBA()}),r}}o.structuresForPalette=[r.AccessTunnel,r.CommonArea,r.SurfaceRoad,r.LivingQuarters,r.Dome,r.Kitchen,r.Mess,r.Study,r.Laboratory,r.Mine,r.Refinery,r.PowerPlant],e.Hud=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.LivingQuartersView=class extends s.CommonAreaView{afterConstruct(){setTimeout(()=>this.planet.populate(this.pos),100)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(5),n=i(1),o=i(4),h=i(3),l=i(7);e.TunnelView=class extends r.Building{constructor(){super(...arguments),this.pickingOrigin=!0,this.edgeWidth=2}nodes(){let t=this.pos.x+this.getWidth()/2,e=this.pos.y;return[new s.Vector(Math.floor(t),e)]}graph(t=new l.Graph){let e=t,i=this.getWidth()/2,r=this.pos.x+i,n=e.findOrCreate(this.nodes()[0],o.measureDistance),h=e.findOrCreate(new s.Vector(r,this.slotHeights()[0]),o.measureDistance);e.edge(n,h),o.eachCons(this.slotHeights(),2).forEach(([t,i])=>{let n=e.findOrCreate(new s.Vector(r,t),o.measureDistance),h=e.findOrCreate(new s.Vector(r,i),o.measureDistance);e.edge(n,h)}),this.slotHeights().forEach(t=>{let n=e.findOrCreate(new s.Vector(r,t),o.measureDistance),h=e.findOrCreate(new s.Vector(r-i,t),o.measureDistance);e.edge(h,n);let l=e.findOrCreate(new s.Vector(r+i,t),o.measureDistance);e.edge(n,l)});for(let t of this.childrenBuildings){let i=e.findOrCreate(t.parentSlot.pos,o.measureDistance),s=e.findOrCreate(t.nodes()[0],o.measureDistance);e.edge(s,i),t.graph(e)}return e}slotHeights(){let t=Math.floor((this.getHeight()-60)/40),e=[];for(let i of o.range(t))e.push(100+this.pos.y+40*i);return e}slots(){let t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,h.Orientation.Up));for(let e of this.slotHeights())t.push(this.buildSlot(this.pos.x,e,h.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),e,h.Orientation.Right));return t}validConnectingStructures(){return[n.MissionControl]}validConnectingDirections(){return[h.Orientation.Down]}handleClick(t){return!this.pickingOrigin||(this.pickingOrigin=!1,!1)}constrainCursor(t){return this.pickingOrigin?this.alignToSlot(t):t.y=Math.max(this.planet.getTop()+100,t.y),t}reshape(t){this.pos.y=this.planet.getTop()+2,this.pickingOrigin||this.setHeight(t.y-this.planet.getTop())}colorBase(){return this.color.darken(.2)}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{l(s.next(t))}catch(t){n(t)}}function h(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,h)}l((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=i(0),n=i(5),o=i(3);e.MissionControlView=class extends n.Building{constructor(){super(...arguments),this.hideBox=!0}slots(){let t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),o.Orientation.Down));let e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,o.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,o.Orientation.Right)),t}constrainCursor(t){return t.y=this.planet.getTop(),t}reshape(t){this.pos=t,this.pos.y-=this.getHeight()-2}interact(t){return s(this,void 0,void 0,function*(){let e=t.drop();e&&this.planet.gather(e)})}draw(t,e){let i=this.mainColor();t.fillStyle=i.toRGBA(),t.fillRect(this.pos.x,this.pos.y,this.getWidth(),this.getHeight());let s=this.pos.x+this.getWidth()/4*3,r=this.pos.y-18;t.fillRect(s,r,2,18),t.fillRect(s,r,10,5),super.draw(t,e)}colorBase(){return r.Color.White}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(5),n=i(3),o=i(1);e.DomeView=class extends r.Building{constructor(){super(...arguments),this.hideBox=!0}slots(){let t=[],e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,n.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,n.Orientation.Right)),t}reshape(t){this.alignToSlot(t)}draw(t,e){let i=this.mainColor();t.beginPath(),t.arc(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),this.getHeight()/1.5,0,Math.PI,!0),t.closePath(),t.fillStyle=i.toRGBA(),t.fill(),super.draw(t,e)}colorBase(){return s.Color.White.darken(.05)}validConnectingStructures(){return[o.SurfaceRoad]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),r=i(3),n=i(1),o=i(0);e.CommonAreaView=class extends s.Building{constructor(){super(...arguments),this.floorHeight=8,this.edgeWidth=1,this.showLabel=!0}slots(){let t=[],e=this.getHeight()-this.floorHeight,i=this.buildSlot(this.pos.x,this.pos.y+e,r.Orientation.Left);t.push(i);let s=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,r.Orientation.Right);return t.push(s),t}nodes(){let t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new o.Vector(Math.floor(t),Math.floor(e))]}reshape(t){this.alignToSlot(t)}validConnectingStructures(){return[n.AccessTunnel,n.CommonArea,n.Laboratory,n.LivingQuarters,n.Mess,n.Kitchen,n.Study]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),r=i(3),n=i(1);e.AccessTunnelView=class extends s.Building{constructor(){super(...arguments),this.edgeWidth=.4,this.pickingOrigin=!0,this.facing=r.Orientation.Left,this.originX=0}slots(){let t=[],e=this.getHeight()/2;return t.push(this.buildSlot(this.pos.x,this.pos.y+e,r.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,r.Orientation.Right)),t}handleClick(t){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(t)),!1)}constrainCursor(t){let e=t.clone();return this.pickingOrigin||(e.y=this.pos.y),e}reshape(t){if(this.pickingOrigin){let e=this.alignToSlot(t);this.facing=e.facing,e&&this.facing===r.Orientation.Left&&(this.originX=e.pos.x)}else this.facing===r.Orientation.Left?(this.setWidth(Math.abs(this.originX-t.x)),this.pos.x=this.originX-this.getWidth()):this.setWidth(Math.abs(this.pos.x-t.x))}validConnectingStructures(){return[n.MainTunnel,n.CommonArea,n.LivingQuarters,n.Laboratory,n.Mine,n.PowerPlant]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Player=class extends s.Actor{constructor(){super(),this.setWidth(5),this.setHeight(5),this.x=5,this.y=5,this.color=new s.Color(255,255,255)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4);e.NavigationTree=class{constructor(t){this.graph=t.graph()}seekPath(t,e){return this.graph.shortestPath(t,e)}closestNode(t){let e=this.graph.dfs();return s.minBy(e,e=>Math.abs(t.distance(e)))||!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(4);e.Mountains=class extends class extends s.Actor{constructor(t,e,i){super(0,t,e,500,i)}}{constructor(){super(...arguments),this.peaks=[]}onInitialize(){let t=this.getWidth()/2,e=this.getWidth()/20;for(let i of r.range(5)){let s=100*i,n=3*i*(e/2);for(let i of r.range(20))this.peaks.push({x:i*e-t+(Math.random()*n-n/2),height:Math.max(10,1e3+3e3*Math.random()+(Math.random()*s-s/2))})}}draw(t,e){let i=this.color.desaturate(.25),s=this.color.saturate(.2).lighten(.5);t.fillStyle=i.toRGBA();let r=this.pos.y-3;this.peaks.forEach(e=>{let n=r-e.height,o=3.4*e.height;t.beginPath(),t.moveTo(e.x,n),t.lineTo(e.x-o,r),t.lineTo(e.x+o,r),t.fillStyle=i.toRGBA(),t.fill(),t.beginPath(),t.moveTo(e.x,n),t.lineTo(e.x+o/4*3,r),t.lineTo(e.x+o,r),t.fillStyle=s.toRGBA(),t.fill()})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Scale={major:{first:16,second:32,third:48,fourth:64,fifth:80,sixth:96,seventh:112,eighth:128},minor:{first:4,second:8,third:12,fourth:16,fifth:20,sixth:24,seventh:28,eighth:32}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{l(s.next(t))}catch(t){n(t)}}function h(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,h)}l((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=i(0),n=i(1),o=i(6),h=i(8);e.Citizen=class extends r.Actor{constructor(t,e){super(t.nodes()[0].x,t.nodes()[0].y,4,10,r.Color.White),this.planet=e,this.walkSpeed=h.Game.citizenSpeed,this.carrying=null,this.path=[],this.workInProgress=!1,this.traits=this.traits.filter(t=>!(t instanceof r.Traits.OffscreenCulling))}update(t,e){if(super.update(t,e),this.workInProgress){let t=(new Date).getTime();this.progress=(t-this.workStarted)/this.workDuration}}draw(t,e){if(super.draw(t,e),this.carrying&&(t.fillStyle=o.blockColor(this.carrying).toRGBA(),t.fillRect(this.x+4,this.y-3,5,5)),this.workInProgress){let e=10,i=3,s=this.x-e/2,n=this.y-10;t.strokeStyle=r.Color.White.toRGBA(),t.strokeRect(s,n,e,i),t.fillStyle=r.Color.Violet.darken(.9).toRGBA(),t.fillRect(s,n,e,i),t.fillStyle=r.Color.Violet.toRGBA(),t.fillRect(s,n,this.progress*e,i),this.vel.x+=Math.random()-.5}}carry(t){this.carrying=t}drop(){if(this.carrying){let t=this.carrying;return this.carrying=null,t}return null}glideTo(t){return this.actions.moveTo(t.x,t.y,this.walkSpeed).asPromise()}progressBar(t){return s(this,void 0,void 0,function*(){this.workInProgress=!0,this.workStarted=(new Date).getTime(),this.workDuration=t,yield new Promise((e,i)=>setTimeout(e,t)),this.workInProgress=!1})}walkTo(t){return s(this,void 0,void 0,function*(){let e=this.planet.pathBetween(this.pos.clone(),t);return e.length>0&&(this.path=e,yield Promise.all(e.map(t=>this.glideTo(t))),this.path=null),!0})}work(){return s(this,void 0,void 0,function*(){if(this.carrying){let t=this.carrying,e=[];if((e="Food"===o.ResourceBlock[t]?[n.Kitchen]:"Hypothesis"===o.ResourceBlock[t]?[n.Laboratory]:"Ore"===o.ResourceBlock[t]?[n.Refinery]:[n.MissionControl]).length>0){let t=this.planet.closestBuildingByType(this.pos,e);t&&(yield this.walkTo(t),yield t.interact(this))}else console.log("nowhere to deliver it",this.carrying)}else{let t=this.planet.closestBuildingByType(this.pos,[n.Dome,n.Mine,n.Study],t=>t.product.length>0);t?(yield this.walkTo(t),yield t.interact(this)):(console.log("i guess i can try again? (sleep for a bit first)"),yield new Promise((t,e)=>setTimeout(t,3e3)))}setTimeout(()=>this.work(),100)})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(0),n=i(4),o=i(30),h=i(28),l=i(1),a=i(27);e.Planet=class extends r.Actor{constructor(t,e,i=2e6,r=1e6){super(0,r/2,i,r,e),this.hud=t,this.color=e,this.width=i,this.depth=r,this.buildings=[],this.citizens=[],this.currentlyConstructing=null,this.traits=this.traits.filter(t=>!(t instanceof s.Traits.OffscreenCulling));let o=-r/2;this.createLayer(o,20,this.color.lighten(.25));let l=r/10;for(let t of n.range(10))this.createLayer(o+20+l/2+l*(t+1),l,this.color.darken(.05+.01*t));this.add(new h.Mountains(-r/2,this.getWidth(),this.color.lighten(.15)))}createLayer(t,e,i){let s=new r.Actor(0,t,this.getWidth(),e,i);this.add(s)}draw(t,e){super.draw(t,e),this.currentlyConstructing&&this.currentlyConstructing.draw(t,e),this.buildings.forEach(i=>i.draw(t,e)),this.citizens.forEach(i=>i.draw(t,e))}update(t,e){super.update(t,e),this.buildings.forEach(i=>i.update(t,e)),this.citizens.forEach(i=>i.update(t,e))}gather(t){this.hud.resourceGathered(t)}placeBuilding(t){t.built=!0,t.parentSlot&&(t.parentSlot.parent.childrenBuildings.push(t),this.buildNavTree()),this.buildings.push(t),t.afterConstruct()}populate(t){let e=this.closestBuildingByType(t,[l.LivingQuarters]),i=new o.Citizen(e,this);i.work(),this.citizens.push(i)}closestBuildingByType(t,e,i=(()=>!0)){let s=this.buildings.filter(t=>e.some(e=>t.structure instanceof e)&&i(t));if(s&&s.length>0){let e=e=>t.distance(e.nodes()[0]);return n.minBy(s,e)}}pathBetween(t,e){this.navTree||this.buildNavTree();let i=this.navTree.closestNode(t),s=e.nodes()[0],r=this.navTree.closestNode(s);return this.navTree.seekPath(i,r)}buildNavTree(){let t=this.buildings.find(t=>t.structure instanceof l.MissionControl);t&&(this.navTree=new a.NavigationTree(t))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(31),n=i(26),o=i(1),h=i(2),l=i(19),a=i(16),c=i(15),u=i(14),d=i(13),p=i(12),g=i(11),f=i(10),w=i(9);class y extends s.Scene{constructor(){super(...arguments),this.dragging=!1}onInitialize(t){this.game=t,this.hud=new l.Hud(t,"hi",t=>{this.startConstructing(t)}),this.add(this.hud),this.planet=new r.Planet(this.hud,t.world.color),this.add(this.planet),this.player=new n.Player,this.add(this.player),this.prepareNextBuilding(),this.camera.zoom(.001),this.camera.zoom(2,1e4)}onActivate(){this.game.input.pointers.primary.on("move",t=>{if(this.dragging)this.camera.pos=this.camera.pos.add(this.dragOrigin.sub(t.pos));else{this.player.pos=t.pos;let e=this.planet.currentlyConstructing;if(e){let t=e.constrainCursor(this.player.pos);this.player.pos=t,e.reshape(this.player.pos)}}}),this.game.input.pointers.primary.on("up",t=>{this.dragging&&(this.dragging=!1)}),this.game.input.pointers.primary.on("down",t=>{if(t.button==s.Input.PointerButton.Left){const e=this.planet.currentlyConstructing;if(e){let i=!e.overlapsAny();e&&i&&e.handleClick(t.pos)&&(this.planet.placeBuilding(e),this.planet.currentlyConstructing=null,this.prepareNextBuilding(t.pos))}}else t.button===s.Input.PointerButton.Middle&&(this.dragging=!0,this.dragOrigin=t.pos)}),this.game.input.pointers.primary.on("wheel",t=>{let e=this.camera.getZoom();t.deltaY<0?this.camera.zoom(Math.min(e+.05,8)):t.deltaY>0&&this.camera.zoom(Math.max(e-.05,.05))}),this.game.input.keyboard.on("press",t=>{t.key===s.Input.Keys.H&&this.buildings&&this.buildings[0]&&(this.camera.move(this.buildings[0].pos,500),this.camera.zoom(.5,1e3))})}onDeactivate(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")}get buildings(){return this.planet.buildings}nextMissingRequiredStructure(){let t=y.requiredStructureList.map(t=>new t),e=this.buildings.map(t=>t.structure.name);return t.find(t=>!e.includes(t.name))}prepareNextBuilding(t=new s.Vector(0,0)){let e=null,i=this.nextMissingRequiredStructure();i&&(e=i),e?this.startConstructing(e,t):this.hud.message("Welcome to OSIRIS")}startConstructing(t,e=new s.Vector(0,0)){t.origin=e,this.hud.message(`Place ${t.name}`);let i=this.spawnBuilding(t);this.planet.currentlyConstructing=i,this.camera.pos=i.pos,this.camera.zoom(t.zoom,250)}spawnBuilding(t){let e=this.assembleBuildingFromStructure(t);return e.reshape(e.constrainCursor(e.pos)),e}assembleBuildingFromStructure(t){return new(0,y.structureViews[t.view])(t,this.planet)}}y.structureViews={TunnelView:h.TunnelView,MissionControlView:h.MissionControlView,DomeView:h.DomeView,AccessTunnelView:h.AccessTunnelView,CommonAreaView:h.CommonAreaView,LivingQuartersView:h.LivingQuartersView,SurfaceRoadView:a.SurfaceRoadView,LabView:c.LabView,MineView:u.MineView,KitchenView:p.KitchenView,MessView:d.MessView,PowerPlantView:g.PowerPlantView,StudyView:f.StudyView,RefineryView:w.RefineryView},y.requiredStructureList=[o.MissionControl,o.SurfaceRoad,o.Dome,o.MainTunnel,o.AccessTunnel,o.Kitchen,o.Mess,o.LivingQuarters],e.Construct=y},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(4);class n{constructor(){this.structures=[]}}e.Colony=n;class o{constructor(){this.color=r.sample(o.colors).darken(.1).desaturate(.8),this.skyColor=r.sample([s.Color.Cyan,s.Color.Vermillion]).lighten(.15).desaturate(.65),this.colony=new n}}o.colors=[s.Color.Red,s.Color.Blue,s.Color.Green],e.World=o},function(t,e,i){t.exports=i.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(34);let n={Sword:new s.Texture(r)};e.Resources=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(8),r=i(33),n=i(32),o=new r.World,h=new s.Game(o),l=new n.Construct(h);h.add("construct",l),h.start().then(()=>{h.goToScene("construct")})}]);
//# sourceMappingURL=main.js.map