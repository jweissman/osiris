!function(t){function e(e){for(var o,s,u=e[0],a=e[1],c=e[2],p=0,h=[];p<u.length;p++)s=u[p],r[s]&&h.push(r[s][0]),r[s]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o]);for(l&&l(e);h.length;)h.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,u=1;u<n.length;u++){var a=n[u];0!==r[a]&&(o=!1)}o&&(i.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},r={1:0},i=[];function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var u=window.webpackJsonp=window.webpackJsonp||[],a=u.push.bind(u);u.push=e,u=u.slice();for(var c=0;c<u.length;c++)e(u[c]);var l=a;i.push([39,0]),n()}([,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(5);e.Building=o.Building;var r=n(26);e.CorridorView=r.CorridorView;var i=n(25);e.CommonAreaView=i.CommonAreaView;var s=n(24);e.DomeView=s.DomeView;var u=n(23);e.MissionControlView=u.MissionControlView;var a=n(22);e.TunnelView=a.TunnelView;var c=n(8);e.ArcologyView=c.ArcologyView;var l=n(7);e.CloneMatrixView=l.CloneMatrixView;var p=n(21);e.LabView=p.LabView;var h=n(20);e.LadderView=h.LadderView;var f=n(19);e.MineView=f.MineView},function(t,e,n){"use strict";var o;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Left=0]="Left",t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Down=3]="Down"}(o=e.Orientation||(e.Orientation={})),e.compass=[o.Left,o.Right,o.Up,o.Down],e.flip=function(t){switch(t){case o.Left:return o.Right;case o.Right:return o.Left;case o.Up:return o.Down;case o.Down:return o.Up}throw new Error("Don't know orientation "+t)}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(6),u=n(32),a=n(2),c=u.Scale.major,l=u.Scale.minor,p=function(t){var e;void 0===t&&(t=new i.Vector(0,0)),this.origin=t,this.name="(structure name)",this.description="(structure description)",this.view="<structure (room) view>",this.width=10,this.height=10,this.zoom=1,this.consumes=null,this.produces=null,this.productionTime=500,this.connections=((e={})[a.Orientation.Left]=[y],e[a.Orientation.Right]=[y],e[a.Orientation.Up]=[x],e[a.Orientation.Down]=[x],e)};e.Structure=p;var h=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Mission Control",n.description="Keeping everything on track",n.view="MissionControlView",n.width=c.third,n.height=l.third,n.zoom=.1,n.connections=((e={})[a.Orientation.Left]=[v],e[a.Orientation.Right]=[v],e[a.Orientation.Up]=[f],e[a.Orientation.Down]=[f],e),n}return r(e,t),e}(p);e.MissionControl=h;var f=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Main Tunnel",n.description="Elevating",n.view="TunnelView",n.width=c.second,n.height=c.eighth,n.zoom=.25,n.connections=((e={})[a.Orientation.Left]=[y],e[a.Orientation.Right]=[y],e[a.Orientation.Up]=[h],e[a.Orientation.Down]=[],e),n}return r(e,t),e}(p);e.MainTunnel=f;var d=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Biodome",n.description="Biome sweet biome",n.produces=s.ResourceBlock.Food,n.view="DomeView",n.width=c.sixth,n.height=c.third,n.zoom=.2,n.productionTime=5e3,n.connections=((e={})[a.Orientation.Left]=[v],e[a.Orientation.Right]=[v],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n}return r(e,t),e}(p);e.Dome=d;var y=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Corridor",n.description="in the hallway",n.view="CorridorView",n.width=l.fifth,n.height=l.third,n.zoom=.5,n.connections=((e={})[a.Orientation.Left]=[f,x,P,_,w,O,g],e[a.Orientation.Right]=[f,x,P,_,w,O,g],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n}return r(e,t),e}(p);e.Corridor=y;var g=function(t){function e(){var n,o=null!==t&&t.apply(this,arguments)||this;return o.name="Commons",o.description="hallway cap",o.view="CommonAreaView",o.width=c.eighth,o.height=c.fifth,o.connections=((n={})[a.Orientation.Left]=[y,P,_,w,O,e],n[a.Orientation.Right]=[y,P,_,w,O,e],n[a.Orientation.Up]=[x],n[a.Orientation.Down]=[x],n),o}return r(e,t),e}(p);e.CommonArea=g;var v=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Road",n.description="go for a walk",n.view="SurfaceRoadView",n.width=l.fifth,n.height=l.first,n.connections=((e={})[a.Orientation.Left]=[C,d,h],e[a.Orientation.Right]=[C,d,h],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n}return r(e,t),e}(p);e.SurfaceRoad=v;var w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Lab",e.description="learn some things",e.consumes=s.ResourceBlock.Hypothesis,e.produces=s.ResourceBlock.Data,e.view="LabView",e.width=c.sixth,e.height=c.fifth,e.productionTime=6500,e}return r(e,t),e}(g);e.Laboratory=w;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Kitchen",e.description="veg -> meals",e.consumes=s.ResourceBlock.Food,e.produces=s.ResourceBlock.Meal,e.view="KitchenView",e.width=c.fourth,e.height=c.fifth,e.productionTime=2e3,e}return r(e,t),e}(g);e.Kitchen=_;var b=function(t){function e(){var n,o=null!==t&&t.apply(this,arguments)||this;return o.name="Mine",o.description="ore else",o.produces=s.ResourceBlock.Ore,o.productionTime=2e4,o.view="MineView",o.width=c.eighth,o.height=3*c.sixth,o.connections=((n={})[a.Orientation.Left]=[e,m,y],n[a.Orientation.Right]=[e,m,y],n[a.Orientation.Up]=[x],n[a.Orientation.Down]=[x],n),o}return r(e,t),e}(p);e.Mine=b;var O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Study",e.description="reflect",e.view="StudyView",e.width=c.third,e.height=c.fifth,e.produces=s.ResourceBlock.Hypothesis,e.productionTime=2e3,e}return r(e,t),e}(g);e.Study=O;var m=function(t){function e(){var n,o=null!==t&&t.apply(this,arguments)||this;return o.name="Refinery",o.description="flotate",o.consumes=s.ResourceBlock.Ore,o.produces=s.ResourceBlock.Mineral,o.view="RefineryView",o.width=c.fifth,o.height=c.fifth,o.productionTime=9e3,o.connections=((n={})[a.Orientation.Left]=[b,e,y],n[a.Orientation.Right]=[b,e,y],n[a.Orientation.Up]=[x],n[a.Orientation.Down]=[x],n),o}return r(e,t),e}(p);e.Refinery=m;var x=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Ladder",n.description="connect vertically",n.view="LadderView",n.width=l.third,n.height=100+c.third,n.zoom=.5,n.connections=((e={})[a.Orientation.Up]=[P,_,w,O,g],e[a.Orientation.Down]=[P,_,w,O,g],e[a.Orientation.Left]=[],e[a.Orientation.Right]=[],e),n}return r(e,t),e}(p);e.Ladder=x;var C=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Arcology",n.description="megalith",n.view="ArcologyView",n.width=12*c.fifth,n.height=34*c.fifth,n.zoom=.01,n.connections=((e={})[a.Orientation.Left]=[v],e[a.Orientation.Right]=[v],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n}return r(e,t),e}(p);e.Arcology=C;var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Clone Matrix",e.description="you seem familiar",e.view="CloneMatrixView",e.width=c.fifth,e.height=c.eighth,e}return r(e,t),e}(g);e.CloneMatrix=P;var M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Power Plant",e.description="sunny day",e.view="PowerPlantView",e.width=2*c.eighth,e.height=2*c.eighth,e}return r(e,t),e}(p);e.PowerPlant=M},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=function(t,e,n){return t.reduce(function(t,o){var r=[e(o),o];return t&&n.apply(null,[t[0],r[0]])==t[0]?t:r},null)[1]};function i(t,e,n){for(var o=[],r=0;r<n;r++)o.push(t[e+r]);return o}e.minBy=function(t,e){return r(t,e,Math.min)},e.maxBy=function(t,e){return r(t,e,Math.max)},e.sample=function(t){return t[Math.floor(Math.random()*t.length)]},e.range=function(t){return Array(t).fill(0).map(function(t,e){return e})},e.closest=function(t,n,o,r){var i=n;if(r&&(n=n.filter(r)),i)return e.minBy(i,function(e){return t.distance(o(e))})},e.flatSingle=function(t){return[].concat.apply([],t)},e.deleteByValue=function(t,e){return t.filter(function(t){return t!==e})},e.eachCons=function(t,e){for(var n=[],o=0;o<t.length-e+1;o++)n.push(i(t,o,e));return n},e.measureDistance=function(t,e){return t.distance(e)},e.drawLine=function(t,e,n,r,i){void 0===r&&(r=o.Color.White),void 0===i&&(i=1),r.a=.5,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.strokeStyle=r.toRGBA(),t.lineWidth=i,t.stroke()},e.drawRect=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=o.Color.White);var i=e.x,s=e.y,u=e.width,a=e.height;if(n>0){var c=o.Color.White;t.fillStyle=c.toRGBA(),t.fillRect(i,s,u,a)}var l=r;t.fillStyle=l.toRGBA(),t.fillRect(i+n,s+n,u-2*n,a-2*n)}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}a((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var u=n(0),a=n(2),c=n(4),l=n(9),p=n(6),h=function(t){function e(e,n){var o=t.call(this,e.origin.x,e.origin.y,e.width,e.height,n.color)||this;return o.structure=e,o.planet=n,o.edgeWidth=0,o.built=!1,o.hover=!1,o.showLabel=!1,o.facing=a.Orientation.Right,o.hideBox=!1,o.childrenBuildings=[],o.product=[],o.capacity=4,o.level=1,o.step=0,o.anchor=new u.Vector(0,0),o.setup(),o.traits=o.traits.filter(function(t){return!(t instanceof u.Traits.OffscreenCulling)}),o.on("pointerenter",function(){o.hover=!0,console.log("HOVER ON",{building:o})}),o.on("pointerleave",function(){o.hover=!1}),o.collisionType=u.CollisionType.PreventCollision,o.nameLabel=new u.Label(o.structure.name,0,0,"Helvetica"),o.nameLabel.color=u.Color.White,o.levelLabel=new u.Label("Lvl. "+o.level,0,0,"Helvetica"),o.levelLabel.fontSize=6,o.levelLabel.color=u.Color.White.darken(.2),o}return r(e,t),e.prototype.levelUp=function(){this.level+=1,this.levelLabel.text="Lvl. "+this.level},e.prototype.draw=function(t,e){var n=this;this.hideBox||c.drawRect(t,this.aabb(),this.edgeWidth,this.processedColor()),this.product.forEach(function(e,o){t.fillStyle=p.blockColor(e).desaturate(.3).lighten(.2).toRGBA(),t.fillRect(n.x+20*o,n.y-20,18,18)}),this.showLabel&&(this.nameLabel.pos=this.getCenter(),this.nameLabel.pos.x-=t.measureText(this.structure.name).width/2,this.nameLabel.draw(t,e))},e.prototype.update=function(e,n){t.prototype.update.call(this,e,n),this.built&&this.produces&&this.product.length<this.capacity&&this.produce(this.step),this.step+=1},e.prototype.setup=function(){},e.prototype.constrainCursor=function(t){return t.clone()},e.prototype.reshape=function(t){this.pos=t.clone()},e.prototype.afterConstruct=function(){},e.prototype.handleClick=function(t){return!0},e.prototype.slots=function(){return[]},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight();return[new u.Vector(Math.floor(t),Math.floor(e)-4)]},e.prototype.graph=function(t){void 0===t&&(t=new l.Graph);for(var e=t,n=this.nodes(),o=e.findOrCreate(n[0],c.measureDistance),r=0,i=this.childrenBuildings;r<i.length;r++){var s=i[r],u=e.findOrCreate(s.parentSlot.pos,c.measureDistance);e.edge(o,u);var a=e.findOrCreate(s.nodes()[0],c.measureDistance);e.edge(u,a),s.graph(e)}return e},Object.defineProperty(e.prototype,"produces",{get:function(){return this.structure.produces},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"consumes",{get:function(){return this.structure.consumes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"productionTime",{get:function(){return this.structure.productionTime},enumerable:!0,configurable:!0}),e.prototype.interact=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.product.length>0?(t.carry(this.produces),this.product.pop(),[3,3]):[3,1];case 1:return this.consumes&&t.carrying===this.consumes?[4,t.progressBar(this.productionTime)]:[3,3];case 2:e.sent(),t.carry(this.produces),e.label=3;case 3:return[2]}})})},e.prototype.produce=function(t){this.produces&&!this.consumes&&t%this.productionTime==0&&(this.product.push(this.produces),console.log("PRODUCE",{produces:this.produces,product:this.product}))},e.prototype.aabb=function(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}},e.prototype.overlaps=function(t){var e=this.aabb(),n=t.aabb();return!!(e.x<n.x+n.width&&e.x+e.width>n.x&&e.y<n.y+n.height&&e.y+e.height>n.y)},e.prototype.overlapsAny=function(){var t=this;return!!this.planet.colony.buildings.find(function(e){return e!==t&&t.overlaps(e)})},e.prototype.edgeColor=function(){return this.processedColor().lighten(.85)},e.prototype.mainColor=function(){return this.processedColor().darken(.08)},e.prototype.colorBase=function(){return this.color},e.prototype.processedColor=function(){var t=this.colorBase().clone();return this.built||(this.overlapsAny()&&(t=u.Color.Red),t.a=.8),this.hover&&(t.a=.5),t},Object.defineProperty(e.prototype,"connections",{get:function(){return this.structure.connections},enumerable:!0,configurable:!0}),e.prototype.findSlot=function(t,e){var n=this;void 0===e&&(e=this.connections);for(var o=[],r=function(r){var i=e[r],s=a.flip(r);i.map(function(e){return n.planet.closestBuildingByType(t,[e])}).forEach(function(t){t&&t.slots().filter(function(t){return t.facing===s}).forEach(function(t){o.push(t)})})},i=0,s=a.compass;i<s.length;i++)r(s[i]);if(o.length>0)return c.closest(t,o,function(t){return t.pos});console.warn("no conecting structures found")},e.prototype.alignToSlot=function(t,e){void 0===e&&(e=this.connections);var n=this.findSlot(t,e);if(n){var o=this.slots().find(function(t){return t.facing==a.flip(n.facing)});if(o){var r=n.pos.sub(o.pos);return this.pos.addEqual(r),this.parentSlot=n,n}}},e.prototype.buildSlot=function(t,e,n){return void 0===n&&(n=a.Orientation.Right),{pos:new u.Vector(t,e),facing:n,parent:this}},e}(u.Actor);e.Building=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0);!function(t){t.Food="Food",t.Ore="Ore",t.Data="Data",t.Meal="Meal",t.Hypothesis="Hypothesis",t.Mineral="Mineral"}(e.ResourceBlock||(e.ResourceBlock={}));var r={Food:o.Color.Green,Data:o.Color.Blue,Mineral:o.Color.Red,Meal:o.Color.Yellow.darken(.2),Hypothesis:o.Color.Violet.darken(.4),Ore:o.Color.Red.darken(.5)};e.blockColor=function(t){return r[t].desaturate(.25).lighten(.125)}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.afterConstruct=function(){this.spawnCitizen()},e.prototype.spawnCitizen=function(){var t=this;setTimeout(function(){return t.planet.populate(t.pos)},100)},e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n)},e}(n(1).CommonAreaView);e.CloneMatrixView=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.draw=function(t,e){this.drawShape(t,this.pos.x,this.pos.y)},e.prototype.drawShape=function(t,e,n){var o=this.getHeight(),r=this.getWidth();t.beginPath(),t.moveTo(0+e,o+n),t.bezierCurveTo(1+e,o-150+n,121+e,70+n,r-80+e,8+n),t.bezierCurveTo(r-40+e,2+n,r-5+e,11+n,r-10+e,25+n),t.bezierCurveTo(r-5+e,10+n,r+e,o-10+n,r+e,o+n),t.lineTo(0+e,o+n),t.fillStyle=this.mainColor().toRGBA(),t.fill()},e}(n(1).DomeView);e.ArcologyView=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),r=function(){function t(){this.empty=!0,this.nodes=[],this.edges={},this.edgesInverse={}}return t.prototype.isEmpty=function(){return this.empty},Object.defineProperty(t.prototype,"size",{get:function(){return this.nodes.length},enumerable:!0,configurable:!0}),t.prototype.node=function(t){this.empty=!1,this.contains(t)||this.nodes.push(t)},t.prototype.contains=function(t){return this.nodes.includes(t)},t.prototype.findOrCreate=function(t,e,n){void 0===n&&(n=5);var r=this.dfs(),i=o.minBy(r,function(n){return e(t,n)});return i&&e(i,t)<n?i:t},t.prototype.edge=function(t,e){this.node(t),this.node(e);var n=this.indexOf(t),o=this.indexOf(e);this.edges[n]=this.edges[n]||[],this.edges[n].push(o),this.edgesInverse[o]=this.edgesInverse[o]||[],this.edgesInverse[o].push(n)},t.prototype.union=function(t){var e=this;t.edgeList().forEach(function(t){var n=t[0],o=t[1];return e.edge(n,o)})},t.prototype.edgeList=function(){for(var t=[],e=0,n=this.nodes;e<n.length;e++){var o=n[e],r=this.indexOf(o);if(this.edges[r])for(var i=0,s=this.edges[r];i<s.length;i++){var u=s[i],a=this.nodes[u];t.includes([a,o])||t.push([o,a])}}return t},t.prototype.adjacent=function(t){var e=this,n=this.indexOf(t);return this.adjacentIndices(n).map(function(t){return e.nodes[t]})},t.prototype.adjacentIndices=function(t){var e=this.edges[t]||[],n=this.edgesInverse[t]||[];return e.concat(n)},t.prototype.dfs=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=[]);var o=t?this.indexOf(t):0;return this.dfsIndex(o).map(function(t){return n.nodes[t]})},t.prototype.dfsIndex=function(t,e){var n=this;return void 0===t&&(t=0),void 0===e&&(e=[]),e.push(t),this.adjacentIndices(t).forEach(function(t){e.includes(t)||n.dfsIndex(t,e)}),e},t.prototype.bfs=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=function(){return!0});var o=t?this.indexOf(t):0;return this.bfsIndex(o,e).map(function(t){return n.nodes[t]})},t.prototype.bfsIndex=function(t,e){void 0===t&&(t=null),void 0===e&&(e=function(){return!0});var n=!1,o=[];for(o.push(t);o.length<this.nodes.length;){for(var r=0,i=o;r<i.length;r++){for(var s=i[r],u=0,a=this.adjacentIndices(s);u<a.length;u++){var c=a[u];if(!o.includes(c)){if(!e(s,c)){n=!0;break}o.push(c)}}if(n)break}if(n)break}return o},t.prototype.shortestPath=function(t,e,n){var o=this;void 0===n&&(n=256);var r={},i=this.indexOf(e);this.bfs(t,function(t,e){return r[e]=t,e!==i});for(var s=[],u=i,a=0,c=this.indexOf(t);!s.includes(c)&&a<n;)s.push(u),u=r[u],a+=1;return s.map(function(t){return o.nodes[t]}).reverse()},t.prototype.indexOf=function(t){return this.nodes.indexOf(t)},t}();e.Graph=r},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(38),u=function(t){function e(e){var n=t.call(this,{width:800,height:600,displayMode:i.DisplayMode.FullScreen,backgroundColor:e.skyColor})||this;return n.world=e,n}return r(e,t),e.prototype.start=function(){var e=new i.Loader;for(var n in s.Resources)e.addResource(s.Resources[n]);return t.prototype.start.call(this,e)},e.citizenSpeed=100,e}(i.Engine);e.Game=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),s=n(3),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.validConnectingStructures=function(){return[s.Corridor,s.Mine,s.Refinery]},e}(i.CommonAreaView);e.RefineryView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(n(1).CommonAreaView);e.StudyView=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),s=n(3),u=n(2),a=n(0),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showLabel=!0,e}return r(e,t),e.prototype.validConnectingStructures=function(){return[s.Corridor]},e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n)},e.prototype.slots=function(){var t=[],e=this.getHeight()/2,n=this.buildSlot(this.pos.x,this.pos.y+e,u.Orientation.Left);t.push(n);var o=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,u.Orientation.Right);return t.push(o),t},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()/2;return[new a.Vector(Math.floor(t),Math.floor(e))]},e.prototype.reshape=function(t){this.alignToSlot(t)},e}(i.Building);e.PowerPlantView=c},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(n(1).CommonAreaView);e.KitchenView=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.colorBase=function(){return this.color.lighten(.1)},e}(n(1).CorridorView);e.SurfaceRoadView=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(6),u=function(t){function e(e,n,o,r){var u=t.call(this,e,n,10,10)||this;u.value=r;var a=new i.Actor(e,n,10,10,s.blockColor(o));return u.add(a),u.count=new i.Label("x"+r,e+10,n+8,"Helvetica"),u.count.fontSize=12,u.count.color=i.Color.White,u.add(u.count),u}return r(e,t),e.prototype.credit=function(t){this.value+=t,this.count.text="x"+this.value},e}(i.Actor);e.ResourceListEntry=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(6),u=n(16),a=function(t){function e(e,n){var o,r=t.call(this,e,n,60,60,i.Color.DarkGray.darken(.8))||this;return r.entries=((o={})[s.ResourceBlock.Food]=null,o[s.ResourceBlock.Hypothesis]=null,o[s.ResourceBlock.Ore]=null,o[s.ResourceBlock.Meal]=null,o[s.ResourceBlock.Mineral]=null,o[s.ResourceBlock.Data]=null,o),[s.ResourceBlock.Meal,s.ResourceBlock.Data,s.ResourceBlock.Mineral].forEach(function(t,e){var n=10*e-10,o=new u.ResourceListEntry(-8,n,t,0);r.add(o),r.entries[t]=o}),r}return r(e,t),e.prototype.increment=function(t){this.entries[t].credit(1)},e}(i.Actor);e.ResourcesList=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(3),u=n(17),a=function(t){function e(e,n,o){void 0===n&&(n="hello"),void 0===o&&(o=null);var r=t.call(this,0,0,e.canvasWidth,e.canvasHeight)||this;return r.onBuildingSelect=o,r.label=new i.Label(n,20,e.canvasHeight-64,"Verdana"),r.label.fontSize=24,r.label.color=i.Color.White,r.add(r.label),r._makePalette(o),r.resources=new u.ResourcesList(50,40),r.add(r.resources),r}return r(e,t),e.prototype.message=function(t){this.label.text=t},e.prototype.draw=function(e,n){if(t.prototype.draw.call(this,e,n),this._paletteElement){var o=e.canvas.offsetLeft,r=e.canvas.offsetTop;this._paletteElement.style.left=o+20+"px",this._paletteElement.style.top=r+100+"px"}},e.prototype.resourceGathered=function(t){this.resources.increment(t)},e.prototype._makePalette=function(t){var n=this;this._paletteElement=document.createElement("div"),this._paletteElement.style.position="absolute",this._paletteElement.style.border="1px solid white",document.body.appendChild(this._paletteElement),e.structuresForPalette.forEach(function(e){var o=new e,r=n.buttonFactory(o);n._paletteElement.appendChild(r),r.onclick=function(e){t(o)}})},e.prototype.buttonFactory=function(t){var e=i.Color.DarkGray.darken(.8);e.a=.6;var n=i.Color.Blue.lighten(.8).desaturate(.55),o=document.createElement("button");return o.textContent=""+t.name,o.style.display="block",o.style.fontSize="10pt",o.style.fontFamily="Helvetica",o.style.fontWeight="600",o.style.padding="8px",o.style.width="130px",o.style.textTransform="uppercase",o.style.border="none",o.style.background=e.toRGBA(),o.style.color=n.toRGBA(),o.onmouseover=function(){o.style.background=e.lighten(.4).toRGBA(),o.style.color=n.lighten(.9).toRGBA()},o.onmouseleave=function(){o.style.background=e.toRGBA(),o.style.color=n.toRGBA()},o},e.structuresForPalette=[s.SurfaceRoad,s.Corridor,s.Ladder,s.Dome,s.Kitchen,s.Study,s.Laboratory,s.Mine,s.Refinery,s.PowerPlant,s.CloneMatrix,s.Arcology],e}(i.UIActor);e.Hud=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),s=n(0),u=n(3),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floorHeight=150,e}return r(e,t),e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new s.Vector(Math.floor(t),Math.floor(e)-4)]},e.prototype.validConnectingStructures=function(){return[u.Corridor,u.Mine,u.Refinery]},e}(i.CommonAreaView);e.MineView=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),s=n(2),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.originSlot=null,e}return r(e,t),e.prototype.constrainCursor=function(t){return this.pickingOrigin||(t.x=this.pos.x),t},e.prototype.reshape=function(t){if(this.pickingOrigin){var e=this.alignToSlot(t);e&&(this.facing=e.facing,e&&(this.originSlot=e))}else if(this.facing===s.Orientation.Up){var n=this.originSlot.pos.y-this.planet.getTop()-25,o=Math.min(n,Math.max(100,this.originSlot.pos.y-t.y));this.setHeight(o/50*50),this.pos.y=this.originSlot.pos.y-this.getHeight()}else o=Math.max(100,t.y-this.originSlot.pos.y),this.setHeight(o/50*50)},e}(i.TunnelView);e.LadderView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(n(1).CommonAreaView);e.LabView=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(5),u=n(4),a=n(2),c=n(9),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pickingOrigin=!0,e.hideBox=!0,e}return r(e,t),e.prototype.colorBase=function(){return this.color.darken(.2)},e.prototype.draw=function(e,n){var o=this.aabb();u.drawRect(e,o,0,this.color.darken(.1)),o.x=o.x+this.getWidth()/5,o.width-=this.getWidth()/5*2,u.drawRect(e,o,0,this.color.darken(.2)),t.prototype.draw.call(this,e,n)},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y;return[new i.Vector(Math.floor(t),e)]},e.prototype.graph=function(t){void 0===t&&(t=new c.Graph);var e=t,n=this.getWidth()/2,o=this.pos.x+n,r=e.findOrCreate(this.nodes()[0],u.measureDistance),s=e.findOrCreate(new i.Vector(o,this.slotHeights()[0]),u.measureDistance);e.edge(r,s);var a=this.slotHeights();u.eachCons(a,2).forEach(function(t){var n=t[0],r=t[1],s=e.findOrCreate(new i.Vector(o,n),u.measureDistance),a=e.findOrCreate(new i.Vector(o,r),u.measureDistance);e.edge(s,a)});var l=e.findOrCreate(new i.Vector(o,this.pos.y+this.getHeight()),u.measureDistance),p=e.findOrCreate(new i.Vector(o,a[a.length-1]),u.measureDistance);e.edge(l,p),a.forEach(function(t){var r=e.findOrCreate(new i.Vector(o,t),u.measureDistance),s=e.findOrCreate(new i.Vector(o-n,t),u.measureDistance);e.edge(s,r);var a=e.findOrCreate(new i.Vector(o+n,t),u.measureDistance);e.edge(r,a)});for(var h=0,f=this.childrenBuildings;h<f.length;h++){var d=f[h],y=e.findOrCreate(d.parentSlot.pos,u.measureDistance),g=e.findOrCreate(d.nodes()[0],u.measureDistance);e.edge(g,y),e.edge(y,g),d.graph(e)}return e},e.prototype.slotHeights=function(){for(var t=Math.floor(this.getHeight()/50),e=[],n=0,o=u.range(t);n<o.length;n++){var r=o[n];e.push(50+this.pos.y+50*r)}return e},e.prototype.slots=function(){var t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,a.Orientation.Up));for(var e=0,n=this.slotHeights();e<n.length;e++){var o=n[e];t.push(this.buildSlot(this.pos.x,o,a.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),o,a.Orientation.Right))}return t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),a.Orientation.Down)),t},e.prototype.handleClick=function(t){return!this.pickingOrigin||(this.pickingOrigin=!1,!1)},e.prototype.constrainCursor=function(t){return this.pickingOrigin?this.alignToSlot(t):t.y=Math.max(this.planet.getTop()+100,t.y),t},e.prototype.reshape=function(t){this.pos.y=this.planet.getTop()+2,this.pickingOrigin||this.setHeight(t.y-this.planet.getTop())},e}(s.Building);e.TunnelView=l},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}a((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var u=n(0),a=n(5),c=n(2),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hideBox=!0,e}return r(e,t),e.prototype.slots=function(){var t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),c.Orientation.Down));var e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,c.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,c.Orientation.Right)),t},e.prototype.constrainCursor=function(t){return t.y=this.planet.getTop(),t},e.prototype.reshape=function(t){this.pos=t,this.pos.y-=this.getHeight()-2},e.prototype.interact=function(t){return i(this,void 0,void 0,function(){var e;return s(this,function(n){return(e=t.drop())&&this.planet.gather(e),[2]})})},e.prototype.draw=function(e,n){var o=this.mainColor();e.fillStyle=o.toRGBA(),e.fillRect(this.pos.x,this.pos.y,this.getWidth(),this.getHeight());var r=this.pos.x+this.getWidth()/4*3,i=this.pos.y-18;e.fillRect(r,i,2,18),e.fillRect(r,i,10,5),t.prototype.draw.call(this,e,n)},e.prototype.colorBase=function(){return u.Color.White},e}(a.Building);e.MissionControlView=l},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(5),u=n(2),a=n(3),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hideBox=!0,e}return r(e,t),e.prototype.slots=function(){var t=[],e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,u.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,u.Orientation.Right)),t},e.prototype.reshape=function(t){this.alignToSlot(t)},e.prototype.draw=function(e,n){var o=this.mainColor();e.beginPath(),e.arc(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),this.getHeight()/1.5,0,Math.PI,!0),e.closePath(),e.fillStyle=o.toRGBA(),e.fill(),t.prototype.draw.call(this,e,n)},e.prototype.colorBase=function(){return i.Color.White.darken(.05)},e.prototype.validConnectingStructures=function(){return[a.SurfaceRoad]},e}(s.Building);e.DomeView=c},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),s=n(2),u=n(0),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floorHeight=8,e.edgeWidth=.5,e.showLabel=!0,e}return r(e,t),e.prototype.colorBase=function(){return this.color.darken(.1)},e.prototype.slots=function(){var t=[],e=this.getHeight()-this.floorHeight,n=this.buildSlot(this.pos.x,this.pos.y+e,s.Orientation.Left);t.push(n);var o=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,s.Orientation.Right);return t.push(o),t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,s.Orientation.Up)),t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),s.Orientation.Down)),t},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new u.Vector(Math.floor(t),Math.floor(e))]},e.prototype.reshape=function(t){this.alignToSlot(t)},e}(i.Building);e.CommonAreaView=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),s=n(2),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.edgeWidth=0,e.pickingOrigin=!0,e.facing=s.Orientation.Left,e.originX=0,e}return r(e,t),e.prototype.colorBase=function(){return this.color.darken(.2)},e.prototype.slots=function(){var t=[],e=this.getHeight()/2;return t.push(this.buildSlot(this.pos.x,this.pos.y+e,s.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,s.Orientation.Right)),t},e.prototype.handleClick=function(t){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(t)),!1)},e.prototype.constrainCursor=function(t){var e=t.clone();return this.pickingOrigin||(e.y=this.pos.y),e},e.prototype.reshape=function(t){if(this.pickingOrigin){var e=this.alignToSlot(t);e&&(this.facing=e.facing,e&&this.facing===s.Orientation.Left&&(this.originX=e.pos.x))}else this.facing===s.Orientation.Left?(this.setWidth(Math.abs(this.originX-t.x)),this.pos.x=this.originX-this.getWidth()):this.setWidth(Math.abs(this.pos.x-t.x))},e}(i.Building);e.CorridorView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=function(t){function e(){var e=t.call(this)||this;return e.setWidth(5),e.setHeight(5),e.x=5,e.y=5,e.color=new i.Color(255,255,255),e}return r(e,t),e}(i.Actor);e.Player=s},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}a((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var u=n(0),a=n(3),c=n(6),l=n(10),p=(n(4),function(t){function e(e,n){var o=t.call(this,e.nodes()[0].x,e.nodes()[0].y,4,10,u.Color.White)||this;return o.planet=n,o.walkSpeed=l.Game.citizenSpeed,o.carrying=null,o.path=[],o.workInProgress=!1,o.traits=o.traits.filter(function(t){return!(t instanceof u.Traits.OffscreenCulling)}),o}return r(e,t),e.prototype.update=function(e,n){if(t.prototype.update.call(this,e,n),this.workInProgress){var o=(new Date).getTime();this.progress=(o-this.workStarted)/this.workDuration}},e.prototype.draw=function(e,n){if(t.prototype.draw.call(this,e,n),this.carrying&&(e.fillStyle=c.blockColor(this.carrying).toRGBA(),e.fillRect(this.x+4,this.y-3,5,5)),this.workInProgress){e.lineWidth=1;var o=this.x-5,r=this.y-10;e.strokeStyle=u.Color.White.toRGBA(),e.strokeRect(o,r,10,3),e.fillStyle=u.Color.Violet.darken(.9).toRGBA(),e.fillRect(o,r,10,3),e.fillStyle=u.Color.Violet.toRGBA(),e.fillRect(o,r,10*this.progress,3),this.vel.x+=Math.random()-.5}this.path},e.prototype.carry=function(t){this.carrying=t},e.prototype.drop=function(){if(this.carrying){var t=this.carrying;return this.carrying=null,t}return null},e.prototype.glideTo=function(t){return this.actions.moveTo(t.x,t.y,this.walkSpeed).asPromise()},e.prototype.progressBar=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.workInProgress=!0,this.workStarted=(new Date).getTime(),this.workDuration=t,[4,new Promise(function(e,n){return setTimeout(e,t)})];case 1:return e.sent(),this.workInProgress=!1,[2]}})})},e.prototype.walkTo=function(t){return i(this,void 0,void 0,function(){var e,n=this;return s(this,function(o){switch(o.label){case 0:return(e=this.planet.pathBetween(this.pos.clone(),t)).length>0?(this.path=e,[4,Promise.all(e.map(function(t){return n.glideTo(t)}))]):[3,2];case 1:o.sent(),this.path=null,o.label=2;case 2:return[2,!0]}})})},e.prototype.work=function(){return i(this,void 0,void 0,function(){var t,e,n,o,r=this;return s(this,function(i){switch(i.label){case 0:return this.carrying?(t=this.carrying,e=[],(e="Food"===c.ResourceBlock[t]?[a.Kitchen]:"Hypothesis"===c.ResourceBlock[t]?[a.Laboratory]:"Ore"===c.ResourceBlock[t]?[a.Refinery]:[a.MissionControl]).length>0?(n=this.planet.closestBuildingByType(this.pos,e))?[4,this.walkTo(n)]:[3,3]:[3,4]):[3,6];case 1:return i.sent(),[4,n.interact(this)];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:console.log("nowhere to deliver it",this.carrying),i.label=5;case 5:return[3,11];case 6:return(o=this.planet.closestBuildingByType(this.pos,[a.Dome,a.Mine,a.Study],function(t){return t.product.length>0}))?[4,this.walkTo(o)]:[3,9];case 7:return i.sent(),[4,o.interact(this)];case 8:return i.sent(),[3,11];case 9:return console.log("i guess i can try again? (sleep for a bit first)"),[4,new Promise(function(t,e){return setTimeout(t,150)})];case 10:i.sent(),i.label=11;case 11:return setTimeout(function(){return r.work()},100),[2]}})})},e}(u.Actor));e.Citizen=p},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(28),u=function(t){function e(e){var n=t.call(this,0,-e.getHeight()/2,0,0)||this;return n.planet=e,n.citizens=[],n.traits=n.traits.filter(function(t){return!(t instanceof i.Traits.OffscreenCulling)}),n}return r(e,t),e.prototype.increase=function(t){var e=new s.Citizen(t,this.planet);e.work(),this.citizens.push(e),this.add(e)},e}(i.Actor);e.Population=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),r=function(){function t(t){this.graph=t.graph()}return t.prototype.seekPath=function(t,e){return this.graph.shortestPath(t,e)},t.prototype.closestNode=function(t){var e=this.graph.dfs();return o.minBy(e,function(e){return Math.abs(t.distance(e))})||!1},t}();e.NavigationTree=r},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(4),u=n(3),a=n(30),c=function(t){function e(e,n){var o=t.call(this,e,n,0,0)||this;return o.buildings=[],o.currentlyConstructing=null,o.traits=o.traits.filter(function(t){return!(t instanceof i.Traits.OffscreenCulling)}),o}return r(e,t),e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n),this.navTree},e.prototype.placeBuilding=function(t){t.built=!0,t.parentSlot&&(t.parentSlot.parent.childrenBuildings.push(t),this.buildNavTree()),this.buildings.push(t),t.afterConstruct(),this.add(t)},e.prototype.closestBuildingByType=function(t,e,n){void 0===n&&(n=function(){return!0});var o=this.buildings.filter(function(t){return e.some(function(e){return t.structure instanceof e})&&n(t)});if(o&&o.length>0)return s.minBy(o,function(e){return t.distance(e.nodes()[0])})},e.prototype.pathBetween=function(t,e){this.navTree||this.buildNavTree();var n=this.navTree.closestNode(t),o=e.nodes()[0],r=this.navTree.closestNode(o);return this.navTree.seekPath(n,r)},e.prototype.buildNavTree=function(){var t=this.buildings.find(function(t){return t.structure instanceof u.MissionControl});t&&(this.navTree=new a.NavigationTree(t))},e}(i.Actor);e.Colony=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Scale={major:{first:16,second:32,third:48,fourth:64,fifth:80,sixth:96,seventh:112,eighth:128},minor:{first:4,second:8,third:12,fourth:16,fifth:20,sixth:24,seventh:28,eighth:32}}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(4),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.peaks=[],e}return r(e,t),e.prototype.onInitialize=function(){for(var t=this.getWidth()/2,e=this.getWidth()/20,n=0,o=s.range(5);n<o.length;n++)for(var r=o[n],i=100*r,u=3*r*(e/2),a=0,c=s.range(20);a<c.length;a++){var l=c[a];this.peaks.push({x:l*e-t+(Math.random()*u-u/2),height:Math.max(10,1e3+3e3*Math.random()+(Math.random()*i-i/2))})}},e.prototype.draw=function(t,e){var n=this.color.desaturate(.25),o=this.color.saturate(.2).lighten(.5);t.fillStyle=n.toRGBA();var r=this.pos.y-3;this.peaks.forEach(function(e){var i=r-e.height,s=3.4*e.height;t.beginPath(),t.moveTo(e.x,i),t.lineTo(e.x-s,r),t.lineTo(e.x+s,r),t.fillStyle=n.toRGBA(),t.fill(),t.beginPath(),t.moveTo(e.x,i),t.lineTo(e.x+s/4*3,r),t.lineTo(e.x+s,r),t.fillStyle=o.toRGBA(),t.fill()})},e}(function(t){function e(e,n,o){return t.call(this,0,e,n,500,o)||this}return r(e,t),e}(i.Actor));e.Mountains=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(0),u=n(4),a=n(33),c=n(3),l=n(31),p=n(29),h=function(t){function e(e,n,o,r){void 0===o&&(o=2e6),void 0===r&&(r=1e7);var s=t.call(this,0,r/2,o,r,n)||this;s.hud=e,s.color=n,s.width=o,s.depth=r,s.traits=s.traits.filter(function(t){return!(t instanceof i.Traits.OffscreenCulling)});var c=-r/2;s.createLayer(c,20,s.color.lighten(.25));for(var h=r/10,f=0,d=u.range(10);f<d.length;f++){var y=d[f];s.createLayer(c+20+h/2+h*(y+1),h,s.color.darken(.05+.01*y))}return s.add(new a.Mountains(-r/2,s.getWidth(),s.color.lighten(.15))),s.colony=new l.Colony(0,-r/2),s.add(s.colony),s.population=new p.Population(s),s.add(s.population),s}return r(e,t),e.prototype.createLayer=function(t,e,n){var o=new s.Actor(0,t,this.getWidth(),e,n);this.add(o)},e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n),this.currentlyConstructing&&this.currentlyConstructing.draw(e,n)},e.prototype.update=function(e,n){t.prototype.update.call(this,e,n),this.colony.buildings.forEach(function(t){return t.update(e,n)}),this.population.citizens.forEach(function(t){return t.update(e,n)})},Object.defineProperty(e.prototype,"currentlyConstructing",{get:function(){return this.colony.currentlyConstructing},enumerable:!0,configurable:!0}),e.prototype.gather=function(t){this.hud.resourceGathered(t)},e.prototype.placeBuilding=function(t){this.colony.placeBuilding(t)},e.prototype.populate=function(t){var e=this.closestBuildingByType(t,[c.CloneMatrix]);this.population.increase(e)},e.prototype.closestBuildingByType=function(t,e,n){return void 0===n&&(n=function(){return!0}),this.colony.closestBuildingByType(t,e,n)},e.prototype.pathBetween=function(t,e){return this.colony.pathBetween(t,e)},e}(s.Actor);e.Planet=h},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(34),u=n(27),a=n(3),c=n(1),l=n(18),p=n(15),h=n(14),f=n(13),d=n(12),y=n(11),g=n(8),v=n(7),w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dragging=!1,e}return r(e,t),e.prototype.onInitialize=function(t){var e=this;this.game=t,this.hud=new l.Hud(t,"hi",function(t){e.startConstructing(t)}),this.add(this.hud),this.planet=new s.Planet(this.hud,t.world.color),this.add(this.planet),this.player=new u.Player,this.add(this.player),this.prepareNextBuilding(),this.camera.zoom(.001),this.camera.zoom(2,1e4)},e.prototype.onActivate=function(){var t=this;this.game.input.pointers.primary.on("move",function(e){if(t.dragging)t.camera.pos=t.camera.pos.add(t.dragOrigin.sub(e.pos));else{t.player.pos=e.pos;var n=t.planet.currentlyConstructing;if(n){var o=n.constrainCursor(t.player.pos);t.player.pos=o,n.reshape(t.player.pos)}}}),this.game.input.pointers.primary.on("up",function(e){t.dragging&&(t.dragging=!1)}),this.game.input.pointers.primary.on("down",function(e){if(e.button==i.Input.PointerButton.Left){var n=t.planet.currentlyConstructing;if(n){var o=!n.overlapsAny();n&&o&&n.handleClick(e.pos)&&(t.planet.placeBuilding(n),t.planet.colony.currentlyConstructing=null,t.prepareNextBuilding(e.pos))}}else e.button===i.Input.PointerButton.Middle&&(t.dragging=!0,t.dragOrigin=e.pos)}),this.game.input.pointers.primary.on("wheel",function(e){var n=t.camera.getZoom();e.deltaY<0?t.camera.zoom(Math.min(n+.05,8)):e.deltaY>0&&t.camera.zoom(Math.max(n-.05,.05))}),this.game.input.keyboard.on("press",function(e){e.key===i.Input.Keys.H&&t.buildings&&t.buildings[0]&&(t.camera.move(t.buildings[0].pos,500),t.camera.zoom(.5,1e3))})},e.prototype.onDeactivate=function(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")},Object.defineProperty(e.prototype,"buildings",{get:function(){return this.planet.colony.buildings},enumerable:!0,configurable:!0}),e.prototype.nextMissingRequiredStructure=function(){var t=e.requiredStructureList.map(function(t){return new t}),n=this.buildings.map(function(t){return t.structure.name});return t.find(function(t){return!n.includes(t.name)})},e.prototype.prepareNextBuilding=function(t){void 0===t&&(t=new i.Vector(0,0));var e=null,n=this.nextMissingRequiredStructure();n&&(e=n),e?this.startConstructing(e,t):this.hud.message("Welcome to OSIRIS!")},e.prototype.startConstructing=function(t,e){void 0===e&&(e=new i.Vector(0,0)),t.origin=e,this.hud.message("Place "+t.name);var n=this.spawnBuilding(t);this.planet.colony.currentlyConstructing=n,this.camera.pos=n.pos,this.camera.zoom(t.zoom,250)},e.prototype.spawnBuilding=function(t){var e=this.assembleBuildingFromStructure(t);return e.reshape(e.constrainCursor(e.pos)),e},e.prototype.assembleBuildingFromStructure=function(t){return new(0,e.structureViews[t.view])(t,this.planet)},e.structureViews={TunnelView:c.TunnelView,MissionControlView:c.MissionControlView,DomeView:c.DomeView,CorridorView:c.CorridorView,CommonAreaView:c.CommonAreaView,SurfaceRoadView:p.SurfaceRoadView,LabView:c.LabView,MineView:c.MineView,KitchenView:h.KitchenView,PowerPlantView:f.PowerPlantView,StudyView:d.StudyView,RefineryView:y.RefineryView,ArcologyView:g.ArcologyView,CloneMatrixView:v.CloneMatrixView,LadderView:c.LadderView},e.requiredStructureList=[a.MissionControl,a.SurfaceRoad,a.Dome,a.MainTunnel,a.Corridor,a.Kitchen,a.CloneMatrix],e}(i.Scene);e.Construct=w},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=n(4),i=function(){this.structures=[]};e.Colony=i;var s=function(){function t(){this.color=r.sample(t.colors).darken(.1).desaturate(.8),this.skyColor=r.sample([o.Color.Cyan,o.Color.Vermillion]).lighten(.15).desaturate(.65),this.colony=new i}return t.colors=[o.Color.Red,o.Color.Blue,o.Color.Green],t}();e.World=s},function(t,e,n){t.exports=n.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=n(37),i={Sword:new o.Texture(r)};e.Resources=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(10),r=n(36),i=n(35),s=new r.World,u=new o.Game(s),a=new i.Construct(u);u.add("construct",a),u.start().then(function(){u.goToScene("construct")})}]);
//# sourceMappingURL=main.js.map