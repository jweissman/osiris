!function(t){function e(e){for(var r,s,a=e[0],c=e[1],u=e[2],h=0,p=[];h<a.length;h++)s=a[h],i[s]&&p.push(i[s][0]),i[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);for(l&&l(e);p.length;)p.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var r={},i={1:0},o=[];function s(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var u=0;u<a.length;u++)e(a[u]);var l=c;o.push([51,0]),n()}([,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=function(t,e,n){return t.reduce(function(t,r){var i=[e(r),r];return t&&n.apply(null,[t[0],i[0]])==t[0]?t:i},null)[1]};function o(t,e,n){for(var r=[],i=0;i<n;i++)r.push(t[e+i]);return r}e.minBy=function(t,e){return i(t,e,Math.min)},e.maxBy=function(t,e){return i(t,e,Math.max)},e.sample=function(t){return t[Math.floor(Math.random()*t.length)]},e.range=function(t){return Array(t).fill(0).map(function(t,e){return e})},e.closest=function(t,n,r,i){var o=n;if(i&&(n=n.filter(i)),o)return e.minBy(o,function(e){return t.distance(r(e))})},e.flatSingle=function(t){return[].concat.apply([],t)},e.deleteByValue=function(t,e){return t.filter(function(t){return t!==e})},e.eachCons=function(t,e){for(var n=[],r=0;r<t.length-e+1;r++)n.push(o(t,r,e));return n},e.measureDistance=function(t,e){return t.distance(e)},e.drawLine=function(t,e,n,i,o){void 0===i&&(i=r.Color.White),void 0===o&&(o=1),i.a=.5,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.strokeStyle=i.toRGBA(),t.lineWidth=o,t.stroke()},e.drawRect=function(t,e,n,i,o){void 0===n&&(n=0),void 0===i&&(i=r.Color.White),void 0===o&&(o=!0);var s=e.x,a=e.y,c=e.width,u=e.height;if(o){var l=i;t.fillStyle=l.toRGBA(),t.fillRect(s,a,c,u)}if(n>0){var h=r.Color.White;t.strokeStyle=n+"px solid "+h.toRGBA(),t.strokeRect(s,a,c,u)}}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),c=n(12),u=n(29),l=n(3),h=function(){function t(t,e){this.pos=t,this.size=e}return Object.defineProperty(t.prototype,"position",{get:function(){return this.pos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibleSize",{get:function(){return l.getVisibleDeviceSize(this.size)},enumerable:!0,configurable:!0}),t}();e.DevicePlace=h;var p=function(t){function e(e,n,r){var i=t.call(this,e.x,e.y,n.width,n.height,r.color)||this;return i.structure=n,i.planet=r,i.edgeWidth=0,i.built=!1,i.hover=!1,i.showLabel=!1,i.facing=s.Orientation.Right,i.hideBox=!1,i.childrenBuildings=[],i.level=1,i.devices=[],i.step=0,i.anchor=new o.Vector(0,0),i.setup(),i.traits=i.traits.filter(function(t){return!(t instanceof o.Traits.OffscreenCulling)}),i.on("pointerenter",function(){i.hover=!0,console.log("HOVER ON",{building:i})}),i.on("pointerleave",function(){i.hover=!1}),i.collisionType=o.CollisionType.PreventCollision,i.nameLabel=new o.Label(i.structure.name,0,0,"Helvetica"),i.nameLabel.color=o.Color.White,i.levelLabel=new o.Label("Lvl. "+i.level,0,0,"Helvetica"),i.levelLabel.fontSize=6,i.levelLabel.color=o.Color.White.darken(.2),i}return i(e,t),e.prototype.levelUp=function(){this.level+=1,this.levelLabel.text="Lvl. "+this.level},e.prototype.draw=function(t,e){this.hideBox||a.drawRect(t,this.aabb(),this.edgeWidth,this.processedColor()),this.devices.forEach(function(n){return n.draw(t,e)}),this.showLabel&&(this.nameLabel.pos=this.getCenter(),this.nameLabel.pos.x-=t.measureText(this.structure.name).width/2,this.nameLabel.draw(t,e))},e.prototype.update=function(e,n){var r=this;t.prototype.update.call(this,e,n),this.built&&this.devices.forEach(function(t){return t.produce(r.step)}),this.step+=1},e.prototype.setup=function(){},e.prototype.constrainCursor=function(t){return t.clone()},e.prototype.reshape=function(t){this.pos=t.clone()},e.prototype.afterConstruct=function(){},e.prototype.handleClick=function(t){return!0},e.prototype.slots=function(){return[]},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight();return[new o.Vector(Math.floor(t),Math.floor(e)-4)]},e.prototype.devicePlaces=function(){return[]},e.prototype.graph=function(t){void 0===t&&(t=new c.Graph);for(var e=t,n=this.nodes(),r=e.findOrCreate(n[0],a.measureDistance),i=0,o=this.childrenBuildings;i<o.length;i++){var s=o[i],u=e.findOrCreate(s.parentSlot.pos,a.measureDistance);e.edge(r,u);var l=e.findOrCreate(s.nodes()[0],a.measureDistance);e.edge(u,l),s.graph(e)}return e},e.prototype.redeem=function(t){this.planet.gather(t)},e.prototype.populate=function(t){this.planet.populate(t)},e.prototype.aabb=function(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}},e.prototype.overlaps=function(t){var e=this.aabb(),n=t.aabb();return!!(e.x<n.x+n.width&&e.x+e.width>n.x&&e.y<n.y+n.height&&e.y+e.height>n.y)},e.prototype.overlapsAny=function(){var t=this;return!!this.planet.colony.buildings.find(function(e){return e!==t&&t.overlaps(e)})},e.prototype.edgeColor=function(){return this.processedColor().lighten(.85)},e.prototype.mainColor=function(){return this.processedColor().darken(.08)},e.prototype.colorBase=function(){return this.color},e.prototype.processedColor=function(){var t=this.colorBase().clone();return this.built||(this.overlapsAny()&&(t=o.Color.Red),t.a=.8),this.hover&&(t.a=.5),t},Object.defineProperty(e.prototype,"connections",{get:function(){return this.structure.connections},enumerable:!0,configurable:!0}),e.prototype.findSlot=function(t,e){var n=this;void 0===e&&(e=this.connections);for(var r=[],i=function(i){var o=e[i],a=s.flip(i);o.map(function(e){return n.planet.closestBuildingByType(t,[e])}).forEach(function(t){t&&t.slots().filter(function(t){return t.facing===a}).forEach(function(t){r.push(t)})})},o=0,c=s.compass;o<c.length;o++)i(c[o]);if(r.length>0)return a.closest(t,r,function(t){return t.pos});console.warn("no conecting structures found")},e.prototype.alignToSlot=function(t,e){void 0===e&&(e=this.connections);var n=this.findSlot(t,e);if(n){var r=this.slots().find(function(t){return t.facing==s.flip(n.facing)});if(r){var i=n.pos.sub(r.pos);return this.pos.addEqual(i),this.parentSlot=n,n}}},e.prototype.buildSlot=function(t,e,n){return void 0===n&&(n=s.Orientation.Right),{pos:new o.Vector(t,e),facing:n,parent:this}},e.prototype.addDevice=function(t){t.finalize(),t.building!==this&&(t.building=this),this.devices.push(t),this.updateName()},e.prototype.hasPlaceForDevice=function(){return this.devices.length<this.devicePlaces().length},e.prototype.nextDevicePlace=function(){return this.devicePlaces()[this.devices.length]},e.prototype.getDevices=function(){return this.devices},e.prototype.updateName=function(){var t=this,e=u.allSpaceFunctions.find(function(e){var n=!0,r=t.devices.slice();return e.machines.forEach(function(t){var e=r.find(function(e){return e.machine instanceof t});e||(n=!1),r=a.deleteByValue(r,e)}),n});e&&(this.nameLabel.text=e.label)},e}(o.Actor);e.Building=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n(9),o=i.Scale.major;i.Scale.minor,function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(r=e.DeviceSize||(e.DeviceSize={})),e.getVisibleDeviceSize=function(t){var e=10;switch(t){case r.Small:e=o.third;break;case r.Medium:e=o.sixth;break;case r.Large:e=2*o.eighth}return e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2);e.Building=r.Building;var i=n(28);e.CorridorView=i.CorridorView;var o=n(27);e.CommonAreaView=o.CommonAreaView;var s=n(26);e.DomeView=s.DomeView;var a=n(25);e.MissionControlView=a.MissionControlView;var c=n(24);e.TunnelView=c.TunnelView;var u=n(23);e.ArcologyView=u.ArcologyView;var l=n(22);e.LadderView=l.LadderView;var h=n(21);e.MineView=h.MineView;var p=n(10);e.SurfaceRoadView=p.SurfaceRoadView},function(t,e,n){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Left=0]="Left",t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Down=3]="Down"}(r=e.Orientation||(e.Orientation={})),e.compass=[r.Left,r.Right,r.Up,r.Down],e.flip=function(t){switch(t){case r.Left:return r.Right;case r.Right:return r.Left;case r.Up:return r.Down;case r.Down:return r.Up}throw new Error("Don't know orientation "+t)}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(7),a=n(0),c=n(3),u={bookshelf:n(42),vat:n(41),bench:n(40),stove:n(39),cabin:n(38),fire:n(37),bed:n(36),fridge:n(35),server:n(34)},l=a.Color.Red,h=a.Color.Green,p=a.Color.Blue,f=a.Color.Orange,d=a.Color.Violet,y=a.Color.Yellow;!function(t){t[t.Work=0]="Work",t[t.SpawnCitizen=1]="SpawnCitizen",t[t.CollectResource=2]="CollectResource",t[t.CollectMeals=3]="CollectMeals",t[t.CollectData=4]="CollectData"}(o=e.MachineOperation||(e.MachineOperation={}));var v=function(){this.name="(machine name)",this.description="(machine description)",this.color=a.Color.LightGray,this.size=c.DeviceSize.Small,this.consumes=null,this.produces=null,this.generationTime=5e3,this.workTime=2e3,this.capacity=2,this.behavior=o.Work,this.image=u.vat,this.prereqs=[]};e.Machine=v;var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Command",e.description="gather resources...",e.behavior=o.CollectResource,e.image=u.bench,e.size=c.DeviceSize.Medium,e}return i(e,t),e}(v);e.CommandCenter=g;var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="O2 Extractor",e.description="breathe deep",e.image=u.vat,e.prereqs=[_,b],e}return i(e,t),e}(v);e.OxygenExtractor=m;var b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Solar Cell",e.description="feel the warmth",e}return i(e,t),e}(v);e.SolarCell=b;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="H20 Condenser",e.prereqs=[b],e}return i(e,t),e}(v);e.WaterCondensingMachine=_;var w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Desk",e.consumes=s.ResourceBlock.Hypothesis,e.produces=s.ResourceBlock.Data,e.image=u.bench,e.prereqs=[m],e}return i(e,t),e}(v);e.Desk=w;var O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Shelf",e.description="brainstorm",e.produces=s.ResourceBlock.Hypothesis,e.image=u.bookshelf,e.prereqs=[m,w],e.color=p,e}return i(e,t),e}(v);e.Bookshelf=O;var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Fridge",e.description="store meals",e.behavior=o.CollectMeals,e.image=u.fridge,e.prereqs=[O],e.color=y,e}return i(e,t),e}(v);e.Fridge=P;var C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Stove",e.description="make a meal",e.consumes=s.ResourceBlock.Food,e.produces=s.ResourceBlock.Meal,e.image=u.stove,e.prereqs=[O,P],e.color=y,e}return i(e,t),e}(v);e.Stove=C;var x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Bed",e.image=u.bed,e.prereqs=[m],e.color=f,e}return i(e,t),e}(v);e.Bed=x;var S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Workstation",e.prereqs=[O],e.color=p,e}return i(e,t),e}(v);e.Workstation=S;var M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="House Plant",e.prereqs=[x],e.produces=s.ResourceBlock.Food,e.capacity=1,e.color=h,e}return i(e,t),e}(v);e.Houseplant=M;var k=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Research Server",e.description="hold data",e.produces=s.ResourceBlock.Hypothesis,e.behavior=o.CollectData,e.image=u.server,e.prereqs=[O],e.size=c.DeviceSize.Medium,e.color=p,e}return i(e,t),e}(v);e.ResearchServer=k;var R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Orchard",e.description="grow some food",e.produces=s.ResourceBlock.Food,e.size=c.DeviceSize.Medium,e.prereqs=[V],e.color=h,e}return i(e,t),e}(v);e.Orchard=R;var B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Cabin",e.consumes=s.ResourceBlock.Food,e.produces=s.ResourceBlock.Meal,e.image=u.cabin,e.prereqs=[R],e.size=c.DeviceSize.Medium,e.color=f,e}return i(e,t),e}(v);e.Cabin=B;var D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Arbor",e.produces=s.ResourceBlock.Food,e.prereqs=[R],e.size=c.DeviceSize.Medium,e.color=h,e}return i(e,t),e}(v);e.Arbor=D;var V=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Algae Vat",e.produces=s.ResourceBlock.Food,e.prereqs=[m,O,P],e.size=c.DeviceSize.Medium,e.color=d,e}return i(e,t),e}(v);e.AlgaeVat=V;var j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Cloning Vat",e.description="grow some replacements",e.behavior=o.SpawnCitizen,e.productionTime=1500,e.image=u.vat,e.prereqs=[V],e.size=c.DeviceSize.Medium,e.color=d,e}return i(e,t),e}(v);e.CloningVat=j;var T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Fabricator",e.consumes=s.ResourceBlock.Mineral,e.produces=s.ResourceBlock.Alloy,e.size=c.DeviceSize.Medium,e.color=l,e}return i(e,t),e}(v);e.Fabricator=T;var A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Mining Drill",e.size=c.DeviceSize.Large,e.prereqs=[T],e}return i(e,t),e}(v);e.MiningDrill=A;var L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Mega-Fabricator",e.size=c.DeviceSize.Large,e.prereqs=[T],e.color=l,e}return i(e,t),e}(v);e.Megafabricator=L;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Preserve",e.size=c.DeviceSize.Large,e.prereqs=[D],e.color=h,e}return i(e,t),e}(v);e.Preserve=z},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0);!function(t){t.Power="Power",t.Hope="Hope",t.Shelter="Shelter",t.Oxygen="Oxygen"}(e.PureValue||(e.PureValue={})),e.emptyMarket={Power:{supply:0,demand:0},Hope:{supply:0,demand:0},Shelter:{supply:0,demand:0},Oxygen:{supply:0,demand:0}},function(t){t.Food="Food",t.Ore="Ore",t.Data="Data",t.Meal="Meal",t.Hypothesis="Hypothesis",t.Mineral="Mineral",t.Alloy="Alloy"}(e.ResourceBlock||(e.ResourceBlock={}));var i={Food:r.Color.Green,Data:r.Color.Blue,Mineral:r.Color.Red,Meal:r.Color.Yellow.darken(.2),Hypothesis:r.Color.Violet.darken(.4),Ore:r.Color.Red.darken(.5),Alloy:r.Color.LightGray.darken(.2)};e.blockColor=function(t){return i[t].desaturate(.25).lighten(.125)}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(9),a=n(5),c=n(6),u=s.Scale.major,l=s.Scale.minor,h=function(){var t;this.name="(structure name)",this.description="(structure description)",this.view="<structure (room) view>",this.width=10,this.height=10,this.zoom=1,this.dominantColor=o.Color.Gray,this.consumes=null,this.produces=null,this.productionTime=500,this.connections=((t={})[a.Orientation.Left]=[d],t[a.Orientation.Right]=[d],t[a.Orientation.Up]=[y],t[a.Orientation.Down]=[y],t),this.machines=[],this.prereqs=[]};e.Structure=h;var p=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Main Tunnel",n.description="Elevating",n.view="TunnelView",n.width=u.second,n.height=u.eighth,n.zoom=.25,n.connections=((e={})[a.Orientation.Left]=[d],e[a.Orientation.Right]=[d],e[a.Orientation.Up]=[C],e[a.Orientation.Down]=[],e),n}return i(e,t),e}(h);e.MainTunnel=p;var f=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Road",n.description="go for a walk",n.view="SurfaceRoadView",n.width=l.fifth,n.height=l.first,n.connections=((e={})[a.Orientation.Left]=[v,C],e[a.Orientation.Right]=[v,C],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n}return i(e,t),e}(h);e.SurfaceRoad=f;var d=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Corridor",n.description="in the hallway",n.view="CorridorView",n.width=l.fifth,n.height=l.third,n.zoom=.5,n.connections=((e={})[a.Orientation.Left]=[p,g],e[a.Orientation.Right]=[p,g],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n.prereqs=[f],n}return i(e,t),e}(h);e.Corridor=d;var y=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Ladder",n.description="connect vertically",n.view="LadderView",n.width=l.third,n.height=100+u.third,n.zoom=.5,n.connections=((e={})[a.Orientation.Up]=[g],e[a.Orientation.Down]=[g],e[a.Orientation.Left]=[],e[a.Orientation.Right]=[],e),n.prereqs=[d,b],n}return i(e,t),e}(h);e.Ladder=y;var v=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.description="Biome sweet biome",n.view="DomeView",n.width=2*u.eighth,n.height=u.eighth,n.zoom=.2,n.connections=((e={})[a.Orientation.Left]=[f],e[a.Orientation.Right]=[f],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n.machines=[c.SolarCell,c.OxygenExtractor,c.WaterCondensingMachine],n}return i(e,t),e}(h),g=function(t){function e(){var n,r=null!==t&&t.apply(this,arguments)||this;return r.name="Commons",r.description="hallway cap",r.view="CommonAreaView",r.width=u.eighth,r.height=u.fifth,r.connections=((n={})[a.Orientation.Left]=[d,e],n[a.Orientation.Right]=[d,e],n[a.Orientation.Up]=[y],n[a.Orientation.Down]=[y],n),r.machines=[c.Stove,c.Bed,c.Desk,c.Bookshelf,c.Fridge,c.Workstation,c.Houseplant],r.prereqs=[],r}return i(e,t),e}(h),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Small Room (2)",e.width=u.eighth,e.prereqs=[O],e}return i(e,t),e}(g);e.SmallRoomTwo=m;var b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Small Room (3)",e.prereqs=[m],e.view="SmallRoomThreeView",e.width=2*u.eighth,e}return i(e,t),e}(g);e.SmallRoomThree=b;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Medium Room",e.prereqs=[b],e.view="MediumRoomView",e.width=3*u.eighth,e.height=2*u.third,e.machines=[c.ResearchServer,c.AlgaeVat,c.CloningVat,c.Fabricator],e}return i(e,t),e}(g);e.MediumRoom=_;var w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Large Room",e.view="LargeRoomView",e.prereqs=[_],e.width=6*u.eighth,e.height=4*u.fifth,e.machines=[c.MiningDrill,c.Megafabricator,c.Preserve],e}return i(e,t),e}(g);e.LargeRoom=w;var O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Small Dome",e.width=3*u.eighth,e.height=2*u.eighth,e}return i(e,t),e}(v);e.SmallDome=O;var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Mid Dome",e.view="MidDomeView",e.width=4*u.eighth,e.height=3*u.eighth,e.prereqs=[O,_],e.machines=[c.Cabin,c.Orchard,c.Arbor],e}return i(e,t),e}(v);e.MidDome=P;var C=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Mission Control",n.description="Keeping everything on track",n.view="MissionControlView",n.width=6*u.eighth,n.height=1*u.sixth,n.zoom=.1,n.connections=((e={})[a.Orientation.Left]=[f],e[a.Orientation.Right]=[f],e[a.Orientation.Up]=[p],e[a.Orientation.Down]=[p],e),n.machines=[c.CommandCenter],n}return i(e,t),e}(h);e.MissionControl=C},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Scale={major:{first:16,second:32,third:48,fourth:64,fifth:80,sixth:96,seventh:112,eighth:128},minor:{first:4,second:8,third:12,fourth:16,fifth:20,sixth:24,seventh:28,eighth:32}}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.colorBase=function(){return this.color.lighten(.1)},e}(n(4).CorridorView);e.SurfaceRoadView=o},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}c((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),c=n(6),u=n(7),l=n(8),h=n(3),p=function(t){function e(e,n){var r=t.call(this,n.x,n.y,h.getVisibleDeviceSize(e.size),h.getVisibleDeviceSize(e.size),e.color)||this;return r.machine=e,r.initialPos=n,r.product=[],r.imageLoaded=!1,r.inUse=!1,r.nameLabel=new a.Label(r.machine.name,0,0,"Helvetica"),r.nameLabel.fontSize=6,r.nameLabel.color=a.Color.White,r.image=new Image,r.image.onload=function(){this.imageLoaded=!0},r.image.src=e.image,r}return i(e,t),e.prototype.draw=function(t,e){t.drawImage(this.image,this.pos.x-this.getWidth()/2,this.pos.y-this.getHeight()/2-10,this.getWidth(),this.getHeight()),this.nameLabel.pos=this.getCenter(),this.nameLabel.pos.x-=10,this.nameLabel.pos.y+=8+this.getHeight()/2,this.nameLabel.draw(t,e);var n=this.x-this.getWidth()/2+5,r=this.y-23;this.product.forEach(function(e,i){t.fillStyle=u.blockColor(e).desaturate(.3).lighten(.2).toRGBA(),t.fillRect(n+5*i,r-5,4,4)})},Object.defineProperty(e.prototype,"produces",{get:function(){return this.machine.produces},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"consumes",{get:function(){return this.machine.consumes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"workTime",{get:function(){return this.machine.workTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.machine.generationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this.machine.capacity},enumerable:!0,configurable:!0}),e.prototype.interact=function(t){return o(this,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return this.inUse?(t.waitToUse(this),[2]):this.product.length>0?(this.product.pop(),this.inUse=!0,[4,t.progressBar(500)]):[3,2];case 1:return n.sent(),this.inUse=!1,t.carry(this.produces),[3,4];case 2:return this.consumes&&t.carrying===this.consumes?(this.inUse=!0,[4,t.progressBar(this.workTime)]):[3,4];case 3:n.sent(),t.carry(this.produces),this.inUse=!1,n.label=4;case 4:return this.machine.behavior===c.MachineOperation.Work||(this.machine.behavior===c.MachineOperation.CollectResource?(e=t.drop())&&this.building.redeem(e):this.machine.behavior===c.MachineOperation.CollectMeals?t.carrying===u.ResourceBlock.Meal&&(e=t.drop())&&this.building.redeem(e):this.machine.behavior===c.MachineOperation.CollectData?t.carrying===u.ResourceBlock.Data&&(e=t.drop())&&this.building.redeem(e):console.warn("no handler for this interaction",{device:this})),[2]}})})},e.prototype.produce=function(t){var e=this;t%this.generationTime==0&&(this.machine.behavior===c.MachineOperation.Work?this.produces&&!this.consumes&&this.product.length<this.capacity&&this.product.push(this.produces):this.machine.behavior===c.MachineOperation.SpawnCitizen&&setTimeout(function(){return e.building.populate(e.pos)},100))},e.prototype.snap=function(t,e){var n=this;void 0===e&&(e=this.pos);var r=t.colony.closestBuildingByType(e,[l.SmallDome,l.MidDome,l.SmallRoomTwo,l.SmallRoomThree,l.MediumRoom,l.LargeRoom],function(t){return t.hasPlaceForDevice()&&t.structure.machines.some(function(t){return n.machine instanceof t})});return r&&(this.building=r,this.pos=this.building.nextDevicePlace().position),!!r},e.prototype.finalize=function(){},e}(a.Actor);e.Device=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=function(){function t(){this.empty=!0,this.nodes=[],this.edges={},this.edgesInverse={}}return t.prototype.isEmpty=function(){return this.empty},Object.defineProperty(t.prototype,"size",{get:function(){return this.nodes.length},enumerable:!0,configurable:!0}),t.prototype.node=function(t){this.empty=!1,this.contains(t)||this.nodes.push(t)},t.prototype.contains=function(t){return this.nodes.includes(t)},t.prototype.findOrCreate=function(t,e,n){void 0===n&&(n=5);var i=this.dfs(),o=r.minBy(i,function(n){return e(t,n)});return o&&e(o,t)<n?o:t},t.prototype.edge=function(t,e){this.node(t),this.node(e);var n=this.indexOf(t),r=this.indexOf(e);this.edges[n]=this.edges[n]||[],this.edges[n].push(r),this.edgesInverse[r]=this.edgesInverse[r]||[],this.edgesInverse[r].push(n)},t.prototype.union=function(t){var e=this;t.edgeList().forEach(function(t){var n=t[0],r=t[1];return e.edge(n,r)})},t.prototype.edgeList=function(){for(var t=[],e=0,n=this.nodes;e<n.length;e++){var r=n[e],i=this.indexOf(r);if(this.edges[i])for(var o=0,s=this.edges[i];o<s.length;o++){var a=s[o],c=this.nodes[a];t.includes([c,r])||t.push([r,c])}}return t},t.prototype.adjacent=function(t){var e=this,n=this.indexOf(t);return this.adjacentIndices(n).map(function(t){return e.nodes[t]})},t.prototype.adjacentIndices=function(t){var e=this.edges[t]||[],n=this.edgesInverse[t]||[];return e.concat(n)},t.prototype.dfs=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=[]);var r=t?this.indexOf(t):0;return this.dfsIndex(r).map(function(t){return n.nodes[t]})},t.prototype.dfsIndex=function(t,e){var n=this;return void 0===t&&(t=0),void 0===e&&(e=[]),e.push(t),this.adjacentIndices(t).forEach(function(t){e.includes(t)||n.dfsIndex(t,e)}),e},t.prototype.bfs=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=function(){return!0});var r=t?this.indexOf(t):0;return this.bfsIndex(r,e).map(function(t){return n.nodes[t]})},t.prototype.bfsIndex=function(t,e){void 0===t&&(t=null),void 0===e&&(e=function(){return!0});var n=!1,r=[];for(r.push(t);r.length<this.nodes.length;){for(var i=0,o=r;i<o.length;i++){for(var s=o[i],a=0,c=this.adjacentIndices(s);a<c.length;a++){var u=c[a];if(!r.includes(u)){if(!e(s,u)){n=!0;break}r.push(u)}}if(n)break}if(n)break}return r},t.prototype.shortestPath=function(t,e,n){var r=this;void 0===n&&(n=256);var i={},o=this.indexOf(e);this.bfs(t,function(t,e){return i[e]=t,e!==o});for(var s=[],a=o,c=0,u=this.indexOf(t);!s.includes(u)&&c<n;)s.push(a),a=i[a],c+=1;return s.map(function(t){return r.nodes[t]}).reverse()},t.prototype.indexOf=function(t){return this.nodes.indexOf(t)},t}();e.Graph=i},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(50),a=function(t){function e(e){var n=t.call(this,{width:800,height:600,displayMode:o.DisplayMode.FullScreen,backgroundColor:e.skyColor})||this;return n.world=e,n}return i(e,t),e.prototype.start=function(){var e=new o.Loader;for(var n in s.Resources)e.addResource(s.Resources[n]);return t.prototype.start.call(this,e)},e.citizenSpeed=100,e}(o.Engine);e.Game=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(2),c=n(3),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-c.getVisibleDeviceSize(c.DeviceSize.Large)/2;return[new s.Vector(e-t/3,n),new s.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Large)})},e}(o.CommonAreaView);e.LargeRoomView=u},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),s=n(3),a=n(2),c=n(0),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-20;return[new c.Vector(e-t/3,n),new c.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,s.DeviceSize.Medium)})},e}(o.CommonAreaView);e.MediumRoomView=u},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(2),c=n(3),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-20;return[new s.Vector(e-t/3,n),new s.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Medium)})},e}(o.DomeView);e.MidDomeView=u},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(2),c=n(3),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-10;return[new s.Vector(e-t/2,n),new s.Vector(e,n),new s.Vector(e+t/2,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Small)})},e}(o.CommonAreaView);e.SmallRoomThreeView=u},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(7),a=function(t){function e(e,n,r,i){var a=t.call(this,e,n,10,10)||this;a.value=i;var c=new o.Actor(e,n,10,10,s.blockColor(r));return a.add(c),a.count=new o.Label("x"+i,e+10,n+8,"Helvetica"),a.count.fontSize=12,a.count.color=o.Color.White,a.add(a.count),a}return i(e,t),e.prototype.credit=function(t){this.value+=t,this.count.text="x"+this.value},e}(o.Actor);e.ResourceListEntry=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(7),a=n(18),c=function(t){function e(e,n){var r,i=t.call(this,e,n,60,60,o.Color.DarkGray.darken(.8))||this;return i.entries=((r={})[s.ResourceBlock.Food]=null,r[s.ResourceBlock.Hypothesis]=null,r[s.ResourceBlock.Ore]=null,r[s.ResourceBlock.Meal]=null,r[s.ResourceBlock.Mineral]=null,r[s.ResourceBlock.Data]=null,r[s.ResourceBlock.Alloy]=null,r),[s.ResourceBlock.Meal,s.ResourceBlock.Data,s.ResourceBlock.Mineral].forEach(function(t,e){var n=10*e-10,r=new a.ResourceListEntry(-8,n,t,0);i.add(r),i.entries[t]=r}),i}return i(e,t),e.prototype.increment=function(t){console.log("INCREMENT",{resource:t});var e=this.entries[t];e&&e.credit(1)},e}(o.Actor);e.ResourcesList=c},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(8),a=n(19),c=n(6),u=n(1),l=function(t){function e(e,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var i=t.call(this,0,0,e.canvasWidth,e.canvasHeight)||this;return i.game=e,i.onBuildingSelect=n,i.onMachineSelect=r,i.comprehendedStructures=[],i.builtStructures=[],i.comprehendedMachines=[],i.builtMachines=[],i.messageLabel=new o.Label("hi",20,e.canvasHeight-64,"Verdana"),i.messageLabel.fontSize=24,i.messageLabel.color=o.Color.White,i.add(i.messageLabel),i._makeStructurePalette(n),i._makeMachinePalette(r),i.resources=new a.ResourcesList(50,40),i.add(i.resources),i}return i(e,t),e.prototype.setMessage=function(t){this.messageLabel.text=t},e.prototype.draw=function(e,n){if(t.prototype.draw.call(this,e,n),this._structurePaletteElement){var r=e.canvas.offsetLeft,i=e.canvas.offsetTop;this._structurePaletteElement.style.left=r+20+"px",this._structurePaletteElement.style.top=i+100+"px"}if(this._machinePaletteElement){r=e.canvas.offsetLeft;var o=e.canvas.offsetTop;this._machinePaletteElement.style.left=r+this.game.canvasWidth-180+"px",this._machinePaletteElement.style.top=o+100+"px"}},e.prototype.resourceGathered=function(t){this.resources.increment(t)},e.prototype.updatePalettes=function(t){this.updateBuildingPalette(t),this.updateMachinePalette(t)},e.prototype.updateBuildingPalette=function(t){var n=this;this.builtStructures=e.structuresForPalette.filter(function(e){return t.buildings.some(function(t){return t.structure instanceof e})}),this.comprehendedStructures=e.structuresForPalette.filter(function(t){return(new t).prereqs.every(function(t){return n.builtStructures.some(function(e){return e===t})})}),console.log("Built",{built:this.builtStructures,comprehended:this.comprehendedStructures}),this._structurePaletteElement.parentElement.removeChild(this._structurePaletteElement),this._makeStructurePalette(this.onBuildingSelect)},e.prototype.updateMachinePalette=function(t){var n=this,r=t.buildings,i=u.flatSingle(r.map(function(t){return t.structure.machines})),o=t.findAllDevices();this.builtMachines=e.machinesForPalette.filter(function(t){return o.some(function(e){return e.machine instanceof t})}),this.comprehendedMachines=e.machinesForPalette.filter(function(t){return i.includes(t)&&(new t).prereqs.every(function(t){return n.builtMachines.some(function(e){return e===t})})}),this._machinePaletteElement.parentElement.removeChild(this._machinePaletteElement),this._makeMachinePalette(this.onMachineSelect)},e.prototype._makeStructurePalette=function(t){var e=this;this._structurePaletteElement=document.createElement("div"),this._structurePaletteElement.style.position="absolute",this._structurePaletteElement.style.border="1px solid white",document.body.appendChild(this._structurePaletteElement),this.comprehendedStructures.map(function(t){return new t}).forEach(function(n){var r=n.name;e.builtStructures.map(function(t){return(new t).name}).includes(n.name)||(r+=" *");var i=n.dominantColor,o=e.buttonFactory(r,i);e._structurePaletteElement.appendChild(o),t&&(o.onclick=function(){t(n)})})},e.prototype._makeMachinePalette=function(t){var e=this;this._machinePaletteElement=document.createElement("div"),this._machinePaletteElement.style.position="absolute",this._machinePaletteElement.style.border="1px solid white",document.body.appendChild(this._machinePaletteElement),this.comprehendedMachines.map(function(t){return new t}).sort(function(t,e){return t.color>e.color?-1:1}).forEach(function(n){var r=n.name;e.builtMachines.map(function(t){return(new t).name}).includes(n.name)||(r+=" *");var i=n.color,o=e.buttonFactory(r,i);e._machinePaletteElement.appendChild(o),t&&(o.onclick=function(){t(n)})})},e.prototype.buttonFactory=function(t,e){var n=e.darken(.6).desaturate(.5).clone();n.a=.8;var r=e.lighten(.8).desaturate(.4).clone(),i=document.createElement("button");return i.textContent=t,i.style.display="block",i.style.fontSize="12pt",i.style.fontFamily="Helvetica",i.style.fontWeight="600",i.style.padding="8px",i.style.width="160px",i.style.textTransform="uppercase",i.style.border="1px solid rgba(255,255,255,0.08)",i.style.background=n.toRGBA(),i.style.color=r.toRGBA(),i.onmouseover=function(){i.style.background=n.saturate(.5).lighten(.95).toRGBA(),i.style.color=r.lighten(.9).toRGBA()},i.onmouseleave=function(){i.style.background=n.toRGBA(),i.style.color=r.toRGBA()},i},e.structuresForPalette=[s.SurfaceRoad,s.Corridor,s.Ladder,s.SmallDome,s.MidDome,s.SmallRoomTwo,s.SmallRoomThree,s.MediumRoom,s.LargeRoom],e.machinesForPalette=[c.AlgaeVat,c.Arbor,c.Bed,c.Bookshelf,c.Cabin,c.CloningVat,c.Desk,c.Fabricator,c.Fridge,c.Houseplant,c.Megafabricator,c.MiningDrill,c.Orchard,c.OxygenExtractor,c.Preserve,c.ResearchServer,c.SolarCell,c.Stove,c.WaterCondensingMachine,c.Workstation],e}(o.UIActor);e.Hud=l},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),s=n(0),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floorHeight=150,e}return i(e,t),e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new s.Vector(Math.floor(t),Math.floor(e)-4)]},e}(o.CommonAreaView);e.MineView=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),s=n(5),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.originSlot=null,e}return i(e,t),e.prototype.constrainCursor=function(t){return this.pickingOrigin||(t.x=this.pos.x),t},e.prototype.reshape=function(t){if(this.pickingOrigin){var e=this.alignToSlot(t);e&&(this.facing=e.facing,e&&(this.originSlot=e))}else if(this.facing===s.Orientation.Up){var n=this.originSlot.pos.y-this.planet.getTop()-25,r=Math.min(n,Math.max(100,this.originSlot.pos.y-t.y));this.setHeight(r/50*50),this.pos.y=this.originSlot.pos.y-this.getHeight()}else r=Math.max(100,t.y-this.originSlot.pos.y),this.setHeight(r/50*50)},e}(o.TunnelView);e.LadderView=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.draw=function(t,e){this.drawShape(t,this.pos.x,this.pos.y)},e.prototype.drawShape=function(t,e,n){var r=this.getHeight(),i=this.getWidth();t.beginPath(),t.moveTo(0+e,r+n),t.bezierCurveTo(1+e,r-150+n,121+e,70+n,i-80+e,8+n),t.bezierCurveTo(i-40+e,2+n,i-5+e,11+n,i-10+e,25+n),t.bezierCurveTo(i-5+e,10+n,i+e,r-10+n,i+e,r+n),t.lineTo(0+e,r+n),t.fillStyle=this.mainColor().toRGBA(),t.fill()},e}(n(4).DomeView);e.ArcologyView=o},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(1),c=n(5),u=n(12),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pickingOrigin=!0,e.hideBox=!0,e}return i(e,t),e.prototype.colorBase=function(){return this.color.darken(.2)},e.prototype.draw=function(e,n){var r=this.aabb();a.drawRect(e,r,0,this.color.darken(.1)),r.x=r.x+this.getWidth()/5,r.width-=this.getWidth()/5*2,a.drawRect(e,r,0,this.color.darken(.2)),t.prototype.draw.call(this,e,n)},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y;return[new o.Vector(Math.floor(t),e)]},e.prototype.graph=function(t){void 0===t&&(t=new u.Graph);var e=t,n=this.getWidth()/2,r=this.pos.x+n,i=e.findOrCreate(this.nodes()[0],a.measureDistance),s=e.findOrCreate(new o.Vector(r,this.slotHeights()[0]),a.measureDistance);e.edge(i,s);var c=this.slotHeights();a.eachCons(c,2).forEach(function(t){var n=t[0],i=t[1],s=e.findOrCreate(new o.Vector(r,n),a.measureDistance),c=e.findOrCreate(new o.Vector(r,i),a.measureDistance);e.edge(s,c)});var l=e.findOrCreate(new o.Vector(r,this.pos.y+this.getHeight()),a.measureDistance),h=e.findOrCreate(new o.Vector(r,c[c.length-1]),a.measureDistance);e.edge(l,h),c.forEach(function(t){var i=e.findOrCreate(new o.Vector(r,t),a.measureDistance),s=e.findOrCreate(new o.Vector(r-n,t),a.measureDistance);e.edge(s,i);var c=e.findOrCreate(new o.Vector(r+n,t),a.measureDistance);e.edge(i,c)});for(var p=0,f=this.childrenBuildings;p<f.length;p++){var d=f[p],y=e.findOrCreate(d.parentSlot.pos,a.measureDistance),v=e.findOrCreate(d.nodes()[0],a.measureDistance);e.edge(v,y),e.edge(y,v),d.graph(e)}return e},e.prototype.slotHeights=function(){for(var t=Math.floor(this.getHeight()/50),e=[],n=0,r=a.range(t);n<r.length;n++){var i=r[n];e.push(50+this.pos.y+50*i)}return e},e.prototype.slots=function(){var t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,c.Orientation.Up));for(var e=0,n=this.slotHeights();e<n.length;e++){var r=n[e];t.push(this.buildSlot(this.pos.x,r,c.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),r,c.Orientation.Right))}return t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),c.Orientation.Down)),t},e.prototype.handleClick=function(t){return!this.pickingOrigin||(this.pickingOrigin=!1,!1)},e.prototype.constrainCursor=function(t){return this.pickingOrigin?this.alignToSlot(t):t.y=Math.max(this.planet.getTop()+100,t.y),t},e.prototype.reshape=function(t){this.pos.y=this.planet.getTop()+2,this.pickingOrigin||this.setHeight(t.y-this.planet.getTop())},e}(s.Building);e.TunnelView=l},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(5),c=n(11),u=n(3),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hideBox=!0,e}return i(e,t),e.prototype.devicePlaces=function(){return this.nodes().map(function(t){return t.y-=20,new s.DevicePlace(t,u.DeviceSize.Medium)})},e.prototype.afterConstruct=function(){var t=this,e=this.structure.machines;if(e&&e.length>0){var n=new e[0];this.devicePlaces().forEach(function(e){var r=new c.Device(n,e.position);t.addDevice(r)})}},e.prototype.slots=function(){var t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),a.Orientation.Down));var e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,a.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,a.Orientation.Right)),t},e.prototype.constrainCursor=function(t){return t.y=this.planet.getTop(),t},e.prototype.reshape=function(t){this.pos=t,this.pos.y-=this.getHeight()-2},e.prototype.draw=function(e,n){var r=this.mainColor();e.fillStyle=r.toRGBA(),e.fillRect(this.pos.x,this.pos.y,this.getWidth(),this.getHeight());var i=this.pos.x+this.getWidth()/4*3,o=this.pos.y-18;e.fillRect(i,o,2,18),e.fillRect(i,o,10,5),t.prototype.draw.call(this,e,n)},e.prototype.colorBase=function(){return o.Color.White},e}(s.Building);e.MissionControlView=l},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(5),c=n(3),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hideBox=!0,e.showLabel=!0,e}return i(e,t),e.prototype.slots=function(){var t=[],e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,a.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,a.Orientation.Right)),t},e.prototype.reshape=function(t){this.alignToSlot(t)},e.prototype.draw=function(e,n){var r=this.mainColor();e.beginPath(),e.arc(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),this.getHeight()/1.5,0,Math.PI,!0),e.closePath(),e.fillStyle=r.toRGBA(),e.fill(),t.prototype.draw.call(this,e,n)},e.prototype.colorBase=function(){return o.Color.White.darken(.05)},e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-6;return[new o.Vector(e-t/3,n),new o.Vector(e+t/3,n)].map(function(t){return new s.DevicePlace(t,c.DeviceSize.Small)})},e}(s.Building);e.DomeView=u},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(5),a=n(0),c=n(3),u=n(1),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floorHeight=10,e.edgeWidth=.5,e.showLabel=!0,e.hideBox=!0,e}return i(e,t),e.prototype.colorBase=function(){return this.color.darken(.3)},e.prototype.draw=function(e,n){u.drawRect(e,this.aabb(),.125,this.processedColor()),u.drawRect(e,{x:this.x,y:this.y+this.getHeight()-this.floorHeight,width:this.getWidth(),height:this.floorHeight},0,this.colorBase().lighten(.7)),t.prototype.draw.call(this,e,n)},e.prototype.slots=function(){var t=[],e=this.getHeight()-this.floorHeight,n=this.buildSlot(this.pos.x,this.pos.y+e,s.Orientation.Left);t.push(n);var r=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,s.Orientation.Right);return t.push(r),t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,s.Orientation.Up)),t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),s.Orientation.Down)),t},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new a.Vector(Math.floor(t),Math.floor(e))]},e.prototype.reshape=function(t){this.alignToSlot(t)},e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-10;return[new a.Vector(e-t/3,n),new a.Vector(e+t/3,n)].map(function(t){return new o.DevicePlace(t,c.DeviceSize.Small)})},e}(o.Building);e.CommonAreaView=l},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(5),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.edgeWidth=0,e.pickingOrigin=!0,e.facing=s.Orientation.Left,e.originX=0,e}return i(e,t),e.prototype.colorBase=function(){return this.color.darken(.2)},e.prototype.slots=function(){var t=[],e=this.getHeight()/2;return t.push(this.buildSlot(this.pos.x,this.pos.y+e,s.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,s.Orientation.Right)),t},e.prototype.handleClick=function(t){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(t)),!1)},e.prototype.constrainCursor=function(t){var e=t.clone();return this.pickingOrigin||(e.y=this.pos.y),e},e.prototype.reshape=function(t){if(this.pickingOrigin){var e=this.alignToSlot(t);e&&(this.facing=e.facing,e&&this.facing===s.Orientation.Left&&(this.originX=e.pos.x))}else this.facing===s.Orientation.Left?(this.setWidth(Math.abs(this.originX-t.x)),this.pos.x=this.originX-this.getWidth()):this.setWidth(Math.abs(this.pos.x-t.x))},e}(o.Building);e.CorridorView=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),s=function(){function t(){}return t.label="(generic)",t.machines=[],t}();e.SpaceFunction=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Living Quarters",e.machines=[o.Bed],e}(s),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Barracks",e.machines=[o.Bed,o.Bed,o.Bed],e}(s),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Kitchen",e.machines=[o.Stove,o.Fridge],e}(s),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Life Support Module",e.machines=[o.OxygenExtractor,o.WaterCondensingMachine],e}(s),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Retreat",e.machines=[o.Cabin,o.Cabin],e}(s),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Clone Matrix",e.machines=[o.CloningVat,o.CloningVat],e}(s),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Reading Room",e.machines=[o.Bookshelf,o.Bookshelf],e}(s),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Library",e.machines=[o.Bookshelf,o.Bookshelf,o.Bookshelf],e}(s),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Study",e.machines=[o.Workstation,o.Desk],e}(s),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Archive",e.machines=[o.ResearchServer,o.ResearchServer],e}(s),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Arboretum",e.machines=[o.Arbor,o.Arbor],e}(s),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Algae Farm",e.machines=[o.AlgaeVat,o.AlgaeVat],e}(s),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Solar Array",e.machines=[o.SolarCell,o.SolarCell],e}(s),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Workshop",e.machines=[o.Fabricator,o.Fabricator],e}(s),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Nursery",e.machines=[o.Houseplant,o.Houseplant,o.Houseplant],e}(s),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Farm",e.machines=[o.Orchard,o.Orchard],e}(s),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.label="Factory",e.machines=[o.Megafabricator,o.Megafabricator],e}(s);e.allSpaceFunctions=[d,c,l,p,a,u,m,v,g,b,h,y,_,f,w,O,P]},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=function(t){function e(){var e=t.call(this)||this;return e.setWidth(5),e.setHeight(5),e.x=5,e.y=5,e.color=new o.Color(255,255,255),e}return i(e,t),e}(o.Actor);e.Player=s},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}c((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),c=n(7),u=n(13),l=(n(1),n(9)),h=n(6),p=function(t){function e(e,n){var r=t.call(this,e.x,e.y,l.Scale.minor.first,l.Scale.minor.third,a.Color.White)||this;return r.device=e,r.planet=n,r.walkSpeed=u.Game.citizenSpeed,r.carrying=null,r.path=[],r.workInProgress=!1,r.traits=r.traits.filter(function(t){return!(t instanceof a.Traits.OffscreenCulling)}),r}return i(e,t),e.prototype.update=function(e,n){if(t.prototype.update.call(this,e,n),this.workInProgress){var r=(new Date).getTime();this.progress=(r-this.workStarted)/this.workDuration}},e.prototype.draw=function(e,n){if(t.prototype.draw.call(this,e,n),this.carrying&&(e.fillStyle=c.blockColor(this.carrying).toRGBA(),e.fillRect(this.x+4,this.y-3,5,5)),this.workInProgress){e.lineWidth=1;var r=this.x-5,i=this.y-10;e.strokeStyle=a.Color.White.toRGBA(),e.strokeRect(r,i,10,3),e.fillStyle=a.Color.Violet.darken(.9).toRGBA(),e.fillRect(r,i,10,3),e.fillStyle=a.Color.Violet.toRGBA(),e.fillRect(r,i,10*this.progress,3),this.vel.x+=Math.random()-.5}this.path},e.prototype.carry=function(t){this.carrying=t},e.prototype.drop=function(){if(this.carrying){var t=this.carrying;return this.carrying=null,t}return null},e.prototype.glideTo=function(t){return this.actions.moveTo(t.x,t.y,this.walkSpeed).asPromise()},e.prototype.progressBar=function(t){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.workInProgress=!0,this.workStarted=(new Date).getTime(),this.workDuration=t,[4,new Promise(function(e,n){return setTimeout(e,t)})];case 1:return e.sent(),this.workInProgress=!1,[2]}})})},e.prototype.pathTo=function(t){return o(this,void 0,void 0,function(){var e,n=this;return s(this,function(r){switch(r.label){case 0:return(e=this.planet.pathBetween(this.pos.clone(),t)).length>0?(this.path=e,e.pop(),e.shift(),[4,Promise.all(e.map(function(t){return n.glideTo(t)}))]):[3,2];case 1:r.sent(),this.path=null,r.label=2;case 2:return[2,!0]}})})},e.prototype.waitToUse=function(t){var e=this;setTimeout(function(){return t.interact(e)},250)},e.prototype.work=function(){return o(this,void 0,void 0,function(){var t,e,n,r=this;return s(this,function(i){switch(i.label){case 0:return this.carrying?(t=this.carrying,(e=this.planet.closestDevice(this.pos,[],function(e){return e.machine.consumes===t||e.machine.behavior===h.MachineOperation.CollectResource||t===c.ResourceBlock.Meal&&e.machine.behavior===h.MachineOperation.CollectMeals||t===c.ResourceBlock.Data&&e.machine.behavior===h.MachineOperation.CollectData}))?[4,this.pathTo(e.building)]:[3,4]):[3,6];case 1:return i.sent(),[4,this.glideTo(e.pos)];case 2:return i.sent(),[4,e.interact(this)];case 3:return i.sent(),[3,5];case 4:console.log("nowhere to deliver it",this.carrying),i.label=5;case 5:return[3,12];case 6:return(n=this.planet.closestDevice(this.pos,[],function(t){return t.product.length>0}))?[4,this.pathTo(n.building)]:[3,10];case 7:return i.sent(),[4,this.glideTo(n.pos)];case 8:return i.sent(),[4,n.interact(this)];case 9:return i.sent(),[3,12];case 10:return console.log("i guess i can try again? (sleep for a bit first)"),[4,new Promise(function(t,e){return setTimeout(t,150)})];case 11:i.sent(),i.label=12;case 12:return setTimeout(function(){return r.work()},100),[2]}})})},e}(a.Actor);e.Citizen=p},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(31),a=function(t){function e(e){var n=t.call(this,0,-e.getHeight()/2,0,0)||this;return n.planet=e,n.citizens=[],n.traits=n.traits.filter(function(t){return!(t instanceof o.Traits.OffscreenCulling)}),n}return i(e,t),e.prototype.increase=function(t){var e=new s.Citizen(t,this.planet);e.work(),this.citizens.push(e),this.add(e)},e}(o.Actor);e.Population=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=function(){function t(t){this.graph=t.graph()}return t.prototype.seekPath=function(t,e){return this.graph.shortestPath(t,e)},t.prototype.closestNode=function(t){var e=this.graph.dfs();return r.minBy(e,function(e){return Math.abs(t.distance(e))})||!1},t}();e.NavigationTree=i},function(t,e,n){t.exports=n.p+"cffe40698a3b47b52ca0ff90a2c86ddf.svg"},function(t,e,n){t.exports=n.p+"43062e54318df93f49e2be9a4281eb4a.svg"},function(t,e,n){t.exports=n.p+"86e09b7a9e4997af44c45206eb8694ad.svg"},function(t,e,n){t.exports=n.p+"c4ab2ceb2f61e18493fc776770c65654.svg"},function(t,e,n){t.exports=n.p+"bbd50a175546bd70d21c5eadbc30d479.svg"},function(t,e,n){t.exports=n.p+"7441c2ab240d0f733451d75204ac0792.svg"},function(t,e,n){t.exports=n.p+"91a8cce06c3c05ce6e4b176afafd7b0a.svg"},function(t,e,n){t.exports=n.p+"0ce4f9c3384680565b6bb16495b64233.svg"},function(t,e,n){t.exports=n.p+"1db542acabeb82ec8da785e77afd4dca.svg"},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=n(8),c=n(33),u=function(t){function e(e,n){var r=t.call(this,e,n,0,0)||this;return r.buildings=[],r.currentlyConstructing=null,r.maxPop=8,r.traits=r.traits.filter(function(t){return!(t instanceof o.Traits.OffscreenCulling)}),r}return i(e,t),e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n),this.navTree},e.prototype.placeBuilding=function(t){t.built=!0,t.parentSlot&&(t.parentSlot.parent.childrenBuildings.push(t),this.buildNavTree()),this.buildings.push(t),t.afterConstruct(),this.add(t)},e.prototype.closestBuildingByType=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=function(){return!0});var r=this.buildings.filter(function(t){return(!(e.length>0)||e.some(function(e){return t.structure instanceof e}))&&n(t)});if(r&&r.length>0)return s.minBy(r,function(e){return t.distance(e.nodes()[0])})},e.prototype.pathBetween=function(t,e){this.navTree||this.buildNavTree();var n=this.navTree.closestNode(t),r=e.nodes()[0],i=this.navTree.closestNode(r);return this.navTree.seekPath(n,i)},e.prototype.closestDeviceByType=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=function(){return!0});var r=this.findAllDevices();if((r=r.filter(function(t){return(!(e.length>0)||e.some(function(e){return t.machine instanceof e}))&&n(t)}))&&r.length>0)return s.minBy(r,function(e){return t.distance(e)})},e.prototype.buildNavTree=function(){var t=this.buildings.find(function(t){return t.structure instanceof a.MissionControl});t&&(this.navTree=new c.NavigationTree(t))},e.prototype.findAllDevices=function(){return s.flatSingle(this.buildings.map(function(t){return t.getDevices()}))},e}(o.Actor);e.Colony=u},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.peaks=[],e}return i(e,t),e.prototype.onInitialize=function(){for(var t=this.getWidth()/2,e=this.getWidth()/20,n=0,r=s.range(5);n<r.length;n++)for(var i=r[n],o=100*i,a=3*i*(e/2),c=0,u=s.range(20);c<u.length;c++){var l=u[c];this.peaks.push({x:l*e-t+(Math.random()*a-a/2),height:Math.max(10,1e3+3e3*Math.random()+(Math.random()*o-o/2))})}},e.prototype.draw=function(t,e){var n=this.color.desaturate(.25),r=this.color.saturate(.2).lighten(.5);t.fillStyle=n.toRGBA();var i=this.pos.y-3;this.peaks.forEach(function(e){var o=i-e.height,s=3.4*e.height;t.beginPath(),t.moveTo(e.x,o),t.lineTo(e.x-s,i),t.lineTo(e.x+s,i),t.fillStyle=n.toRGBA(),t.fill(),t.beginPath(),t.moveTo(e.x,o),t.lineTo(e.x+s/4*3,i),t.lineTo(e.x+s,i),t.fillStyle=r.toRGBA(),t.fill()})},e}(function(t){function e(e,n,r){return t.call(this,0,e,n,500,r)||this}return i(e,t),e}(o.Actor));e.Mountains=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(0),a=n(1),c=n(44),u=n(43),l=n(32),h=n(6),p=function(t){function e(e,n,r,i){void 0===r&&(r=2e6),void 0===i&&(i=1e7);var s=t.call(this,0,i/2,r,i,n)||this;s.hud=e,s.color=n,s.width=r,s.depth=i,s.traits=s.traits.filter(function(t){return!(t instanceof o.Traits.OffscreenCulling)});var h=-i/2;s.createLayer(h,20,s.color.lighten(.25));for(var p=i/10,f=0,d=a.range(10);f<d.length;f++){var y=d[f];s.createLayer(h+20+p/2+p*(y+1),p,s.color.darken(.05+.01*y))}return s.add(new c.Mountains(-i/2,s.getWidth(),s.color.lighten(.15))),s.colony=new u.Colony(0,-i/2),s.add(s.colony),s.population=new l.Population(s),s.add(s.population),s}return i(e,t),e.prototype.createLayer=function(t,e,n){var r=new s.Actor(0,t,this.getWidth(),e,n);this.add(r)},e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n),this.currentlyConstructing&&this.currentlyConstructing.draw(e,n)},e.prototype.update=function(e,n){t.prototype.update.call(this,e,n),this.colony.buildings.forEach(function(t){return t.update(e,n)}),this.population.citizens.forEach(function(t){return t.update(e,n)})},Object.defineProperty(e.prototype,"currentlyConstructing",{get:function(){return this.colony.currentlyConstructing},enumerable:!0,configurable:!0}),e.prototype.gather=function(t){this.hud.resourceGathered(t)},e.prototype.placeBuilding=function(t){this.colony.placeBuilding(t)},e.prototype.populate=function(t){if(this.population.citizens.length<this.colony.maxPop){var e=this.closestDevice(t,[h.CloningVat]);this.population.increase(e)}},e.prototype.closestBuildingByType=function(t,e,n){return void 0===n&&(n=function(){return!0}),this.colony.closestBuildingByType(t,e,n)},e.prototype.closestDevice=function(t,e,n){return void 0===e&&(e=[]),void 0===n&&(n=function(){return!0}),this.colony.closestDeviceByType(t,e,n)},e.prototype.pathBetween=function(t,e){return this.colony.pathBetween(t,e)},e}(s.Actor);e.Planet=p},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(45),a=n(30),c=n(8),u=n(4),l=n(20),h=n(10),p=n(11),f=n(6),d=n(17),y=n(16),v=n(15),g=n(14),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dragging=!1,e}return i(e,t),e.prototype.onInitialize=function(t){var e=this;this.game=t,this.hud=new l.Hud(t,function(t){e.startConstructing(t)},function(t){e.startConstructing(t)}),this.add(this.hud),this.planet=new s.Planet(this.hud,t.world.color),this.add(this.planet),this.player=new a.Player,this.add(this.player),this.prepareNextBuilding(),this.camera.zoom(.001),this.camera.zoom(2,1e4)},e.prototype.onActivate=function(){var t=this;this.game.input.pointers.primary.on("move",function(e){if(t.dragging)t.camera.pos=t.camera.pos.add(t.dragOrigin.sub(e.pos));else{t.player.pos=e.pos;var n=t.planet.currentlyConstructing;if(n instanceof u.Building){var r=n.constrainCursor(t.player.pos);t.player.pos=r,n.reshape(t.player.pos)}else n instanceof p.Device&&n.snap(t.planet,t.player.pos)}}),this.game.input.pointers.primary.on("up",function(){t.dragging&&(t.dragging=!1)}),this.game.input.pointers.primary.on("down",function(e){if(e.button==o.Input.PointerButton.Left){var n=t.planet.currentlyConstructing;if(n)if(n instanceof u.Building){var r=n,i=!r.overlapsAny();r&&i&&r.handleClick(e.pos)&&(t.planet.placeBuilding(r),t.planet.colony.currentlyConstructing=null,t.prepareNextBuilding(e.pos),t.hud.updatePalettes(t.planet.colony))}else{var s=n;s.snap(t.planet)&&(s.building.addDevice(s),t.planet.colony.currentlyConstructing=null,t.hud.updatePalettes(t.planet.colony))}}else e.button===o.Input.PointerButton.Middle&&(t.dragging=!0,t.dragOrigin=e.pos)}),this.game.input.pointers.primary.on("wheel",function(e){var n=t.camera.getZoom();e.deltaY<0?t.camera.zoom(Math.min(n+.05,8)):e.deltaY>0&&t.camera.zoom(Math.max(n-.05,.05))}),this.game.input.keyboard.on("press",function(e){e.key===o.Input.Keys.H?t.buildings&&t.buildings[0]&&(t.camera.move(t.buildings[0].pos,500),t.camera.zoom(.5,1e3)):e.key===o.Input.Keys.Esc&&(t.planet.colony.currentlyConstructing=null)})},e.prototype.onDeactivate=function(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")},Object.defineProperty(e.prototype,"buildings",{get:function(){return this.planet.colony.buildings},enumerable:!0,configurable:!0}),e.prototype.nextMissingRequiredStructure=function(){var t=e.requiredStructureList.map(function(t){return new t}),n=this.buildings.map(function(t){return t.structure.name});return t.find(function(t){return!n.includes(t.name)})},e.prototype.prepareNextBuilding=function(t){void 0===t&&(t=new o.Vector(0,0));var e=null,n=this.nextMissingRequiredStructure();n&&(e=n),e?this.startConstructing(e,t):this.hud.setMessage("Welcome to OSIRIS!")},e.prototype.startConstructing=function(t,e){void 0===e&&(e=new o.Vector(0,0));var n=null;if(t instanceof c.Structure){var r=t;this.hud.setMessage("Place "+r.name),n=this.spawnBuilding(r,e),this.camera.zoom(r.zoom,250)}else if(t instanceof f.Machine){var i=t;n=this.spawnDevice(i,e),this.camera.zoom(1.5,250)}this.planet.colony.currentlyConstructing=n,n&&(console.warn("would start constructing",{theNextOne:n}),this.camera.pos=n.pos)},e.prototype.spawnDevice=function(t,e){var n=new p.Device(t,e);return n.snap(this.planet),n},e.prototype.spawnBuilding=function(t,e){var n=this.assembleBuildingFromStructure(t,e);return n.reshape(n.constrainCursor(n.pos)),n},e.prototype.assembleBuildingFromStructure=function(t,n){return new(0,e.structureViews[t.view])(n,t,this.planet)},e.structureViews={CommonAreaView:u.CommonAreaView,CorridorView:u.CorridorView,DomeView:u.DomeView,LadderView:u.LadderView,MidDomeView:y.MidDomeView,MissionControlView:u.MissionControlView,SmallRoomThreeView:d.SmallRoomThreeView,SurfaceRoadView:h.SurfaceRoadView,TunnelView:u.TunnelView,MediumRoomView:v.MediumRoomView,LargeRoomView:g.LargeRoomView},e.requiredStructureList=[c.MissionControl,c.SurfaceRoad,c.MainTunnel,c.Corridor],e}(o.Scene);e.Construct=m},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=n(1),o=function(){function t(){this.color=i.sample(t.colors).darken(.1).desaturate(.8),this.skyColor=i.sample([r.Color.Cyan,r.Color.Vermillion]).lighten(.15).desaturate(.65)}return t.colors=[r.Color.Red,r.Color.Blue,r.Color.Green],t}();e.World=o},function(t,e,n){t.exports=n.p+"0f6ac78b40c6bc151aee01b517f49ca1.png"},function(t,e,n){t.exports=n.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=n(49),o=n(48),s={Sword:new r.Texture(i),Bookshelf:new r.Texture(o)};e.Resources=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(13),i=n(47),o=n(46),s=new i.World,a=new r.Game(s),c=new o.Construct(a);a.add("construct",c),a.start().then(function(){a.goToScene("construct")})}]);
//# sourceMappingURL=main.js.map