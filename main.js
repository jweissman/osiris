!function(e){function t(t){for(var o,s,a=t[0],c=t[1],u=t[2],p=0,h=[];p<a.length;p++)s=a[p],i[s]&&h.push(i[s][0]),i[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(l&&l(t);h.length;)h.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(o=!1)}o&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},i={1:0},r=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;r.push([125,0]),n()}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=function(e,t,n){return e.reduce(function(e,o){var i=[t(o),o];return e&&n.apply(null,[e[0],i[0]])==e[0]?e:i},null)[1]};function r(e,t,n){for(var o=[],i=0;i<n;i++)o.push(e[t+i]);return o}t.minBy=function(e,t){return i(e,t,Math.min)},t.maxBy=function(e,t){return i(e,t,Math.max)},t.sample=function(e){return e[Math.floor(Math.random()*e.length)]},t.range=function(e){return Array(e).fill(0).map(function(e,t){return t})},t.closest=function(e,n,o,i){var r=n;if(i&&(n=n.filter(i)),r)return t.minBy(r,function(t){return e.distance(o(t))})},t.flatSingle=function(e){return[].concat.apply([],e)},t.deleteByValue=function(e,t){return e.filter(function(e){return e!==t})},t.deleteByValueOnce=function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)},t.eachCons=function(e,t){for(var n=[],o=0;o<e.length-t+1;o++)n.push(r(e,o,t));return n},t.eachChunk=function(e,t){return e.reduce(function(e,n,o,i){return o%t==0&&e.push(i.slice(o,o+t)),e},[])},t.measureDistance=function(e,t){return e.distance(t)},t.sleep=function(e){return new Promise(function(t){return setTimeout(t,e)})},t.shuffle=function(e){return e.sort(function(){return Math.random()>.5?1:-1})},t.zip=function(e,t){return e.map(function(e,n){return[e,t[n]]})},t.countOccurrences=function(e){var t={};return e.forEach(function(e){t[e]=t[e]||0,t[e]+=1}),t},t.containsUniq=function(e,n){var o=!1,i=e.slice();if(e.length>0){var r=!1;n.forEach(function(e){i.find(function(t){return t===e})?t.deleteByValueOnce(i,e):r=!0}),o=!r}return o},t.mixColors=function(e,t,n){void 0===n&&(n=.5);var i=n,r=1-n;return new o.Color(e.r*i+t.r*r,e.g*i+t.g*r,e.b*i+t.b*r,1)},t.onlyUnique=function(e,t,n){return n.indexOf(e)===t}},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(24),a=function(e){function t(t){var n=e.call(this,{width:800,height:600,displayMode:r.DisplayMode.FullScreen,backgroundColor:r.Color.Black})||this;return n.world=t,n}return i(t,e),t.prototype.start=function(){var n=new r.Loader;for(var o in s.Resources)n.addResource(s.Resources[o]);return n.backgroundColor="#0a0e0c",n.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwAAAADACAYAAACzgQSnAAAIHElEQVR4nO3dMYobSRQGYO2yqbPF2cAaM5s7E+gGXrBv4sAHcTA3scG+QYMy5xbGhskGZ3OA3UDQ1GrU6mqpS13d7/uixmjs6pqHoHi/X61WAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAEfpt6AUC/h4dfvZ+5327b55v1+t+S67nfbtvvjpv1uvfzz5//WXI5xeXs/4Gi+78a+N19zf0/2Kt0H9o1d63nxM9OpXefS+ztJXtYgvqH5fl96gUAAADX4wAAAACB/DH1AoDj0rb7ty+f2+e/X/9ztL2eRnE+vHxRcGWr1fvvP3pb/N++fG7b9Om7zKUdfyL2kBNvKB2vHLSGOe7/ganiql37vKS9PUr9w7LpAAAAQCAOAAAAEIgpQDCxrlZ711Sf0vGesbz//qN93jVN+11zu9kc/fxUrfnMCSdHJ7HkGOu9LpzEcrVpNoWmAF1t+s1Y9XDJOq+5D+p/TzSIaHQAAAAgEAcAAAAIRAQIJjB0ws9cYj+pn4+P7fNdR/v+66eP7XfQqzdv2z+fMObRO/UlVVtsoIb3mnsEqEvm3o6yn6X3oYY6KWGp7wUl6AAAAEAgDgAAABCIi8DgSnJiP3OM+uR419FSv3v41b57GgcqcXHPJRGOVM3xgHRtB+/b9V5H393FSU9l7u3Z03JKU/9HqX/C0gEAAIBAHAAAACAQESCYQITYz1/PnrXP6USgVBoNSuNAq/LxiaIXOdUgc9LOLOIrtTkRNTmqwkiJ+t9T/4SlAwAAAIE4AAAAQCAiQFBQ2m6+327b55v1eorlzMauadrnS+ITOfGM1NxjDzkWEF+pWVWREvX/lPqHPR0AAAAIxAEAAAACEQGCkUW+8OsSXROBhl4QNtaFRwH1xlfEIZ4aGikpTf2fTf0Tig4AAAAE4gAAAACBiABBQWI/5xnxgrDFX3h0iRPxlaqm2XA29X+C+icyHQAAAAjEAQAAAAIRAQLCiRx76FLbNBvKUf9PqX+i0QEAAIBAHAAAACAQESAY2f122z7frNcTrmR5dk3TPmvTT8ulSHs11GENawDmRQcAAAACcQAAAIBARIBgZDfrtcu/VqvVz8fHUf6eMy4Fc3HPuFyKlK+G/alhDUui/lkkHQAAAAjEAQAAAAIRAQJCiDypZiiXIp02dE9qqL0a1jAX6p8IdAAAACAQBwAAAAhEBAiAXGEnn5yIgpgME4ffL4uhAwAAAIE4AAAAQCAiQMBoxrr8qwTTPMiRWSe9sZ/apu6ofyClAwAAAIE4AAAAQCAiQMBFao79rP4f1WBck0xEuXKUpat+ZhH7Wan/kkwEYtZ0AAAAIBAHAAAACEQECBis8tiP1nw5U0VKpvp3e2upwtiP+i9HpIrF0AEAAIBAHAAAACAQESAgS+Wxn14VRjVmoZILpErHWmZ3sddQc1//VCqpfxidDgAAAATiAAAAAIGIAAGdZhr7ORrnSFv54hCn1Rx7GOt3d/COaeynNw5UOfV/oZrrH8aiAwAAAIE4AAAAQCAiQDCy++22bbu///6jbcd/ePlimgVlqDnqc5e043dN0+7t7WbT9SNLinPUYJF7mMZgciIfM4rQqP9x2UMWSQcAAAACcQAAAIBARIBgZDfr9dRLyFJz7KdLGvvpimGY4HEdlcdgLtEboaktDjQ0zgSgAwAAAIE4AAAAQCAiQLBAc4z3XFNtEY4aRI6OnIjQLHKijvp/KnL9E5MOAAAABOIAAAAAgYgAQUHfvnw+einYO233k9LLv75++tju4as3b4f+VbOb6HJNJ2IPi4m7DLWwC8LU/wnqn8h0AAAAIBAHAAAACEQECEbWFSHYNU3bSr57+CUOdOCuY6/S2E9ORCHaRJcR9e5JtIjIgVnEadT/2dQ/oegAAABAIA4AAAAQiAgQFDR0ogh7t5tN+3xJ231hE11GMbQOl7oPOeYep1H/T6l/2NMBAACAQBwAAAAgEBEgmEB6uVXkiUAjXvg11KCJLqm5RAIyow7Vxldqs7A4jfrfU/+EpQMAAACBOAAAAEAgIkBwJV0Rgq44UGru0aC7jnZ8V+ynRMzgjIkuRz9Tc7TjROyh971Stb1X5ZZ6QdjRz9TwLl3UP+TTAQAAgEAcAAAAIBD/6x0m1tW23jVN+3y72cxuUlAa+9k1Tftdk17ylZqq7V56WshY73XGRXKD1lxonUfX0PVvXfKzU8mMnQxa/zX3Qf3v1VZXUJoOAAAABOIAAAAAgYgAQaUOJgW1z6/evO2aaNEqHRPqmuqTuuaEnxLOmCiSKv3devYaSu9/tAhQKmf9qZr3Qf3DsukAAABAIA4AAAAQiIvAoFKZF/e00qlBXReKjSVnqs8cYz+poft/oOj+Z66hNcf9X4DeC8Jqpv5h2XQAAAAgEAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACjrP5jX6VZYFfcVAAAAAElFTkSuQmCC",n.logoWidth=768,n.logoHeight=192,n.startButtonFactory=function(){var e=document.createElement("button");return e.textContent="Make Planetfall",e.style.border="none",e.style.display="block",e.style.padding="24px",e.style.fontFamily=t.font,e.style.color="white",e.style.fontSize="20pt",e.style.fontWeight="300",e.style.backgroundColor="#9a5e5c",e.onmouseenter=function(){e.style.backgroundColor=r.Color.Red.darken(.5).toRGBA()},e.onmouseleave=function(){e.style.backgroundColor="#9a5e5c"},e},e.prototype.start.call(this,n).then(function(){console.log("Osiris running.")})},t.citizenSpeed=50,t.debugPath=!1,t.startHour=9,t.bulletSpeed=800,t.raidingPartyFrequency=3e4,t.minuteTickMillis=500,t.font="Helvetica",t.title="ASTRA",t}(r.Engine);t.Game=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(18),r=i.Scale.major,s=i.Scale.minor;!function(e){e[e.Tiny=0]="Tiny",e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large",e[e.Huge=4]="Huge"}(o=t.DeviceSize||(t.DeviceSize={})),t.getVisibleDeviceSize=function(e){var t=10;switch(e){case o.Tiny:t=s.third;break;case o.Small:t=r.third;break;case o.Medium:t=r.fourth;break;case o.Large:t=r.eighth+r.second;break;case o.Huge:t=6*r.eighth}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(8);t.Building=o.Building;var i=n(76);t.CorridorView=i.CorridorView;var r=n(75);t.CommonAreaView=r.CommonAreaView;var s=n(74);t.DomeView=s.DomeView;var a=n(73);t.TunnelView=a.TunnelView;var c=n(72);t.ArcologyView=c.ArcologyView;var u=n(71);t.LadderView=u.LadderView;var l=n(70);t.SurfaceRoadView=l.SurfaceRoadView;var p=n(69);t.SmallDomeThreeView=p.SmallDomeThreeView;var h=n(68);t.MidDomeView=h.MidDomeView;var f=n(67);t.BigDomeView=f.BigDomeView;var d=n(66);t.SmallRoomThreeView=d.SmallRoomThreeView;var y=n(65);t.MediumRoomView=y.MediumRoomView;var m=n(64);t.LargeRoomView=m.LargeRoomView;var v=n(63);t.HugeRoomView=v.HugeRoomView;var g=n(62);t.MediumRoomThreeView=g.MediumRoomThreeView;var b=n(61);t.MediumSurfaceRoomView=b.MediumSurfaceRoomView;var w=n(60),A={CorridorView:i.CorridorView,LadderView:u.LadderView,TunnelView:a.TunnelView,SurfaceRoadView:l.SurfaceRoadView,DomeView:s.DomeView,SmallDomeThreeView:p.SmallDomeThreeView,MidDomeView:h.MidDomeView,BigDomeView:f.BigDomeView,SmallRoomThreeView:d.SmallRoomThreeView,CommonAreaView:r.CommonAreaView,MediumRoomView:y.MediumRoomView,MediumRoomThreeView:g.MediumRoomThreeView,LargeRoomView:m.LargeRoomView,HugeRoomView:v.HugeRoomView,ArcologyView:c.ArcologyView,MediumSurfaceRoomView:b.MediumSurfaceRoomView,GroundVehiclePoolView:w.GroundVehiclePoolView};t.structureViews=A},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(0);function r(e,t){return Math.floor(e[t].supply-e[t].demand)}!function(e){e.Power="Power",e.Oxygen="Oxygen",e.Water="Water",e.Shelter="Shelter",e.Hope="Hope",e.Joy="Joy",e.Wisdom="Wisdom",e.Wealth="Wealth",e.Beauty="Beauty",e.Wonder="Wonder"}(o=t.PureValue||(t.PureValue={})),t.allValues=[o.Power,o.Oxygen,o.Water,o.Shelter,o.Hope,o.Joy,o.Wisdom,o.Wealth,o.Beauty,o.Wonder],t.emptyMarket=function(){return{Power:{supply:0,demand:0},Oxygen:{supply:0,demand:0},Water:{supply:0,demand:0},Shelter:{supply:0,demand:0},Hope:{supply:0,demand:0},Joy:{supply:0,demand:0},Wealth:{supply:0,demand:0},Wisdom:{supply:0,demand:0},Beauty:{supply:0,demand:0},Wonder:{supply:0,demand:0}}},t.availableCapacity=r,t.sumMarkets=function(e,t){var n={Power:{supply:0,demand:0},Oxygen:{supply:0,demand:0},Water:{supply:0,demand:0},Shelter:{supply:0,demand:0},Hope:{supply:0,demand:0},Joy:{supply:0,demand:0},Wealth:{supply:0,demand:0},Wisdom:{supply:0,demand:0},Beauty:{supply:0,demand:0},Wonder:{supply:0,demand:0}};for(var i in o){var r=e[i],s=r.supply,a=r.demand,c=t[i],u=s+c.supply,l=a+c.demand;n[i]={supply:u,demand:l}}return n},t.equilibrium=function(e){return t.allValues.every(function(t){return r(e,t)>=0})},function(e){e.Biomass="Biomass",e.Ore="Ore",e.Idea="Idea",e.Meal="Meal",e.Data="Data",e.Mineral="Mineral",e.Bioplasma="Bioplasma",e.Alloy="Alloy",e.Algorithm="Algorithm",e.Argent="Argent",e.Aurum="Aurum",e.Omnium="Omnium"}(t.ResourceBlock||(t.ResourceBlock={}));var s={Biomass:i.Color.Green,Data:i.Color.Blue.lighten(.3),Mineral:i.Color.Red,Meal:i.Color.Yellow.darken(.3),Idea:i.Color.Blue.lighten(.6),Ore:i.Color.Red.darken(.3),Bioplasma:i.Color.Viridian,Alloy:i.Color.DarkGray.darken(.3),Algorithm:i.Color.Blue.darken(.3),Argent:i.Color.Gray.lighten(.3),Aurum:i.Color.Orange.lighten(.3),Omnium:i.Color.White};t.blockColor=function(e){return s[e].desaturate(.1)}},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),a=n(0),c=n(3),u=n(117),l=n(1),p={bookshelf:n(116),vat:n(115),bench:n(114),stove:n(113),cabin:n(112),fire:n(111),bed:n(110),fridge:n(109),server:n(108),plant:n(107),workstation:n(106),console:n(105),consolePurple:n(104),consoleGreen:n(103),consoleRed:n(102),megaconsole:n(101),fabricator:n(100),couch:n(99),solar:n(98),miner:n(97),statue:n(96),codex:n(95),lavaLamp:n(94),orrery:n(93),telescope:n(92),books:n(91),greenhouse:n(90),o2:n(89),h20:n(88),minProcessor:n(87)},h=a.Color.Red,f=a.Color.Green,d=a.Color.Blue,y=a.Color.Orange,m=a.Color.Violet,v=a.Color.Yellow,g=u.mechanicalOperations.store,b=u.mechanicalOperations.generate,w=u.mechanicalOperations.recipe,A=u.mechanicalOperations.spawn,_=u.mechanicalOperations.accelerateTime,k=u.mechanicalOperations.explore,P=function(){function e(){this.name="(machine name)",this.description="(machine description)",this.color=a.Color.LightGray,this.cost=[s.ResourceBlock.Mineral],this.size=c.DeviceSize.Small,this.operation={type:"noop"},this.image=p.vat,this.prereqs=[],this.economy=s.emptyMarket(),this.forDome=!1,this.hide=!1,this.isVehicle=!1,this.tinySlots=!1,this.isEatingSurface=!1}return e.prototype.concretize=function(){return this},e.prototype.onPlacement=function(e){},e}();t.Machine=P;var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Command Console",t.description="commander, we need your help",t.operation=g([s.ResourceBlock.Mineral,s.ResourceBlock.Ore],24),t.image=p.megaconsole,t.size=c.DeviceSize.Medium,t.economy=r({},s.emptyMarket(),{Power:{supply:1,demand:0},Oxygen:{supply:20,demand:0},Water:{supply:3,demand:0},Hope:{supply:1,demand:0},Shelter:{supply:3,demand:0}}),t}return i(t,e),t.prototype.onPlacement=function(e){for(var t in e.built=!0,l.range(20))e.produceResource(s.ResourceBlock.Mineral);var n=e.building;n.populate(e.pos.add(n.pos),!0),n.populate(e.pos.add(n.pos),!1),n.populate(e.pos.add(n.pos),!1)},t}(P);t.CommandCenter=O;var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mission Log",t.description="gather data",t.operation=g([s.ResourceBlock.Data],8),t.image=p.consolePurple,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:.1},Hope:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.MissionLog=x;var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Lava Lamp",t.description="mesmerizing",t.size=c.DeviceSize.Tiny,t.prereqs=[z],t.image=p.lavaLamp,t.economy=r({},s.emptyMarket(),{Joy:{supply:1,demand:0},Power:{supply:0,demand:.1}}),t}return i(t,e),t}(P);t.LavaLamp=C;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Figurine",t.description="not an action figure",t.size=c.DeviceSize.Tiny,t.prereqs=[z],t.image=p.statue,t.economy=r({},s.emptyMarket(),{Beauty:{supply:.1,demand:0}}),t}return i(t,e),t}(P);t.Figurine=S;var M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Orrery",t.description="to the stars",t.size=c.DeviceSize.Tiny,t.prereqs=[z],t.image=p.orrery,t.economy=r({},s.emptyMarket(),{Wonder:{supply:.1,demand:0}}),t}return i(t,e),t}(P);t.Orrery=M;var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Books",t.description="all there in black and white",t.operation=b(s.ResourceBlock.Idea,2),t.size=c.DeviceSize.Tiny,t.prereqs=[z],t.image=p.books,t.economy=r({},s.emptyMarket(),{Wisdom:{supply:.1,demand:0}}),t}return i(t,e),t}(P);t.Books=B;var R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="O2 Extractor",t.description="breathe deep",t.image=p.o2,t.prereqs=[T,D],t.forDome=!0,t.economy=r({},s.emptyMarket(),{Oxygen:{supply:6,demand:0},Power:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.OxygenExtractor=R;var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Solar Cell",t.description="feel the warmth",t.image=p.solar,t.prereqs=[q],t.forDome=!0,t.economy=r({},s.emptyMarket(),{Power:{supply:10,demand:0}}),t}return i(t,e),t}(P);t.SolarCell=D;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="H2O Condenser",t.description="have a drink",t.prereqs=[D,R],t.image=p.h20,t.forDome=!0,t.economy=r({},s.emptyMarket(),{Water:{supply:5,demand:0},Power:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.WaterCondensingMachine=T;var j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Telescope",t.description="look to the stars",t.prereqs=[M],t.forDome=!0,t.image=p.telescope,t.economy=r({},s.emptyMarket(),{Wisdom:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.Telescope=j;var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Table",t.description="a simple table",t.image=p.bench,t.isEatingSurface=!0,t.tinySlots=!0,t}return i(t,e),t}(P);t.Table=z;var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Statue",t.description="for honor",t.economy=r({},s.emptyMarket(),{Hope:{supply:.1,demand:0},Beauty:{supply:1,demand:0}}),t.image=p.statue,t.prereqs=[S],t}return i(t,e),t}(P);t.Statue=L;var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.operation=w([s.ResourceBlock.Idea,s.ResourceBlock.Idea,s.ResourceBlock.Idea],s.ResourceBlock.Data),t.color=d,t}return i(t,e),t.prototype.concretize=function(){return new W},t}(P);t.StudyMachine=V;var E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Codex",t.description="read it closely",t.image=p.codex,t.prereqs=[G],t.operation=g([s.ResourceBlock.Data],3),t.color=d,t}return i(t,e),t}(P);t.Codex=E;var W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Workstation",t.description="hackety hack",t.prereqs=[G],t.image=p.workstation,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return i(t,e),t.prototype.concretize=function(){return this},t}(V);t.Workstation=W;var H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Couch",t.description="take it easy",t.prereqs=[],t.image=p.couch,t.economy=r({},s.emptyMarket(),{Joy:{supply:.1,demand:0}}),t}return i(t,e),t}(P);t.Couch=H;var G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Shelf",t.description="brainstorm",t.operation=b(s.ResourceBlock.Idea),t.image=p.bookshelf,t.prereqs=[B,E],t.color=d,t}return i(t,e),t}(P);t.Bookshelf=G;var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Fridge",t.description="store meals",t.operation=g([s.ResourceBlock.Meal],6),t.image=p.fridge,t.prereqs=[G],t.color=v,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.Fridge=F;var I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Stove",t.description="make a meal",t.operation=w([s.ResourceBlock.Biomass,s.ResourceBlock.Biomass],s.ResourceBlock.Meal),t.image=p.stove,t.prereqs=[G,F],t.color=v,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.Stove=I;var q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Bed",t.description="sweet dreams",t.image=p.bed,t.prereqs=[R],t.color=y,t.economy=r({},s.emptyMarket(),{Shelter:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.Bed=q;var U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="House Plant",t.description="so nice",t.prereqs=[se,q],t.cost=[s.ResourceBlock.Biomass],t.operation=b(s.ResourceBlock.Biomass,1),t.color=f,t.image=p.plant,t.economy=r({},s.emptyMarket(),{Oxygen:{supply:1,demand:0},Water:{supply:0,demand:.1}}),t}return i(t,e),t}(P);t.Houseplant=U;var Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Personnel Registry",t.description="track everybody",t.prereqs=[Y],t.operation=g([s.ResourceBlock.Data],4),t.color=v,t.image=p.console,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:.1},Wisdom:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.PersonnelRegistry=Q;var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Orientation Console",t.description="welcome to the colony",t.prereqs=[Y],t.operation=b(s.ResourceBlock.Data,1),t.image=p.consoleRed,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:.1},Hope:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.OrientationConsole=N;var Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Cloning Vat",t.description="we all grow",t.operation=A(),t.productionTime=1500,t.image=p.vat,t.prereqs=[Z],t.size=c.DeviceSize.Small,t.color=m,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:2}}),t}return i(t,e),t}(P);t.CloningVat=Y;var X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Dissolution Vat",t.description="back to basics",t.operation=w([s.ResourceBlock.Biomass,s.ResourceBlock.Biomass],s.ResourceBlock.Bioplasma),t.productionTime=1500,t.image=p.vat,t.prereqs=[K],t.size=c.DeviceSize.Small,t.color=m,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.DissolutionVat=X;var K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Bioplasm Bank",t.description="hold on",t.operation=g([s.ResourceBlock.Bioplasma]),t.prereqs=[Z],t.color=f,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.PlasmaBank=K;var J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Fabricator",t.description="you made that",t.operation=w([s.ResourceBlock.Mineral,s.ResourceBlock.Mineral],s.ResourceBlock.Alloy),t.size=c.DeviceSize.Small,t.color=h,t.prereqs=[W],t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:3}}),t.image=p.fabricator,t}return i(t,e),t}(P);t.Fabricator=J;var Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Algae Vat",t.description="where there is a will",t.operation=b(s.ResourceBlock.Biomass),t.prereqs=[R,G,F],t.size=c.DeviceSize.Small,t.color=m,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:2}}),t}return i(t,e),t}(P);t.AlgaeVat=Z;var $=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Life Sciences Console",t.description="mind and body together",t.operation=g([s.ResourceBlock.Biomass,s.ResourceBlock.Data],5),t.prereqs=[U,se],t.color=f,t.image=p.consoleGreen,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:.2}}),t}return i(t,e),t}(P);t.LifeSciencesConsole=$;var ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Miner (Rover)",t.description="mobile drill unit",t.operation=k(s.ResourceBlock.Ore,2),t.prereqs=[ae,ye],t.color=h,t.size=c.DeviceSize.Medium,t.isVehicle=!0,t.image=p.miner,t}return i(t,e),t}(P);t.Miner=ee;var te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Metal Storage",t.description="contain minerals and alloys?",t.operation=g([s.ResourceBlock.Mineral,s.ResourceBlock.Alloy],8),t.prereqs=[G],t.color=h,t.size=c.DeviceSize.Medium,t}return i(t,e),t}(P);t.MetalStorage=te;var ne=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Research Server",t.description="hold data",t.operation=g([s.ResourceBlock.Data,s.ResourceBlock.Algorithm],10),t.image=p.server,t.prereqs=[G,W],t.size=c.DeviceSize.Medium,t.color=d,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:4}}),t}return i(t,e),t}(P);t.ResearchServer=ne;var oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Greenhouse",t.description="grow some food",t.operation=b(s.ResourceBlock.Biomass),t.size=c.DeviceSize.Medium,t.prereqs=[Z],t.color=f,t.forDome=!0,t.image=p.greenhouse,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1},Water:{supply:0,demand:1},Oxygen:{supply:4,demand:0}}),t}return i(t,e),t}(P);t.Greenhouse=oe;var ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Cabin",t.description="home on the plains",t.operation=w([s.ResourceBlock.Biomass,s.ResourceBlock.Biomass],s.ResourceBlock.Meal),t.image=p.cabin,t.prereqs=[de],t.size=c.DeviceSize.Medium,t.color=y,t.forDome=!0,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1},Water:{supply:0,demand:1},Shelter:{supply:4,demand:0}}),t}return i(t,e),t}(P);t.Cabin=ie;var re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Arbor",t.description="arbor around the clock",t.operation=b(s.ResourceBlock.Biomass),t.prereqs=[de],t.size=c.DeviceSize.Medium,t.color=f,t.forDome=!0,t}return i(t,e),t}(P);t.Arbor=re;var se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Botany",t.description="plant lab",t.operation=b(s.ResourceBlock.Biomass),t.prereqs=[R,G],t.size=c.DeviceSize.Medium,t.color=f,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.Botany=se;var ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mineral Processor",t.description="wheat from the chaff",t.operation=w([s.ResourceBlock.Ore,s.ResourceBlock.Ore,s.ResourceBlock.Ore],s.ResourceBlock.Mineral),t.size=c.DeviceSize.Medium,t.color=h,t.image=p.minProcessor,t.prereqs=[W,J],t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:2}}),t}return i(t,e),t}(P);t.MineralProcessor=ae;var ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Thinking Fountain",t.description="slowly growing",t.size=c.DeviceSize.Medium,t.prereqs=[ge,me,ve],t.color=a.Color.fromHex("daa520"),t.operation=b(s.ResourceBlock.Aurum,8),t.cost=[s.ResourceBlock.Aurum],t.economy=r({},s.emptyMarket(),{Wisdom:{supply:2,demand:0},Wonder:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.ThinkingFountain=ce;var ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Silver Forest",t.description="immense serenity",t.size=c.DeviceSize.Medium,t.prereqs=[me,ge],t.color=a.Color.fromHex("c0c0c0"),t.operation=g([s.ResourceBlock.Argent],12),t.cost=[s.ResourceBlock.Alloy,s.ResourceBlock.Algorithm],t.economy=r({},s.emptyMarket(),{Beauty:{supply:2,demand:0},Wonder:{supply:1,demand:0}}),t.forDome=!0,t}return i(t,e),t}(P);t.SilverForest=ue;var le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Time Crystal",t.description="xlr8",t.size=c.DeviceSize.Medium,t.color=a.Color.fromHex("e5e4e2"),t.operation=_(),t.cost=[s.ResourceBlock.Omnium],t.prereqs=[me,ue],t}return i(t,e),t}(P);t.TimeCrystal=le;var pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Holo Projector",t.description="whatever your heart desires",t.size=c.DeviceSize.Medium,t.color=d,t.operation=b(s.ResourceBlock.Data,3),t.cost=[s.ResourceBlock.Algorithm,s.ResourceBlock.Mineral],t.prereqs=[ge],t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:2},Joy:{supply:3,demand:0}}),t}return i(t,e),t}(P);t.HoloProjector=pe;var he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sacred Grove",t.description="where the furies play",t.size=c.DeviceSize.Medium,t.forDome=!0,t.cost=[s.ResourceBlock.Omnium],t.prereqs=[fe],t.economy=r({},s.emptyMarket(),{Oxygen:{supply:4,demand:0},Wonder:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.SacredGrove=he;var fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Atomic Compiler",t.description="super position",t.operation=w([s.ResourceBlock.Aurum,s.ResourceBlock.Argent],s.ResourceBlock.Omnium),t.cost=[s.ResourceBlock.Argent,s.ResourceBlock.Algorithm],t.prereqs=[ce,ue],t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:3}}),t}return i(t,e),t}(P);t.AtomicCompiler=fe;var de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Orchard",t.description="grow some food",t.operation=b(s.ResourceBlock.Biomass,10),t.size=c.DeviceSize.Large,t.prereqs=[Z],t.color=f,t.forDome=!0,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:1},Water:{supply:0,demand:1},Oxygen:{supply:2,demand:0}}),t}return i(t,e),t}(P);t.Orchard=de;var ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mining Drill",t.description="ore away",t.operation=b(s.ResourceBlock.Ore),t.size=c.DeviceSize.Large,t.prereqs=[J],t.image=p.miner,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:5}}),t}return i(t,e),t}(P);t.MiningDrill=ye;var me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mega-Fabricator",t.size=c.DeviceSize.Large,t.prereqs=[J],t.color=h,t.operation=w([s.ResourceBlock.Alloy,s.ResourceBlock.Algorithm],s.ResourceBlock.Argent),t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:8}}),t}return i(t,e),t}(P);t.Megafabricator=me;var ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Molecular Engine",t.size=c.DeviceSize.Large,t.prereqs=[me],t.color=m,t.operation=w([s.ResourceBlock.Bioplasma,s.ResourceBlock.Algorithm],s.ResourceBlock.Aurum),t.image=p.megaconsole,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:3},Water:{supply:0,demand:1}}),t}return i(t,e),t}(P);t.MolecularEngine=ve;var ge=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mainframe",t.size=c.DeviceSize.Large,t.color=d,t.prereqs=[ne],t.cost=[s.ResourceBlock.Mineral,s.ResourceBlock.Mineral],t.operation=w([s.ResourceBlock.Data,s.ResourceBlock.Data],s.ResourceBlock.Algorithm),t.image=p.server,t.economy=r({},s.emptyMarket(),{Power:{supply:0,demand:6}}),t}return i(t,e),t}(P);t.Mainframe=ge;var be=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Nature Preserve",t.size=c.DeviceSize.Large,t.prereqs=[re],t.color=f,t.forDome=!0,t.operation=b(s.ResourceBlock.Biomass,12),t.economy=r({},s.emptyMarket(),{Water:{supply:0,demand:4},Oxygen:{supply:12,demand:0}}),t}return i(t,e),t}(P);t.Preserve=be;var we=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Logic Pool",t.size=c.DeviceSize.Large,t.prereqs=[ve],t.color=a.Color.fromHex("daa520"),t.operation=g([s.ResourceBlock.Aurum],12),t.cost=[s.ResourceBlock.Algorithm,s.ResourceBlock.Bioplasma],t.economy=r({},s.emptyMarket(),{Wisdom:{supply:2,demand:0},Wonder:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.LogicPool=we;var Ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Cathedral",t.description="first ultrahumanist",t.size=c.DeviceSize.Large,t.prereqs=[he],t}return i(t,e),t}(P);t.Cathedral=Ae;var _e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Microcity",t.size=c.DeviceSize.Huge,t.prereqs=[me],t.color=y,t.forDome=!0,t.economy=r({},s.emptyMarket(),{Water:{supply:0,demand:2},Power:{supply:0,demand:2},Joy:{supply:5,demand:0},Hope:{supply:5,demand:0},Beauty:{supply:1,demand:0},Wonder:{supply:1,demand:0}}),t}return i(t,e),t}(P);t.Microcity=_e;var ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Logic Crystal",t.size=c.DeviceSize.Huge,t.prereqs=[me],t.color=d,t}return i(t,e),t}(P);t.LogicCrystal=ke,t.allMachines=[Z,re,q,G,ie,Y,J,F,U,me,ye,de,R,be,ne,D,I,T,W,_e,ke,se,ae,K,X,te,ge,Q,ve,ce,ue,N,$,le,we,pe,Ae,he,fe,H,L,E,z,C,S,ee,M,j,B]},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Left=0]="Left",e[e.Up=1]="Up",e[e.Right=2]="Right",e[e.Down=3]="Down"}(o=t.Orientation||(t.Orientation={})),t.compass=[o.Left,o.Right,o.Up,o.Down],t.flip=function(e){switch(e){case o.Left:return o.Right;case o.Right:return o.Left;case o.Up:return o.Down;case o.Down:return o.Up}throw new Error("Don't know orientation "+e)}},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),a=n(7),c=n(2),u=n(1),l=n(23),p=n(5),h=n(13),f=n(3),d=n(6),y=n(17),m=n(9),v=function(){function e(e,t){this.pos=e,this.size=t}return Object.defineProperty(e.prototype,"position",{get:function(){return this.pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleSize",{get:function(){return f.getVisibleDeviceSize(this.size)},enumerable:!0,configurable:!0}),e}();t.DevicePlace=v;var g=function(e){function t(t,n,o){var i=e.call(this,t.x,t.y,n.width,n.height,n.infra?o.color.darken(.3):s.Color.Transparent)||this;return i.structure=n,i.planet=o,i.edgeWidth=0,i.placed=!1,i.hover=!1,i.showLabel=!1,i.facing=a.Orientation.Right,i.hideBox=!1,i.childrenBuildings=[],i.devices=[],i.active=!0,i.step=0,i.anchor=new s.Vector(0,0),i.setup(),i.traits=i.traits.filter(function(e){return!(e instanceof s.Traits.OffscreenCulling)}),i.on("pointerenter",function(){i.hover=!0,i.devices.some(function(e){return e.hover})||(i.planet.currentlyViewing=i)}),i.on("pointerdown",function(){i.toggleActive()}),i.on("pointerleave",function(){i.hover=!1}),i.collisionType=s.CollisionType.PreventCollision,i.nameLabel=new s.Label(i.structure.name,0,0,c.Game.font),i.nameLabel.fontSize=9,i.nameLabel.color=s.Color.White,i.structure.infra&&(i.active=!0),i}return i(t,e),t.prototype.draw=function(t,n){this.hideBox||m.drawRect(t,this.aabb(),this.edgeWidth,this.processedColor()),e.prototype.draw.call(this,t,n),this.showLabel&&this.spaceFunction&&(this.nameLabel.pos=this.pos.add(new s.Vector(28,24)),this.nameLabel.draw(t,n)),c.Game.debugPath&&(this.slots().length>0&&this.slots().forEach(function(e){var n={x:e.pos.x,y:e.pos.y,width:3,height:3};m.drawRect(t,n,1,s.Color.Gray.lighten(.5))}),this.nodes().length>0&&this.nodes().forEach(function(e){var n={x:e.x,y:e.y,width:4,height:4};m.drawRect(t,n,1,s.Color.Yellow.lighten(.5))}))},t.prototype.update=function(t,n){var o=this;e.prototype.update.call(this,t,n),this.placed&&this.devices.forEach(function(e){e.tryProduce(o.step),e.tinyDevices.length>0&&e.tinyDevices.forEach(function(e){return e.tryProduce(o.step)})}),this.step+=1},t.prototype.poly=function(){return this.aabbPoly()},Object.defineProperty(t.prototype,"name",{get:function(){return this.spaceFunction?this.spaceFunction.name:this.structure.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.spaceFunction?this.spaceFunction.description:this.structure.description},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"floorY",{get:function(){return this.pos.y+this.getHeight()},enumerable:!0,configurable:!0}),t.prototype.economy=function(e){if(void 0===e&&(e=!0),e&&!this.isActive)return p.emptyMarket();var t=this.devices.map(function(e){return e.economy}),n=r({},p.emptyMarket(),{Oxygen:{demand:1,supply:0}});return t.concat([n]).reduce(p.sumMarkets,p.emptyMarket())},t.prototype.toggleActive=function(){if(!this.structure.infra)if(this.active){if(this.devices.some(function(e){return e.inUse}))return;var e=p.equilibrium(this.planet.economy);if(this.active=!1,e)p.equilibrium(this.planet.economy)||(this.active=!0);else for(var t=0,n=p.allValues;t<n.length;t++){var o=n[t],i=p.availableCapacity(this.economy(!1),o),r=p.availableCapacity(this.planet.economy,o);i>0&&r<0&&(this.active=!0)}}else{var s=[this.planet.economy,this.economy(!1)].reduce(p.sumMarkets,p.emptyMarket());p.equilibrium(s)&&(this.active=!0)}},Object.defineProperty(t.prototype,"isActive",{get:function(){return!!this.active},enumerable:!0,configurable:!0}),t.prototype.setup=function(){},t.prototype.constrainCursor=function(e){return e.clone()},t.prototype.reshape=function(e){this.alignToSlot(e)},t.prototype.afterConstruct=function(){},t.prototype.handleClick=function(e){return!0},t.prototype.slots=function(){return[]},t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y+this.getHeight();return[new s.Vector(Math.floor(e),Math.floor(t))]},t.prototype.devicePlaces=function(){return[]},t.prototype.deviceInteractionPlaces=function(){return this.devicePlaces().map(function(e){return e.position.y+=e.visibleSize/2,e.position})},t.prototype.graph=function(e){void 0===e&&(e=new l.Graph);for(var t=e,n=this.nodes(),o=t.findOrCreate(n[0],u.measureDistance),i=0,r=this.childrenBuildings;i<r.length;i++){var s=r[i],a=t.findOrCreate(s.parentSlot.pos,u.measureDistance);t.edge(o,a);var c=t.findOrCreate(s.nodes()[0],u.measureDistance);t.edge(a,c),s.graph(t)}return t},t.prototype.redeem=function(e){this.planet.gather(e)},t.prototype.debit=function(e){this.planet.spend(e)},t.prototype.populate=function(e,t){void 0===t&&(t=!1),this.planet.populate(e,t)},t.prototype.aabb=function(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}},t.prototype.aabbPoly=function(){return m.pathFromRect(this.aabb())},t.prototype.angledRoofPoly=function(){var e=this.getHeight()/3*1-3;return[{x:this.pos.x,y:this.pos.y+this.getHeight()},{x:this.pos.x,y:this.pos.y+e},{x:this.pos.x+20,y:this.pos.y},{x:this.pos.x+this.getWidth()-20,y:this.pos.y},{x:this.pos.x+this.getWidth(),y:this.pos.y+e},{x:this.pos.x+this.getWidth(),y:this.pos.y+this.getHeight()}]},t.prototype.overlaps=function(e){var t=this.aabb(),n=e.aabb();return!!(t.x<n.x+n.width&&t.x+t.width>n.x&&t.y<n.y+n.height&&t.y+t.height>n.y)},t.prototype.overlapsAny=function(){var e=this;return!!this.planet.colony.buildings.find(function(t){return t!==e&&e.overlaps(t)})},t.prototype.edgeColor=function(){return this.processedColor().lighten(.85)},t.prototype.mainColor=function(){return this.processedColor().darken(.08)},t.prototype.colorBase=function(){return this.color},t.prototype.processedColor=function(){var e=this.colorBase().clone();return this.placed||(this.overlapsAny()&&(e=s.Color.Red),e.a=.8),this.active||(e=e.darken(.8)),this.hover&&(e.a=.5),e},Object.defineProperty(t.prototype,"connections",{get:function(){return this.structure.connections},enumerable:!0,configurable:!0}),t.prototype.findSlot=function(e,t){var n=this;void 0===t&&(t=this.connections);for(var o=[],i=function(i){var r=t[i],s=a.flip(i);r.map(function(t){return n.planet.closestBuildingByType(e,[t])}).forEach(function(e){e&&e.slots().filter(function(e){return e.facing===s}).forEach(function(e){o.push(e)})})},r=0,s=a.compass;r<s.length;r++)i(s[r]);if(o.length>0)return u.closest(e,o,function(e){return e.pos})},t.prototype.alignToSlot=function(e,t){void 0===t&&(t=this.connections);var n=this.findSlot(e,t);if(n){var o=this.slots().find(function(e){return e.facing==a.flip(n.facing)});if(o){var i=n.pos.sub(o.pos);return this.pos.addEqual(i),this.parentSlot=n,n}}},t.prototype.buildSlot=function(e,t,n){return void 0===n&&(n=a.Orientation.Right),{pos:new s.Vector(e,t),facing:n,parent:this}},t.prototype.addDevice=function(e){e.building!==this&&(e.building=this),this.devices.push(e),e.pos.subEqual(this.pos),this.add(e),this.updateFunction(),e.machine.onPlacement(e),this.toggleActive(),e.placed=!0},t.prototype.hasPlaceForDevice=function(){return this.devices.length<this.devicePlaces().length},t.prototype.nextDevicePlace=function(){return this.devicePlaces()[this.devices.length]},t.prototype.getDevices=function(){return this.devices.concat(u.flatSingle(this.devices.map(function(e){return e.tinyDevices})))},t.prototype.updateFunction=function(){var e=[d.StudyMachine].concat(d.allMachines,[d.CommandCenter,d.MissionLog]),t=this.devices.map(function(t){return e.find(function(e){return t.machine instanceof e})}),n=h.allSpaceFunctions.find(function(e){var n=new e;return u.containsUniq(t,n.machines)});if(n){var o=new n;this.spaceFunction=o,this.nameLabel.text=o.name}},Object.defineProperty(t.prototype,"backgroundPattern",{get:function(){return this.spaceFunction?this.spaceFunction.background:y.BackgroundPattern.Grid},enumerable:!0,configurable:!0}),t}(s.Actor);t.Building=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(17),r=n(2);function s(e){var t={x:e.x,y:e.y};return[{x:t.x,y:t.y+e.height},{x:t.x,y:t.y},{x:t.x+e.width,y:t.y},{x:t.x+e.width,y:t.y+e.height}]}function a(e,t,n,r){void 0===n&&(n=i.BackgroundPattern.Grid),void 0===r&&(r=o.Color.Black);var s=i.getBackgroundPattern(e,n);s&&(e.save(),e.translate(t[0].x,t[0].y),e.beginPath(),e.moveTo(0,0),t.forEach(function(n){return e.lineTo(n.x-t[0].x,n.y-t[0].y)}),e.lineTo(0,0),e.closePath(),e.fillStyle=s,e.fill(),e.strokeStyle=r.fillStyle(),e.stroke(),e.restore())}t.pathFromRect=s,t.drawLine=function(e,t,n,i,r){void 0===i&&(i=o.Color.White),void 0===r&&(r=1);var s=i.clone();e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.strokeStyle=s.toRGBA(),e.lineWidth=r,e.stroke(),e.lineWidth=1},t.drawPatternedRect=function(e,t,n){void 0===n&&(n=i.BackgroundPattern.Grid),i.getBackgroundPattern(e,n)&&a(e,s(t),n)},t.drawPatternedPoly=a,t.drawRect=function(e,t,n,i,r,s){void 0===n&&(n=0),void 0===i&&(i=o.Color.White),void 0===r&&(r=!0),void 0===s&&(s=!1);var a=t.x,c=t.y,u=t.width,l=t.height;if(r){var p=i.clone();e.fillStyle=p.toRGBA(),e.fillRect(a,c,u,l)}if(n>0){var h=o.Color.White.clone();e.strokeStyle=h.toRGBA(),e.lineWidth=n,s?e.setLineDash([5,10]):e.setLineDash([]),e.strokeRect(a,c,u,l)}},t.drawPoly=function(e,t,n){e.beginPath(),e.moveTo(t[0].x,t[0].y),t.forEach(function(t){return e.lineTo(t.x,t.y)}),e.lineTo(t[0].x,t[0].y),e.closePath(),e.fillStyle=n.fillStyle(),e.fill()},t.drawStar=function(e,t,n,o,i,r){void 0===o&&(o=3.6),void 0===i&&(i=1.4),void 0===r&&(r=5);var s=Math.PI/2*3,a=t,c=n,u=Math.PI/r;e.beginPath(),e.moveTo(t,n-o);for(var l=0;l<r;l++)a=t+Math.cos(s)*o,c=n+Math.sin(s)*o,e.lineTo(a,c),s+=u,a=t+Math.cos(s)*i,c=n+Math.sin(s)*i,e.lineTo(a,c),s+=u;e.lineTo(t,n-o),e.closePath(),e.lineWidth=1,e.strokeStyle="yellow",e.stroke(),e.fillStyle="yellow",e.fill()},t.drawCircle=function(e,t,n,o,i,r){void 0===r&&(r=!1);var s=r?Math.PI:2*Math.PI;e.beginPath(),e.arc(t,n,o,0,s,!0),e.closePath(),e.fillStyle=i.toRGBA(),e.fill()},t.drawEllipse=function(e,t,n,o,i,r,s){void 0===s&&(s=!1);var a=s?Math.PI:2*Math.PI;e.beginPath(),e.ellipse(t,n,o,i,0,0,a),e.closePath(),e.fillStyle=r.toRGBA(),e.fill()},t.drawText=function(e,t,n,i){e.font="6pt "+r.Game.font,e.fillStyle=o.Color.White.toRGBA(),e.fillText(t,n,i)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(42),a=function(){function e(e){this.pawn=e,this.sleepInterval=150,this.isActive=!1}return Object.defineProperty(e.prototype,"planet",{get:function(){return this.pawn.currentPlanet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"devices",{get:function(){return this.planet.colony.findPoweredDevices()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"operations",{get:function(){return this.devices.map(function(e){return e.operation})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recipes",{get:function(){var e=[];return this.operations.forEach(function(t){"recipe"===t.type&&e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"explorers",{get:function(){var e=[];return this.operations.forEach(function(t){"explore"===t.type&&e.push(t)}),e},enumerable:!0,configurable:!0}),e.prototype.attempt=function(){return o(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this.isActive?[2]:this.isActive?[3,2]:(this.isActive=!0,[4,this.apply()]);case 1:e.sent(),this.isActive=!1,e.label=2;case 2:return[2]}})})},e.prototype.pause=function(){return o(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,r.sleep(this.sleepInterval)];case 1:return e.sent(),[2]}})})},e.prototype.gatherBlock=function(e){return o(this,void 0,void 0,function(){var t,n,o,r,a,c,u;return i(this,function(i){switch(i.label){case 0:return t=!1,n=function(t){return"generator"===t.operation.type&&t.product.some(function(t){return e===t})},o=this.planet.colony.closestDeviceByType(this.pawn.pos,[],n),r=function(t){return"store"===t.operation.type&&t.product.some(function(t){return e===t})},a=this.planet.colony.closestDeviceByType(this.pawn.pos,[],r),(c=o||a)?[4,this.visitDevice(c)]:[3,6];case 1:if(i.sent(),!c.inUse)return[3,4];u=0,i.label=2;case 2:return c.inUse?[4,this.pause()]:[3,4];case 3:return i.sent(),u++>10?[2,!1]:[3,2];case 4:return[4,c.interact(this.pawn,s.retrieveResource(e))];case 5:return i.sent()&&(t=!0),[3,7];case 6:console.warn("Didn't gather..."),i.label=7;case 7:return[2,t]}})})},e.prototype.visitDevice=function(e){return o(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.pawn.visit(e)];case 1:return t.sent(),[2]}})})},e.prototype.workExploration=function(e){return o(this,void 0,void 0,function(){var t,n,o;return i(this,function(i){switch(i.label){case 0:return t=function(t){return t.operation===e&&!t.reserved},n=this.planet.colony.closestDeviceByType(this.pawn.pos,[],t),o=!1,n?(n.reserved=!0,[4,this.drive(n,e)]):[3,2];case 1:i.sent()&&(o=!0),n.reserved=!1,i.label=2;case 2:return[2,o]}})})},e.prototype.drive=function(e,t){return o(this,void 0,void 0,function(){var n;return i(this,function(o){switch(o.label){case 0:if(n=!1,e.machine.isVehicle)return[3,1];throw new Error("Tried to drive a device that wasn't a vehicle!");case 1:return[4,this.visitDevice(e)];case 2:return o.sent(),[4,e.interact(this.pawn,s.drive())];case 3:return o.sent()?[4,e.interact(this.pawn,s.retrieveResource(t.gathers))]:[3,5];case 4:o.sent()&&(n=!0),o.label=5;case 5:return[2,n]}})})},e.prototype.workRecipe=function(e){return o(this,void 0,void 0,function(){var t,n,o;return i(this,function(i){switch(i.label){case 0:return console.debug("Working recipe",{product:e.produces}),t=function(t){return t.operation===e&&!t.reserved},n=this.planet.colony.closestDeviceByType(this.pawn.pos,[],t),o=!1,n?(n.reserved=!0,[4,this.gatherIngredients(e.consumes)]):[3,5];case 1:return i.sent()?[4,this.visitDevice(n)]:[3,4];case 2:return i.sent(),[4,this.performRecipeTask(n,e)];case 3:i.sent()&&(o=!0),i.label=4;case 4:n.reserved=!1,i.label=5;case 5:return[2,o]}})})},e.prototype.gatherIngredients=function(e){return o(this,void 0,void 0,function(){var t,n,o,r,s;return i(this,function(i){switch(i.label){case 0:if(this.pawn.isCarryingUnique(e))return[3,9];console.debug("Gathering blocks..."),t=0,n=e,i.label=1;case 1:if(!(t<n.length))return[3,9];o=n[t],r=0,s=!1,i.label=2;case 2:return!s&&r<20?(r+=1,[4,this.gatherBlock(o)]):[3,7];case 3:return i.sent()?(s=!0,[3,6]):[3,4];case 4:return[4,this.pause()];case 5:i.sent(),i.label=6;case 6:return[3,2];case 7:if(!s)return console.warn("couldn't gather one of the ingredients!!"),[2,!1];i.label=8;case 8:return t++,[3,1];case 9:return[2,!0]}})})},e.prototype.performRecipeTask=function(e,t,n){return void 0===n&&(n=5),o(this,void 0,void 0,function(){var o,r;return i(this,function(i){switch(i.label){case 0:return console.debug("Try to perform recipe task...",{produces:t.produces}),[4,e.interact(this.pawn,{type:"work",recipe:t})];case 1:if(o=i.sent())return[3,6];console.warn("waiting for machine to become available..."),r=0,i.label=2;case 2:return r<n?[4,this.pause()]:[3,6];case 3:return i.sent(),[4,this.performRecipeTask(e,t)];case 4:if(i.sent())return o=!0,[3,6];i.label=5;case 5:return r++,[3,2];case 6:return[2,o]}})})},e}();t.Strategy=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),c=n(5),u=n(12),l=n(3),p=n(1),h=n(9),f=n(2),d=function(e){function t(t,n){var o=e.call(this,n.x,n.y,l.getVisibleDeviceSize(t.size),l.getVisibleDeviceSize(t.size),a.Color.Transparent)||this;return o.machine=t,o.product=[],o.inUse=!1,o.hover=!1,o.imageLoaded=!1,o.built=!1,o.reserved=!1,o.placed=!1,o.parentDevice=null,o.tinyDevices=[],o.nameLabel=new a.Label(o.machine.name,0,0,f.Game.font),o.nameLabel.fontSize=o.machine.size===l.DeviceSize.Tiny?2:6,o.nameLabel.color=a.Color.White,o.image=new Image,o.image.onload=function(){o.imageLoaded=!0},o.image.src=t.image,o.on("pointerenter",function(){o.hover=!0;var e=o.tinyDevices.length>0&&o.tinyDevices.some(function(e){return e.hover});o.building&&!e&&(o.building.planet.currentlyViewing=o)}),o.on("pointerleave",function(){o.hover=!1,o.building&&o.building.planet.currentlyViewing===o&&(o.building.planet.currentlyViewing=null)}),o}return i(t,e),Object.defineProperty(t.prototype,"imageX",{get:function(){return this.pos.x-this.getWidth()/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageY",{get:function(){return this.pos.y-this.getHeight()/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"economy",{get:function(){return this.built?this.computeEconomy():c.emptyMarket()},enumerable:!0,configurable:!0}),t.prototype.computeEconomy=function(){return[this.machine.economy].concat(this.tinyDevices.map(function(e){return e.economy})).reduce(c.sumMarkets,c.emptyMarket())},t.prototype.draw=function(t,n){if(this.imageLoaded){t.save(),this.built||(t.globalAlpha=.5),t.translate(this.imageX,this.imageY),this.vel.x>0&&(t.translate(this.getWidth(),0),t.scale(-1,1)),t.drawImage(this.image,0,0,this.getWidth(),this.getHeight());var o=a.Color.Transparent.clone();this.hover&&((o=a.Color.White.clone()).a=.5),this.size!==l.DeviceSize.Tiny&&!this.placed&&this.overlapsAny()&&((o=a.Color.Red.clone()).a=.3),h.drawRect(t,{x:0,y:0,width:this.getWidth(),height:this.getHeight()},0,o),t.restore()}var i=new a.Vector(this.imageX,this.imageY+this.getHeight()/8);this.nameLabel.pos=i,this.nameLabel.draw(t,n);var r=i.x,s=i.y,u=this.nameLabel.fontSize;this.product.forEach(function(e,n){t.fillStyle=c.blockColor(e).toRGBA(),t.fillRect(r+5*n,s-5+u,4,4)}),e.prototype.draw.call(this,t,n)},Object.defineProperty(t.prototype,"name",{get:function(){return this.machine.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.machine.description},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.machine.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"operation",{get:function(){return this.machine.operation},enumerable:!0,configurable:!0}),t.prototype.assemble=function(e){return r(this,void 0,void 0,function(){var t,n,o;return s(this,function(i){switch(i.label){case 0:if(!e.isCarryingUnique(this.machine.cost))return[3,5];t=0,n=this.machine.cost,i.label=1;case 1:return t<n.length?(o=n[t],e.drop(o),[4,e.progressBar(3e3)]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:this.built=!0,i.label=5;case 5:return[2]}})})},t.prototype.interact=function(e,t){return r(this,void 0,void 0,function(){var n,o,i,r,a,c,u,l,p,h;return s(this,function(s){switch(s.label){case 0:return this.inUse||!this.built?[2,!1]:(n=!1,"recipe"!==(o=this.operation).type||"work"!==t.type?[3,5]:(i=o,e.carrying.some(function(e){return i.consumes.includes(e)})?(this.inUse=!0,e.isCarryingUnique(i.consumes)?(i.consumes.forEach(function(t){return e.drop(t)}),r=this.getEffectiveWorkTime(i),[4,e.progressBar(r)]):[3,2]):[3,4]));case 1:return s.sent(),e.carry(i.produces),n=!0,[3,3];case 2:console.warn("not carrying all requirements?",{requires:i.consumes,has:e.carrying}),s.label=3;case 3:this.inUse=!1,s.label=4;case 4:return[3,16];case 5:return"store"!==o.type&&"explore"!==o.type||"retrieve"!==t.type&&"store"!==t.type?[3,9]:(a=o,t&&"retrieve"===t.type?(this.inUse=!0,[4,e.progressBar(1e3)]):[3,7]);case 6:return s.sent(),n=this.dispense(e,t),this.inUse=!1,[3,8];case 7:"store"===a.type?(c=a,"store"===t.type&&e.carrying.some(function(e){return c.stores.includes(e)})&&this.product.length<this.getEffectiveOperationalCapacity(c)&&(u=null,c.stores.some(function(t){return u=e.drop(t)})&&u&&(this.produceResource(u),n=!0))):(console.warn("no capacity in this store!!"),n=!1),s.label=8;case 8:return[3,16];case 9:return"generator"!==o.type?[3,12]:(this.inUse=!0,(n=this.dispense(e,t))?[4,e.progressBar(500)]:[3,11]);case 10:s.sent(),s.label=11;case 11:return this.inUse=!1,[3,16];case 12:return"explore"!==o.type?[3,16]:(this.inUse=!0,l=this.pos.x,p=3*f.Game.citizenSpeed,e.drive(this),h=25e3*(Math.random()>.5?-1:1),[4,this.actions.moveTo(this.pos.x+h,this.pos.y,p).asPromise()]);case 13:return s.sent(),[4,e.progressBar(5e3)];case 14:return s.sent(),this.produceResource(o.gathers),[4,this.actions.moveTo(l,this.pos.y,p).asPromise()];case 15:s.sent(),n=!0,e.stopDriving(),this.inUse=!1,s.label=16;case 16:return[2,n]}})})},t.prototype.getEffectiveOperationalCapacity=function(e){var t=this.building.spaceFunction?this.building.spaceFunction.bonuses.capacity:0;return e.capacity+t},t.prototype.getEffectiveWorkTime=function(e){var t=this.building.spaceFunction?this.building.spaceFunction.bonuses.workSpeed:1;return Math.round(e.workTime*(1/t))},t.prototype.dispense=function(e,t){return!(!t||"retrieve"!==t.type||!this.product.find(function(e){return e===t.resource}))&&(p.deleteByValueOnce(this.product,t.resource),e.carry(t.resource),this.building.debit(t.resource),!0)},t.prototype.tryProduce=function(e){var t=this;this.building.isActive&&this.built&&("generator"===this.machine.operation.type?e%this.machine.operation.generationTime==0&&this.product.length<this.machine.operation.capacity&&this.produceResource(this.machine.operation.generates):"spawn"===this.machine.operation.type&&e%1e3==0&&setTimeout(function(){return t.building.populate(t.pos.add(t.building.pos))},100))},t.prototype.produceResource=function(e){this.product.push(e),this.building.redeem(e)},t.prototype.snap=function(e,t){var n=this;if(void 0===t&&(t=this.pos),this.size===l.DeviceSize.Tiny)return this.snapTiny(e,t);console.log("attempt to snap device...");var o=e.colony.closestBuildingByType(t,u.allStructures,function(e){return e.structure.machines.some(function(e){return n.machine instanceof e})}),i=!1,r=l.getVisibleDeviceSize(this.size)/2;if(o){var s=o.getCenter();i=s.distance(t)<o.getWidth()/2-r&&Math.abs(s.y-t.y)<80}if(i){this.building=o,this.pos=t;var a=r;this.pos.x+=o.x,this.pos.x=Math.floor(this.pos.x/a)*a,this.pos.x-=o.x,this.pos.x=Math.max(o.x,this.pos.x),this.pos.x=Math.min(o.x+o.getWidth()-r,this.pos.x),this.pos.y=o.floorY-l.getVisibleDeviceSize(this.size)/2}else this.pos=t;return i},t.prototype.overlapsAny=function(){var e=this;return!this.building||!!this.building.planet.colony.findAllDevices().find(function(t){return t!==e&&e.overlaps(t)})},t.prototype.overlaps=function(e){var t=this.aabb(),n=e.aabb();return!!(t.x<n.x+n.width&&t.x+t.width>n.x&&t.y<n.y+n.height&&t.y+t.height>n.y)},t.prototype.aabb=function(){var e=this.pos.clone();return this.placed&&e.addEqual(this.building.pos),{x:e.x,y:e.y,width:this.getWidth(),height:this.getHeight()}},t.prototype.snapTiny=function(e,t){var n=e.colony.closestBuildingByType(t,u.allStructures,function(e){return e.getDevices().some(function(e){return e.built&&e.hasTinyPlace()})}),o=p.closest(t,n.getDevices().filter(function(e){return e.built&&e.hasTinyPlace()}),function(e){return e.pos});this.pos=t;var i=!1;if(o){var r=o.nextTinyPlace().add(o.pos).add(o.building.pos);(i=r.distance(t)<50)&&(this.building=o.building,this.parentDevice=o,this.pos=r)}return i},t.prototype.hasTinyPlace=function(){return!!this.machine.tinySlots&&this.tinyDevices.length<3},t.prototype.nextTinyPlace=function(){var e=-this.getWidth()/3,t=this.tinyDevices.length;return new a.Vector(e+14*t,-3)},t.prototype.addTinyDevice=function(e){e.pos=this.nextTinyPlace(),this.tinyDevices.push(e),this.add(e)},t}(a.Actor);t.Device=d},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(18),a=n(7),c=n(6),u=n(3),l=s.Scale.major,p=s.Scale.minor,h=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Small}),f=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Medium}),d=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Large}),y=c.allMachines.filter(function(e){return(new e).size===u.DeviceSize.Huge}),m=h.filter(function(e){return(new e).forDome}),v=h.filter(function(e){return!(new e).forDome}),g=f.filter(function(e){return(new e).forDome}),b=f.filter(function(e){return!(new e).forDome&&!(new e).isVehicle}),w=d.filter(function(e){return(new e).forDome}),A=d.filter(function(e){return!(new e).forDome}),_=y.filter(function(e){return(new e).forDome}),k=y.filter(function(e){return!(new e).forDome}),P=f.filter(function(e){return(new e).isVehicle}),O=function(){var e;this.name="(structure name)",this.description="(structure description)",this.view="<structure (room) view>",this.width=10,this.height=10,this.zoom=1,this.color=r.Color.Gray,this.infra=!1,this.connections=((e={})[a.Orientation.Left]=[S],e[a.Orientation.Right]=[S],e[a.Orientation.Up]=[M],e[a.Orientation.Down]=[M],e),this.machines=[],this.prereqs=[],this.hide=!1};t.Structure=O;var x=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Main Tunnel",n.description="Elevating",n.view="TunnelView",n.width=l.fifth,n.height=l.eighth,n.zoom=.25,n.connections=((t={})[a.Orientation.Left]=[S],t[a.Orientation.Right]=[S],t[a.Orientation.Up]=[E],t[a.Orientation.Down]=[],t),n.infra=!0,n}return i(t,e),t}(O);t.MainTunnel=x;var C=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Road",n.description="go for a walk",n.view="SurfaceRoadView",n.width=p.fifth,n.height=p.first,n.connections=((t={})[a.Orientation.Left]=[B,E],t[a.Orientation.Right]=[B,E],t[a.Orientation.Up]=[],t[a.Orientation.Down]=[],t),n.infra=!0,n}return i(t,e),t}(O);t.SurfaceRoad=C;var S=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Corridor",n.description="in the hallway",n.view="CorridorView",n.width=p.fifth,n.height=p.seventh,n.zoom=.5,n.connections=((t={})[a.Orientation.Left]=[x,R,M],t[a.Orientation.Right]=[x,R,M],t[a.Orientation.Up]=[],t[a.Orientation.Down]=[],t),n.prereqs=[C],n.infra=!0,n}return i(t,e),t}(O);t.Corridor=S;var M=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.name="Ladder",n.description="connect vertically",n.view="LadderView",n.width=l.second,n.height=l.third,n.zoom=.5,n.connections=((t={})[a.Orientation.Up]=[R],t[a.Orientation.Down]=[R],t[a.Orientation.Left]=[],t[a.Orientation.Right]=[],t),n.prereqs=[S,T],n.infra=!0,n}return i(t,e),t}(O);t.Ladder=M;var B=function(e){function t(){var t,n=null!==e&&e.apply(this,arguments)||this;return n.description="Biome sweet biome",n.view="DomeView",n.width=2*l.sixth,n.height=l.fifth,n.zoom=.2,n.connections=((t={})[a.Orientation.Left]=[C],t[a.Orientation.Right]=[C],t[a.Orientation.Up]=[],t[a.Orientation.Down]=[],t),n.machines=[c.SolarCell,c.OxygenExtractor,c.WaterCondensingMachine],n}return i(t,e),t}(O),R=function(e){function t(){var n,o=null!==e&&e.apply(this,arguments)||this;return o.name="Commons",o.description="hallway cap",o.view="CommonAreaView",o.width=l.eighth,o.height=l.fifth,o.connections=((n={})[a.Orientation.Left]=[S,t],n[a.Orientation.Right]=[S,t],n[a.Orientation.Up]=[M],n[a.Orientation.Down]=[M],n),o.machines=[],o.prereqs=[],o}return i(t,e),t}(O),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Room (2)",t.width=l.eighth,t.height=l.fifth,t.prereqs=[W],t.machines=v,t}return i(t,e),t}(R);t.SmallRoomTwo=D;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Room (3)",t.prereqs=[D],t.view="SmallRoomThreeView",t.width=2*l.eighth,t.height=l.eighth,t.machines=v,t}return i(t,e),t}(R);t.SmallRoomThree=T;var j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mid Room",t.prereqs=[T],t.view="MediumRoomView",t.width=2*l.eighth,t.machines=b.concat(v),t}return i(t,e),t}(R);t.MediumRoom=j;var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mid Room (3)",t.prereqs=[j],t.view="MediumRoomThreeView",t.width=3*l.eighth,t.height=l.eighth,t.machines=b.concat(v),t}return i(t,e),t}(R);t.MediumRoomThree=z;var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Lg. Room",t.view="LargeRoomView",t.prereqs=[j],t.width=4*l.eighth,t.height=2*l.eighth,t.machines=A.concat(b,v),t}return i(t,e),t}(R);t.LargeRoom=L;var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Huge Room",t.view="HugeRoomView",t.width=10*l.eighth,t.height=8*l.eighth,t.prereqs=[L],t.machines=k,t}return i(t,e),t}(R);t.HugeRoom=V;var E=function(e){function t(){var n,o=null!==e&&e.apply(this,arguments)||this;return o.name="Mid Surf Bldg",o.description="home away from home",o.view="MediumSurfaceRoomView",o.width=4*l.eighth,o.height=l.seventh,o.zoom=.1,o.prereqs=[W],o.connections=((n={})[a.Orientation.Left]=[C],n[a.Orientation.Right]=[C],n[a.Orientation.Up]=[x,t],n[a.Orientation.Down]=[x,t],n),o.machines=b.concat(v),o}return i(t,e),t}(B);t.MediumSurfaceRoom=E;var W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Dome",t.width=2*l.fifth,t.machines=m,t}return i(t,e),t}(B);t.SmallDome=W;var H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Sm. Dome (3)",t.view="SmallDomeThreeView",t.width=3*l.fifth,t.machines=m,t}return i(t,e),t}(B);t.SmallDomeThree=H;var G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mid Dome",t.view="MidDomeView",t.width=3*l.seventh,t.prereqs=[W,j],t.machines=g.concat(m),t}return i(t,e),t}(B);t.MidDome=G;var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Lg. Dome",t.view="BigDomeView",t.width=4*l.eighth,t.prereqs=[G,L],t.machines=w.concat(g,m),t}return i(t,e),t}(B);t.LargeDome=F;var I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Arcology",t.view="ArcologyView",t.width=12*l.eighth,t.height=36*l.eighth,t.prereqs=[F,V],t.machines=_,t}return i(t,e),t}(B);t.Arcology=I;var q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Veh. Pool",t.description="ground transit hub",t.view="GroundVehiclePoolView",t.width=2*l.eighth,t.height=p.second,t.machines=P,t}return i(t,e),t}(B);t.GroundVehiclePool=q,t.allStructures=[W,H,G,F,I,E,D,T,j,z,L,V,q]},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),s=n(0),a=n(12),c=n(17),u=function(){this.name="(generic)",this.description="(generic description)",this.machines=[],this.color=s.Color.Gray,this.prereqs=[],this.structure=null,this.hide=!1,this.background=c.BackgroundPattern.Beige,this.bonuses={capacity:0,workSpeed:1}};t.RoomRecipe=u;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hide=!0,t.name="Mission Control",t.description="keeping everything on track",t.structure=a.MediumSurfaceRoom,t.prereqs=[],t.machines=[r.CommandCenter,r.MissionLog],t.background=c.BackgroundPattern.Window,t}return i(t,e),t}(u);t.MissionControl=l;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Living Quarters",t.description="good night",t.machines=[r.Bed],t}return i(t,e),t}(u);t.LivingQuarters=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Barracks",t.description="sleep tight",t.machines=[r.Bed,r.Bed,r.Bed],t}return i(t,e),t}(u),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Kitchen",t.description="stay together",t.machines=[r.Stove,r.Fridge],t.bonuses={capacity:2,workSpeed:1.1},t.background=c.BackgroundPattern.Checker,t}return i(t,e),t}(u);t.Kitchen=f;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Life Support",t.description="keep it going",t.machines=[r.OxygenExtractor,r.WaterCondensingMachine],t}return i(t,e),t}(u);t.LifeSupportPod=d;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Retreat",t.description="take it easy",t.machines=[r.Cabin,r.Cabin],t}return i(t,e),t}(u),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Clone Matrix",t.description="clone home",t.machines=[r.CloningVat,r.CloningVat],t}return i(t,e),t}(u);t.CloneMatrix=m;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Clone Reception",t.description="welcome clone",t.machines=[r.CloningVat,r.OrientationConsole,r.PersonnelRegistry],t}return i(t,e),t}(u);t.CloneReception=v;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Reading Room",t.description="butterflies in the sky",t.machines=[r.Bookshelf,r.Bookshelf],t}return i(t,e),t}(u),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Library",t.description="take a look",t.machines=[r.Bookshelf,r.Bookshelf,r.Bookshelf],t.background=c.BackgroundPattern.Books,t}return i(t,e),t}(u);t.Library=b;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Study",t.description="plan it out",t.machines=[r.StudyMachine,r.Bookshelf],t.background=c.BackgroundPattern.Wood,t}return i(t,e),t}(u);t.Study=w;var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Computer Lab",t.description="make it happen",t.machines=[r.Workstation,r.Workstation,r.Workstation],t}return i(t,e),t}(u),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Archive",t.description="write it down",t.machines=[r.ResearchServer,r.ResearchServer],t}return i(t,e),t}(u);t.Archive=_;var k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Arboretum",t.description="walk it out",t.machines=[r.Arbor,r.Arbor],t}return i(t,e),t}(u),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Algae Farm",t.description="make do",t.machines=[r.AlgaeVat,r.AlgaeVat],t}return i(t,e),t}(u),O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Solar Array",t.description="warm up",t.machines=[r.SolarCell,r.SolarCell],t}return i(t,e),t}(u);t.SolarArray=O;var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Workshop",t.description="take form",t.machines=[r.Fabricator,r.Fabricator],t}return i(t,e),t}(u);t.Workshop=x;var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Nursery",t.description="quiet please",t.machines=[r.Houseplant,r.Houseplant,r.Houseplant],t.background=c.BackgroundPattern.Leafy,t}return i(t,e),t}(u),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Farm",t.description="food for the masses",t.machines=[r.Orchard,r.Orchard],t}return i(t,e),t}(u),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Factory",t.description="production lines",t.machines=[r.Megafabricator,r.Megafabricator],t}return i(t,e),t}(u),B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Computer Core",t.description="let us calculate",t.machines=[r.Mainframe,r.Mainframe],t.background=c.BackgroundPattern.Tech,t}return i(t,e),t}(u);t.ComputerCore=B;var R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Life Sciences Lab",t.description="where do i come from",t.machines=[r.Botany,r.Botany],t}return i(t,e),t}(u);t.LifeSciencesLab=R;var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Refinery",t.description="separation",t.machines=[r.MineralProcessor],t}return i(t,e),t}(u);t.Refinery=D;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Mine",t.description="ore from the stone",t.machines=[r.MiningDrill],t}return i(t,e),t}(u);t.Mine=T;var j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Hologram Matrix",t.description="dream it",t.machines=[r.HoloProjector,r.HoloProjector],t}return i(t,e),t}(u);t.HoloMatrix=j;var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Time Chamber",t.description="believe it",t.machines=[r.TimeCrystal,r.TimeCrystal],t}return i(t,e),t}(u);t.TimeChamber=z;var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Living Room",t.description="just relax",t.machines=[r.Couch,r.Couch],t}return i(t,e),t}(u);t.LivingRoom=L;var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Statuary",t.description="to remember",t.machines=[r.Statue,r.Statue,r.Statue],t}return i(t,e),t}(u);t.Statuary=V,t.allSpaceFunctions=[l,b,h,d,m,p,f,P,_,k,O,y,w,x,g,C,S,M,A,B,R,v,D,T,j,z,L,V]},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),c=n(5),u=n(2),l=n(1),p=n(44),h=n(9),f=n(41),d=n(39),y=n(37),m=n(3),v=n(35),g=n(33),b=function(e){function t(t,n,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var s=e.call(this,n.x,n.y,18,20,a.Color.Transparent.clone())||this;return s.name=t,s.home=n,s.planet=o,s.elite=i,s.evil=r,s.alive=!0,s.isPlanning=!1,s.carrying=[],s.path=[],s.workInProgress=!1,s.sleeping=!1,s.hunger=0,s.energy=100,s.health=100,s.driving=null,s.currentBuilding=null,s.combatting=null,s.paceUnit=20,s.combatMovementUnit=5*s.paceUnit,s.firingRangeBuffer=2*s.combatMovementUnit,s.firing=!1,s.guarding=!1,s.traits=s.traits.filter(function(e){return!(e instanceof a.Traits.OffscreenCulling)}),s.productionStrategy=new p.CapacityBasedProduction(s),s.constructionStrategy=new f.ProxmityBasedConstruction(s),s.sleepingStrategy=new d.AnyBedSleepingStrategy(s),s.eatingStrategy=new y.WhenHungryEatingStrategy(s),s.fightingStrategy=new v.AttackNearestHostileStrategy(s),s.shirtColor=(s.elite?a.Color.Red:l.sample([a.Color.Green,a.Color.Blue,a.Color.Orange,a.Color.Yellow])).clone(),s.evil&&(s.shirtColor=a.Color.Black.clone()),s.skinColor=l.sample([a.Color.Orange.lighten(.5),a.Color.Orange.lighten(.6),a.Color.Orange.lighten(.7),a.Color.Orange.lighten(.8)]),s.weight=l.sample(l.range(7).map(function(e){return e+4})),s.collisionType=a.CollisionType.Passive,s.bloodEmitter=s.makeBloodEmitter(),s.add(s.bloodEmitter),s}return i(t,e),t.prototype.makeBloodEmitter=function(){var e=new a.ParticleEmitter;return e.emitterType=a.EmitterType.Circle,e.radius=7,e.minVel=10,e.maxVel=30,e.minAngle=0,e.maxAngle=2*Math.PI,e.emitRate=350,e.opacity=.5,e.fadeFlag=!0,e.particleLife=500,e.maxSize=2,e.minSize=1,e.beginColor=a.Color.Red.darken(.12),e.endColor=a.Color.Red.darken(.36),e.isEmitting=!1,e},Object.defineProperty(t.prototype,"title",{get:function(){return this.elite?"Cmdr. ":""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHungry",{get:function(){return this.hunger>60},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTired",{get:function(){return this.energy<90},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPlanet",{get:function(){return this.planet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"walkSpeed",{get:function(){var e=this.planet.timeFactor*(this.elite?1.6:1);return u.Game.citizenSpeed*e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEvil",{get:function(){return!!this.evil},enumerable:!0,configurable:!0}),t.prototype.update=function(t,n){if(e.prototype.update.call(this,t,n),this.workInProgress){var o=(new Date).getTime();this.progress=Math.min((o-this.workStarted)/this.workDuration,1),this.fatigue()}else this.path.length>0||this.work();this.driving&&(this.pos=this.driving.pos.add(this.driving.building.pos)),this.combatting&&!this.combatting.alive&&(console.warn("enemy was killed?",this.combatting),this.combatting=null),this.sleeping&&(this.health=Math.min(100,this.health+.1),this.energy=Math.min(100,this.energy+.1),100!==this.health||this.isTired||(this.sleeping=!1,this.abortProgressBar()))},t.prototype.draw=function(t,n){var o=this.x,i=this.y;if(t.save(),t.translate(o,i-this.getHeight()/2),this.alive){if(h.drawText(t,this.name,-14,-22),this.health<100){var r=this.health>60?a.Color.Green:a.Color.Yellow;this.health<10&&(r=a.Color.Red),this.drawBar(t,-13,-18,32,4,this.health/100,r)}if(this.guarding){var s=a.Color.Cyan.clone();s.a=.3,h.drawCircle(t,2,2,24,s)}}if(!this.sleeping&&this.alive||(t.rotate(-Math.PI/2),this.sleeping?t.translate(5,-10):t.translate(-5,0)),this.drawSelf(t),this.carrying&&this.carrying.forEach(function(e,n){t.fillStyle=c.blockColor(e).clone().saturate(.2).toRGBA(),t.fillRect(5,2-4*n,5,5)}),t.restore(),this.workInProgress){t.lineWidth=1;var p=10+Math.floor(this.workDuration/1e4),f=this.x-p/2,d=this.y-10;this.drawBar(t,f,d,p,3,this.progress)}if(this.path&&u.Game.debugPath){var y=a.Color.White.clone().lighten(.5);y.a=.5,l.eachCons(this.path,2).forEach(function(e){var n=e[0],o=e[1];t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(o.x,o.y),t.strokeStyle=y.toRGBA(),t.lineWidth=4,t.stroke()})}this.combatting,e.prototype.draw.call(this,t,n)},t.prototype.drawBar=function(e,t,n,o,i,r,s){void 0===s&&(s=a.Color.Violet);var c=s.clone();e.strokeStyle=a.Color.White.toRGBA(),e.strokeRect(t,n,o,i),e.fillStyle=c.darken(.9).toRGBA(),e.fillRect(t,n,o,i),e.fillStyle=c.toRGBA(),e.fillRect(t,n,r*o,i)},t.prototype.drawSelf=function(e){h.drawEllipse(e,2,8,this.weight,9,this.shirtColor.desaturate(.1).lighten(.1)),h.drawCircle(e,2,-3,4.5,this.skinColor.desaturate(.2)),this.elite&&h.drawStar(e,12,-8)},t.prototype.progressBar=function(e){return r(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.workInProgress=!0,this.workStarted=(new Date).getTime(),this.workDuration=e,[4,new Promise(function(t,n){return setTimeout(t,e)})];case 1:return t.sent(),this.workInProgress=!1,[2]}})})},t.prototype.abortProgressBar=function(){this.log("work in progress aborted...!"),this.workInProgress=!1},t.prototype.drive=function(e){this.driving=e},t.prototype.stopDriving=function(){this.driving=null},t.prototype.carry=function(e){this.carrying.push(e)},t.prototype.isCarryingUnique=function(e){return l.containsUniq(this.carrying,e)},t.prototype.drop=function(e){return this.carrying.length>0&&this.carrying.find(function(t){return t===e})?(l.deleteByValueOnce(this.carrying,e),e):null},t.prototype.visit=function(e){return r(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=this.targetForDevice(e),[4,this.pathTo(t)];case 1:return n.sent(),[4,this.glideTo(t)];case 2:return n.sent(),this.currentBuilding=e.building,[2]}})})},t.prototype.pathTo=function(e){return r(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return(t=this.planet.pathBetweenPoints(this.pos.clone(),e)).pop(),[4,this.followPath(t)];case 1:return n.sent(),[2]}})})},t.prototype.targetForDevice=function(e){var t=e.pos.add(e.building.pos);return e.parentDevice?((t=e.parentDevice.pos.add(e.building.pos)).x+=e.pos.x,t.y+=m.getVisibleDeviceSize(e.parentDevice.size)/2):t.y+=m.getVisibleDeviceSize(e.size)/2,t},t.prototype.glideTo=function(e){if(e)return this.actions.moveTo(e.x,e.y,this.walkSpeed).asPromise()},t.prototype.followPath=function(e){return r(this,void 0,void 0,function(){var t=this;return s(this,function(n){switch(n.label){case 0:return e.length>0?(this.path=e,[4,Promise.all(e.map(function(e){t.log("glide to next step"),t.glideTo(e)}))]):[3,2];case 1:n.sent(),this.path=[],n.label=2;case 2:return[2]}})})},Object.defineProperty(t.prototype,"strategies",{get:function(){return[this.fightingStrategy].concat(this.evil?[]:[this.sleepingStrategy],this.evil?[]:[this.eatingStrategy],this.evil?[]:[this.constructionStrategy],this.evil?[]:[this.productionStrategy])},enumerable:!0,configurable:!0}),t.prototype.work=function(){return r(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.isPlanning||this.sleeping||!this.alive?[2]:(this.isPlanning=!0,this.carrying.length>0&&(this.carrying=[]),(e=this.strategies.find(function(e){return e.canApply()}))?[4,e.attempt()]:[3,2]);case 1:t.sent(),t.label=2;case 2:return this.isPlanning=!1,[2]}})})},t.prototype.takeRest=function(e){return void 0===e&&(e=480*u.Game.minuteTickMillis),r(this,void 0,void 0,function(){return s(this,function(t){return this.sleeping=!0,this.progressBar(e),[2]})})},t.prototype.eat=function(){return r(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=30*u.Game.minuteTickMillis,[4,this.progressBar(e)];case 1:return t.sent(),l.deleteByValueOnce(this.carrying,c.ResourceBlock.Meal),this.hunger=0,[2]}})})},t.prototype.engageHostile=function(e){this.abortProgressBar(),this.actionQueue.clearActions(),this.combatting||this.workInProgress||(this.combatting=e)},Object.defineProperty(t.prototype,"enemyCombatant",{get:function(){return this.combatting},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engagedInCombat",{get:function(){return null!==this.combatting},enumerable:!0,configurable:!0}),t.prototype.distanceToHostile=function(){return this.combatting?this.combatting.getWorldPos().distance(this.getWorldPos()):0},Object.defineProperty(t.prototype,"idealCombatRange",{get:function(){return 20*this.paceUnit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hostileDirectionSign",{get:function(){if(this.combatting){var e=this.combatting.getWorldPos(),t=this.getWorldPos();return e.x>t.x?1:-1}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enemyPosition",{get:function(){return this.combatting.getWorldPos().clone()},enumerable:!0,configurable:!0}),t.prototype.tooCloseToEnemyLine=function(){return Math.abs(this.enemyPosition.x-this.x)<this.idealCombatRange-this.firingRangeBuffer},t.prototype.tooFarFromEnemyLine=function(){return Math.abs(this.enemyPosition.x-this.x)>this.idealCombatRange+this.firingRangeBuffer},t.prototype.withinFiringRange=function(){return!(this.tooCloseToEnemyLine()||this.tooFarFromEnemyLine())},t.prototype.advanceTowardsEnemy=function(){return r(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return e=this.getWorldPos().clone(),t=this.combatMovementUnit,this.tooFarFromEnemyLine()?(t*=this.hostileDirectionSign,this.log("ADVANCE TOWARD ENEMY LINE"),e.x+=t,[4,this.glideTo(e)]):[3,2];case 1:return n.sent(),[3,4];case 2:return this.tooCloseToEnemyLine()?(t*=-this.hostileDirectionSign,this.log("RETREAT FROM ENEMY LINE"),e.x+=t,[4,this.glideTo(e)]):[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},t.prototype.fire=function(){return r(this,void 0,void 0,function(){var e,t,n,o,i,r,c;return s(this,function(u){switch(u.label){case 0:return this.firing?[3,7]:[4,l.sleep(500)];case 1:for(i in u.sent(),e=l.range(l.sample(l.range(3))),t=function(e){var t;return s(this,function(e){switch(e.label){case 0:return[4,n.progressBar(150)];case 1:return e.sent(),n.alive&&n.combatting&&n.combatting.alive&&(n.firing=!0,t=n.assembleBullet(),n.scene.add(t),n.scene.addTimer(new a.Timer(function(){t.kill()},2e3)),n.firing=!1),[2]}})},n=this,o=[],e)o.push(i);r=0,u.label=2;case 2:return r<o.length?(c=o[r],[5,t(c)]):[3,5];case 3:u.sent(),u.label=4;case 4:return r++,[3,2];case 5:return[4,l.sleep(250)];case 6:u.sent(),u.label=7;case 7:return[2]}})})},t.prototype.guard=function(){return r(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.guarding?[3,2]:this.alive&&this.combatting?(this.guarding=!0,[4,l.sleep(1500)]):[3,2];case 1:e.sent(),this.guarding=!1,e.label=2;case 2:return[2]}})})},t.prototype.assembleBullet=function(){var e=this.hostileDirectionSign;return new g.LaserBeam(this,e)},t.prototype.injure=function(e,t){this.elite&&(e*=.3),this.health-=e,this.health<=0&&this.die(),this.bleed(),this.engageHostile(t)},t.prototype.die=function(){var e=this;this.actionQueue.clearActions(),this.path=[],this.alive=!1,this.collisionType=a.CollisionType.Passive,this.scene.addTimer(new a.Timer(function(){e.kill()},5e3))},t.prototype.bleed=function(){var e=this;this.bloodEmitter.isEmitting=!0,this.scene.addTimer(new a.Timer(function(){e.bloodEmitter.isEmitting=!1},50))},t.prototype.fatigue=function(){this.energy-=1e-4,this.hunger+=1e-4},t.prototype.log=function(e){},t}(a.Actor);t.Citizen=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(2);t.assembleButton=function(e,t){void 0===t&&(t=o.Color.LightGray);var n=t.clone(),r=n.darken(.5).desaturate(.5).clone();r.a=.8;var s=n.lighten(.8).desaturate(.4).clone(),a=document.createElement("button");return a.textContent=e,a.style.display="block",a.style.fontSize="6pt",a.style.fontFamily=i.Game.font,a.style.fontWeight="500",a.style.padding="2px",a.style.width="100px",a.style.textTransform="uppercase",a.style.border="none",a.style.background=r.toRGBA(),a.style.color=s.toRGBA(),a.onmouseover=function(){a.style.background=r.saturate(.5).lighten(.95).toRGBA(),a.style.color=s.lighten(.9).toRGBA()},a.onmouseleave=function(){a.style.background=r.toRGBA(),a.style.color=s.toRGBA()},a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(2),r=function(){function e(e,t,n){var o=this;this.name=e,this.x=t,this.y=n,this.dragging=!1,this.xOff=0,this.yOff=0,this.dragStart=function(e){e.target===o.title&&(o.initialX=e.clientX-o.xOff,o.initialY=e.clientY-o.yOff,o.dragging=!0)},this.drag=function(e){if(o.dragging){e.preventDefault();var t=e.clientX-o.initialX,n=e.clientY-o.initialY;o.xOff=t,o.yOff=n}},this.dragEnd=function(e){o.dragging&&(o.dragging=!1)},this.makeRootElement()}return e.prototype.makeRootElement=function(){var e=this;if(this._element&&this._element.parentElement.removeChild(this._element),this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.display="flex",this._element.style.flexWrap="wrap",this._element.style.width="200px",this._element.style.border="none",document.body.appendChild(this._element),this.name){var t=document.createElement("div");t.style.width="200px",t.style.backgroundColor=o.Color.Violet.darken(.92).toRGBA(),this.title=document.createElement("div"),this.title.textContent=this.name,this.title.style.fontFamily=i.Game.font,this.title.style.border="none",this.title.style.fontSize="8pt",this.title.style.fontWeight="600",this.title.style.color=o.Color.White.toRGBA(),this.title.style.padding="4px",this.title.style.margin="0px",t.appendChild(this.title),this._element.appendChild(t),document.addEventListener("pointerdown",function(t){e.dragStart(t)},!1),document.addEventListener("pointerup",function(t){e.dragEnd(t)},!1),document.addEventListener("pointermove",function(t){e.drag(t)},!1)}},e.prototype.draw=function(e){if(this._element){var t=e.canvas.offsetLeft,n=e.canvas.offsetTop;this._element.style.left=t+this.x+this.xOff+"px",this._element.style.top=n+this.y+this.yOff+"px"}},e}();t.Pane=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(86),i=n(85),r=n(84),s=n(83),a=n(82),c=n(81),u=n(80),l=n(79),p=n(78),h=n(77),f=function(e,t){void 0===t&&(t=1);var n={image:null,pattern:null,loading:!0};return n.image=new Image,n.image.src=e,n.image.onload=function(){n.loading=!1},{background:n,scale:t}};!function(e){e.Leafy="Leafy",e.Grid="Grid",e.Books="Books",e.Poster="Poster",e.Tech="Tech",e.Checker="Checker",e.Beige="Beige",e.Window="Window",e.USSF="USSF",e.Wood="Wood"}(t.BackgroundPattern||(t.BackgroundPattern={}));var d={Leafy:f(i),Grid:f(o),Books:f(r),Poster:f(s),Tech:f(a),Checker:f(c),Beige:f(u),Window:f(l),USSF:f(p,.5),Wood:f(h)};t.getBackgroundPattern=function(e,t){var n=d[t],o=n.background;if(!o.loading){if(!o.pattern){var i=new DOMMatrix;o.pattern=e.createPattern(o.image,"repeat"),o.pattern.setTransform(i.scale(n.scale))}return o.pattern}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Scale={major:{first:16,second:32,third:48,fourth:64,fifth:80,sixth:96,seventh:112,eighth:128},minor:{first:4,second:8,third:12,fourth:16,fifth:20,sixth:24,seventh:28,eighth:32}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(1),r=function(){function e(){this.color=i.sample(e.colors).clone().darken(.1).desaturate(.8),this.skyColor=i.sample([o.Color.Cyan]).clone().lighten(.15).desaturate(.8)}return e.nameCitizen=function(){return i.sample(["Parthas","Athos","Karzak","Echo","Jaen","Xavier","Mante","Ern","Leor","Exiel","Tomlien","Amriel","Sariel","Arthax","Avalon","Kor","Exelon","Dominel","Prinz","Etsa","Corinth","Coade","Exter","Domnek","Tahm","Esk","Ith","Torl","Klapaucius","Antonidus","Exeleron","Moab","Thim","Pol","Maigel"])},e.colors=[o.Color.Orange,o.Color.Azure],e}();t.World=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(7),r=function(){function e(e,t){this.game=e,this.camera=t,this.dragging=!1,this.pointerMoveCallback=null,this.leftClickCallback=null,this.cameraPanCallback=null,this.keyPressCallback=null}return e.prototype.onMove=function(e){this.pointerMoveCallback=e},e.prototype.onLeftClick=function(e){this.leftClickCallback=e},e.prototype.onCameraPan=function(e){this.cameraPanCallback=e},e.prototype.onKeyPress=function(e){this.keyPressCallback=e},e.prototype.activate=function(){var e=this;this.game.input.pointers.primary.on("move",function(t){e.dragging?e.camera.pos=e.camera.pos.add(e.dragOrigin.sub(t.pos)):e.pointerMoveCallback&&e.pointerMoveCallback(t.pos)}),this.game.input.pointers.primary.on("up",function(){e.dragging&&(e.dragging=!1)}),this.game.input.pointers.primary.on("down",function(t){t.button==o.Input.PointerButton.Left?e.leftClickCallback&&e.leftClickCallback(t.pos):t.button===o.Input.PointerButton.Middle&&(e.dragging=!0,e.dragOrigin=t.pos)}),this.game.input.pointers.primary.on("wheel",function(t){var n=e.camera.getZoom();t.deltaY<0?e.camera.zoom(Math.min(n+.05,8)):t.deltaY>0&&e.camera.zoom(Math.max(n-.05,.05))});var t=i.Orientation.Up,n=i.Orientation.Down,r=i.Orientation.Left,s=i.Orientation.Right,a=function(i){e.cameraPanCallback&&e.cameraPanCallback();var a=1/e.camera.getZoom()*10,c=new o.Vector(0,0);switch(i){case r:c.x=-a;break;case s:c.x=a;break;case t:c.y=-a;break;case n:c.y=a}e.camera.move(e.camera.pos.add(c),0)};this.game.input.keyboard.on("press",function(i){i.key===o.Input.Keys.Up||i.key===o.Input.Keys.W?a(t):i.key===o.Input.Keys.Left||i.key===o.Input.Keys.A?a(r):i.key===o.Input.Keys.Down||i.key===o.Input.Keys.S?a(n):i.key===o.Input.Keys.Right||i.key===o.Input.Keys.D?a(s):e.keyPressCallback&&e.keyPressCallback(i.key)}),this.game.input.keyboard.on("hold",function(e){e.key===o.Input.Keys.Up||e.key===o.Input.Keys.W?a(t):e.key===o.Input.Keys.Left||e.key===o.Input.Keys.A?a(r):e.key===o.Input.Keys.Down||e.key===o.Input.Keys.S?a(n):e.key!==o.Input.Keys.Right&&e.key!==o.Input.Keys.D||a(s)})},e}();t.GameController=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),c=n(0),u=n(4),l=n(1),p=n(5),h=n(47),f=n(45),d=n(11),y=n(32),m=n(14),v=function(e){function t(t,n,o,i,r,s,u){void 0===r&&(r=2e5),void 0===s&&(s=4e4);var p=e.call(this,0,s/2,r,s,t.color)||this;p.world=t,p.hud=n,p.onBuildingHover=o,p.onDeviceHover=i,p.w=r,p.depth=s,p.scene=u,p.hostiles=[],p.traits=p.traits.filter(function(e){return!(e instanceof a.Traits.OffscreenCulling)}),p.sky=new c.Actor(0,-s,r,s,t.skyColor),p.add(p.sky);var d=-s/2;p.createLayer(d,40,p.color.lighten(.45));for(var m=s/10,v=0,g=l.range(10);v<g.length;v++){var b=g[v];p.createLayer(d+40+m/2+m*(b+1),m,p.color.darken(.05+.01*b))}return p.color.clone(),p.skyLayers=new y.SkyLayers(-s/2,p.getWidth(),p.color.lighten(.04),t.skyColor,6),p.add(p.skyLayers),p.colony=new h.Colony(0,-s/2),p.add(p.colony),console.log("in planet, scene is: ",{scene:p.scene}),p.population=new f.Population(p,u),p.add(p.population),p}return i(t,e),Object.defineProperty(t.prototype,"hour",{get:function(){return this.currentHour},set:function(e){this.currentHour=e},enumerable:!0,configurable:!0}),t.prototype.setTime=function(e){this.hour=Math.floor(e/60)%24;var t=this.hour+1,n=Math.floor(e%60)/60,o=this.skyColorForHour(this.hour),i=this.skyColorForHour(t),r=l.mixColors(i,o,n);this.assignColors(r)},t.prototype.assignColors=function(e){this.sky.color=e;var t=l.mixColors(this.sky.color.lighten(.4),this.color.darken(.4),.7);this.skyLayers.setHi(t)},t.prototype.skyColorForHour=function(e){var t=this.world.skyColor.clone().darken(.2).desaturate(.1),n={night:t.darken(.7),dawn:t.darken(.2),morning:t.lighten(.1),afternoon:t.lighten(.2).desaturate(.1),evening:t},o=null;if(e>=5&&e<8){var i=(e-6)/5;o=n.dawn.lighten(i)}else e>=8&&e<12?(i=(e-8)/24,o=n.morning.lighten(i)):e>=12&&e<14?o=n.afternoon:e>=14&&e<18?(i=(e-14)/16,o=n.afternoon.darken(i)):e>=18&&e<23?(i=(e-18)/10,o=n.evening.darken(i)):e>=23?o=n.night:e<5&&(o=n.night);return o},Object.defineProperty(t.prototype,"currentlyViewing",{set:function(e){if(e instanceof u.Building){var t=e;this.onBuildingHover(t)}else if(e instanceof d.Device){var n=e;this.onDeviceHover(n)}},enumerable:!0,configurable:!0}),t.prototype.createLayer=function(e,t,n){var o=new c.Actor(0,e,this.getWidth(),t,n);this.add(o)},t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.currentlyConstructing&&this.currentlyConstructing.draw(t,n)},Object.defineProperty(t.prototype,"economy",{get:function(){var e=this.colony.buildings.map(function(e){return e.economy()}).reduce(p.sumMarkets,p.emptyMarket()),t=this.population.citizens.length;return e.Shelter.demand=t,e.Oxygen.demand+=t,e.Water.demand+=t,e},enumerable:!0,configurable:!0}),t.prototype.update=function(t,n){e.prototype.update.call(this,t,n),this.colony.buildings.forEach(function(e){return e.update(t,n)}),this.population.citizens.forEach(function(e){return e.update(t,n)})},Object.defineProperty(t.prototype,"currentlyConstructing",{get:function(){return this.colony.currentlyConstructing},enumerable:!0,configurable:!0}),t.prototype.gather=function(e){this.hud.resourceGathered(e)},t.prototype.spend=function(e){this.hud.resourceExpended(e)},t.prototype.placeBuilding=function(e){this.colony.placeBuilding(e)},t.prototype.populate=function(e,t){void 0===t&&(t=!1),this.population.citizens.length<this.maxPop?this.population.increase(e,t):console.warn("too many citizens already to populate more!")},Object.defineProperty(t.prototype,"maxPop",{get:function(){var e=this.colony.findPoweredDevices().map(function(e){return e.machine.economy}).reduce(p.sumMarkets,p.emptyMarket()),t=[p.PureValue.Shelter,p.PureValue.Water,p.PureValue.Oxygen];return Math.max(0,Math.min.apply(Math,t.map(function(t){return p.availableCapacity(e,t)})))},enumerable:!0,configurable:!0}),t.prototype.closestBuildingByType=function(e,t,n){return void 0===n&&(n=function(){return!0}),this.colony.closestBuildingByType(e,t,n)},t.prototype.closestDevice=function(e,t,n){return void 0===t&&(t=[]),void 0===n&&(n=function(){return!0}),this.colony.closestDeviceByType(e,t,n)},t.prototype.pathBetween=function(e,t){return this.colony.pathBetween(e,t)},t.prototype.pathBetweenPoints=function(e,t){return this.colony.pathBetweenPoints(e,t)},Object.defineProperty(t.prototype,"timeFactor",{get:function(){return this.colony.findPoweredDevices().map(function(e){return e.operation}).map(function(e){return"accelerate"===e.type?e.factor:1}).reduce(function(e,t){return t*e},1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storedResources",{get:function(){var e=this.colony.findAllDevices();return l.flatSingle(e.map(function(e){return e.product}))},enumerable:!0,configurable:!0}),t.prototype.hasMachineKind=function(e){return this.colony.findPoweredDevices().find(function(t){return t.machine instanceof e})},t.prototype.sendRaidingParty=function(){var e=1+l.sample(l.range(3));for(var t in l.range(e))this.sendRaider();console.warn("Sent "+e+" raiders!")},t.prototype.sendRaider=function(){return r(this,void 0,void 0,function(){var e,t,n;return s(this,function(o){switch(o.label){case 0:return(e=this.colony.origin.clone()).y=this.getTop()+5,t=50*Math.random(),n=new m.Citizen("Raider",e.add(new c.Vector(3e3+t,0)),this,!1,!0),this.population.raiders.push(n),this.scene.add(n),[4,n.glideTo(e)];case 1:return o.sent(),[2]}})})},t}(c.Actor);t.Planet=v},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(12),a=n(5),c=n(6),u=n(1),l=n(59),p=n(53),h=n(13),f=n(50),d=n(49),y=n(48),m=function(e){function t(n,o,i,r,s){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===s&&(s=null);var u=e.call(this,0,0,n.canvasWidth,n.canvasHeight)||this;u.game=n,u.onBuildingSelect=o,u.onMachineSelect=i,u.onFunctionSelect=r,u.onCitizenSelect=s,u.hidePalettes=!0,u.showCitizenList=!0,u.modal=null;var h=n.canvasHeight/window.devicePixelRatio,d=n.canvasWidth/window.devicePixelRatio;u.status=new l.StatusAnalysisView(a.emptyMarket(),n.canvasWidth,64),u.add(u.status);var m=function(e){return u.showCard(e)};return u.machinePalette=new f.Palette("Machine",20,55,c.allMachines,i,m),u.structurePalette=new f.Palette("Structure",20,300,t.structuresForPalette,o,m),u.functionPalette=new f.Palette("Room Recipe",20,435,t.functionsForPalette,r,m,!1),u.citizenList=new y.CitizenList(d-220,55,s),u.card=new p.Card(null,20,h-200),u.add(u.card),u}return i(t,e),t.prototype.systemMessage=function(e,t,n){void 0===t&&(t="Commander...");var o=this.game.canvasHeight/window.devicePixelRatio,i=this.game.canvasWidth/window.devicePixelRatio;return this.modal=new d.Modal(t,e,i/2,o/2),this.modal.addButtons(n),this.modal},t.prototype.closeSystemMessage=function(){console.log("hide system message"),this.modal.teardown(),this.modal=null},t.prototype.showPalettes=function(){this.hidePalettes=!1},t.prototype.setStatus=function(e){this.status.setMessage(e)},t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.hidePalettes||(this.structurePalette.draw(t),this.functionPalette.draw(t),this.machinePalette.comprehended.length>0&&this.machinePalette.draw(t)),this.modal&&this.modal.draw(t),this.showCitizenList&&this.citizenList.draw(t)},t.prototype.update=function(t,n){e.prototype.update.call(this,t,n)},t.prototype.resourceGathered=function(e){this.status.incrementResource(e)},t.prototype.resourceExpended=function(e){this.status.decrementResource(e)},t.prototype.updateDetails=function(e,t,n,o,i){void 0===o&&(o=!0),void 0===i&&(i=0),e&&(o&&this.updatePalettes(e.colony,t),this.updateEconomy(e),this.updateMaxPop(e.economy[a.PureValue.Shelter].demand,e.maxPop),this.status.setClock(i),this.citizenList.updateRoster(e.population.citizens.filter(function(e){return e.alive}),n),!this.showCitizenList&&e.hasMachineKind(c.PersonnelRegistry)&&(this.showCitizenList=!0))},t.prototype.showCard=function(e){this.card.present(e)},t.prototype.updateMaxPop=function(e,t){this.status.showPopCap(e,t)},t.prototype.updateEconomy=function(e){this.status.showEconomy(e.economy)},t.prototype.updatePalettes=function(e,t){this.updateBuildingPalette(e),this.updateMachinePalette(e,t),this.updateFunctionPalette(e)},t.prototype.updateBuildingPalette=function(e){var n=this,o=t.structuresForPalette.filter(function(t){return e.buildings.some(function(e){return e.structure instanceof t})});o.every(function(e){return n.structurePalette.built.includes(e)})||this.structurePalette.updateBuilt(o)},t.prototype.updateMachinePalette=function(e,n){var o=this,i=e.findAllDevices(),r=t.machinesForPalette.filter(function(e){return i.some(function(t){return t.machine instanceof e&&t.built})}).slice();r.every(function(e){return o.machinePalette.built.includes(e)})||this.machinePalette.updateBuilt(r,n.allUnlockedMachines())},t.prototype.updateFunctionPalette=function(e){var n=this,o=u.flatSingle(e.buildings.map(function(e){return e.spaceFunction})),i=t.functionsForPalette.filter(function(e){return o.some(function(t){return t instanceof e})});i.every(function(e){return n.functionPalette.built.includes(e)})||this.functionPalette.updateBuilt(i)},t.structuresForPalette=[s.SurfaceRoad,s.Corridor,s.Ladder].concat(s.allStructures),t.machinesForPalette=c.allMachines,t.functionsForPalette=h.allSpaceFunctions,t}(r.UIActor);t.Hud=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=function(){function e(){this.empty=!0,this.nodes=[],this.edges={},this.edgesInverse={}}return e.prototype.isEmpty=function(){return this.empty},Object.defineProperty(e.prototype,"size",{get:function(){return this.nodes.length},enumerable:!0,configurable:!0}),e.prototype.node=function(e){this.empty=!1,this.contains(e)||this.nodes.push(e)},e.prototype.contains=function(e){return this.nodes.includes(e)},e.prototype.findOrCreate=function(e,t,n){void 0===n&&(n=5);var i=this.dfs(),r=o.minBy(i,function(n){return t(e,n)});return r&&t(r,e)<n?r:e},e.prototype.edge=function(e,t){this.node(e),this.node(t);var n=this.indexOf(e),o=this.indexOf(t);this.edges[n]=this.edges[n]||[],this.edges[n].push(o),this.edgesInverse[o]=this.edgesInverse[o]||[],this.edgesInverse[o].push(n)},e.prototype.union=function(e){var t=this;e.edgeList().forEach(function(e){var n=e[0],o=e[1];return t.edge(n,o)})},e.prototype.edgeList=function(){for(var e=[],t=0,n=this.nodes;t<n.length;t++){var o=n[t],i=this.indexOf(o);if(this.edges[i])for(var r=0,s=this.edges[i];r<s.length;r++){var a=s[r],c=this.nodes[a];e.includes([c,o])||e.push([o,c])}}return e},e.prototype.adjacent=function(e){var t=this,n=this.indexOf(e);return this.adjacentIndices(n).map(function(e){return t.nodes[e]})},e.prototype.adjacentIndices=function(e){var t=this.edges[e]||[],n=this.edgesInverse[e]||[];return t.concat(n)},e.prototype.dfs=function(e,t){var n=this;void 0===e&&(e=null),void 0===t&&(t=[]);var o=e?this.indexOf(e):0;return this.dfsIndex(o).map(function(e){return n.nodes[e]})},e.prototype.dfsIndex=function(e,t){var n=this;return void 0===e&&(e=0),void 0===t&&(t=[]),t.push(e),this.adjacentIndices(e).forEach(function(e){t.includes(e)||n.dfsIndex(e,t)}),t},e.prototype.bfs=function(e,t){var n=this;void 0===e&&(e=null),void 0===t&&(t=function(){return!0});var o=e?this.indexOf(e):0;return this.bfsIndex(o,t).map(function(e){return n.nodes[e]})},e.prototype.bfsIndex=function(e,t){void 0===e&&(e=null),void 0===t&&(t=function(){return!0});var n=!1,o=[];o.push(e);for(var i=0;o.length<this.nodes.length&&i++<20*this.nodes.length;){for(var r=0,s=o;r<s.length;r++){for(var a=s[r],c=0,u=this.adjacentIndices(a);c<u.length;c++){var l=u[c];if(!o.includes(l)){if(!t(a,l)){n=!0;break}o.push(l)}}if(n)break}if(n)break}return o},e.prototype.shortestPath=function(e,t,n){var o=this;void 0===n&&(n=256);var i={},r=this.indexOf(t);this.bfs(e,function(e,t){return i[t]=e,t!==r});for(var s=[],a=r,c=0,u=this.indexOf(e);!s.includes(u)&&c<n;)s.push(a),a=i[a],c+=1;return s.map(function(e){return o.nodes[e]}).reverse()},e.prototype.indexOf=function(e){return this.nodes.indexOf(e)},e}();t.Graph=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(124),r=(n(123),n(122)),s=(n(121),n(120),n(119)),a={Sword:new o.Texture(i),Assembler:new o.Sound(r),FutureTense:new o.Sound(s)};t.Resources=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),s=n(0),a=n(15),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.setup=function(e,t){var n=this;e.forEach(function(e){var o=a.assembleButton(e.label,s.Color.Blue);o.onclick=function(){t.goToScene(e.scene),n._element.style.display="none"},n._element.appendChild(o)})},t}(r.Pane),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onInitialize=function(){this.sceneList=new c("AD ASTRA: OSIRIS",this.engine.halfCanvasWidth-100,this.engine.halfCanvasHeight-30),this.sceneList.setup([{label:"Play",scene:"construct"},{label:"Arena",scene:"arena"}],this.engine);var e=new s.ParticleEmitter(this.engine.halfCanvasWidth,this.engine.halfCanvasHeight);e.endColor=s.Color.Blue,e.beginColor=s.Color.White,e.radius=100,e.minVel=10,e.maxVel=150,e.minAngle=0,e.maxAngle=2*Math.PI,e.emitRate=250,e.opacity=.5,e.fadeFlag=!0,e.particleLife=6e3,e.maxSize=20,e.minSize=1,e.isEmitting=!0,this.add(e)},t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.sceneList.draw(t)},t}(s.Scene);t.Menu=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(14),a=n(21),c=n(19),u=n(22),l=n(16),p=n(15),h=n(20),f=function(){},d=function(e){function t(t,n,o,i){var s=e.call(this,"Spawn",t,n)||this;s.makeRootElement();var a=p.assembleButton("Good guy",r.Color.Green);a.onclick=o,s._element.appendChild(a);var c=p.assembleButton("Bad guy",r.Color.Red);return c.onclick=i,s._element.appendChild(c),s}return i(t,e),t}(l.Pane),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spawnFriendly=function(){var e=new s.Citizen("Good Guy",new r.Vector(200*Math.random()+800,t.floorY),t.planet,!0);t.planet.population.citizens.push(e),t.add(e)},t.spawnHostile=function(){var e=new s.Citizen("Bad Guy",new r.Vector(200*Math.random()-100,t.floorY),t.planet,!1,!0);t.planet.population.raiders.push(e),t.add(e)},t}return i(t,e),t.prototype.onInitialize=function(e){new h.GameController(e,this.camera).activate();var t=new c.World,n=new u.Hud(e);this.planet=new a.Planet(t,n,f,f,2e5,4e4,this),this.add(this.planet),this.floorY=this.planet.getTop(),this.spawnFriendly(),this.spawnHostile(),this.camera.move(this.planet.population.citizens[0].pos,1e3),this.spawnPalette=new d(100,100,this.spawnFriendly,this.spawnHostile)},t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.spawnPalette.draw(t)},t}(r.Scene);t.Arena=y},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(6);!function(e){e.Survival="Environmental Control",e.Agriculture="Food Production",e.LibraryScience="Library Science",e.Cooking="Food Preparation",e.MineralProduction="Mineral Production"}(i=t.Discipline||(t.Discipline={})),t.disciplineTree=((o={})[i.Survival]=[{name:"Survival I",level:1,description:"staying alive",prereqs:[r.Bed,r.SolarCell],unlocks:[r.OxygenExtractor,r.WaterCondensingMachine]}],o[i.Agriculture]=[{name:"Food Prod. I",level:1,description:"watch the calories",prereqs:[r.Botany],unlocks:[r.Houseplant,r.Greenhouse,r.Orchard]}],o[i.Cooking]=[{name:"Food Prep. I",level:1,description:"bam",prereqs:[r.Fridge],unlocks:[r.Stove]}],o[i.LibraryScience]=[{name:"Library Science I",level:1,description:"try to understand",prereqs:[r.Books],unlocks:[r.Bookshelf,r.Workstation,r.Codex]}],o[i.MineralProduction]=[{name:"Mineral Production I",level:1,description:"make it work",prereqs:[r.Table],unlocks:[r.Miner,r.MineralProcessor]}],o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(27),r=function(){function e(){var e;this.currentLevels=((e={})[i.Discipline.Survival]=-1,e[i.Discipline.LibraryScience]=-1,e[i.Discipline.Agriculture]=-1,e[i.Discipline.Cooking]=-1,e[i.Discipline.MineralProduction]=-1,e)}return e.prototype.findDisciplineToRankUp=function(e){for(var t=0,n=Object.keys(i.Discipline);t<n.length;t++){var o=n[t],r=i.Discipline[o];if(this.canRankUp(r,e))return r}return null},e.prototype.rankUp=function(e){return this.currentLevels[e]+=1,this.currentRank(e)},e.prototype.currentRank=function(e){return i.disciplineTree[e][this.currentLevels[e]]},e.prototype.canRankUp=function(e,t){var n=this.currentLevels[e],o=i.disciplineTree[e][n+1];return!(!o||!o.prereqs.every(function(e){return t.includes(e)}))},e.prototype.allUnlockedMachines=function(){for(var e=[],t=0,n=Object.keys(i.Discipline);t<n.length;t++){var o=n[t];e.push.apply(e,this.unlockedMachinesFor(i.Discipline[o]))}return e},e.prototype.unlockedMachinesFor=function(e){var t=i.disciplineTree[e],n=[],r=this.currentLevels[e]+1;for(var s in o.range(r))n.push.apply(n,t[s].unlocks);return n},e}();t.TechTree=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(){var t=e.call(this)||this;return t.setWidth(5),t.setHeight(5),t.x=5,t.y=5,t.color=new r.Color(255,255,255),t}return i(t,e),t}(r.Actor);t.Player=s},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(e){function t(t,n,o){return e.call(this,0,t,n,1500,o)||this}return i(t,e),t}(r.Actor),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layers=[],t.skyColor=r.Color.Blue.clone(),t.layerHeight=80,t.layerCount=1,t.peakCount=1e3,t}return i(t,e),Object.defineProperty(t.prototype,"peakWidth",{get:function(){return Math.floor(this.getWidth()/this.peakCount)},enumerable:!0,configurable:!0}),t.prototype.onInitialize=function(){for(var e=0,t=s.range(this.layerCount);e<t.length;e++){var n=t[e];this.layers.unshift({baseY:(n+1)*-this.layerHeight,deltas:this.genPeaks(n)})}},t.prototype.draw=function(e,t){for(var n=this.color.clone(),o=this.skyColor.clone(),i=1,r=0,a=this.layers.slice();r<a.length;r++){var c=a[r],u=s.mixColors(n,o,i/this.layers.length);this.drawLayer(e,c,u),i+=1}},t.prototype.drawLayer=function(e,t,n){var o=-this.getWidth()/2,i=this.pos.y+t.baseY,r=n.clone();e.beginPath(),e.moveTo(o,i);for(var s=0,a=0,c=t.deltas;a<c.length;a++){var u=c[a];e.lineTo(o+s*this.peakWidth,i+u),s+=1}e.lineTo(o+this.peakCount*this.peakWidth,i),e.lineTo(o+this.peakCount*this.peakWidth,i+this.layerHeight),e.lineTo(o,i+this.layerHeight),e.closePath(),r.a=1,e.fillStyle=r.toRGBA(),e.fill()},t.prototype.genPeaks=function(e){var t=this.layerHeight/3*2,n=[],o=0;for(var i in s.range(this.peakCount)){var r=Math.random()*t-t/2,a=Math.max(o-15,Math.min(r,o+15));n.push(a),o=a}return n},t}(a);t.MountainLayers=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.peaks=[],t}return i(t,e),t.prototype.onInitialize=function(){for(var e=this.getWidth()/2,t=this.getWidth()/9,n=t/2*3,o=0,i=s.range(9);o<i.length;o++){var r=i[o],a=Math.max(400,200+800*Math.random()+(100*Math.random()-50));this.peaks.push({x:Math.min(this.getWidth()/2-a/2,r*t-e+Math.random()*n),height:a})}},t.prototype.draw=function(e,t){var n=this.color.desaturate(.35),o=n.lighten(.1);e.fillStyle=n.toRGBA();var i=this.pos.y-3;this.peaks.forEach(function(t){var r=i-t.height,s=3.4*t.height;e.beginPath(),e.moveTo(t.x,r),e.lineTo(t.x-s,i),e.lineTo(t.x+s,i),e.fillStyle=n.toRGBA(),e.fill(),e.beginPath(),e.moveTo(t.x,r),e.lineTo(t.x+s/4*3,i),e.lineTo(t.x+s,i),e.fillStyle=o.toRGBA(),e.fill()})},t}(a);t.Mountains=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=n(30),c=function(e){function t(t,n,o,i){var r=e.call(this,0,t,n,1500)||this,c=s.mixColors(o,i);return r.backMountainLayers=new a.MountainLayers(-60,n,c),r.backMountainLayers.skyColor=i,r.add(r.backMountainLayers),r.mountains=new a.Mountains(0,n,c),r.add(r.mountains),r.mountainLayers=new a.MountainLayers(0,r.getWidth(),o),r.mountainLayers.skyColor=c,r.add(r.mountainLayers),r}return i(t,e),t.prototype.setLoHi=function(e,t){var n=s.mixColors(e,t);this.backMountainLayers.color=n,this.backMountainLayers.skyColor=t,this.mountains.color=n,this.mountainLayers.color=e,this.mountainLayers.skyColor=n},t}(r.Actor);t.SkyLayer=c},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=n(31),c=function(e){function t(t,n,o,i,r){void 0===r&&(r=5);var c=e.call(this,0,t,n,1500)||this;c.lo=o,c.layerCount=r,c.layers=[];for(var u=0,l=s.range(r);u<l.length;u++){var p=l[u],h=s.mixColors(o,i,p/(r+1)),f=s.mixColors(o,i,(p+1)/(r+1)),d=new a.SkyLayer(-20-50*(r-p-1),c.getWidth(),f,h);c.layers.push(d),c.add(d)}return c}return i(t,e),t.prototype.setHi=function(e){for(var t=this.lo,n=0,o=s.range(this.layerCount);n<o.length;n++){var i=o[n],r=s.mixColors(t,e,i/(this.layerCount+1)),a=s.mixColors(t,e,(i+1)/(this.layerCount+1));this.layers[i].setLoHi(a,r)}},t}(r.Actor);t.SkyLayers=c},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(2),a=n(14),c=function(e){function t(t,n){var o=e.call(this,t.pos.x+42*n,t.pos.y-10,18,1)||this;return o.source=t,o.targetDirectionSign=n,o.evil=t.isEvil,o.color=(o.evil?r.Color.Green:r.Color.Cyan).clone().lighten(.3),o.vel.x=s.Game.bulletSpeed*n,o.vel.y=10*Math.random()-5,o.on("collisionstart",function(e){e.other instanceof a.Citizen&&e.other.alive&&o.evil!==e.other.isEvil&&(e.other.guarding?(o.vel.x=-o.vel.x,o.evil=!o.evil):Math.random()>.3&&(o.kill(),e.other.injure(6+4*Math.random(),o.source)))}),o.collisionType=r.CollisionType.Passive,o}return i(t,e),t}(r.Actor);t.LaserBeam=c},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n(10).Strategy);t.CombatStrategy=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(34),c=n(1),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vigilanceRange=2e3,t}return i(t,e),t.prototype.apply=function(){return r(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return this.pawn.engagedInCombat?[3,1]:((e=c.closest(this.pawn.pos,this.hostiles.filter(function(e){return e.alive}),function(e){return e.pos}))?(this.pawn.log("found new target"),this.pawn.engageHostile(e)):this.pawn.log("no new targets?"),[3,7]);case 1:return t=this.pawn.enemyCombatant,Math.abs(this.pawn.pos.y-t.y)>40?[4,this.seek(t)]:[3,3];case 2:return n.sent(),[3,7];case 3:return this.pawn.withinFiringRange()?[4,this.attack()]:[3,5];case 4:return n.sent(),[3,7];case 5:return[4,this.pawn.advanceTowardsEnemy()];case 6:n.sent(),n.label=7;case 7:return[2]}})})},t.prototype.seek=function(e){return r(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return(t=this.planet.pathBetweenPoints(this.pawn.pos.clone(),e.pos.clone()))[1]?[4,this.pawn.glideTo(t[1])]:[3,2];case 1:n.sent(),n.label=2;case 2:return Math.abs(this.pawn.pos.y-e.y)>40&&t[2]?[4,this.pawn.glideTo(t[2])]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},t.prototype.attack=function(){return r(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.pawn.y=this.pawn.enemyCombatant.y,this.pawn.guarding||this.pawn.firing?[3,5]:[4,c.sleep(150*Math.random())];case 1:return e.sent(),this.pawn.isEvil||Math.random()>.5||this.pawn.health>90?[4,this.pawn.fire()]:[3,3];case 2:return e.sent(),[3,5];case 3:return[4,this.pawn.guard()];case 4:e.sent(),e.label=5;case 5:return[2]}})})},t.prototype.canApply=function(){var e=this;return this.hostiles.some(function(t){return e.pawn.pos.distance(t.pos)<e.vigilanceRange})},Object.defineProperty(t.prototype,"hostiles",{get:function(){return this.pawn.isEvil?this.planet.population.citizens:this.planet.population.raiders},enumerable:!0,configurable:!0}),t}(a.CombatStrategy);t.AttackNearestHostileStrategy=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n(10).Strategy);t.EatingStrategy=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(36),c=n(5),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.canApply=function(){return this.pawn.isHungry&&this.planet.storedResources.includes(c.ResourceBlock.Meal)},t.prototype.apply=function(){return r(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return(e=this.devices.find(function(e){return"store"===e.machine.operation.type&&e.machine.operation.stores.includes(c.ResourceBlock.Meal)&&e.product.includes(c.ResourceBlock.Meal)&&!e.reserved}))?(e.reserved=!0,[4,this.visitDevice(e)]):[3,6];case 1:return n.sent(),[4,e.interact(this.pawn,{type:"retrieve",resource:c.ResourceBlock.Meal})];case 2:return n.sent(),e.reserved=!1,(t=this.devices.find(function(e){return e.machine.isEatingSurface}))?[4,this.visitDevice(t)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[4,this.pawn.eat()];case 5:n.sent(),n.label=6;case 6:return[2]}})})},t}(a.EatingStrategy);t.WhenHungryEatingStrategy=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n(10).Strategy);t.SleepingStrategy=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(38),c=n(6),u=n(1),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.canApply=function(){var e=this;return!!this.bed&&!this.planet.population.raiders.some(function(t){return t.pos.distance(e.pawn.pos)<1e3})&&(this.pawn.health<100||!!this.pawn.isTired&&(this.planet.hour>21||this.planet.hour<4))},t.prototype.apply=function(){return r(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return(e=this.bed)?(e.inUse=!0,[4,this.visitDevice(e)]):[3,3];case 1:return t.sent(),[4,this.pawn.takeRest()];case 2:t.sent(),e.inUse=!1,t.label=3;case 3:return[2,!0]}})})},Object.defineProperty(t.prototype,"bed",{get:function(){return u.shuffle(this.devices).find(function(e){return e.machine instanceof c.Bed&&!e.inUse})},enumerable:!0,configurable:!0}),t}(a.SleepingStrategy);t.AnyBedSleepingStrategy=l},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),s=n(1),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.canApply=function(){return!!this.unbuiltDevice},Object.defineProperty(t.prototype,"unbuiltDevice",{get:function(){var e=this;return this.planet.colony.findAllDevices().find(function(t){return!t.built&&!t.inUse&&t.building.isActive&&s.containsUniq(e.planet.storedResources,t.machine.cost)})},enumerable:!0,configurable:!0}),t}(r.Strategy);t.ConstructionStrategy=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(){return r(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.unbuiltDevice&&this.unbuiltDevice.building?[4,this.constructDevice(this.unbuiltDevice)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.pause()];case 3:return e.sent(),[2]}})})},t.prototype.constructDevice=function(e){return r(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return e.inUse=!0,t=e.machine.cost,[4,this.gatherIngredients(t)];case 1:return n.sent()?[4,this.visitDevice(e)]:[3,4];case 2:return n.sent(),[4,e.assemble(this.pawn)];case 3:n.sent(),n.label=4;case 4:return e.inUse=!1,[2]}})})},t}(n(40).ConstructionStrategy);t.ProxmityBasedConstruction=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.retrieveResource=function(e){return{type:"retrieve",resource:e}},t.drive=function(){return{type:"drive"}}},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.storeBlock=function(e){return r(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:t=!1,n=0,o.label=1;case 1:return!t&&n<30?(n++,[4,this.tryStoreBlock(e)]):[3,6];case 2:return o.sent()?(t=!0,[3,5]):[3,3];case 3:return[4,this.pause()];case 4:o.sent(),o.label=5;case 5:return[3,1];case 6:return[2]}})})},t.prototype.tryStoreBlock=function(e){return r(this,void 0,void 0,function(){var t,n,o;return s(this,function(i){switch(i.label){case 0:return t=function(t){return"store"===t.operation.type&&t.product.length<t.getEffectiveOperationalCapacity(t.operation)&&t.operation.stores.includes(e)},n=this.planet.colony.closestDeviceByType(this.pawn.pos,[],t),o=!1,n?[4,this.visitDevice(n)]:[3,3];case 1:return i.sent(),[4,n.interact(this.pawn,{type:"store",resource:e})];case 2:i.sent()&&(o=!0),i.label=3;case 3:return[2,o]}})})},t}(n(10).Strategy);t.ProductionStrategy=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.canApply=function(){return!!this.findStore()},t.prototype.apply=function(){return r(this,void 0,void 0,function(){var e,t,n;return s(this,function(o){switch(o.label){case 0:return e=this.findStore(),t=this.findRecipe(e),n=this.findExplorer(e),t&&a.containsUniq(this.planet.storedResources,t.consumes)?[4,this.workRecipe(t)]:[3,4];case 1:return o.sent()?[4,this.storeBlock(t.produces)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[3,8];case 4:return n?[4,this.workExploration(n)]:[3,8];case 5:return o.sent()?[4,this.storeBlock(n.gathers)]:[3,7];case 6:o.sent(),o.label=7;case 7:return[3,8];case 8:return[2]}})})},t.prototype.findStore=function(){return a.shuffle(this.devices).find(function(e){return"store"===e.operation.type&&e.product.length<e.getEffectiveOperationalCapacity(e.operation)})},t.prototype.findRecipe=function(e){if(e&&"store"===e.operation.type){var t=e.operation;return a.shuffle(this.recipes).find(function(e){return t.stores.some(function(t){return e.produces===t})})}},t.prototype.findExplorer=function(e){if(e&&"store"===e.operation.type){var t=e.operation;return a.shuffle(this.explorers).find(function(e){return t.stores.some(function(t){return e.gathers===t})})}},t}(n(43).ProductionStrategy);t.CapacityBasedProduction=c},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(14),a=n(19),c=function(e){function t(t,n){var o=e.call(this,0,-t.getHeight()/2,0,0)||this;return o.planet=t,o.scene=n,o.citizens=[],o.raiders=[],o.traits=o.traits.filter(function(e){return!(e instanceof r.Traits.OffscreenCulling)}),console.log("in pop ctor, scene is: ",{scene:o.scene}),o}return i(t,e),t.prototype.update=function(e,t){var n=function(e){return e.alive};this.citizens=this.citizens.filter(n),this.raiders=this.raiders.filter(n)},t.prototype.increase=function(e,t){void 0===t&&(t=!1);var n=new s.Citizen(a.World.nameCitizen(),e,this.planet,t);n.work(),this.citizens.push(n),this.scene?this.scene.add(n):console.warn("no scene to add citizen to!?!?")},t}(r.Actor);t.Population=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=function(){function e(e){this.graph=e.graph()}return e.prototype.seekPath=function(e,t){return this.graph.shortestPath(e,t)},e.prototype.closestNode=function(e){var t=this.graph.dfs();return o.minBy(t,function(t){return Math.abs(e.distance(t))})||!1},e.prototype.closestNodeAtSameYCoordinate=function(e,t){void 0===t&&(t=50);var n=this.graph.dfs();return o.minBy(n.filter(function(n){return Math.abs(n.y-e.y)<t}),function(t){return Math.abs(e.distance(t))})||!1},e}();t.NavigationTree=i},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=n(46),c=n(2),u=function(e){function t(t,n){var o=e.call(this,t,n,0,0)||this;return o.buildings=[],o.currentlyConstructing=null,o.traits=o.traits.filter(function(e){return!(e instanceof r.Traits.OffscreenCulling)}),o}return i(t,e),t.prototype.draw=function(t,n){var o=this;e.prototype.draw.call(this,t,n);var i=c.Game.debugPath;this.navTree&&i&&this.navTree.graph.edgeList().forEach(function(e){var n=e[0],i=e[1],r=t.createLinearGradient(n.x,n.y+o.pos.y,i.x,i.y+o.pos.y);r.addColorStop(0,"green"),r.addColorStop(1,"blue"),t.beginPath(),t.moveTo(n.x,n.y+o.pos.y),t.lineTo(i.x,i.y+o.pos.y),t.closePath(),t.strokeStyle=r,t.lineWidth=.5,t.stroke()})},t.prototype.placeBuilding=function(e){e.placed=!0,e.parentSlot&&(e.parentSlot.parent.childrenBuildings.push(e),this.buildNavTree()),this.buildings.push(e),e.afterConstruct(),this.add(e)},t.prototype.closestBuildingByType=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=function(){return!0});var o=this.buildings.filter(function(e){return(!(t.length>0)||t.some(function(t){return e.structure instanceof t}))&&n(e)});if(o&&o.length>0)return s.minBy(o,function(t){return e.distance(t.nodes()[0])})},t.prototype.pathBetween=function(e,t){this.navTree||this.buildNavTree();var n=this.navTree.closestNode(e),o=t.nodes()[0],i=this.navTree.closestNode(o);return this.navTree.seekPath(n,i)},t.prototype.pathBetweenPoints=function(e,t,n){void 0===n&&(n=!0),this.navTree||this.buildNavTree();var o=n?this.navTree.closestNodeAtSameYCoordinate(e):this.navTree.closestNode(e),i=t,r=this.navTree.closestNode(i);return this.navTree.seekPath(o,r)},t.prototype.closestDeviceByType=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=function(){return!0});var o=this.findPoweredDevices();if((o=o.filter(function(e){return(!(t.length>0)||t.some(function(t){return e.machine instanceof t}))&&n(e)}))&&o.length>0)return s.minBy(o,function(t){return e.distance(t.pos.add(t.building.pos))})},Object.defineProperty(t.prototype,"origin",{get:function(){return this.buildings[0].pos},enumerable:!0,configurable:!0}),t.prototype.buildNavTree=function(){var e=this.buildings[0];e&&(this.navTree=new a.NavigationTree(e))},t.prototype.findAllDevices=function(){return s.flatSingle(this.buildings.map(function(e){return e.getDevices()}))},t.prototype.findPoweredDevices=function(){return s.flatSingle(this.activeBuildings.map(function(e){return e.getDevices()})).filter(function(e){return e.built})},Object.defineProperty(t.prototype,"activeBuildings",{get:function(){return this.buildings.filter(function(e){return e.isActive})},enumerable:!0,configurable:!0}),t}(r.Actor);t.Colony=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(16),a=n(2),c=n(15),u=function(){function e(e,t){this.citizen=e,this.onSelect=t,this.followed=!1,this.buildLine()}return Object.defineProperty(e.prototype,"root",{get:function(){return this._line},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t,n){e!==this.followed&&(this.followed=e,this._line.removeChild(this.button),this.button=this.makeButton(),this._line.appendChild(this.button)),this.sleepy.style.display=n?"inline":"none",this.hunger.style.display=t?"inline":"none",this.fighting.style.display=this.citizen.engagedInCombat?"inline":"none"},e.prototype.buildLine=function(){this._line=document.createElement("div"),this._line.style.fontFamily=a.Game.font,this._line.style.color="white",this._line.style.backgroundColor="#6a6a6a",this._line.style.display="flex",this._line.style.width="100%",this._line.style.justifyContent="space-between",this._line.style.paddingLeft="5px",this._line.style.fontSize="7pt";var e=document.createElement("span");e.textContent=[this.citizen.title,this.citizen.name].join(" "),e.style.alignSelf="center",this._line.appendChild(e),this.hunger=document.createElement("span"),this.hunger.textContent="hungry",this.hunger.style.color="yellow",this.hunger.style.padding="2px",this._line.appendChild(this.hunger),this.sleepy=document.createElement("span"),this.sleepy.textContent="sleepy",this.sleepy.style.color="blue",this.sleepy.style.padding="2px",this._line.appendChild(this.sleepy),this.fighting=document.createElement("span"),this.fighting.textContent="fighting",this.fighting.style.color="red",this.fighting.style.padding="2px",this._line.appendChild(this.fighting),this.button=this.makeButton(),this._line.appendChild(this.button)},e.prototype.makeButton=function(){var e=this,t=this.followed?"Following":"Follow",n=this.followed?r.Color.Violet:r.Color.DarkGray,o=c.assembleButton(t,n);return o.style.padding="15px",this.onSelect&&(o.onclick=function(){e.onSelect(e.citizen)}),o},e}(),l=function(e){function t(t,n,o){void 0===o&&(o=null);var i=e.call(this,"Colony Roster",t,n)||this;return i.onCitizenSelect=o,i.citizens=[],i.following=null,i.citizenLines=new Map,i}return i(t,e),t.prototype.updateRoster=function(e,t){var n=this,o=e.some(function(e){return!n.doesRosterInclude(e)}),i=this.citizens.some(function(t){return!e.includes(t)});(o||i)&&(this.citizens=e,this.makeRoster()),this.following=t,this.updateRosterDetails()},t.prototype.updateRosterDetails=function(){var e=this;this.citizens.forEach(function(t){e.citizenLines.get(t).update(e.following===t,t.isHungry,t.isTired)})},t.prototype.doesRosterInclude=function(e){return this.citizens.includes(e)},t.prototype.makeRoster=function(){var e=this;this.makeRootElement(),this.citizens.forEach(function(t){return e.makeCitizenLine(t)})},t.prototype.makeCitizenLine=function(e){var t=new u(e,this.onCitizenSelect);this.citizenLines.set(e,t),this._element.appendChild(t.root)},t}(s.Pane);t.CitizenList=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(2),r=function(){function e(e,t,n,o,i){void 0===i&&(i=500),this.title=e,this.message=t,this.x=n,this.y=o,this.width=i,this.makeDialog()}return e.prototype.draw=function(e){if(this._element){var t=e.canvas.offsetLeft-this.width/2,n=e.canvas.offsetTop-this._element.clientHeight/2;this._element.style.left=t+this.x+"px",this._element.style.top=n+this.y+"px"}},e.prototype.addButtons=function(e){var t=this,n=Object.entries(e);n.forEach(function(e){var i=e[0],r=e[1],s=t.buttonFactory(i,o.Color.Gray,t.width/n.length);s.onclick=r,t._footer.appendChild(s)})},e.prototype.teardown=function(){document.body.removeChild(this._element)},e.prototype.makeDialog=function(){this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.display="flex",this._element.style.flexWrap="wrap",this._element.style.width=this.width+"px",this._element.style.border="none",document.body.appendChild(this._element);var e=o.Color.Violet.clone().darken(.92);e.a=.3;var t=document.createElement("div");t.textContent=this.title,t.style.fontFamily=i.Game.font,t.style.fontSize="14pt",t.style.fontWeight="700",t.style.textTransform="uppercase",t.style.textAlign="center",t.style.width=this.width+"px",t.style.color=o.Color.White.toRGBA(),t.style.backgroundColor=e.toRGBA(),t.style.padding="12px",t.style.margin="0px",this._element.appendChild(t),this._header=document.createElement("div"),this._header.style.width=this.width+"px",this._header.style.backgroundColor=e.toRGBA(),this._element.appendChild(this._header),this._body=document.createElement("div"),this._body.textContent=this.message,this._body.style.fontFamily=i.Game.font,this._body.style.fontSize="9pt",this._body.style.fontWeight="400",this._body.style.width=this.width+"px",this._body.style.color=o.Color.White.toRGBA(),this._body.style.backgroundColor=e.toRGBA(),this._body.style.padding="24px",this._body.style.paddingBottom="48px",this._body.style.margin="0px",this._element.appendChild(this._body),this._footer=document.createElement("div"),this._footer.style.width=this.width+"px",this._footer.style.display="flex",this._footer.style.flexWrap="wrap",this._element.appendChild(this._footer)},e.prototype.addHeading=function(e,t,n){void 0===t&&(t=24),void 0===n&&(n=o.Color.White);var r=document.createElement("div");r.textContent=e,r.style.fontFamily=i.Game.font,r.style.fontSize=t+"pt",r.style.fontWeight="600",r.style.textAlign="center",r.style.width=this.width+"px",r.style.color=n.clone().toRGBA(),r.style.padding="0px",r.style.margin="0px",this._header.appendChild(r)},e.prototype.addIconMatrix=function(e){void 0===e&&(e=[]);var t=document.createElement("div");t.style.display="flex",t.style.flexWrap="wrap",t.style.padding="15px",t.style.width="100%",e.forEach(function(e){var n=e.label,o=e.image,r=new Image;r.width=64,r.height=64,r.src=o,r.style.padding="8px";var s=document.createElement("span");s.textContent=n,s.style.textAlign="center",s.style.padding="8px",s.style.fontSize="6pt",s.style.fontFamily=i.Game.font;var a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.padding="4px",a.appendChild(r),a.appendChild(s),t.appendChild(a)}),this._body.appendChild(t)},e.prototype.buttonFactory=function(e,t,n){void 0===t&&(t=o.Color.DarkGray),void 0===n&&(n=this.width/2);var r=t.darken(.5).desaturate(.5).clone();r.a=.8;var s=t.lighten(.8).desaturate(.4).clone(),a=document.createElement("button");return a.textContent=e,a.style.display="block",a.style.fontSize="7pt",a.style.fontFamily=i.Game.font,a.style.fontWeight="500",a.style.padding="20px",a.style.width=n+"px",a.style.textTransform="uppercase",a.style.border="none",a.style.background=r.toRGBA(),a.style.color=s.toRGBA(),a.onmouseover=function(){a.style.background=r.saturate(.5).lighten(.95).toRGBA(),a.style.color=s.lighten(.9).toRGBA()},a.onmouseleave=function(){a.style.background=r.toRGBA(),a.style.color=s.toRGBA()},a},e}();t.Modal=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(16),a=n(15),c=function(e){function t(t,n,o,i,r,s,a){void 0===r&&(r=null),void 0===s&&(s=null),void 0===a&&(a=!0);var c=e.call(this,t,n,o)||this;return c.all=i,c.onButtonClick=r,c.onButtonEnter=s,c.comprehend=a,c.built=[],c.comprehended=[],c.makePalette(),c}return i(t,e),t.prototype.updateBuilt=function(e,t){var n=this;if(void 0===t&&(t=[]),this.built=e,this.comprehend){var o=this.all.filter(function(e){return(new e).prereqs.every(function(e){return n.built.some(function(t){return t===e})})});this.comprehended=o.concat(t).filter(r.onlyUnique)}else this.comprehended=this.built.concat(t).filter(r.onlyUnique);this.makePalette()},t.prototype.makePalette=function(){var e=this;this.makeRootElement(),this.comprehended.map(function(e){return new e}).sort(function(e,t){return e.color>t.color?-1:1}).forEach(function(t){if(!t.hide){var n=t.name;e.built.map(function(e){return(new e).name}).includes(t.name)||(n+=" *");var o=t.color,i=a.assembleButton(n,o);e._element.appendChild(i),e.onButtonEnter&&(i.onmouseenter=function(){e.onButtonEnter(t)}),e.onButtonClick&&(i.onclick=function(){e.onButtonClick(t)})}})},t}(s.Pane);t.Palette=c},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(6),a=n(5),c=n(13),u=n(4),l=n(11),p=n(1),h=n(2),f=function(e){function t(t,n,o){var i=e.call(this,n,o,0,0)||this;return i.entity=t,i.describeResources=function(e){var t=p.countOccurrences(e);return Object.keys(t).map(function(e){return e+" x"+t[e]}).join(" + ")},i.values=new r.Label("",0,0,h.Game.font),i.values.fontSize=10,i.add(i.values),i.notes=new r.Label("behavioral notes",0,30,h.Game.font),i.notes.fontSize=11,i.add(i.notes),i.description=new r.Label("description",0,60,h.Game.font),i.description.fontSize=12,i.description.fontStyle=r.FontStyle.Italic,i.description.color=r.Color.DarkGray,i.add(i.description),i.footer=new r.Label("footer",20,80,h.Game.font),i.footer.fontSize=10,i.footer.fontStyle=r.FontStyle.Italic,i.add(i.footer),i.show(t),i}return i(t,e),t.prototype.show=function(e){if(e)if(this.description.text=e.description,e instanceof s.Machine||e instanceof l.Device){this.values.text=this.describeEconomy(e.economy);var t=e instanceof s.Machine?"Cost: "+this.describeResources(e.cost):e.built?this.describeResources(e.product):"under construction",n="For Dome: "+((e instanceof s.Machine?e.forDome:e.machine.forDome)?"Yes":"No");this.footer.text=""===t?n:[t,n].join(" | "),this.notes.text="";var o=e.operation;o&&("recipe"===o.type?this.notes.text="Turns "+o.consumes.join(" + ")+" -> "+o.produces+".":"generator"===o.type?this.notes.text="Generates "+o.generates+".":"store"===o.type?this.notes.text="Stores "+o.stores.join(" + "):"spawn"===o.type&&(this.notes.text="Decants clones."))}else if(e instanceof c.RoomRecipe){var i=e.bonuses,r=i.capacity,a=i.workSpeed,p=[];r>0&&p.push("+"+r+" cap"),a>1&&p.push("+"+Math.floor(100*a-100)+"% efficiency"),this.values.text=p.join("; "),this.notes.text=e.machines.map(function(e){return(new e).name}).join(" + "),this.footer.text=""}else if(e instanceof u.Building){this.values.text=this.describeEconomy(e.economy(!1)),this.notes.text=e.getDevices().map(function(e){return e.machine.name}).join(" + ");var h=e.getDevices().map(function(e){return e.product}).reduce(function(e,t){return e.concat(t)},[]);this.footer.text=h.length>0?"Currently contains: "+this.describeResources(h):""}else this.values.text="",this.notes.text="",this.footer.text=""},t.prototype.describeEconomy=function(e){var t=[],n=e;for(var o in a.PureValue){var i=n[o],r=i.supply-i.demand;r>0?t.push("+"+r.toFixed()+" "+o):r<0&&t.push(r.toFixed()+" "+o)}return t.join(" | ")},t}(r.Actor);t.CardBody=f},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(12),a=n(6),c=n(3),u=n(13),l=n(4),p=n(11),h=n(2),f=function(e){function t(t,n,o){var i=e.call(this,n,o,14,32,t&&t.color||r.Color.Gray)||this;return i.entity=t,i.name=new r.Label(t&&t.name||"..",20,16,h.Game.font),i.name.fontSize=28,i.name.color=r.Color.Black,i.add(i.name),i.type=new r.Label("..",220,18,h.Game.font),i.type.fontSize=10,i.type.color=r.Color.Gray,i.type.fontStyle=r.FontStyle.Italic,i.add(i.type),t&&i.announce(t),i}return i(t,e),t.prototype.announce=function(e){this.name.text=e.name,this.color=e.color.desaturate(.5).darken(.2),e instanceof a.Machine&&(this.type.text=c.DeviceSize[e.size]+" Machine Type"),e instanceof s.Structure&&(this.type.text="Structure"),e instanceof u.RoomRecipe&&(this.type.text="Function"),e instanceof l.Building&&(this.type.text="Building"),e instanceof p.Device&&(this.type.text=c.DeviceSize[e.size]+" Machine")},t}(r.Actor);t.CardTitle=f},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(6),a=n(52),c=n(51),u=n(11),l=function(e){function t(t,n,o){var i=e.call(this,n+160,o+90,320,180,r.Color.White)||this;return i.entity=t,i.title=new a.CardTitle(t,-153,-50),i.add(i.title),i.cardBody=new c.CardBody(t,-136,-10),i.add(i.cardBody),i.image=new Image,i}return i(t,e),t.prototype.draw=function(t,n){if(e.prototype.draw.call(this,t,n),this.entity&&(this.entity instanceof s.Machine||this.entity instanceof u.Device)){var o=this.pos.x+48,i=this.pos.y-16;t.drawImage(this.image,o,i,92,92)}},t.prototype.present=function(e){this.title.announce(e),this.cardBody.show(e),this.entity=e;var t=null;this.entity instanceof s.Machine?t=this.entity.image:this.entity instanceof u.Device&&(t=this.entity.machine.image),t&&(this.image.src=t)},t}(r.Actor);t.Card=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(1),r=n(2),s=function(){function e(e,t,n){var o=this;this.x=e,this.y=t,this.playlist=n,this.paused=!1,this.makePlayer(),setTimeout(function(){o.startMusic()},3e3),this._titleElem.textContent="Getting ready...",this.currentTrack=i.sample(Object.keys(this.playlist))}return e.prototype.startMusic=function(){var e=this;this._titleElem.textContent="Playing: "+this.currentTrack,this.playlist[this.currentTrack].play().then(function(){e.advancePlaylist()})},e.prototype.draw=function(e){if(this._element){var t=e.canvas.offsetLeft,n=e.canvas.offsetTop;this._wrapper.style.left=t+this.x+"px",this._wrapper.style.top=n+this.y+"px"}},e.prototype.makePlayer=function(){this._wrapper=document.createElement("div"),this._wrapper.style.position="absolute",this._wrapper.style.width="20%",this._wrapper.style.maxHeight="20px",this._wrapper.style.textAlign="left",this._wrapper.style.border="none",this._wrapper.style.overflow="hidden",document.body.appendChild(this._wrapper),this._element=document.createElement("div"),this._element.style.display="inline-block",this._element.style.border="none",this._wrapper.appendChild(this._element),this._titleElem=document.createElement("span"),this._titleElem.style.fontFamily=r.Game.font,this._titleElem.style.fontSize="7pt",this._titleElem.style.padding="24px",this._titleElem.style.color="white",this._wrapper.appendChild(this.inlineBlock(this._titleElem));var e=this.iconFactory({type:"play"},"&#9655;");this._wrapper.appendChild(this.inlineBlock(e));var t=this.iconFactory({type:"pause"},"&#10072; &#10072;");this._wrapper.appendChild(this.inlineBlock(t));var n=this.iconFactory({type:"next"},"&rarr;");this._wrapper.appendChild(this.inlineBlock(n))},e.prototype.handleAction=function(e){"pause"===e.type?(this.song.pause(),this.paused=!0,this._titleElem.textContent="Paused: "+this.currentTrack):"play"===e.type?(this.song.play(),this.paused=!1,this._titleElem.textContent="Playing: "+this.currentTrack):"next"===e.type&&(this.paused&&(this.song.play(),this.paused=!1),this.song.stop())},e.prototype.advancePlaylist=function(){var e=this.trackNames.indexOf(this.currentTrack);e=(e+1)%this.trackNames.length,this.currentTrack=this.trackNames[e],this.startMusic()},Object.defineProperty(e.prototype,"trackNames",{get:function(){return Object.keys(this.playlist)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"song",{get:function(){return this.playlist[this.currentTrack]},enumerable:!0,configurable:!0}),e.prototype.inlineBlock=function(e){var t=document.createElement("div");return t.style.display="inline-block",t.style.border="none",t.append(e),t},e.prototype.iconFactory=function(e,t){var n=this,i=o.Color.Transparent,s=o.Color.White,a=document.createElement("button");return a.innerHTML=t,a.style.display="block",a.style.fontSize="7pt",a.style.fontFamily=r.Game.font,a.style.border="none",a.style.padding="4px",a.style.background=i.toRGBA(),a.style.color=s.toRGBA(),a.onclick=function(){n.handleAction(e)},a},e}();t.MusicPlayer=s},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(2),a=function(e){function t(t,n,o){var i=e.call(this,n,o,0,0)||this;return i.nameLabel=new r.Label(t,n,o,s.Game.font),i.nameLabel.fontSize=10,i.nameLabel.color=r.Color.White.darken(.2),i.add(i.nameLabel),i.valueLabel=new r.Label("0",n+40,o,s.Game.font),i.valueLabel.fontSize=10,i.valueLabel.color=r.Color.White.darken(.2),i.add(i.valueLabel),i}return i(t,e),t.prototype.setCount=function(e){this.valueLabel.text=""+e;var t=r.Color.Gray;e>0?t=r.Color.Green:e<0&&(t=r.Color.Red),this.valueLabel.color=t},t}(r.Actor);t.EconomicValue=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(5),a=n(55),c=n(1),u=function(e){function t(t,n,o){var i=e.call(this,n,o,0,0)||this;i.valueLabels={Power:null,Oxygen:null,Water:null,Shelter:null,Hope:null,Joy:null,Wisdom:null,Wealth:null,Beauty:null,Wonder:null};for(var r=0,a=0,u=c.eachChunk(s.allValues,2);a<u.length;a++){var l=u[a],p=l[0],h=l[1];i.addValue(32*r,0,p),i.addValue(32*r,7,h),r+=1}return i.updateView(t),i}return i(t,e),t.prototype.addValue=function(e,t,n){var o=new a.EconomicValue(n,e,t);this.valueLabels[n]=o,this.add(o)},t.prototype.updateView=function(e){for(var t=e,n=0,o=s.allValues;n<o.length;n++){var i=o[n];this.valueLabels[i].setCount(s.availableCapacity(t,i))}},t}(r.Actor);t.EconomyView=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(5),a=n(2),c=function(e){function t(t,n,o){var i=e.call(this,t,n,60,16,r.Color.Black)||this;return i.messageLabel=new r.Label(o,-16,6,a.Game.font),i.messageLabel.color=r.Color.White,i.add(i.messageLabel),i}return i(t,e),t}(r.Actor),u=function(e){function t(t,n,o,i){var u=e.call(this,t-5,n-5,20,10)||this;u.value=i,u.hovering=!1;var l=new r.Actor(5,5,10,10,s.blockColor(o));return u.add(l),u.count=new r.Label("x"+i,15,10,a.Game.font),u.count.fontSize=10,u.count.color=r.Color.White,u.add(u.count),u.tooltip=new c(0,5,s.ResourceBlock[o]),u.tooltip.visible=!1,u.add(u.tooltip),u.on("pointerenter",function(){u.tooltip.visible=!0}),u.on("pointerleave",function(){u.tooltip.visible=!1}),u}return i(t,e),t.prototype.credit=function(e){this.value+=e,this.count.text="x"+this.value},t.prototype.debit=function(e){this.value-=e,this.count.text="x"+this.value},t}(r.UIActor);t.ResourceListEntry=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(5),a=n(57),c=n(1),u=function(e){function t(t,n){var o,i=e.call(this,t,n,0,0)||this;i.entries=((o={})[s.ResourceBlock.Biomass]=null,o[s.ResourceBlock.Idea]=null,o[s.ResourceBlock.Ore]=null,o[s.ResourceBlock.Meal]=null,o[s.ResourceBlock.Mineral]=null,o[s.ResourceBlock.Data]=null,o[s.ResourceBlock.Alloy]=null,o[s.ResourceBlock.Bioplasma]=null,o[s.ResourceBlock.Algorithm]=null,o[s.ResourceBlock.Argent]=null,o[s.ResourceBlock.Aurum]=null,o[s.ResourceBlock.Omnium]=null,o);var r=[s.ResourceBlock.Meal,s.ResourceBlock.Bioplasma,s.ResourceBlock.Data,s.ResourceBlock.Algorithm,s.ResourceBlock.Mineral,s.ResourceBlock.Alloy,s.ResourceBlock.Argent,s.ResourceBlock.Aurum];return c.eachChunk(r,2).forEach(function(e,t){var n=e[0],o=e[1],r=0+36*t,s=0*t-5;i.addEntry(r,s,n),i.addEntry(r,s+14,o)}),i}return i(t,e),t.prototype.addEntry=function(e,t,n){var o=new a.ResourceListEntry(e,t,n,0);this.add(o),this.entries[n]=o},t.prototype.increment=function(e){var t=this.entries[e];t&&t.credit(1)},t.prototype.decrement=function(e){var t=this.entries[e];t&&t.debit(1)},t}(r.Actor);t.ResourcesList=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(58),a=n(56),c=n(54),u=n(24),l=n(2),p=function(e){function t(t,n,o){var i=e.call(this,0,0,2*n,o,r.Color.DarkGray.clone().darken(.92))||this,p=new r.Label(l.Game.title,5,32,l.Game.font);p.fontSize=28,p.color=r.Color.Gray,p.fontStyle=r.FontStyle.Italic,i.add(p);var h=new r.Label("v0.1",100,28,l.Game.font);return h.fontSize=7,h.color=r.Color.Gray.darken(.4),i.add(h),i.resources=new s.ResourcesList(130,14),i.add(i.resources),i.economy=new a.EconomyView(t,280,14),i.add(i.economy),i.clock=new r.Label("current time",600,14,l.Game.font),i.clock.color=r.Color.White,i.add(i.clock),i.popLabel=new r.Label("",600,28,l.Game.font),i.popLabel.fontSize=10,i.popLabel.color=r.Color.White,i.add(i.popLabel),i.messageLabel=new r.Label("hi",750,14,l.Game.font),i.messageLabel.fontSize=10,i.messageLabel.color=r.Color.White,i.messageLabel.fontStyle=r.FontStyle.Italic,i.add(i.messageLabel),i.musicPlayer=new c.MusicPlayer(726,12,{"Future Tense":u.Resources.FutureTense,Assembler:u.Resources.Assembler}),i}return i(t,e),t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n),this.musicPlayer.draw(t)},t.prototype.incrementResource=function(e){this.resources.increment(e)},t.prototype.decrementResource=function(e){this.resources.decrement(e)},t.prototype.setMessage=function(e){this.messageLabel.text=e},t.prototype.showEconomy=function(e){this.economy.updateView(e)},t.prototype.showPopCap=function(e,t){this.popLabel.text="Pop: "+e+"/"+t},t.prototype.setClock=function(e){void 0===e&&(e=0);var t=(Math.floor(e/1440)+1).toString(),n=Math.floor(e/60)%24,o=Math.floor((n+11)%12+1).toString(),i=Math.floor(e%60).toString(),r=n<12?"AM":"PM";this.clock.text="Day "+t+". "+o+":"+i.padStart(2,"0")+" "+r},t}(r.Actor);t.StatusAnalysisView=p},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),s=n(7),a=n(0),c=n(3),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.deviceSize=c.DeviceSize.Small,t}return i(t,e),t.prototype.colorBase=function(){return a.Color.Orange.clone().darken(.05)},t.prototype.draw=function(t,n){e.prototype.draw.call(this,t,n)},t.prototype.slots=function(){var e=[],t=this.getHeight(),n=this.getWidth()/4;return e.push(this.buildSlot(this.pos.x-n,this.pos.y+t,s.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth()+n,this.pos.y+t,s.Orientation.Right)),e},t}(r.Building);t.GroundVehiclePoolView=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(8),a=n(7),c=n(3),u=n(9),l=n(1),p=n(17),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hideBox=!0,t.showLabel=!0,t.devicePlaceSize=c.DeviceSize.Medium,t.devicePlaceCount=3,t}return i(t,e),Object.defineProperty(t.prototype,"floorHeight",{get:function(){return this.getHeight()/6},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"floorY",{get:function(){return this.pos.y+this.getHeight()-this.floorHeight},enumerable:!0,configurable:!0}),t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y+this.getHeight()-16;return[new r.Vector(Math.floor(e),Math.floor(t))]},t.prototype.devicePlaces=function(){var e=this,t=this.getWidth()/2,n=this.pos.x+t,o=this.pos.y+this.getHeight()-this.floorHeight-12;return o-=c.getVisibleDeviceSize(this.devicePlaceSize)/3.5,[new r.Vector(n-t/2,o)].concat(this.devicePlaceCount>2?[new r.Vector(n,o)]:[],[new r.Vector(n+t/2,o)]).map(function(t){return new s.DevicePlace(t,e.devicePlaceSize)})},t.prototype.graph=function(t){var n=e.prototype.graph.call(this,t),o=function(e){return n.findOrCreate(e,l.measureDistance)},i=this.slots().map(function(e){return e.pos}),r=this.deviceInteractionPlaces().map(function(e){return o(e)});if(l.eachCons(r,2).forEach(function(e){var t=e[0],o=e[1];return n.edge(t,o)}),this.isGroundFloor){var s=o(i[0]),a=o(i[i.length-1]);n.edge(s,r[0]),n.edge(r[r.length-1],a)}else{var c=o(i[1]);n.edge(r[1],c)}var u=this.nodes()[0];return r.forEach(function(e){return n.edge(e,o(u))}),n},t.prototype.slots=function(){var e=[],t=this.getHeight()-this.floorHeight;return this.isGroundFloor&&e.push(this.buildSlot(this.pos.x,this.pos.y+t,a.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),a.Orientation.Down)),e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y-1,a.Orientation.Up)),this.isGroundFloor&&e.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+t,a.Orientation.Right)),e},Object.defineProperty(t.prototype,"isGroundFloor",{get:function(){return!(this.parentSlot&&this.parentSlot.parent instanceof t)},enumerable:!0,configurable:!0}),t.prototype.constrainCursor=function(e){return 0===this.planet.colony.buildings.length&&(e.y=this.planet.getTop()),e},t.prototype.reshape=function(e){0===this.planet.colony.buildings.length?(this.pos=e,this.pos.y-=this.getHeight()-2-this.floorHeight):this.alignToSlot(e)},t.prototype.draw=function(t,n){var o=this.mainColor();if(t.fillStyle=o.toRGBA(),u.drawPatternedPoly(t,this.angledRoofPoly(),this.backgroundPattern,this.mainColor()),!this.isActive){var i=r.Color.Black.clone();i.a=.6,u.drawPoly(t,this.angledRoofPoly(),i)}var s=this.planet.color.darken(.6);u.drawRect(t,{x:this.x,y:this.y+this.getHeight()-this.floorHeight-12,width:this.getWidth(),height:17},0,s.lighten(.4)),u.drawRect(t,{x:this.x,y:this.y+this.getHeight()-this.floorHeight- -5,width:this.getWidth(),height:this.floorHeight+-5},0,s);var a=this.pos.x+this.getWidth()/4*3,c=this.pos.y-18;t.fillStyle=r.Color.Black.fillStyle(),t.fillRect(a,c-1,1,19),u.drawPatternedRect(t,{x:a,y:c,width:10,height:6},p.BackgroundPattern.USSF),e.prototype.draw.call(this,t,n)},t.prototype.colorBase=function(){return r.Color.White.clone()},t}(s.Building);t.MediumSurfaceRoomView=h},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),s=n(3),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=s.DeviceSize.Medium,t.devicePlaceCount=3,t}return i(t,e),t.prototype.poly=function(){return this.angledRoofPoly()},t}(r.CommonAreaView);t.MediumRoomThreeView=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),s=n(0),a=n(8),c=n(3),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=c.DeviceSize.Huge,t}return i(t,e),t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-this.floorHeight-c.getVisibleDeviceSize(c.DeviceSize.Huge)/2;return[new s.Vector(t-e/3,n),new s.Vector(t+e/3,n)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Huge)})},t}(r.CommonAreaView);t.HugeRoomView=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),s=n(0),a=n(8),c=n(3),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=c.DeviceSize.Large,t}return i(t,e),t.prototype.devicePlaces=function(){var e=this.getWidth()/2,t=this.pos.x+e,n=this.pos.y+this.getHeight()-c.getVisibleDeviceSize(c.DeviceSize.Large)/2;return[new s.Vector(t-e/3,n),new s.Vector(t+e/3,n)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Large)})},t}(r.CommonAreaView);t.LargeRoomView=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),s=n(3),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceSize=s.DeviceSize.Medium,t.devicePlaceCount=2,t}return i(t,e),t}(r.CommonAreaView);t.MediumRoomView=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceCount=3,t}return i(t,e),t.prototype.poly=function(){return this.angledRoofPoly()},t}(n(4).CommonAreaView);t.SmallRoomThreeView=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceCount=3,t}return i(t,e),t}(n(4).DomeView);t.BigDomeView=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceCount=3,t}return i(t,e),t}(n(4).DomeView);t.MidDomeView=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.devicePlaceCount=3,t}return i(t,e),t}(n(4).DomeView);t.SmallDomeThreeView=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.colorBase=function(){return this.color.lighten(.1)},t}(n(4).CorridorView);t.SurfaceRoadView=r},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),s=n(7),a=n(18),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.originSlot=null,t.slotSize=a.Scale.major.third,t}return i(t,e),t.prototype.constrainCursor=function(e){return this.pickingOrigin||(e.x=this.pos.x),e},t.prototype.reshape=function(e){if(this.pickingOrigin){var t=this.alignToSlot(e);t&&(this.facing=t.facing,t&&(this.originSlot=t))}else if(this.facing===s.Orientation.Up){var n=this.originSlot.pos.y-this.planet.getTop()-25,o=Math.min(n,Math.max(this.slotSize,this.originSlot.pos.y-e.y));this.setHeight(o/this.slotSize*this.slotSize+15),this.pos.y=this.originSlot.pos.y-this.getHeight()}else o=Math.max(this.slotSize,e.y-this.originSlot.pos.y),this.setHeight(o/this.slotSize*this.slotSize+15)},t}(r.TunnelView);t.LadderView=c},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),s=n(0),a=n(8),c=n(3),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.devicePlaces=function(){var e=3*this.getWidth()/5,t=this.pos.x+e,n=this.pos.y+this.getHeight()/2;return[new s.Vector(t,n-800),new s.Vector(t,n),new s.Vector(t,n+800)].map(function(e){return new a.DevicePlace(e,c.DeviceSize.Huge)})},t.prototype.draw=function(e,t){this.drawShape(e,this.pos.x,this.pos.y),this.getDevices().forEach(function(n){return n.draw(e,t)})},t.prototype.drawShape=function(e,t,n){var o=this.getHeight(),i=this.getWidth();e.beginPath(),e.moveTo(0+t,o+n),e.bezierCurveTo(1+t,o-150+n,121+t,70+n,i-80+t,8+n),e.bezierCurveTo(i-40+t,2+n,i-5+t,11+n,i-10+t,25+n),e.bezierCurveTo(i-5+t,10+n,i+t,o-10+n,i+t,o+n),e.lineTo(0+t,o+n),e.fillStyle=this.mainColor().toRGBA(),e.fill()},t}(r.DomeView);t.ArcologyView=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(8),a=n(1),c=n(7),u=n(23),l=n(9),p=n(18),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slotSize=p.Scale.major.eighth+10,t.pickingOrigin=!0,t.hideBox=!0,t}return i(t,e),t.prototype.colorBase=function(){return this.planet.color.darken(.2)},t.prototype.draw=function(e,t){var n=this.aabb();l.drawRect(e,n,0,this.color.darken(.1)),n.x=n.x+this.getWidth()/5,n.width-=this.getWidth()/5*2,l.drawRect(e,n,0,this.color.darken(.2))},t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y;return[new r.Vector(Math.floor(e),t)]},t.prototype.graph=function(e){void 0===e&&(e=new u.Graph);var t=e,n=this.getWidth()/2,o=this.pos.x+n,i=t.findOrCreate(this.nodes()[0],a.measureDistance),s=t.findOrCreate(new r.Vector(o,this.slotHeights()[0]),a.measureDistance);t.edge(i,s);var c=this.slotHeights();a.eachCons(c,2).forEach(function(e){var n=e[0],i=e[1],s=t.findOrCreate(new r.Vector(o,n),a.measureDistance),c=t.findOrCreate(new r.Vector(o,i),a.measureDistance);t.edge(s,c)});var l=t.findOrCreate(new r.Vector(o,this.pos.y+this.getHeight()),a.measureDistance),p=t.findOrCreate(new r.Vector(o,c[c.length-1]),a.measureDistance);t.edge(l,p),c.forEach(function(e){var i=t.findOrCreate(new r.Vector(o,e),a.measureDistance),s=t.findOrCreate(new r.Vector(o-n,e),a.measureDistance);t.edge(s,i);var c=t.findOrCreate(new r.Vector(o+n,e),a.measureDistance);t.edge(i,c)});for(var h=0,f=this.childrenBuildings;h<f.length;h++){var d=f[h],y=t.findOrCreate(d.parentSlot.pos,a.measureDistance),m=t.findOrCreate(d.nodes()[0],a.measureDistance);t.edge(m,y),t.edge(y,m),d.graph(t)}return t},t.prototype.slotHeights=function(){var e=Math.floor(this.getHeight()/this.slotSize),t=[],n=this.pos.y;if(e>0)for(var o=0,i=a.range(e);o<i.length;o++){var r=i[o];t.push(n+(r+1)*this.slotSize)}else t.push(this.slotSize);return t},t.prototype.slots=function(){var e=[];e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,c.Orientation.Up));for(var t=0,n=this.slotHeights();t<n.length;t++){var o=n[t];e.push(this.buildSlot(this.pos.x,o,c.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth(),o,c.Orientation.Right))}return e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),c.Orientation.Down)),e},t.prototype.handleClick=function(e){return!this.pickingOrigin||(this.pickingOrigin=!1,!1)},t.prototype.constrainCursor=function(e){return this.pickingOrigin,e},t.prototype.reshape=function(e){this.pickingOrigin&&this.alignToSlot(e);var t=this.slotSize*Math.floor(Math.abs(e.y-this.planet.getTop())/this.slotSize)+15;this.setHeight(Math.max(t,this.slotSize+15))},t}(s.Building);t.TunnelView=h},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(8),a=n(7),c=n(3),u=n(1),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hideBox=!0,t.showLabel=!0,t.deviceSize=c.DeviceSize.Small,t.devicePlaceCount=2,t}return i(t,e),t.prototype.graph=function(t){var n=e.prototype.graph.call(this,t),o=function(e){return n.findOrCreate(e,u.measureDistance)},i=this.slots().map(function(e){return e.pos}),r=o(i[0]),s=o(i[i.length-1]),a=this.deviceInteractionPlaces().map(function(e){return o(e)});n.edge(r,a[0]),u.eachCons(a,2).forEach(function(e){var t=e[0],o=e[1];return n.edge(t,o)}),n.edge(a[a.length-1],s);var c=this.nodes()[0];return a.forEach(function(e){return n.edge(e,o(c))}),n},t.prototype.slots=function(){var e=[],t=this.getHeight(),n=this.getWidth()/4;return e.push(this.buildSlot(this.pos.x-n,this.pos.y+t,a.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth()+n,this.pos.y+t,a.Orientation.Right)),e},t.prototype.draw=function(t,n){var o=this.mainColor(),i=this.getHeight();t.beginPath(),t.arc(this.pos.x+this.getWidth()/2,this.pos.y+i,this.getWidth()/1.5,0,Math.PI,!0),t.closePath(),t.fillStyle=o.toRGBA(),t.fill(),e.prototype.draw.call(this,t,n)},t.prototype.colorBase=function(){return r.Color.White.clone().darken(.05)},t.prototype.devicePlaces=function(){var e=this,t=this.getWidth()/2,n=this.pos.x+t,o=this.pos.y+this.getHeight()-c.getVisibleDeviceSize(this.deviceSize)/3;return[new r.Vector(n-t/3,o)].concat(3===this.devicePlaceCount?[new r.Vector(n,o)]:[],[new r.Vector(n+t/3,o)]).map(function(t){return new s.DevicePlace(t,e.deviceSize)})},t}(s.Building);t.DomeView=l},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),s=n(7),a=n(0),c=n(3),u=n(9),l=n(1),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edgeWidth=0,t.showLabel=!0,t.hideBox=!0,t.devicePlaceSize=c.DeviceSize.Small,t.devicePlaceCount=2,t}return i(t,e),Object.defineProperty(t.prototype,"floorHeight",{get:function(){return this.getHeight()/6},enumerable:!0,configurable:!0}),t.prototype.colorBase=function(){return this.color.darken(.3)},t.prototype.poly=function(){return this.aabbPoly()},Object.defineProperty(t.prototype,"floorY",{get:function(){return this.pos.y+this.getHeight()-this.floorHeight},enumerable:!0,configurable:!0}),t.prototype.draw=function(t,n){if(u.drawPatternedPoly(t,this.poly(),this.backgroundPattern,this.mainColor()),!this.isActive){var o=a.Color.Black.clone();o.a=.6,u.drawPoly(t,this.poly(),o)}var i=this.planet.color.darken(.6);u.drawRect(t,{x:this.x,y:this.y+this.getHeight()-this.floorHeight-12,width:this.getWidth(),height:17},0,i.lighten(.4)),u.drawRect(t,{x:this.x,y:this.y+this.getHeight()-this.floorHeight- -5,width:this.getWidth(),height:this.floorHeight+-5},0,i),e.prototype.draw.call(this,t,n)},t.prototype.slots=function(){var e=[],t=this.getHeight()-this.floorHeight,n=this.buildSlot(this.pos.x,this.pos.y+t,s.Orientation.Left);e.push(n);var o=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+t,s.Orientation.Right);return e.push(o),e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,s.Orientation.Up)),e.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),s.Orientation.Down)),e},t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y+this.getHeight()-this.floorHeight;return[new a.Vector(Math.floor(e),Math.floor(t))]},t.prototype.graph=function(t){var n=e.prototype.graph.call(this,t),o=this.slots(),i=function(e){return n.findOrCreate(e,l.measureDistance)},r=i(o[0].pos),s=i(o[1].pos),a=this.deviceInteractionPlaces().map(function(e){return i(e)});n.edge(r,a[0]),l.eachCons(a,2).forEach(function(e){var t=e[0],o=e[1];return n.edge(t,o)}),n.edge(a[a.length-1],s);var c=this.nodes()[0];return a.forEach(function(e){return n.edge(e,i(c))}),n},t.prototype.reshape=function(e){this.alignToSlot(e)},t.prototype.devicePlaces=function(){var e=this,t=this.getWidth()/2,n=this.pos.x+t,o=this.pos.y+this.getHeight()-this.floorHeight-10;return o-=c.getVisibleDeviceSize(this.devicePlaceSize)/3.5,[new a.Vector(n-t/2,o)].concat(this.devicePlaceCount>2?[new a.Vector(n,o)]:[],[new a.Vector(n+t/2,o)]).map(function(t){return new r.DevicePlace(t,e.devicePlaceSize)})},t}(r.Building);t.CommonAreaView=p},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),s=n(0),a=n(7),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edgeWidth=0,t.pickingOrigin=!0,t.facing=a.Orientation.Left,t.originX=0,t}return i(t,e),t.prototype.nodes=function(){var e=this.pos.x+this.getWidth()/2,t=this.pos.y+this.getHeight()/2;return[new s.Vector(Math.floor(e),Math.floor(t))]},t.prototype.colorBase=function(){return this.color.darken(.2)},t.prototype.slots=function(){var e=[],t=this.getHeight()/2;return e.push(this.buildSlot(this.pos.x,this.pos.y+t,a.Orientation.Left)),e.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+t,a.Orientation.Right)),e},t.prototype.handleClick=function(e){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(e)),!1)},t.prototype.constrainCursor=function(e){var t=e.clone();return this.pickingOrigin||(t.y=this.pos.y),t},t.prototype.reshape=function(e){if(this.pickingOrigin){var t=this.alignToSlot(e);t&&(this.facing=t.facing,t&&this.facing===a.Orientation.Left&&(this.originX=t.pos.x))}else this.facing===a.Orientation.Left?(this.setWidth(Math.abs(this.originX-e.x)),this.pos.x=this.originX-this.getWidth()):this.setWidth(Math.abs(this.pos.x-e.x))},t}(r.Building);t.CorridorView=c},function(e,t,n){e.exports=n.p+"0a266eded2bf27831b18735ffc081448.png"},function(e,t,n){e.exports=n.p+"2475589a97ba4901bfa7ab53b5487778.png"},function(e,t,n){e.exports=n.p+"98240dde9344ac8d071d076ac951e15d.png"},function(e,t,n){e.exports=n.p+"da31cf43235263c1c3e0ad45a46360a1.png"},function(e,t,n){e.exports=n.p+"a6a38278ac501400c6199e0df9e1bf84.png"},function(e,t,n){e.exports=n.p+"ece1d5d5858bc048d2d949ecc3f5e9bc.png"},function(e,t,n){e.exports=n.p+"3654f0489813e0668743efde017c9653.png"},function(e,t,n){e.exports=n.p+"3abbdabf07943966f102ac7345a59986.png"},function(e,t,n){e.exports=n.p+"d1b4690b9f5fa4957f98602afc8cfdb6.png"},function(e,t,n){e.exports=n.p+"0eb7a15ea04678b14a2b88b5965aabeb.png"},function(e,t,n){e.exports=n.p+"490d8337dc1436fdb073e0ce7c1aa4e2.svg"},function(e,t,n){e.exports=n.p+"9a1897cb324167653e7d23e377df09f7.svg"},function(e,t,n){e.exports=n.p+"f74ccf77b74f12d78334366e7365d1ee.svg"},function(e,t,n){e.exports=n.p+"d754bb375d83b60c875254997ad378af.svg"},function(e,t,n){e.exports=n.p+"48be2487ecb6d75a112437662b61e05d.svg"},function(e,t,n){e.exports=n.p+"c39dae9d5741e8fcd6c6a812b599a99c.svg"},function(e,t,n){e.exports=n.p+"f91c0d7d285b0686ece2084cc3640bce.svg"},function(e,t,n){e.exports=n.p+"824e22e59890ae78258b54985e42ca6d.svg"},function(e,t,n){e.exports=n.p+"dfe6e4db2f0c22d18befa85c1e163369.svg"},function(e,t,n){e.exports=n.p+"9a947d50110c1d1db07c76a4bba2e653.svg"},function(e,t,n){e.exports=n.p+"4976b6042ef557ca6085c8d0168251f4.svg"},function(e,t,n){e.exports=n.p+"46418cf15643d9b1b171c1b64160a5af.svg"},function(e,t,n){e.exports=n.p+"36a02c2483b688be86ce07bea4bd7295.svg"},function(e,t,n){e.exports=n.p+"29c5f1be64c99bbc14d5063eea2f0953.svg"},function(e,t,n){e.exports=n.p+"502f86b65239e20806bbae8bc77a6116.svg"},function(e,t,n){e.exports=n.p+"5289b20985e3c3a98081267a2da1772e.svg"},function(e,t,n){e.exports=n.p+"1d893905e4eea3bbc48b0e129e318ea6.svg"},function(e,t,n){e.exports=n.p+"bd556d00e484db4e52d198d0bf39d0f2.svg"},function(e,t,n){e.exports=n.p+"650cd431226df0755357c71d61bef1f2.svg"},function(e,t,n){e.exports=n.p+"f12c591f538ab3026bf13e93f3fa9485.svg"},function(e,t,n){e.exports=n.p+"3aeb9dd24809ba3fbd4eeb31a28c3b19.svg"},function(e,t,n){e.exports=n.p+"6cc6f6773bb6eb26fcef87b9629f7b87.svg"},function(e,t,n){e.exports=n.p+"43062e54318df93f49e2be9a4281eb4a.svg"},function(e,t,n){e.exports=n.p+"24611230ec712ba7ee38b99561aedd87.svg"},function(e,t,n){e.exports=n.p+"c4ab2ceb2f61e18493fc776770c65654.svg"},function(e,t,n){e.exports=n.p+"bbd50a175546bd70d21c5eadbc30d479.svg"},function(e,t,n){e.exports=n.p+"7441c2ab240d0f733451d75204ac0792.svg"},function(e,t,n){e.exports=n.p+"91a8cce06c3c05ce6e4b176afafd7b0a.svg"},function(e,t,n){e.exports=n.p+"0ce4f9c3384680565b6bb16495b64233.svg"},function(e,t,n){e.exports=n.p+"1db542acabeb82ec8da785e77afd4dca.svg"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mechanicalOperations={store:function(e,t){return void 0===t&&(t=10),{type:"store",stores:e,capacity:t}},generate:function(e,t){return void 0===t&&(t=4),{type:"generator",generates:e,generationTime:1e3,capacity:t}},recipe:function(e,t){return{type:"recipe",consumes:e,produces:t,workTime:1e3}},spawn:function(){return{type:"spawn"}},accelerateTime:function(){return{type:"accelerate",factor:2}},explore:function(e,t){return void 0===t&&(t=4),{type:"explore",gathers:e,capacity:t}}}},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(4),a=n(11),c=n(22),u=n(21),l=n(29),p=n(2),h=n(6),f=n(13),d=n(12),y=n(1),m=n(3),v=n(28),g=n(20),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultMessage="Welcome to the Colony, Commander.",t.placingFunction=null,t.time=60*p.Game.startHour,t.hasActiveModal=!1,t.techTree=new v.TechTree,t.firstBuilding=!0,t.followedCitizen=null,t.showTutorial=!0,t.timeStepIntervalMillis=50,t}return i(t,e),t.prototype.update=function(t,n){e.prototype.update.call(this,t,n);var o=this.planet.colony.findPoweredDevices(),i=h.allMachines.filter(function(e){return o.some(function(t){return t.machine instanceof e})}),r=this.techTree.findDisciplineToRankUp(i);if(r){var s=this.techTree.rankUp(r);this.rankUp(s)}this.hud.updateDetails(this.planet,this.techTree,this.followedCitizen,!0,this.time)},t.prototype.onInitialize=function(e){var t=this;this.game=e;var n=function(e){return t.startConstructing(e)};this.hud=new c.Hud(e,n,n,n,function(e){return t.toggleFollowing(e)}),this.add(this.hud),this.planet=new u.Planet(e.world,this.hud,function(e){return t.hud.showCard(e)},function(e){return t.hud.showCard(e)},2e5,4e4,this),this.add(this.planet),this.player=new l.Player,this.add(this.player),this.prepareNextBuilding(),this.camera.pos.y=this.planet.getTop()-1e3,this.camera.zoom(.05),this.camera.zoom(.5,1e4),this.addTimer(new r.Timer(function(){t.stepTime()},this.timeStepIntervalMillis,!0)),this.systemMessage("Welcome to the Colony, sir... We are what is left of the crew of the Osiris. Can you help us build a functioning society? First, choose a location for the Command post. Then we'll lay out some infrastructure.")},t.prototype.systemMessage=function(e){var t=this;this.hasActiveModal=!0,this.hud.systemMessage(e,"",{continue:function(){t.closeSystemMessage()}})},t.prototype.tutorialMessage=function(e){var t=this;this.showTutorial&&(this.hasActiveModal=!0,this.hud.systemMessage(e,"",{continue:function(){t.closeSystemMessage()},"i got this":function(){t.closeSystemMessage(),t.showTutorial=!1}}))},t.prototype.rankUp=function(e){var t,n=this;this.hasActiveModal&&this.closeSystemMessage(),this.hasActiveModal=!0;var o=y.sample(["excellent!","great!","perfect","good work","cool","wonderful","brilliant","that is what i am talking about","keep up the good work","learning is fun!"]),i=this.hud.systemMessage("Your colony's mastery of a discipline has improved! The following new machines are now available for construction:","rank up",((t={})[o]=function(){n.closeSystemMessage()},t));i.addHeading(e.name,28,r.Color.Orange),i.addHeading(e.description,12),i.addIconMatrix(e.unlocks.map(function(e){return new e}).map(function(e){return{image:e.image,label:e.name}}))},t.prototype.closeSystemMessage=function(){this.hud.closeSystemMessage(),this.hasActiveModal=!1},t.prototype.stepTime=function(){this.time+=this.timeStepIntervalMillis/p.Game.minuteTickMillis,this.planet.setTime(this.time)},t.prototype.onActivate=function(){var e=this;this.addTimer(new r.Timer(function(){e.planet.sendRaidingParty()},p.Game.raidingPartyFrequency,!0)),this.controller=new g.GameController(this.game,this.camera),this.controller.onCameraPan(function(){return e.stopFollowing()}),this.controller.onMove(function(t){if(!e.hasActiveModal){e.player.pos=t;var n=e.planet.currentlyConstructing;if(n instanceof s.Building){var o=n.constrainCursor(e.player.pos);e.player.pos=o,n.reshape(e.player.pos)}else n instanceof a.Device&&n.snap(e.planet,e.player.pos)}}),this.controller.onLeftClick(function(t){if(!e.hasActiveModal){var n=e.planet.currentlyConstructing;if(n)if(n instanceof s.Building){var o=n,i=!o.overlapsAny();if(o&&i&&o.handleClick(t)){if(e.planet.placeBuilding(o),e.firstBuilding&&e.planet.sendRaidingParty(),e.placingFunction){var r=e.placingFunction;y.zip(r.machines,o.devicePlaces()).forEach(function(e){var t=e[0],n=e[1],i=(new t).concretize(),r=new a.Device(i,n.position);o.addDevice(r)}),e.placingFunction=null}e.hud.setStatus(e.defaultMessage),e.planet.colony.currentlyConstructing=null,e.prepareNextBuilding(t)}}else{var c=n;i=c.size===m.DeviceSize.Tiny||!c.overlapsAny(),c.snap(e.planet)&&i&&(c.size===m.DeviceSize.Tiny?c.parentDevice.addTinyDevice(c):c.building.addDevice(c),e.planet.colony.currentlyConstructing=null,e.hud.setStatus(e.defaultMessage))}}}),this.controller.onKeyPress(function(t){e.hasActiveModal||(t===r.Input.Keys.H?e.buildings&&e.buildings[0]&&(e.stopFollowing(),e.camera.move(e.buildings[0].pos,500),e.camera.zoom(.5,1e3)):t===r.Input.Keys.Esc&&(e.planet.colony.currentlyConstructing=null,e.placingFunction=null,e.stopFollowing(!0),e.hud.setStatus(e.defaultMessage)))}),this.controller.activate()},t.prototype.onDeactivate=function(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")},Object.defineProperty(t.prototype,"buildings",{get:function(){return this.planet.colony.buildings},enumerable:!0,configurable:!0}),t.prototype.nextMissingStructureOrFunction=function(){var e=t.requiredStructuresAndFunctions.map(function(e){return new e}),n=this.buildings.map(function(e){return e.structure.name}),o=y.flatSingle(this.buildings.map(function(e){return e.spaceFunction&&e.spaceFunction.name})),i=n.concat(o);return e.find(function(e){return!i.includes(e.name)})},t.prototype.prepareNextBuilding=function(e){void 0===e&&(e=new r.Vector(0,0));var t=null,n=this.nextMissingStructureOrFunction();if(n&&(t=n),t){var o=y.sample(["Alright!","Perfect.","Great work!","Excellent!","Good.","That works.","Cool.","Fantastic!","Now we are cooking.","It looks good!"]),i=y.sample(["Let's pick a location for a","Next we will build a","Okay, time to make a","Get ready to place a"]);this.tutorialMessage(o+" "+i+" "+t.name+"..."),this.startConstructing(t,e)}else this.hud.showPalettes()},t.prototype.toggleFollowing=function(e){this.followedCitizen===e?this.stopFollowing(!0):this.startFollowing(e)},t.prototype.startFollowing=function(e){this.stopFollowing(),this.cameraStrategy=new r.LockCameraToActorStrategy(e),this.camera.zoom(1.2,1e3),this.camera.addStrategy(this.cameraStrategy),this.followedCitizen=e},t.prototype.stopFollowing=function(e){void 0===e&&(e=!1),this.cameraStrategy&&(this.camera.removeStrategy(this.cameraStrategy),e&&this.camera.zoom(.5,1e3),this.followedCitizen=null)},t.prototype.startConstructing=function(e,t){void 0===t&&(t=new r.Vector(0,0)),this.hud.showCard(e);var n=null;if(e instanceof d.Structure){var o=e;this.hud.setStatus("Place "+o.name+" ("+o.description+")"),n=this.spawnBuilding(o,t),this.firstBuilding&&(this.camera.zoom(o.zoom,250),this.camera.pos=n.pos,this.firstBuilding=!1)}else if(e instanceof h.Machine){var i=e;this.hud.setStatus("Install "+i.name+" ("+i.description+")"),n=this.spawnDevice(i,t)}else if(e instanceof f.RoomRecipe){var s=e;this.hud.setStatus("Place "+s.name+" ("+s.description+")"),n=this.spawnFunction(s,t),this.placingFunction=s}this.planet.colony.currentlyConstructing=null,n&&(this.planet.colony.currentlyConstructing=n)},t.prototype.spawnDevice=function(e,t){var n=new a.Device(e,t);return n.snap(this.planet)&&(this.camera.pos=n.pos),n},t.prototype.spawnBuilding=function(e,t){var n=this.assembleBuildingFromStructure(e,t);return n.reshape(n.constrainCursor(t)),n},t.prototype.assembleBuildingFromStructure=function(e,t){return new(0,s.structureViews[e.view])(t,e,this.planet)},t.prototype.spawnFunction=function(e,t){var n=e.structure&&new e.structure;if(!n){n=new d.SmallRoomThree;var o=e.machines.map(function(e){return new e});o.some(function(e){return e.size===m.DeviceSize.Medium})&&(n=new d.MediumRoomThree),o.some(function(e){return e.size===m.DeviceSize.Large})&&(n=new d.LargeRoom),o.some(function(e){return e.size===m.DeviceSize.Huge})&&(n=new d.HugeRoom),o.some(function(e){return e.forDome})&&(n=new d.SmallDome)}var i=this.assembleBuildingFromStructure(n,t);return i.reshape(i.constrainCursor(i.pos)),i},t.requiredStructuresAndFunctions=[f.MissionControl,d.SurfaceRoad,f.SolarArray,d.MainTunnel,d.Corridor,f.LivingQuarters],t}(r.Scene);t.Construct=b},function(e,t,n){e.exports=n.p+"37914c496c3c503f7a53d7c9a1457b53.mp3"},function(e,t,n){e.exports=n.p+"1b8e735649248c4c552a84996e61f241.mp3"},function(e,t,n){e.exports=n.p+"1a607294aebce07746d6f25ffa517d80.mp3"},function(e,t,n){e.exports=n.p+"22bdefc1e8515661fdeb8e8076820641.mp3"},function(e,t,n){e.exports=n.p+"cf150ab26eba01503f4f6dc3d9ab47f7.mp3"},function(e,t,n){e.exports=n.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(19),r=n(118),s=n(26),a=n(25),c=new i.World,u=new o.Game(c),l=new r.Construct(u);u.add("construct",l);var p=new s.Arena(u);u.add("arena",p);var h=new a.Menu(u);u.add("menu",h),u.start().then(function(){u.goToScene("menu")})}]);
//# sourceMappingURL=main.js.map