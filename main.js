!function(t){function e(e){for(var s,o,h=e[0],l=e[1],a=e[2],c=0,d=[];c<h.length;c++)o=h[c],n[o]&&d.push(n[o][0]),n[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);for(u&&u(e);d.length;)d.shift()();return r.push.apply(r,a||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],s=!0,h=1;h<i.length;h++){var l=i[h];0!==n[l]&&(s=!1)}s&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var s={},n={1:0},r=[];function o(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=s,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var h=window.webpackJsonp=window.webpackJsonp||[],l=h.push.bind(h);h.push=e,h=h.slice();for(var a=0;a<h.length;a++)e(h[a]);var u=l;r.push([21,0]),i()}([,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(0),r=i(4);e.Building=class extends s.Actor{constructor(t,e){super(t.origin.x,t.origin.y,t.width,t.height,e.color),this.structure=t,this.planet=e,this.built=!1,this.hover=!1,this.facing=r.Orientation.Right,console.log(`CREATE NEW ${t.name}`,{origin:t.origin,width:t.width,height:t.height}),this.setup(),this.traits=this.traits.filter(t=>!(t instanceof n.Traits.OffscreenCulling)),this.on("pointerenter",()=>{this.hover=!0}),this.on("pointerleave",()=>{this.hover=!1}),this.collisionType=s.CollisionType.PreventCollision}setup(){}constrainCursor(t){return t.clone()}reshape(t){this.pos=t.clone()}handleClick(t){return!0}slots(t){return[]}aabb(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}}overlaps(t){let e=this.aabb(),i=t.aabb();return e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y}overlapsAny(){return!!this.planet.buildings.find(t=>t!==this&&this.overlaps(t))}edgeColor(){return this.processedColor().lighten(.5)}mainColor(){return this.processedColor().darken(.08)}colorBase(){return this.color}processedColor(){let t=this.colorBase().clone();return this.built||(this.overlapsAny()&&(t=s.Color.Red),t.a=.8),this.hover&&(t.a=.5),t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);class n{constructor(t=new s.Vector(0,0)){this.origin=t,this.name="(default structure name)",this.description="(default structure description)",this.view="<add a default structure (room) view>",this.width=10,this.height=10,this.zoom=2}}e.Structure=n,e.MissionControl=class extends n{constructor(){super(...arguments),this.name="Mission Control",this.description="Keeping everything on track",this.view="MissionControlView",this.width=60,this.height=14,this.zoom=1}},e.MainTunnel=class extends n{constructor(){super(...arguments),this.name="Main Tunnel",this.description="Elevating",this.view="TunnelView",this.width=30,this.height=100,this.zoom=.25}},e.Dome=class extends n{constructor(){super(...arguments),this.name="Biodome",this.description="Biome sweet biome",this.view="DomeView",this.width=80,this.height=60}},e.AccessTunnel=class extends n{constructor(){super(...arguments),this.name="Access Tunnel",this.description="in the hallway",this.view="AccessTunnelView",this.width=10,this.height=7}},e.CommonArea=class extends n{constructor(){super(...arguments),this.name="Common Area",this.description="hallway cap",this.view="CommonAreaView",this.width=120,this.height=70}},e.LivingQuarters=class extends n{constructor(){super(...arguments),this.name="Living Quarters",this.description="sleepy time",this.view="LivingQuartersView",this.width=15,this.height=20}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=(t,e,i)=>t.reduce(function(t,s){var n=[e(s),s];return t&&i.apply(null,[t[0],n[0]])==t[0]?t:n},null)[1];e.minBy=((t,e)=>s(t,e,Math.min)),e.maxBy=((t,e)=>s(t,e,Math.max)),e.sample=(t=>t[Math.floor(Math.random()*t.length)]),e.range=(t=>Array(t).fill(0).map((t,e)=>e)),e.closest=function(t,i,s,n){let r=i;if(n&&(i=i.filter(n)),r){let i=e=>t.distance(s(e));return e.minBy(r,i)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Left=0]="Left",t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Down=3]="Down"}(e.Orientation||(e.Orientation={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1);e.Building=s.Building;const n=i(12);e.AccessTunnelView=n.AccessTunnelView;const r=i(11);e.CommonAreaView=r.CommonAreaView;const o=i(10);e.DomeView=o.DomeView;const h=i(9);e.MissionControlView=h.MissionControlView;const l=i(8);e.TunnelView=l.TunnelView;const a=i(7);e.LivingQuartersView=a.LivingQuartersView},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Hud=class extends s.UIActor{constructor(){super(0,0),this.label=new s.Label("land anywhere",20,50,"Helvetica"),this.label.fontSize=32,this.label.color=s.Color.White,this.add(this.label)}message(t){this.label.text=t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),n=i(2),r=i(3);e.LivingQuartersView=class extends s.Building{constructor(){super(...arguments),this.edgeWidth=2}constrainCursor(t){let e=this.planet.closestBuildingByType(t,n.CommonArea);if(e&&e.slots(this.getWidth()).length>0){let i=e.slots(this.getWidth()),s=r.closest(t,i,t=>t.pos);return this.facing=-s.facing,s.pos}return t}draw(t){t.save(),t.translate(this.pos.x,this.pos.y);let e=this.facing*(Math.PI/2);t.rotate(e);let i=this.edgeColor();t.fillStyle=i.toRGBA(),t.fillRect(-this.getWidth(),0,this.getWidth(),this.getHeight());let s=this.mainColor();t.fillStyle=s.toRGBA(),t.fillRect(this.edgeWidth-this.getWidth(),this.edgeWidth,this.getWidth()-2*this.edgeWidth,this.getHeight()-2*this.edgeWidth),t.restore()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),n=i(2);e.TunnelView=class extends s.Building{constructor(){super(...arguments),this.pickingOrigin=!0}handleClick(t){if(this.pickingOrigin){let t=this.planet.closestBuildingByType(this.pos,n.MissionControl);return this.pos.x=t.x+t.getWidth()/2-this.getWidth()/2,this.pickingOrigin=!1,!1}return!0}constrainCursor(t){if(this.pickingOrigin){let e=this.planet.closestBuildingByType(t,n.MissionControl);this.pos.x=e.x+e.getWidth()/2-this.getWidth()/2}else t.y=Math.max(this.planet.getTop()+100,t.y);return t}reshape(t){this.pos.y=this.planet.getTop()+2,this.pickingOrigin||this.setHeight(t.y-this.planet.getTop())}draw(t){let e=this.getHeight(),i=this.getWidth(),s=this.edgeColor(),n=this.mainColor();t.fillStyle=s.toRGBA(),t.fillRect(this.x,this.y,i,e),this.pickingOrigin&&(n.a=.5),t.fillStyle=n.toRGBA(),t.fillRect(this.x+4,this.y,i-8,e)}colorBase(){return this.color.darken(.2)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1);e.MissionControlView=class extends n.Building{constrainCursor(t){return t.y=this.planet.getTop(),t}reshape(t){this.pos=t,this.pos.y-=this.getHeight()-2}draw(t){let e=this.mainColor();t.fillStyle=e.toRGBA(),t.fillRect(this.x,this.y,this.getWidth(),this.getHeight());let i=this.x+this.getWidth()/4*3,s=this.y-18;t.fillRect(i,s,2,18),t.fillRect(i,s,10,5)}colorBase(){return s.Color.White}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1);e.DomeView=class extends n.Building{constrainCursor(t){return t.y=this.planet.getTop(),t}reshape(t){this.pos=t}draw(t){let e=this.mainColor();t.beginPath(),t.arc(this.x+this.getWidth()/2,this.y,this.getHeight(),0,Math.PI,!0),t.closePath(),t.fillStyle=e.toRGBA(),t.fill()}colorBase(){return s.Color.White.darken(.05)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),n=i(0),r=i(4),o=i(2),h=i(3);e.CommonAreaView=class extends s.Building{slots(t){let e=[],i=Math.floor(this.getWidth()/t),s=Math.floor(this.getHeight()/t);for(let s of h.range(i)){let i={pos:new n.Vector(s*t+this.pos.x,this.pos.y),facing:r.Orientation.Up,size:t,parent:this};e.push(i);let o={pos:new n.Vector(s*t+this.pos.x,this.pos.y+this.getHeight()),facing:r.Orientation.Down,size:t,parent:this};e.push(o)}for(let i of h.range(s)){let s={pos:new n.Vector(this.pos.x,i*t+this.pos.y),facing:r.Orientation.Left,size:t,parent:this};e.push(s);let o={pos:new n.Vector(this.pos.x+this.getWidth(),i*t+this.pos.y),facing:r.Orientation.Right,size:t,parent:this};e.push(o)}return e}constrainCursor(t){let e=t.clone(),i=this.planet.closestBuildingByType(t,o.AccessTunnel);return i&&(i.facing===r.Orientation.Left?e.x=i.x-i.getWidth()-this.getWidth():e.x=i.x+i.getWidth(),e.y=i.y-this.getHeight()+i.getHeight()+5),e}draw(t){let e=this.edgeColor();t.fillStyle=e.toRGBA(),t.fillRect(this.pos.x,this.pos.y,this.getWidth(),this.getHeight());let i=this.mainColor();t.fillStyle=i.toRGBA(),t.fillRect(this.pos.x+4,this.pos.y+4,this.getWidth()-8,this.getHeight()-8)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),n=i(4),r=i(2);e.AccessTunnelView=class extends s.Building{constructor(){super(...arguments),this.pickingOrigin=!0,this.facing=n.Orientation.Left}aabb(){return this.facing===n.Orientation.Right?super.aabb():{x:this.pos.x-this.getWidth(),y:this.pos.y,width:this.getWidth(),height:this.getHeight()}}handleClick(t){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(t)),!1)}constrainCursor(t){let e=t.clone();if(this.pickingOrigin){let i=this.nearestTunnel(t);t.x>i.x+i.getWidth()/2?e.x=i.x+i.getWidth():e.x=i.x-this.getWidth()}else e.y=this.pos.y;return e}reshape(t){if(this.pickingOrigin){let e=this.nearestTunnel(t);t.x>e.x+e.getWidth()/2?(this.pos.x=e.x+e.getWidth(),this.facing=n.Orientation.Right):(this.pos.x=e.x,this.facing=n.Orientation.Left),this.pos.y=Math.min(Math.max(t.y,e.y+10),e.y+e.getHeight()-this.getHeight()-10)}else this.setWidth(Math.abs(this.pos.x-t.x))}draw(t,e){let i=this.edgeColor().toRGBA(),s=this.mainColor().toRGBA();t.fillStyle=this.color.toRGBA(),t.save(),t.translate(this.pos.x,this.pos.y);let n=this.facing*(Math.PI/2);t.rotate(n),t.fillStyle=i,t.fillRect(-this.getWidth(),0,this.getWidth(),this.getHeight()),t.fillStyle=s,t.fillRect(-this.getWidth(),1,this.getWidth(),this.getHeight()-2),t.restore()}nearestTunnel(t){return this.planet.closestBuildingByType(t,r.MainTunnel)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Player=class extends s.Actor{constructor(){super(),this.setWidth(5),this.setHeight(5),this.x=5,this.y=5,this.color=new s.Color(255,255,255)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3);e.Mountains=class extends class extends s.Actor{constructor(t,e,i){super(0,t,e,500,i)}}{constructor(){super(...arguments),this.peaks=[]}onInitialize(){let t=this.getWidth()/2,e=this.getWidth()/30;for(let i of n.range(10)){let s=100*i,r=3*i*(e/2);for(let i of n.range(30))this.peaks.push({x:i*e-t+(Math.random()*r-r/2),height:Math.max(10,Math.random()*s-s/2+1e3)})}console.log({peaks:this.peaks})}draw(t,e){let i=this.color.desaturate(.25),s=this.color.saturate(.2).lighten(.5);t.fillStyle=i.toRGBA();let n=this.pos.y-3;this.peaks.forEach(e=>{let r=n-e.height,o=3.4*e.height;t.beginPath(),t.moveTo(e.x,r),t.lineTo(e.x-o,n),t.lineTo(e.x+o,n),t.fillStyle=i.toRGBA(),t.fill(),t.beginPath(),t.moveTo(e.x,r),t.lineTo(e.x+o/4*3,n),t.lineTo(e.x+o,n),t.fillStyle=s.toRGBA(),t.fill()})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(0),r=i(3),o=i(14);e.Planet=class extends n.Actor{constructor(t,e=2e6,i=1e5){super(0,0,e,i,t),this.color=t,this.width=e,this.depth=i,this.buildings=[],this.traits=this.traits.filter(t=>!(t instanceof s.Traits.OffscreenCulling));let n=-i/2;this.createLayer(n,20,this.color.lighten(.25));let h=i/20;for(let t of r.range(20))this.createLayer(n+20+h/2+h*(t+1),h,this.color.darken(.05+.01*t));this.add(new o.Mountains(-i/2,this.getWidth(),this.color.lighten(.15)))}createLayer(t,e,i){let s=new n.Actor(0,t,this.getWidth(),e,i);this.add(s)}placeBuilding(t){t.built=!0,this.buildings.push(t)}closestBuildingByType(t,e){let i=this.buildings.filter(t=>t.structure instanceof e);if(i){let e=e=>t.distance(e);return r.minBy(i,e)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(15),r=i(13),o=i(2),h=i(5),l=i(6);class a extends s.Scene{constructor(){super(...arguments),this.currentBuildingListIndex=0,this.buildings=[],this.dragging=!1}onInitialize(t){this.game=t,this.planet=new n.Planet(t.world.color),this.add(this.planet),this.player=new r.Player,this.add(this.player),this.hud=new l.Hud,this.add(this.hud),this.prepareNextBuilding(),this.camera.zoom(.5),this.camera.y=-this.planet.depth/2}onActivate(){this.game.input.pointers.primary.on("move",t=>{if(this.dragging)this.camera.pos=this.camera.pos.add(this.dragOrigin.sub(t.pos));else{this.player.pos=t.pos;let e=this.currentlyBuilding;if(e){let t=e.constrainCursor(this.player.pos);this.player.pos=t,e.reshape(this.player.pos)}}}),this.game.input.pointers.primary.on("up",t=>{this.dragging&&(this.dragging=!1)}),this.game.input.pointers.primary.on("down",t=>{if(t.button==s.Input.PointerButton.Left){const e=this.currentlyBuilding;let i=!e.overlapsAny();e&&i&&e.handleClick(t.pos)&&(this.planet.placeBuilding(e),this.prepareNextBuilding(t.pos))}else t.button===s.Input.PointerButton.Middle&&(this.dragging=!0,this.dragOrigin=t.pos)}),this.game.input.pointers.primary.on("wheel",t=>{let e=this.camera.getZoom();t.deltaY<0?this.camera.zoom(Math.min(e+.05,8)):t.deltaY>0&&this.camera.zoom(Math.max(e-.05,.05))}),this.game.input.keyboard.on("press",t=>{t.key===s.Input.Keys.H&&this.planet.buildings&&this.planet.buildings[0]&&(this.camera.move(this.planet.buildings[0].pos,500),this.camera.zoom(.5,1e3))})}onDeactivate(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")}nextMissingRequiredStructure(){let t=a.requiredStructureList,e=this.buildings.map(t=>t.structure.name);return t.find(t=>!e.includes(t.name))}prepareNextBuilding(t=new s.Vector(0,0)){let e=a.structureList[this.currentBuildingListIndex%a.structureList.length],i=this.nextMissingRequiredStructure();i?e=i:this.currentBuildingListIndex+=1,e.origin=t,this.hud.message(`Place ${e.name}`);let n=this.spawnBuilding(e);this.currentlyBuilding=n,this.camera.pos=n.pos,this.camera.zoom(e.zoom,250)}spawnBuilding(t){console.log("spawn",{structure:t});let e=this.assembleBuildingFromStructure(t);return e.reshape(e.constrainCursor(e.pos)),this.add(e),this.buildings.push(e),e}assembleBuildingFromStructure(t){return new(0,a.structureViews[t.view])(t,this.planet)}}a.firstStructure=new o.MissionControl,a.secondStructure=new o.MainTunnel,a.requiredStructureList=[new o.MissionControl,new o.MainTunnel,new o.Dome],a.structureList=[new o.AccessTunnel,new o.CommonArea,new o.LivingQuarters,new o.LivingQuarters,new o.LivingQuarters],a.structureViews={TunnelView:h.TunnelView,MissionControlView:h.MissionControlView,DomeView:h.DomeView,AccessTunnelView:h.AccessTunnelView,CommonAreaView:h.CommonAreaView,LivingQuartersView:h.LivingQuartersView},e.Construct=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3);class r{constructor(){this.structures=[]}}e.Colony=r;class o{constructor(){this.color=n.sample(o.colors).darken(.1).desaturate(.8),this.skyColor=n.sample([s.Color.Cyan,s.Color.Vermillion]).lighten(.15).desaturate(.65),this.colony=new r}}o.colors=[s.Color.Red,s.Color.Blue,s.Color.Green],e.World=o},function(t,e,i){t.exports=i.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(18);let r={Sword:new s.Texture(n)};e.Resources=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(19);e.Game=class extends s.Engine{constructor(t){super({width:800,height:600,displayMode:s.DisplayMode.FullScreen,backgroundColor:t.skyColor}),this.world=t}start(){let t=new s.Loader;for(let e in n.Resources)t.addResource(n.Resources[e]);return super.start(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(20),n=i(17),r=i(16),o=new n.World,h=new s.Game(o),l=new r.Construct(h);h.add("construct",l),h.start().then(()=>{h.goToScene("construct")})}]);
//# sourceMappingURL=main.js.map