!function(t){function e(e){for(var o,s,a=e[0],c=e[1],u=e[2],p=0,h=[];p<a.length;p++)s=a[p],r[s]&&h.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);for(l&&l(e);h.length;)h.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(o=!1)}o&&(i.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},r={1:0},i=[];function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var u=0;u<a.length;u++)e(a[u]);var l=c;i.push([63,0]),n()}([,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=n(11),i=r.Scale.major;r.Scale.minor,function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large",t[t.Huge=3]="Huge"}(o=e.DeviceSize||(e.DeviceSize={})),e.getVisibleDeviceSize=function(t){var e=10;switch(t){case o.Small:e=i.third;break;case o.Medium:e=i.sixth;break;case o.Large:e=2*i.eighth;break;case o.Huge:e=6*i.eighth}return e}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(7),a=n(4),c=n(13),u=n(9),l=n(1),p=function(){function t(t,e){this.pos=t,this.size=e}return Object.defineProperty(t.prototype,"position",{get:function(){return this.pos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibleSize",{get:function(){return l.getVisibleDeviceSize(this.size)},enumerable:!0,configurable:!0}),t}();e.DevicePlace=p;var h=function(t){function e(e,n,o){var r=t.call(this,e.x,e.y,n.width,n.height,o.color)||this;return r.structure=n,r.planet=o,r.edgeWidth=0,r.built=!1,r.hover=!1,r.showLabel=!1,r.facing=s.Orientation.Right,r.hideBox=!1,r.childrenBuildings=[],r.level=1,r.devices=[],r.step=0,r.anchor=new i.Vector(0,0),r.setup(),r.traits=r.traits.filter(function(t){return!(t instanceof i.Traits.OffscreenCulling)}),r.on("pointerenter",function(){r.hover=!0}),r.on("pointerleave",function(){r.hover=!1}),r.collisionType=i.CollisionType.PreventCollision,r.nameLabel=new i.Label(r.structure.name,0,0,"Helvetica"),r.nameLabel.color=i.Color.White,r.levelLabel=new i.Label("Lvl. "+r.level,0,0,"Helvetica"),r.levelLabel.fontSize=6,r.levelLabel.color=i.Color.White.darken(.2),r}return r(e,t),e.prototype.levelUp=function(){this.level+=1,this.levelLabel.text="Lvl. "+this.level},e.prototype.draw=function(t,e){this.hideBox||a.drawRect(t,this.aabb(),this.edgeWidth,this.processedColor()),this.devices.forEach(function(n){return n.draw(t,e)}),this.showLabel&&(this.nameLabel.pos=this.getCenter(),this.nameLabel.pos.x-=t.measureText(this.structure.name).width/2,this.nameLabel.draw(t,e))},e.prototype.update=function(e,n){var o=this;t.prototype.update.call(this,e,n),this.built&&this.devices.forEach(function(t){return t.produce(o.step)}),this.step+=1},e.prototype.setup=function(){},e.prototype.constrainCursor=function(t){return t.clone()},e.prototype.reshape=function(t){this.pos=t.clone()},e.prototype.afterConstruct=function(){},e.prototype.handleClick=function(t){return!0},e.prototype.slots=function(){return[]},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight();return[new i.Vector(Math.floor(t),Math.floor(e)-4)]},e.prototype.devicePlaces=function(){return[]},e.prototype.graph=function(t){void 0===t&&(t=new c.Graph);for(var e=t,n=this.nodes(),o=e.findOrCreate(n[0],a.measureDistance),r=0,i=this.childrenBuildings;r<i.length;r++){var s=i[r],u=e.findOrCreate(s.parentSlot.pos,a.measureDistance);e.edge(o,u);var l=e.findOrCreate(s.nodes()[0],a.measureDistance);e.edge(u,l),s.graph(e)}return e},e.prototype.redeem=function(t){this.planet.gather(t)},e.prototype.populate=function(t){this.planet.populate(t)},e.prototype.aabb=function(){return{x:this.pos.x,y:this.pos.y,width:this.getWidth(),height:this.getHeight()}},e.prototype.overlaps=function(t){var e=this.aabb(),n=t.aabb();return!!(e.x<n.x+n.width&&e.x+e.width>n.x&&e.y<n.y+n.height&&e.y+e.height>n.y)},e.prototype.overlapsAny=function(){var t=this;return!!this.planet.colony.buildings.find(function(e){return e!==t&&t.overlaps(e)})},e.prototype.edgeColor=function(){return this.processedColor().lighten(.85)},e.prototype.mainColor=function(){return this.processedColor().darken(.08)},e.prototype.colorBase=function(){return this.color},e.prototype.processedColor=function(){var t=this.colorBase().clone();return this.built||(this.overlapsAny()&&(t=i.Color.Red),t.a=.8),this.hover&&(t.a=.5),t},Object.defineProperty(e.prototype,"connections",{get:function(){return this.structure.connections},enumerable:!0,configurable:!0}),e.prototype.findSlot=function(t,e){var n=this;void 0===e&&(e=this.connections);for(var o=[],r=function(r){var i=e[r],a=s.flip(r);i.map(function(e){return n.planet.closestBuildingByType(t,[e])}).forEach(function(t){t&&t.slots().filter(function(t){return t.facing===a}).forEach(function(t){o.push(t)})})},i=0,c=s.compass;i<c.length;i++)r(c[i]);if(o.length>0)return a.closest(t,o,function(t){return t.pos})},e.prototype.alignToSlot=function(t,e){void 0===e&&(e=this.connections);var n=this.findSlot(t,e);if(n){var o=this.slots().find(function(t){return t.facing==s.flip(n.facing)});if(o){var r=n.pos.sub(o.pos);return this.pos.addEqual(r),this.parentSlot=n,n}}},e.prototype.buildSlot=function(t,e,n){return void 0===n&&(n=s.Orientation.Right),{pos:new i.Vector(t,e),facing:n,parent:this}},e.prototype.addDevice=function(t){t.building!==this&&(t.building=this),this.devices.push(t),this.updateName()},e.prototype.hasPlaceForDevice=function(){return this.devices.length<this.devicePlaces().length},e.prototype.nextDevicePlace=function(){return this.devicePlaces()[this.devices.length]},e.prototype.getDevices=function(){return this.devices},e.prototype.updateName=function(){var t=this,e=u.allSpaceFunctions.find(function(e){var n=!0,o=t.devices.slice();return(new e).machines.forEach(function(t){var e=o.find(function(e){return e.machine instanceof t});e||(n=!1),o=a.deleteByValue(o,e)}),n});if(e){var n=new e;this.spaceFunction=n,this.nameLabel.text=n.name}},e}(i.Actor);e.Building=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(2);e.Building=o.Building;var r=n(39);e.CorridorView=r.CorridorView;var i=n(38);e.CommonAreaView=i.CommonAreaView;var s=n(37);e.DomeView=s.DomeView;var a=n(36);e.MissionControlView=a.MissionControlView;var c=n(35);e.TunnelView=c.TunnelView;var u=n(34);e.ArcologyView=u.ArcologyView;var l=n(33);e.LadderView=l.LadderView;var p=n(32);e.MineView=p.MineView;var h=n(12);e.SurfaceRoadView=h.SurfaceRoadView},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=function(t,e,n){return t.reduce(function(t,o){var r=[e(o),o];return t&&n.apply(null,[t[0],r[0]])==t[0]?t:r},null)[1]};function i(t,e,n){for(var o=[],r=0;r<n;r++)o.push(t[e+r]);return o}e.minBy=function(t,e){return r(t,e,Math.min)},e.maxBy=function(t,e){return r(t,e,Math.max)},e.sample=function(t){return t[Math.floor(Math.random()*t.length)]},e.range=function(t){return Array(t).fill(0).map(function(t,e){return e})},e.closest=function(t,n,o,r){var i=n;if(r&&(n=n.filter(r)),i)return e.minBy(i,function(e){return t.distance(o(e))})},e.flatSingle=function(t){return[].concat.apply([],t)},e.deleteByValue=function(t,e){return t.filter(function(t){return t!==e})},e.deleteByValueOnce=function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},e.eachCons=function(t,e){for(var n=[],o=0;o<t.length-e+1;o++)n.push(i(t,o,e));return n},e.measureDistance=function(t,e){return t.distance(e)},e.drawLine=function(t,e,n,r,i){void 0===r&&(r=o.Color.White),void 0===i&&(i=1),r.a=.5,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.strokeStyle=r.toRGBA(),t.lineWidth=i,t.stroke()},e.drawRect=function(t,e,n,r,i){void 0===n&&(n=0),void 0===r&&(r=o.Color.White),void 0===i&&(i=!0);var s=e.x,a=e.y,c=e.width,u=e.height;if(i){var l=r;t.fillStyle=l.toRGBA(),t.fillRect(s,a,c,u)}if(n>0){var p=o.Color.White;t.strokeStyle=p.toRGBA(),t.lineWidth=n,t.strokeRect(s,a,c,u)}},e.sleep=function(t){return new Promise(function(e){return setTimeout(e,t)})},e.shuffle=function(t){return t.sort(function(){return Math.random()>.5?1:-1})},e.zip=function(t,e){return t.map(function(t,n){return[t,e[n]]})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=n(0);!function(t){t.Power="Power",t.Oxygen="Oxygen",t.Water="Water",t.Shelter="Shelter",t.Hope="Hope",t.Joy="Joy",t.Wisdom="Wisdom",t.Wealth="Wealth",t.Beauty="Beauty",t.Wonder="Wonder"}(o=e.PureValue||(e.PureValue={})),e.allValues=[o.Power,o.Oxygen,o.Water,o.Shelter,o.Hope,o.Wisdom,o.Wealth,o.Beauty,o.Wonder],e.emptyMarket=function(){return{Power:{supply:0,demand:0},Oxygen:{supply:0,demand:0},Water:{supply:0,demand:0},Shelter:{supply:0,demand:0},Hope:{supply:0,demand:0},Joy:{supply:0,demand:0},Wealth:{supply:0,demand:0},Wisdom:{supply:0,demand:0},Beauty:{supply:0,demand:0},Wonder:{supply:0,demand:0}}},e.availableCapacity=function(t,e){return Math.floor(t[e].supply-t[e].demand)},e.sumMarkets=function(t,e){var n={Power:{supply:0,demand:0},Oxygen:{supply:0,demand:0},Water:{supply:0,demand:0},Shelter:{supply:0,demand:0},Hope:{supply:0,demand:0},Joy:{supply:0,demand:0},Wealth:{supply:0,demand:0},Wisdom:{supply:0,demand:0},Beauty:{supply:0,demand:0},Wonder:{supply:0,demand:0}};for(var r in o){var i=t[r],s=i.supply,a=i.demand,c=e[r],u=s+c.supply,l=a+c.demand;n[r]={supply:u,demand:l}}return n},function(t){t.Food="Food",t.Ore="Ore",t.Data="Data",t.Meal="Meal",t.Hypothesis="Hypothesis",t.Mineral="Mineral",t.Alloy="Alloy"}(e.ResourceBlock||(e.ResourceBlock={}));var i={Food:r.Color.Green,Data:r.Color.Blue,Mineral:r.Color.Red,Meal:r.Color.Yellow.darken(.2),Hypothesis:r.Color.Blue.lighten(.4),Ore:r.Color.Red.darken(.5),Alloy:r.Color.LightGray.darken(.2)};e.blockColor=function(t){return i[t].desaturate(.25).lighten(.125)}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var s=n(5),a=n(0),c=n(1),u=n(55),l={bookshelf:n(54),vat:n(53),bench:n(52),stove:n(51),cabin:n(50),fire:n(49),bed:n(48),fridge:n(47),server:n(46),plant:n(45),workstation:n(44)},p=a.Color.Red,h=a.Color.Green,f=a.Color.Blue,d=a.Color.Orange,y=a.Color.Violet,v=a.Color.Yellow,g=u.mechanicalOperations.store,m=u.mechanicalOperations.generate,w=u.mechanicalOperations.recipe,_=u.mechanicalOperations.spawn,b=function(){this.name="(machine name)",this.description="(machine description)",this.color=a.Color.LightGray,this.size=c.DeviceSize.Small,this.operation={type:"noop"},this.image=l.vat,this.prereqs=[],this.economy=s.emptyMarket(),this.forDome=!1};e.Machine=b;var O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Command Console",e.description="gather resources...",e.operation=g([s.ResourceBlock.Data]),e.image=l.bench,e.size=c.DeviceSize.Medium,e.economy=i({},s.emptyMarket(),{Power:{supply:1,demand:0},Oxygen:{supply:1,demand:0},Hope:{supply:1,demand:0}}),e}return r(e,t),e}(b);e.CommandCenter=O;var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="O2 Extractor",e.description="breathe deep",e.image=l.vat,e.prereqs=[x,S],e.forDome=!0,e.economy=i({},s.emptyMarket(),{Oxygen:{supply:3,demand:0},Power:{supply:0,demand:1}}),e}return r(e,t),e}(b);e.OxygenExtractor=P;var S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Solar Cell",e.description="feel the warmth",e.forDome=!0,e.economy=i({},s.emptyMarket(),{Power:{supply:5,demand:0}}),e}return r(e,t),e}(b);e.SolarCell=S;var x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="H20 Condenser",e.description="have a drink",e.prereqs=[S],e.forDome=!0,e.economy=i({},s.emptyMarket(),{Water:{supply:4,demand:0},Power:{supply:0,demand:1}}),e}return r(e,t),e}(b);e.WaterCondensingMachine=x;var C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.operation=w([s.ResourceBlock.Hypothesis,s.ResourceBlock.Hypothesis,s.ResourceBlock.Hypothesis],s.ResourceBlock.Data),e}return r(e,t),e}(b);e.StudyMachine=C;var M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Desk",e.description="get to work",e.image=l.bench,e.prereqs=[P],e}return r(e,t),e}(C);e.Desk=M;var k=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Workstation",e.description="hackety hack",e.prereqs=[D],e.color=f,e.image=l.workstation,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),e}return r(e,t),e}(C);e.Workstation=k;var D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Shelf",e.description="brainstorm",e.operation=m(s.ResourceBlock.Hypothesis),e.image=l.bookshelf,e.prereqs=[P,M],e.color=f,e}return r(e,t),e}(b);e.Bookshelf=D;var B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Fridge",e.description="store meals",e.operation=g([s.ResourceBlock.Meal],6),e.image=l.fridge,e.prereqs=[D],e.color=v,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),e}return r(e,t),e}(b);e.Fridge=B;var R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Stove",e.description="make a meal",e.operation=w([s.ResourceBlock.Food,s.ResourceBlock.Food],s.ResourceBlock.Meal),e.image=l.stove,e.prereqs=[D,B],e.color=v,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1}}),e}return r(e,t),e}(b);e.Stove=R;var V=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Bed",e.description="sweet dreams",e.image=l.bed,e.prereqs=[P],e.color=d,e.economy=i({},s.emptyMarket(),{Shelter:{supply:2,demand:0}}),e}return r(e,t),e}(b);e.Bed=V;var j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="House Plant",e.description="so nice",e.prereqs=[V],e.operation=m(s.ResourceBlock.Food),e.capacity=1,e.color=h,e.image=l.plant,e.economy=i({},s.emptyMarket(),{Oxygen:{supply:1,demand:0},Water:{supply:0,demand:.1}}),e}return r(e,t),e}(b);e.Houseplant=j;var L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Research Server",e.description="hold data",e.operation=g([s.ResourceBlock.Data],10),e.image=l.server,e.prereqs=[D],e.size=c.DeviceSize.Medium,e.color=f,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:4}}),e}return r(e,t),e}(b);e.ResearchServer=L;var A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Orchard",e.description="grow some food",e.operation=m(s.ResourceBlock.Food),e.size=c.DeviceSize.Medium,e.prereqs=[z],e.color=h,e.forDome=!0,e.economy=i({},s.emptyMarket(),{Power:{supply:2,demand:0}}),e}return r(e,t),e}(b);e.Orchard=A;var T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Cabin",e.description="home on the plains",e.operation=w([s.ResourceBlock.Food,s.ResourceBlock.Food],s.ResourceBlock.Meal),e.image=l.cabin,e.prereqs=[A],e.size=c.DeviceSize.Medium,e.color=d,e.forDome=!0,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:1},Water:{supply:0,demand:1},Shelter:{supply:4,demand:1}}),e}return r(e,t),e}(b);e.Cabin=T;var W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Arbor",e.description="arbor around the clock",e.operation=m(s.ResourceBlock.Food),e.prereqs=[A],e.size=c.DeviceSize.Medium,e.color=h,e.forDome=!0,e}return r(e,t),e}(b);e.Arbor=W;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Algae Vat",e.description="where there is a will",e.operation=m(s.ResourceBlock.Food),e.prereqs=[P,D,B],e.size=c.DeviceSize.Medium,e.color=y,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:2}}),e}return r(e,t),e}(b);e.AlgaeVat=z;var H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Botany",e.description="plant lab",e.operation=m(s.ResourceBlock.Food),e.prereqs=[P,D],e.size=c.DeviceSize.Medium,e.color=h,e}return r(e,t),e}(b);e.Botany=H;var E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Cloning Vat",e.description="we all grow",e.operation=_(),e.productionTime=1500,e.image=l.vat,e.prereqs=[z],e.size=c.DeviceSize.Medium,e.color=y,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:2}}),e}return r(e,t),e}(b);e.CloningVat=E;var F=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Fabricator",e.description="you made that",e.operation=w([s.ResourceBlock.Ore,s.ResourceBlock.Ore,s.ResourceBlock.Ore],s.ResourceBlock.Mineral),e.size=c.DeviceSize.Medium,e.color=p,e.prereqs=[k],e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:3}}),e}return r(e,t),e}(b);e.Fabricator=F;var G=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Mining Drill",e.description="ore away",e.operation=m(s.ResourceBlock.Ore),e.size=c.DeviceSize.Large,e.prereqs=[F],e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:5}}),e}return r(e,t),e}(b);e.MiningDrill=G;var q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Mega-Fabricator",e.size=c.DeviceSize.Large,e.prereqs=[F],e.color=p,e.economy=i({},s.emptyMarket(),{Power:{supply:0,demand:8}}),e}return r(e,t),e}(b);e.Megafabricator=q;var I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Preserve",e.size=c.DeviceSize.Large,e.prereqs=[W],e.color=h,e.forDome=!0,e.economy=i({},s.emptyMarket(),{Water:{supply:0,demand:4}}),e}return r(e,t),e}(b);e.Preserve=I;var U=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Microcity",e.size=c.DeviceSize.Huge,e.prereqs=[q],e.color=d,e.forDome=!0,e.economy=i({},s.emptyMarket(),{Water:{supply:0,demand:2},Power:{supply:0,demand:2},Joy:{supply:5,demand:0},Hope:{supply:5,demand:0},Beauty:{supply:1,demand:0},Wonder:{supply:1,demand:0}}),e}return r(e,t),e}(b);e.Microcity=U;var N=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Logic Crystal",e.size=c.DeviceSize.Huge,e.prereqs=[q],e.color=f,e}return r(e,t),e}(b);e.LogicCrystal=N,e.allMachines=[z,W,V,D,T,E,M,F,B,j,q,G,A,P,I,L,S,R,x,k,U,N,H]},function(t,e,n){"use strict";var o;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Left=0]="Left",t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Down=3]="Down"}(o=e.Orientation||(e.Orientation={})),e.compass=[o.Left,o.Right,o.Up,o.Down],e.flip=function(t){switch(t){case o.Left:return o.Right;case o.Right:return o.Left;case o.Up:return o.Down;case o.Down:return o.Up}throw new Error("Don't know orientation "+t)}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(11),a=n(7),c=n(6),u=n(1),l=s.Scale.major,p=s.Scale.minor,h=c.allMachines.filter(function(t){return(new t).size===u.DeviceSize.Small}),f=c.allMachines.filter(function(t){return(new t).size===u.DeviceSize.Medium}),d=c.allMachines.filter(function(t){return(new t).size===u.DeviceSize.Large}),y=c.allMachines.filter(function(t){return(new t).size===u.DeviceSize.Huge}),v=h.filter(function(t){return(new t).forDome}),g=h.filter(function(t){return!(new t).forDome}),m=f.filter(function(t){return(new t).forDome}),w=f.filter(function(t){return!(new t).forDome}),_=d.filter(function(t){return(new t).forDome}),b=d.filter(function(t){return!(new t).forDome}),O=y.filter(function(t){return(new t).forDome}),P=y.filter(function(t){return!(new t).forDome}),S=function(){var t;this.name="(structure name)",this.description="(structure description)",this.view="<structure (room) view>",this.width=10,this.height=10,this.zoom=1,this.color=i.Color.Gray,this.connections=((t={})[a.Orientation.Left]=[M],t[a.Orientation.Right]=[M],t[a.Orientation.Up]=[k],t[a.Orientation.Down]=[k],t),this.machines=[],this.prereqs=[]};e.Structure=S;var x=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Main Tunnel",n.description="Elevating",n.view="TunnelView",n.width=l.second,n.height=l.eighth,n.zoom=.25,n.connections=((e={})[a.Orientation.Left]=[M],e[a.Orientation.Right]=[M],e[a.Orientation.Up]=[F],e[a.Orientation.Down]=[],e),n}return r(e,t),e}(S);e.MainTunnel=x;var C=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Road",n.description="go for a walk",n.view="SurfaceRoadView",n.width=p.fifth,n.height=p.first,n.connections=((e={})[a.Orientation.Left]=[D,F],e[a.Orientation.Right]=[D,F],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n}return r(e,t),e}(S);e.SurfaceRoad=C;var M=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Corridor",n.description="in the hallway",n.view="CorridorView",n.width=p.fifth,n.height=p.third,n.zoom=.5,n.connections=((e={})[a.Orientation.Left]=[x,B],e[a.Orientation.Right]=[x,B],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n.prereqs=[C],n}return r(e,t),e}(S);e.Corridor=M;var k=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Ladder",n.description="connect vertically",n.view="LadderView",n.width=p.third,n.height=100+l.third,n.zoom=.5,n.connections=((e={})[a.Orientation.Up]=[B],e[a.Orientation.Down]=[B],e[a.Orientation.Left]=[],e[a.Orientation.Right]=[],e),n.prereqs=[M,V],n}return r(e,t),e}(S);e.Ladder=k;var D=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.description="Biome sweet biome",n.view="DomeView",n.width=2*l.eighth,n.height=l.eighth,n.zoom=.2,n.connections=((e={})[a.Orientation.Left]=[C],e[a.Orientation.Right]=[C],e[a.Orientation.Up]=[],e[a.Orientation.Down]=[],e),n.machines=[c.SolarCell,c.OxygenExtractor,c.WaterCondensingMachine],n}return r(e,t),e}(S),B=function(t){function e(){var n,o=null!==t&&t.apply(this,arguments)||this;return o.name="Commons",o.description="hallway cap",o.view="CommonAreaView",o.width=l.eighth,o.height=l.fifth,o.connections=((n={})[a.Orientation.Left]=[M,e],n[a.Orientation.Right]=[M,e],n[a.Orientation.Up]=[k],n[a.Orientation.Down]=[k],n),o.machines=[],o.prereqs=[],o}return r(e,t),e}(S),R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Sm. Room (2)",e.width=l.eighth,e.prereqs=[T],e.machines=g,e}return r(e,t),e}(B);e.SmallRoomTwo=R;var V=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Sm. Room (3)",e.prereqs=[R],e.view="SmallRoomThreeView",e.width=2*l.eighth,e.machines=g,e}return r(e,t),e}(B);e.SmallRoomThree=V;var j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Mid Room",e.prereqs=[V],e.view="MediumRoomView",e.width=3*l.eighth,e.height=2*l.third,e.machines=w,e}return r(e,t),e}(B);e.MediumRoom=j;var L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Lg. Room",e.view="LargeRoomView",e.prereqs=[j],e.width=6*l.eighth,e.height=4*l.fifth,e.machines=b,e}return r(e,t),e}(B);e.LargeRoom=L;var A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Huge Room",e.view="HugeRoomView",e.width=10*l.eighth,e.height=8*l.eighth,e.prereqs=[L],e.machines=P,e}return r(e,t),e}(B);e.HugeRoom=A;var T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Sm. Dome",e.width=3*l.eighth,e.height=2*l.eighth,e.machines=v,e}return r(e,t),e}(D);e.SmallDome=T;var W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Sm. Dome (3)",e.view="SmallDomeThreeView",e.width=4*l.seventh,e.height=3*l.seventh,e.machines=v,e}return r(e,t),e}(D);e.SmallDomeThree=W;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Mid Dome",e.view="MidDomeView",e.width=6*l.eighth,e.height=5*l.eighth,e.prereqs=[T,j],e.machines=m,e}return r(e,t),e}(D);e.MidDome=z;var H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Lg. Dome",e.view="BigDomeView",e.width=8*l.eighth,e.height=6*l.eighth,e.prereqs=[z,L],e.machines=_,e}return r(e,t),e}(D);e.LargeDome=H;var E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Arcology",e.view="ArcologyView",e.width=12*l.eighth,e.height=36*l.eighth,e.prereqs=[H,A],e.machines=O,e}return r(e,t),e}(D);e.Arcology=E;var F=function(t){function e(){var e,n=null!==t&&t.apply(this,arguments)||this;return n.name="Mission Control",n.description="Keeping everything on track",n.view="MissionControlView",n.width=6*l.eighth,n.height=1*l.sixth,n.zoom=.1,n.connections=((e={})[a.Orientation.Left]=[C],e[a.Orientation.Right]=[C],e[a.Orientation.Up]=[x],e[a.Orientation.Down]=[x],e),n.machines=[c.CommandCenter],n}return r(e,t),e}(S);e.MissionControl=F,e.allStructures=[T,W,z,H,E,R,V,j,L,A]},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(6),s=n(0),a=function(){this.name="(generic)",this.description="(generic description)",this.machines=[],this.color=s.Color.Gray,this.prereqs=[]};e.SpaceFunction=a;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Living Quarters",e.machines=[i.Bed],e}return r(e,t),e}(a);e.LivingQuarters=c;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Barracks",e.machines=[i.Bed,i.Bed,i.Bed],e}return r(e,t),e}(a),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Kitchen",e.machines=[i.Stove,i.Fridge],e}return r(e,t),e}(a);e.Kitchen=l;var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Life Support Module",e.machines=[i.OxygenExtractor,i.WaterCondensingMachine],e}return r(e,t),e}(a);e.LifeSupportPod=p;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Retreat",e.machines=[i.Cabin,i.Cabin],e}return r(e,t),e}(a),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Clone Matrix",e.machines=[i.CloningVat,i.CloningVat],e}return r(e,t),e}(a);e.CloneMatrix=f;var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Reading Room",e.machines=[i.Bookshelf,i.Bookshelf],e}return r(e,t),e}(a),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Library",e.machines=[i.Bookshelf,i.Bookshelf,i.Bookshelf],e}return r(e,t),e}(a),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Study",e.machines=[i.StudyMachine,i.Bookshelf],e}return r(e,t),e}(a),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Lab",e.machines=[i.Workstation,i.Workstation,i.Workstation],e}return r(e,t),e}(a),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Archive",e.machines=[i.ResearchServer,i.ResearchServer],e}return r(e,t),e}(a),w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Arboretum",e.machines=[i.Arbor,i.Arbor],e}return r(e,t),e}(a),_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Algae Farm",e.machines=[i.AlgaeVat,i.AlgaeVat],e}return r(e,t),e}(a),b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Solar Array",e.machines=[i.SolarCell,i.SolarCell],e}return r(e,t),e}(a),O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Workshop",e.machines=[i.Fabricator,i.Fabricator],e}return r(e,t),e}(a),P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Nursery",e.machines=[i.Houseplant,i.Houseplant,i.Houseplant],e}return r(e,t),e}(a),S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Farm",e.machines=[i.Orchard,i.Orchard],e}return r(e,t),e}(a),x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Factory",e.machines=[i.Megafabricator,i.Megafabricator],e}return r(e,t),e}(a);e.allSpaceFunctions=[y,u,p,f,c,l,_,m,w,b,h,v,O,d,P,S,x,g]},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}c((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),c=n(5),u=n(8),l=n(1),p=n(4);e.retrieveResource=function(t){return{type:"retrieve",resource:t}};var h=function(t){function e(e,n){var o=t.call(this,n.x,n.y,l.getVisibleDeviceSize(e.size),l.getVisibleDeviceSize(e.size),e.color)||this;return o.machine=e,o.product=[],o.inUse=!1,o.imageLoaded=!1,o.nameLabel=new a.Label(o.machine.name,0,0,"Helvetica"),o.nameLabel.fontSize=6,o.nameLabel.color=a.Color.White,o.image=new Image,o.image.onload=function(){o.imageLoaded=!0},o.image.src=e.image,o}return r(e,t),e.prototype.draw=function(t,e){this.imageLoaded&&t.drawImage(this.image,this.pos.x-this.getWidth()/2,this.pos.y-this.getHeight()/2-10,this.getWidth(),this.getHeight()),this.nameLabel.pos=this.getCenter(),this.nameLabel.pos.x-=10,this.nameLabel.pos.y+=8+this.getHeight()/2,this.nameLabel.draw(t,e);var n=this.x-this.getWidth()/2+5,o=this.y-23;this.product.forEach(function(e,r){t.fillStyle=c.blockColor(e).desaturate(.3).lighten(.2).toRGBA(),t.fillRect(n+5*r,o-5,4,4)})},Object.defineProperty(e.prototype,"operation",{get:function(){return this.machine.operation},enumerable:!0,configurable:!0}),e.prototype.interact=function(t,e){return i(this,void 0,void 0,function(){var n,o,r,i,a;return s(this,function(s){switch(s.label){case 0:return this.inUse?(t.waitToUse(this),[2,!1]):(n=!1,"recipe"!==(o=this.operation).type?[3,5]:(r=o,t.carrying.some(function(t){return r.consumes.includes(t)})?(this.inUse=!0,t.isCarryingUnique(r.consumes)?(r.consumes.forEach(function(e){return t.drop(e)}),[4,t.progressBar(r.workTime)]):[3,2]):[3,4]));case 1:return s.sent(),t.carry(r.produces),n=!0,[3,3];case 2:console.log("not carrying all requirements?",{requires:r.consumes,has:t.carrying}),s.label=3;case 3:this.inUse=!1,s.label=4;case 4:return[3,13];case 5:return"store"!==o.type?[3,10]:(i=o,e?(this.inUse=!0,(n=this.dispense(t,e))?[4,t.progressBar(500)]:[3,7]):[3,8]);case 6:s.sent(),s.label=7;case 7:return this.inUse=!1,[3,9];case 8:t.carrying.some(function(t){return i.stores.includes(t)})&&(this.product.length<i.capacity?(a=null,i.stores.some(function(e){return a=t.drop(e)})&&a&&(this.product.push(a),this.building.redeem(a),n=!0)):console.warn("no capacity in this store!!")),s.label=9;case 9:return[3,13];case 10:return"generator"!==o.type?[3,13]:(this.inUse=!0,(n=this.dispense(t,e))?[4,t.progressBar(500)]:[3,12]);case 11:s.sent(),s.label=12;case 12:this.inUse=!1,s.label=13;case 13:return[2,n]}})})},e.prototype.dispense=function(t,e){return!(!e||"retrieve"!==e.type||!this.product.find(function(t){return t===e.resource}))&&(p.deleteByValueOnce(this.product,e.resource),t.carry(e.resource),!0)},e.prototype.produce=function(t){var e=this;"generator"===this.machine.operation.type?t%this.machine.operation.generationTime==0&&this.product.length<this.machine.operation.capacity&&this.product.push(this.machine.operation.generates):"spawn"===this.machine.operation.type&&setTimeout(function(){return e.building.populate(e.pos)},100)},e.prototype.snap=function(t,e){var n=this;void 0===e&&(e=this.pos);var o=t.colony.closestBuildingByType(e,u.allStructures,function(t){return t.hasPlaceForDevice()&&t.structure.machines.some(function(t){return n.machine instanceof t})}),r=!1;return o&&(r=o.nextDevicePlace().position.distance(e)<150),r?(this.building=o,this.pos=this.building.nextDevicePlace().position):this.pos=e,r;//!!bldg;
},e}(a.Actor);e.Device=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Scale={major:{first:16,second:32,third:48,fourth:64,fifth:80,sixth:96,seventh:112,eighth:128},minor:{first:4,second:8,third:12,fourth:16,fifth:20,sixth:24,seventh:28,eighth:32}}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.colorBase=function(){return this.color.lighten(.1)},e}(n(3).CorridorView);e.SurfaceRoadView=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),r=function(){function t(){this.empty=!0,this.nodes=[],this.edges={},this.edgesInverse={}}return t.prototype.isEmpty=function(){return this.empty},Object.defineProperty(t.prototype,"size",{get:function(){return this.nodes.length},enumerable:!0,configurable:!0}),t.prototype.node=function(t){this.empty=!1,this.contains(t)||this.nodes.push(t)},t.prototype.contains=function(t){return this.nodes.includes(t)},t.prototype.findOrCreate=function(t,e,n){void 0===n&&(n=5);var r=this.dfs(),i=o.minBy(r,function(n){return e(t,n)});return i&&e(i,t)<n?i:t},t.prototype.edge=function(t,e){this.node(t),this.node(e);var n=this.indexOf(t),o=this.indexOf(e);this.edges[n]=this.edges[n]||[],this.edges[n].push(o),this.edgesInverse[o]=this.edgesInverse[o]||[],this.edgesInverse[o].push(n)},t.prototype.union=function(t){var e=this;t.edgeList().forEach(function(t){var n=t[0],o=t[1];return e.edge(n,o)})},t.prototype.edgeList=function(){for(var t=[],e=0,n=this.nodes;e<n.length;e++){var o=n[e],r=this.indexOf(o);if(this.edges[r])for(var i=0,s=this.edges[r];i<s.length;i++){var a=s[i],c=this.nodes[a];t.includes([c,o])||t.push([o,c])}}return t},t.prototype.adjacent=function(t){var e=this,n=this.indexOf(t);return this.adjacentIndices(n).map(function(t){return e.nodes[t]})},t.prototype.adjacentIndices=function(t){var e=this.edges[t]||[],n=this.edgesInverse[t]||[];return e.concat(n)},t.prototype.dfs=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=[]);var o=t?this.indexOf(t):0;return this.dfsIndex(o).map(function(t){return n.nodes[t]})},t.prototype.dfsIndex=function(t,e){var n=this;return void 0===t&&(t=0),void 0===e&&(e=[]),e.push(t),this.adjacentIndices(t).forEach(function(t){e.includes(t)||n.dfsIndex(t,e)}),e},t.prototype.bfs=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=function(){return!0});var o=t?this.indexOf(t):0;return this.bfsIndex(o,e).map(function(t){return n.nodes[t]})},t.prototype.bfsIndex=function(t,e){void 0===t&&(t=null),void 0===e&&(e=function(){return!0});var n=!1,o=[];for(o.push(t);o.length<this.nodes.length;){for(var r=0,i=o;r<i.length;r++){for(var s=i[r],a=0,c=this.adjacentIndices(s);a<c.length;a++){var u=c[a];if(!o.includes(u)){if(!e(s,u)){n=!0;break}o.push(u)}}if(n)break}if(n)break}return o},t.prototype.shortestPath=function(t,e,n){var o=this;void 0===n&&(n=256);var r={},i=this.indexOf(e);this.bfs(t,function(t,e){return r[e]=t,e!==i});for(var s=[],a=i,c=0,u=this.indexOf(t);!s.includes(u)&&c<n;)s.push(a),a=r[a],c+=1;return s.map(function(t){return o.nodes[t]}).reverse()},t.prototype.indexOf=function(t){return this.nodes.indexOf(t)},t}();e.Graph=r},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(62),a=function(t){function e(e){var n=t.call(this,{width:800,height:600,displayMode:i.DisplayMode.FullScreen,backgroundColor:e.skyColor})||this;return n.world=e,n}return r(e,t),e.prototype.start=function(){var e=new i.Loader;for(var n in s.Resources)e.addResource(s.Resources[n]);return t.prototype.start.call(this,e)},e.citizenSpeed=100,e}(i.Engine);e.Game=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(2),c=n(1),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-6;return[new s.Vector(e-t/3,n),new s.Vector(e,n),new s.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Small)})},e}(i.DomeView);e.SmallDomeThreeView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),s=n(2),a=n(0),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-20;return[new a.Vector(e-t/3,n),new a.Vector(e+t/3,n)].map(function(t){return new s.DevicePlace(t,i.DeviceSize.Large)})},e}(n(3).DomeView);e.BigDomeView=c},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(2),c=n(1),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-c.getVisibleDeviceSize(c.DeviceSize.Huge)/2;return[new s.Vector(e-t/3,n),new s.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Huge)})},e}(i.CommonAreaView);e.HugeRoomView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(2),c=n(1),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-c.getVisibleDeviceSize(c.DeviceSize.Large)/2;return[new s.Vector(e-t/3,n),new s.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Large)})},e}(i.CommonAreaView);e.LargeRoomView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(1),a=n(2),c=n(0),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-20;return[new c.Vector(e-t/3,n),new c.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,s.DeviceSize.Medium)})},e}(i.CommonAreaView);e.MediumRoomView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(2),c=n(1),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-20;return[new s.Vector(e-t/3,n),new s.Vector(e+t/3,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Medium)})},e}(i.DomeView);e.MidDomeView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(2),c=n(1),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-10;return[new s.Vector(e-t/2,n),new s.Vector(e,n),new s.Vector(e+t/2,n)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Small)})},e}(i.CommonAreaView);e.SmallRoomThreeView=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,n,o,r){void 0===o&&(o=null),void 0===r&&(r=null),this.x=t,this.y=e,this.all=n,this.onButtonClick=o,this.onButtonEnter=r,this.built=[],this.comprehended=[],this.makePalette()}return t.prototype.draw=function(t){if(this._element){var e=t.canvas.offsetLeft,n=t.canvas.offsetTop;this._element.style.left=e+this.x+"px",this._element.style.top=n+this.y+"px"}},t.prototype.updateBuilt=function(t){var e=this;this.built=t,this.comprehended=this.all.filter(function(t){return(new t).prereqs.every(function(t){return e.built.some(function(e){return e===t})})}),this.makePalette()},t.prototype.makePalette=function(){var t=this;this._element&&this._element.parentElement.removeChild(this._element),this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.border="1px solid white",document.body.appendChild(this._element),this.comprehended.map(function(t){return new t}).sort(function(t,e){return t.color>e.color?-1:1}).forEach(function(e){var n=e.name;t.built.map(function(t){return(new t).name}).includes(e.name)||(n+=" *");var o=e.color,r=t.buttonFactory(n,o);t._element.appendChild(r),t.onButtonEnter&&(r.onmouseenter=function(){t.onButtonEnter(e)}),t.onButtonClick&&(r.onclick=function(){t.onButtonClick(e)})})},t.prototype.buttonFactory=function(t,e){var n=e.darken(.6).desaturate(.5).clone();n.a=.8;var o=e.lighten(.8).desaturate(.4).clone(),r=document.createElement("button");return r.textContent=t,r.style.display="block",r.style.fontSize="9pt",r.style.fontFamily="Helvetica",r.style.fontWeight="600",r.style.padding="2px",r.style.width="160px",r.style.textTransform="uppercase",r.style.border="1px solid rgba(255,255,255,0.08)",r.style.background=n.toRGBA(),r.style.color=o.toRGBA(),r.onmouseover=function(){r.style.background=n.saturate(.5).lighten(.95).toRGBA(),r.style.color=o.lighten(.9).toRGBA()},r.onmouseleave=function(){r.style.background=n.toRGBA(),r.style.color=o.toRGBA()},r},t}();e.Palette=o},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(8),a=n(6),c=n(5),u=function(t){function e(e,n,o){var r=t.call(this,n,o,0,0)||this;return r.entity=e,r.values=new i.Label(""),r.values.fontSize=10,r.add(r.values),r.notes=new i.Label("behavioral notes",0,30),r.notes.fontSize=11,r.add(r.notes),r.description=new i.Label("description",0,60),r.description.fontSize=12,r.description.fontStyle=i.FontStyle.Italic,r.add(r.description),r.show(e),r}return r(e,t),e.prototype.show=function(t){if(t)if(this.description.text=t.description,t instanceof a.Machine){var e=[],n=t.economy;for(var o in c.PureValue){var r=n[o],i=r.supply-r.demand;i>0?e.push("+"+i+" "+o):i<0&&e.push(i+" "+o)}this.values.text=e.join(" | "),this.notes.text=""}else t instanceof s.Structure&&(this.values.text="",this.notes.text="")},e}(i.Actor);e.CardBody=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(8),a=n(6),c=n(1),u=n(9),l=function(t){function e(e,n,o){var r=t.call(this,n,o,14,32,e&&e.color||i.Color.Gray)||this;return r.entity=e,r.name=new i.Label(e&&e.name||"..",20,16),r.name.fontSize=28,r.name.color=i.Color.Black,r.add(r.name),r.type=new i.Label("..",232,16),r.type.fontSize=10,r.type.color=i.Color.Gray,r.type.fontStyle=i.FontStyle.Italic,r.add(r.type),r}return r(e,t),e.prototype.announce=function(t){this.name.text=t.name,this.color=t.color.desaturate(.5).darken(.2),t instanceof a.Machine&&(this.type.text=c.DeviceSize[t.size]+" Machine"),t instanceof s.Structure&&(this.type.text="Structure"),t instanceof u.SpaceFunction&&(this.type.text="Function")},e}(i.Actor);e.CardTitle=l},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(6),a=n(24),c=n(23),u=function(t){function e(e,n,o){var r=t.call(this,n+160,o+90,320,180,i.Color.White)||this;return r.entity=e,r.title=new a.CardTitle(e,-153,-50),r.add(r.title),r.cardBody=new c.CardBody(e,-136,-10),r.add(r.cardBody),r.image=new Image,r}return r(e,t),e.prototype.draw=function(e,n){if(t.prototype.draw.call(this,e,n),this.entity&&this.entity instanceof s.Machine){var o=this.pos.x+48,r=this.pos.y-16;e.drawImage(this.image,o,r,92,92)}},e.prototype.present=function(t){this.title.announce(t),this.cardBody.show(t),this.entity=t,this.entity instanceof s.Machine&&(this.image.src=this.entity.image)},e}(i.Actor);e.Card=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=function(t){function e(e,n,o){var r=t.call(this,n,o,0,0)||this;return r.nameLabel=new i.Label(e,n,o),r.nameLabel.fontSize=10,r.nameLabel.color=i.Color.White.darken(.2),r.add(r.nameLabel),r.valueLabel=new i.Label("0",n+40,o),r.valueLabel.fontSize=10,r.valueLabel.color=i.Color.White.darken(.2),r.add(r.valueLabel),r}return r(e,t),e.prototype.setCount=function(t){this.valueLabel.text=""+t;var e=i.Color.Gray;t>0?e=i.Color.Green:t<0&&(e=i.Color.Red),this.valueLabel.color=e},e}(i.Actor);e.EconomicValue=s},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(5),a=n(26),c=function(t){function e(e,n,o){var r=t.call(this,n,o,0,0)||this;r.valueLabels={Power:null,Oxygen:null,Water:null,Shelter:null,Hope:null,Joy:null,Wisdom:null,Wealth:null,Beauty:null,Wonder:null};for(var i=0,c=0,u=s.allValues;c<u.length;c++){var l=u[c],p=new a.EconomicValue(l,34*i++,0);r.valueLabels[l]=p,r.add(p)}return r.updateView(e),r}return r(e,t),e.prototype.updateView=function(t){for(var e=t,n=0,o=s.allValues;n<o.length;n++){var r=o[n];this.valueLabels[r].setCount(s.availableCapacity(e,r))}},e}(i.Actor);e.EconomyView=c},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(5),a=function(t){function e(e,n,o,r){var a=t.call(this,e,n,10,10)||this;a.value=r;var c=new i.Actor(e,n,10,10,s.blockColor(o));return a.add(c),a.count=new i.Label("x"+r,e+10,n+6,"Helvetica"),a.count.fontSize=10,a.count.color=i.Color.White,a.add(a.count),a}return r(e,t),e.prototype.credit=function(t){this.value+=t,this.count.text="x"+this.value},e}(i.Actor);e.ResourceListEntry=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(5),a=n(28),c=function(t){function e(e,n){var o,r=t.call(this,e,n,0,0,i.Color.DarkGray.darken(.8))||this;return r.entries=((o={})[s.ResourceBlock.Food]=null,o[s.ResourceBlock.Hypothesis]=null,o[s.ResourceBlock.Ore]=null,o[s.ResourceBlock.Meal]=null,o[s.ResourceBlock.Mineral]=null,o[s.ResourceBlock.Data]=null,o[s.ResourceBlock.Alloy]=null,o),[s.ResourceBlock.Meal,s.ResourceBlock.Data,s.ResourceBlock.Mineral].forEach(function(t,e){var n=0+16*e,o=0*e-2.5,i=new a.ResourceListEntry(n,o,t,0);r.add(i),r.entries[t]=i}),r}return r(e,t),e.prototype.increment=function(t){var e=this.entries[t];e&&e.credit(1)},e}(i.Actor);e.ResourcesList=c},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(29),a=n(27),c=function(t){function e(e,n,o){void 0===n&&(n=1e4),void 0===o&&(o=36);var r=t.call(this,0,0,n,o,i.Color.DarkGray.darken(.8))||this,c=new i.Label("OSIRIS",5,16);c.fontSize=12,c.color=i.Color.Gray,c.fontStyle=i.FontStyle.Italic,r.add(c);var u=new i.Label("v0.0.1",48,16);return u.fontSize=7,u.color=i.Color.Gray.darken(.4),r.add(u),r.resources=new s.ResourcesList(80,14),r.add(r.resources),r.economy=new a.EconomyView(e,200,14),r.add(r.economy),r.popLabel=new i.Label("",900,14,"Helvetica"),r.popLabel.fontSize=10,r.popLabel.color=i.Color.White,r.add(r.popLabel),r.messageLabel=new i.Label("hi",1e3,14,"Helvetica"),r.messageLabel.fontSize=10,r.messageLabel.color=i.Color.White,r.messageLabel.fontStyle=i.FontStyle.Italic,r.add(r.messageLabel),r}return r(e,t),e.prototype.incrementResource=function(t){this.resources.increment(t)},e.prototype.setMessage=function(t){this.messageLabel.text=t},e.prototype.showEconomy=function(t){this.economy.updateView(t)},e.prototype.showPopCap=function(t,e){this.popLabel.text="Pop: "+t+"/"+e},e}(i.Actor);e.StatusAnalysisView=c},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(8),a=n(5),c=n(6),u=n(30),l=n(25),p=n(22),h=function(t){function e(n,o,r){void 0===o&&(o=null),void 0===r&&(r=null);var i=t.call(this,0,0,n.canvasWidth,n.canvasHeight)||this;return i.game=n,i.onBuildingSelect=o,i.onMachineSelect=r,i.status=new u.StatusAnalysisView(a.emptyMarket()),i.add(i.status),i.structurePalette=new p.Palette(20,35,e.structuresForPalette,o,function(t){return i.showCard(t)}),i.machinePalette=new p.Palette(20,300,c.allMachines,r,function(t){return i.showCard(t)}),i.card=new l.Card(null,20,800),i.add(i.card),i}return r(e,t),e.prototype.setMessage=function(t){this.status.setMessage(t)},e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n),this.structurePalette.draw(e),this.machinePalette.draw(e)},e.prototype.resourceGathered=function(t){this.status.incrementResource(t)},e.prototype.updateDetails=function(t,e){void 0===e&&(e=!0),e&&this.updatePalettes(t.colony),this.updateEconomy(t),this.updateMaxPop(t.economy[a.PureValue.Shelter].demand,t.maxPop)},e.prototype.showCard=function(t){this.card.present(t)},e.prototype.updateMaxPop=function(t,e){this.status.showPopCap(t,e)},e.prototype.updateEconomy=function(t){this.status.showEconomy(t.economy)},e.prototype.updatePalettes=function(t){this.updateBuildingPalette(t),this.updateMachinePalette(t)},e.prototype.updateBuildingPalette=function(t){var n=e.structuresForPalette.filter(function(e){return t.buildings.some(function(t){return t.structure instanceof e})});this.structurePalette.updateBuilt(n)},e.prototype.updateMachinePalette=function(t){var n=t.findAllDevices(),o=e.machinesForPalette.filter(function(t){return n.some(function(e){return e.machine instanceof t})});this.machinePalette.updateBuilt(o)},e.structuresForPalette=[s.SurfaceRoad,s.Corridor,s.Ladder].concat(s.allStructures),e.machinesForPalette=c.allMachines,e}(i.UIActor);e.Hud=h},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(0),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floorHeight=150,e}return r(e,t),e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new s.Vector(Math.floor(t),Math.floor(e)-4)]},e}(i.CommonAreaView);e.MineView=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(7),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.originSlot=null,e}return r(e,t),e.prototype.constrainCursor=function(t){return this.pickingOrigin||(t.x=this.pos.x),t},e.prototype.reshape=function(t){if(this.pickingOrigin){var e=this.alignToSlot(t);e&&(this.facing=e.facing,e&&(this.originSlot=e))}else if(this.facing===s.Orientation.Up){var n=this.originSlot.pos.y-this.planet.getTop()-25,o=Math.min(n,Math.max(100,this.originSlot.pos.y-t.y));this.setHeight(o/50*50),this.pos.y=this.originSlot.pos.y-this.getHeight()}else o=Math.max(100,t.y-this.originSlot.pos.y),this.setHeight(o/50*50)},e}(i.TunnelView);e.LadderView=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=n(0),a=n(2),c=n(1),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.devicePlaces=function(){var t=3*this.getWidth()/5,e=this.pos.x+t,n=this.pos.y+this.getHeight()/2;return[new s.Vector(e,n-800),new s.Vector(e,n),new s.Vector(e,n+800)].map(function(t){return new a.DevicePlace(t,c.DeviceSize.Huge)})},e.prototype.draw=function(t,e){this.drawShape(t,this.pos.x,this.pos.y),this.getDevices().forEach(function(n){return n.draw(t,e)})},e.prototype.drawShape=function(t,e,n){var o=this.getHeight(),r=this.getWidth();t.beginPath(),t.moveTo(0+e,o+n),t.bezierCurveTo(1+e,o-150+n,121+e,70+n,r-80+e,8+n),t.bezierCurveTo(r-40+e,2+n,r-5+e,11+n,r-10+e,25+n),t.bezierCurveTo(r-5+e,10+n,r+e,o-10+n,r+e,o+n),t.lineTo(0+e,o+n),t.fillStyle=this.mainColor().toRGBA(),t.fill()},e}(i.DomeView);e.ArcologyView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(2),a=n(4),c=n(7),u=n(13),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pickingOrigin=!0,e.hideBox=!0,e}return r(e,t),e.prototype.colorBase=function(){return this.color.darken(.2)},e.prototype.draw=function(e,n){var o=this.aabb();a.drawRect(e,o,0,this.color.darken(.1)),o.x=o.x+this.getWidth()/5,o.width-=this.getWidth()/5*2,a.drawRect(e,o,0,this.color.darken(.2)),t.prototype.draw.call(this,e,n)},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y;return[new i.Vector(Math.floor(t),e)]},e.prototype.graph=function(t){void 0===t&&(t=new u.Graph);var e=t,n=this.getWidth()/2,o=this.pos.x+n,r=e.findOrCreate(this.nodes()[0],a.measureDistance),s=e.findOrCreate(new i.Vector(o,this.slotHeights()[0]),a.measureDistance);e.edge(r,s);var c=this.slotHeights();a.eachCons(c,2).forEach(function(t){var n=t[0],r=t[1],s=e.findOrCreate(new i.Vector(o,n),a.measureDistance),c=e.findOrCreate(new i.Vector(o,r),a.measureDistance);e.edge(s,c)});var l=e.findOrCreate(new i.Vector(o,this.pos.y+this.getHeight()),a.measureDistance),p=e.findOrCreate(new i.Vector(o,c[c.length-1]),a.measureDistance);e.edge(l,p),c.forEach(function(t){var r=e.findOrCreate(new i.Vector(o,t),a.measureDistance),s=e.findOrCreate(new i.Vector(o-n,t),a.measureDistance);e.edge(s,r);var c=e.findOrCreate(new i.Vector(o+n,t),a.measureDistance);e.edge(r,c)});for(var h=0,f=this.childrenBuildings;h<f.length;h++){var d=f[h],y=e.findOrCreate(d.parentSlot.pos,a.measureDistance),v=e.findOrCreate(d.nodes()[0],a.measureDistance);e.edge(v,y),e.edge(y,v),d.graph(e)}return e},e.prototype.slotHeights=function(){for(var t=Math.floor(this.getHeight()/50),e=[],n=0,o=a.range(t);n<o.length;n++){var r=o[n];e.push(50+this.pos.y+50*r)}return e},e.prototype.slots=function(){var t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,c.Orientation.Up));for(var e=0,n=this.slotHeights();e<n.length;e++){var o=n[e];t.push(this.buildSlot(this.pos.x,o,c.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),o,c.Orientation.Right))}return t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),c.Orientation.Down)),t},e.prototype.handleClick=function(t){return!this.pickingOrigin||(this.pickingOrigin=!1,!1)},e.prototype.constrainCursor=function(t){return this.pickingOrigin?this.alignToSlot(t):t.y=Math.max(this.planet.getTop()+100,t.y),t},e.prototype.reshape=function(t){this.pos.y=this.planet.getTop()+2,this.pickingOrigin||this.setHeight(t.y-this.planet.getTop())},e}(s.Building);e.TunnelView=l},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(2),a=n(7),c=n(10),u=n(1),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hideBox=!0,e}return r(e,t),e.prototype.devicePlaces=function(){return this.nodes().map(function(t){return t.y-=20,new s.DevicePlace(t,u.DeviceSize.Medium)})},e.prototype.afterConstruct=function(){var t=this,e=this.structure.machines;if(e&&e.length>0){var n=new e[0];this.devicePlaces().forEach(function(e){var o=new c.Device(n,e.position);t.addDevice(o)})}},e.prototype.slots=function(){var t=[];t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),a.Orientation.Down));var e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,a.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,a.Orientation.Right)),t},e.prototype.constrainCursor=function(t){return t.y=this.planet.getTop(),t},e.prototype.reshape=function(t){this.pos=t,this.pos.y-=this.getHeight()-2},e.prototype.draw=function(e,n){var o=this.mainColor();e.fillStyle=o.toRGBA(),e.fillRect(this.pos.x,this.pos.y,this.getWidth(),this.getHeight());var r=this.pos.x+this.getWidth()/4*3,i=this.pos.y-18;e.fillRect(r,i,2,18),e.fillRect(r,i,10,5),t.prototype.draw.call(this,e,n)},e.prototype.colorBase=function(){return i.Color.White},e}(s.Building);e.MissionControlView=l},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(2),a=n(7),c=n(1),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hideBox=!0,e.showLabel=!0,e}return r(e,t),e.prototype.slots=function(){var t=[],e=this.getHeight();return t.push(this.buildSlot(this.pos.x,this.pos.y+e,a.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,a.Orientation.Right)),t},e.prototype.reshape=function(t){this.alignToSlot(t)},e.prototype.draw=function(e,n){var o=this.mainColor();e.beginPath(),e.arc(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),this.getHeight()/1.5,0,Math.PI,!0),e.closePath(),e.fillStyle=o.toRGBA(),e.fill(),t.prototype.draw.call(this,e,n)},e.prototype.colorBase=function(){return i.Color.White.darken(.05)},e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-6;return[new i.Vector(e-t/3,n),new i.Vector(e+t/3,n)].map(function(t){return new s.DevicePlace(t,c.DeviceSize.Small)})},e}(s.Building);e.DomeView=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),s=n(7),a=n(0),c=n(1),u=n(4),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floorHeight=12,e.edgeWidth=.5,e.showLabel=!0,e.hideBox=!0,e}return r(e,t),e.prototype.colorBase=function(){return this.color.darken(.3)},e.prototype.draw=function(e,n){var o=this.processedColor(),r=this.processedColor().darken(.4);u.drawRect(e,this.aabb(),.5,o),u.drawRect(e,{x:this.x,y:this.y+this.getHeight()-this.floorHeight,width:this.getWidth(),height:this.floorHeight},.2,r),t.prototype.draw.call(this,e,n)},e.prototype.slots=function(){var t=[],e=this.getHeight()-this.floorHeight,n=this.buildSlot(this.pos.x,this.pos.y+e,s.Orientation.Left);t.push(n);var o=this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,s.Orientation.Right);return t.push(o),t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y,s.Orientation.Up)),t.push(this.buildSlot(this.pos.x+this.getWidth()/2,this.pos.y+this.getHeight(),s.Orientation.Down)),t},e.prototype.nodes=function(){var t=this.pos.x+this.getWidth()/2,e=this.pos.y+this.getHeight()-this.floorHeight;return[new a.Vector(Math.floor(t),Math.floor(e))]},e.prototype.reshape=function(t){this.alignToSlot(t)},e.prototype.devicePlaces=function(){var t=this.getWidth()/2,e=this.pos.x+t,n=this.pos.y+this.getHeight()-this.floorHeight-10;return[new a.Vector(e-t/3,n),new a.Vector(e+t/3,n)].map(function(t){return new i.DevicePlace(t,c.DeviceSize.Small)})},e}(i.Building);e.CommonAreaView=l},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),s=n(7),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.edgeWidth=0,e.pickingOrigin=!0,e.facing=s.Orientation.Left,e.originX=0,e}return r(e,t),e.prototype.colorBase=function(){return this.color.darken(.2)},e.prototype.slots=function(){var t=[],e=this.getHeight()/2;return t.push(this.buildSlot(this.pos.x,this.pos.y+e,s.Orientation.Left)),t.push(this.buildSlot(this.pos.x+this.getWidth(),this.pos.y+e,s.Orientation.Right)),t},e.prototype.handleClick=function(t){return!this.pickingOrigin||(this.pickingOrigin=!1,this.reshape(this.constrainCursor(t)),!1)},e.prototype.constrainCursor=function(t){var e=t.clone();return this.pickingOrigin||(e.y=this.pos.y),e},e.prototype.reshape=function(t){if(this.pickingOrigin){var e=this.alignToSlot(t);e&&(this.facing=e.facing,e&&this.facing===s.Orientation.Left&&(this.originX=e.pos.x))}else this.facing===s.Orientation.Left?(this.setWidth(Math.abs(this.originX-t.x)),this.pos.x=this.originX-this.getWidth()):this.setWidth(Math.abs(this.pos.x-t.x))},e}(i.Building);e.CorridorView=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=function(t){function e(){var e=t.call(this)||this;return e.setWidth(5),e.setHeight(5),e.x=5,e.y=5,e.color=new i.Color(255,255,255),e}return r(e,t),e}(i.Actor);e.Player=s},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}c((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),c=n(5),u=n(14),l=n(4),p=n(10),h=n(11),f=function(t){function e(e,n){var o=t.call(this,e.x,e.y,h.Scale.minor.first,h.Scale.minor.third,a.Color.White)||this;return o.device=e,o.planet=n,o.walkSpeed=u.Game.citizenSpeed,o.carrying=[],o.path=[],o.workInProgress=!1,o.working=!1,o.traits=o.traits.filter(function(t){return!(t instanceof a.Traits.OffscreenCulling)}),o}return r(e,t),e.prototype.update=function(e,n){if(t.prototype.update.call(this,e,n),this.work(),this.workInProgress){var o=(new Date).getTime();this.progress=(o-this.workStarted)/this.workDuration}},e.prototype.draw=function(e,n){var o=this;if(t.prototype.draw.call(this,e,n),this.carrying&&this.carrying.forEach(function(t,n){e.fillStyle=c.blockColor(t).toRGBA(),e.fillRect(o.x+4,o.y-3*n,5,5)}),this.workInProgress){e.lineWidth=1;var r=this.x-5,i=this.y-10;e.strokeStyle=a.Color.White.toRGBA(),e.strokeRect(r,i,10,3),e.fillStyle=a.Color.Violet.darken(.9).toRGBA(),e.fillRect(r,i,10,3),e.fillStyle=a.Color.Violet.toRGBA(),e.fillRect(r,i,10*this.progress,3)}this.path},e.prototype.carry=function(t){this.carrying.push(t)},e.prototype.isCarryingUnique=function(t){var e=!0,n=this.carrying.slice();return this.carrying.length>0&&t.forEach(function(t){n.find(function(e){return e===t})?l.deleteByValueOnce(n,t):e=!1}),e},e.prototype.drop=function(t){return console.log("ASKED TO DROP",{res:t}),this.carrying.length>0&&this.carrying.find(function(e){return e===t})?(l.deleteByValueOnce(this.carrying,t),t):null},e.prototype.glideTo=function(t){return this.actions.moveTo(t.x,t.y,this.walkSpeed).asPromise()},e.prototype.progressBar=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.workInProgress=!0,this.workStarted=(new Date).getTime(),this.workDuration=t,[4,new Promise(function(e,n){return setTimeout(e,t)})];case 1:return e.sent(),this.workInProgress=!1,[2]}})})},e.prototype.pathTo=function(t){return i(this,void 0,void 0,function(){var e,n=this;return s(this,function(o){switch(o.label){case 0:if(this.path.length>0)throw console.log("The path already exists",{path:this.path}),new Error("Already pathing!!");return console.log("Pathing to",{building:t}),(e=this.planet.pathBetween(this.pos.clone(),t)).length>0?(this.path=e,e.pop(),e.shift(),[4,Promise.all(e.map(function(t){return n.glideTo(t)}))]):[3,2];case 1:o.sent(),this.path=[],o.label=2;case 2:return[2,!0]}})})},e.prototype.waitToUse=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,l.sleep(250)];case 1:return e.sent(),t.interact(this),[2]}})})},e.prototype.workRecipe=function(t){return i(this,void 0,void 0,function(){var e,n,o,r,i;return s(this,function(s){switch(s.label){case 0:console.log("WORK RECIPE",{recipe:t}),e=0,n=t.consumes,s.label=1;case 1:return e<n.length?(o=n[e],console.log("TRY TO GATHER",{ingredient:o}),[4,this.gather(o)]):[3,4];case 2:s.sent(),console.log("OKAY, I should have gathered",{ingredient:o,recipe:t}),s.label=3;case 3:return e++,[3,1];case 4:return r=this.planet.colony.findAllDevices(),(i=r.find(function(e){return e.operation===t}))?(console.log("found recipe maker, let's do this!"),[4,this.pathTo(i.building)]):[3,11];case 5:return s.sent(),console.log("walking to recipe maker!"),[4,this.glideTo(i)];case 6:return s.sent(),[4,i.interact(this)];case 7:return s.sent()?(console.log("i worked the recipe!"),[3,11]):[3,8];case 8:return console.log("i failed to work the recipe..."),[4,l.sleep(1e3)];case 9:return s.sent(),[4,this.workRecipe(t)];case 10:s.sent(),s.label=11;case 11:return[2]}})})},e.prototype.gather=function(t){return i(this,void 0,void 0,function(){var e,n,o;return s(this,function(r){switch(r.label){case 0:return console.log("GATHER",{res:t}),e=this.planet.colony.findAllDevices(),(n=e.find(function(e){return"generator"===e.operation.type&&e.product.some(function(e){return t===e})}))?(console.log("found generator with resource",{res:t,gen:n}),[4,this.pathTo(n.building)]):[3,8];case 1:return r.sent(),console.log("gliding to get generated resource!",{gen:n,machine:n.machine,pos:n.pos}),[4,this.glideTo(n.pos)];case 2:return r.sent(),console.log("attempt to interact with generator to gather",{gen:n,res:t}),[4,n.interact(this,p.retrieveResource(t))];case 3:return r.sent()?(console.log("gathered okay!"),[3,7]):[3,4];case 4:return console.warn("trying to gather again in a bit?"),[4,l.sleep(1e3)];case 5:return r.sent(),[4,this.gather(t)];case 6:r.sent(),r.label=7;case 7:return[3,13];case 8:return(o=e.find(function(e){return"recipe"===e.operation.type&&e.operation.produces===t}))?[4,this.workRecipe(o.operation)]:[3,10];case 9:return r.sent(),[3,13];case 10:return console.warn("Can't find producer of",{res:t}),[4,l.sleep(1e3)];case 11:return r.sent(),[4,this.gather(t)];case 12:r.sent(),r.label=13;case 13:return[2]}})})},e.prototype.work=function(){this.working||(l.sleep(3e3*Math.random()),this.workOne())},e.prototype.workOne=function(){return i(this,void 0,void 0,function(){var t,e,n,o,r;return s(this,function(i){switch(i.label){case 0:return this.working?[2]:(this.working=!0,t=this.planet.colony.findAllDevices(),(e=l.shuffle(t).find(function(t){return"store"===t.operation.type&&t.product.length<t.operation.capacity}))?(console.log("WORKING FOR STORE",{store:e}),n=t.filter(function(t){return"recipe"===t.operation.type}),o=n.map(function(t){return t.operation}),(r=l.shuffle(o).find(function(t){return e.operation.stores.some(function(e){return t.produces===e})}))?(console.log("TRY TO WORK RECIPE!!!",r),[4,this.workRecipe(r)]):[3,5]):[3,5]);case 1:return i.sent(),console.log("DELIVER TO STORE..."),[4,this.pathTo(e.building)];case 2:return i.sent(),console.log("INTERACT WITH STORE...!"),[4,this.glideTo(e.pos)];case 3:return i.sent(),[4,e.interact(this)];case 4:i.sent()?console.log("i think it worked!!"):console.warn("maybe it didn't work!"),i.label=5;case 5:return[4,l.sleep(1e3)];case 6:return i.sent(),this.working=!1,[2]}})})},e}(a.Actor);e.Citizen=f},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(41),a=function(t){function e(e){var n=t.call(this,0,-e.getHeight()/2,0,0)||this;return n.planet=e,n.citizens=[],n.traits=n.traits.filter(function(t){return!(t instanceof i.Traits.OffscreenCulling)}),n}return r(e,t),e.prototype.increase=function(t){var e=new s.Citizen(t,this.planet);e.work(),this.citizens.push(e),this.add(e)},e}(i.Actor);e.Population=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),r=function(){function t(t){this.graph=t.graph()}return t.prototype.seekPath=function(t,e){return this.graph.shortestPath(t,e)},t.prototype.closestNode=function(t){var e=this.graph.dfs();return o.minBy(e,function(e){return Math.abs(t.distance(e))})||!1},t}();e.NavigationTree=r},function(t,e,n){t.exports=n.p+"9ed5e1137b47b9fc3d2bbf4534777307.svg"},function(t,e,n){t.exports=n.p+"3aeb9dd24809ba3fbd4eeb31a28c3b19.svg"},function(t,e,n){t.exports=n.p+"cffe40698a3b47b52ca0ff90a2c86ddf.svg"},function(t,e,n){t.exports=n.p+"43062e54318df93f49e2be9a4281eb4a.svg"},function(t,e,n){t.exports=n.p+"86e09b7a9e4997af44c45206eb8694ad.svg"},function(t,e,n){t.exports=n.p+"c4ab2ceb2f61e18493fc776770c65654.svg"},function(t,e,n){t.exports=n.p+"bbd50a175546bd70d21c5eadbc30d479.svg"},function(t,e,n){t.exports=n.p+"7441c2ab240d0f733451d75204ac0792.svg"},function(t,e,n){t.exports=n.p+"91a8cce06c3c05ce6e4b176afafd7b0a.svg"},function(t,e,n){t.exports=n.p+"0ce4f9c3384680565b6bb16495b64233.svg"},function(t,e,n){t.exports=n.p+"1db542acabeb82ec8da785e77afd4dca.svg"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mechanicalOperations={store:function(t,e){return void 0===e&&(e=10),{type:"store",stores:t,capacity:e}},generate:function(t){return{type:"generator",generates:t,generationTime:1e3,capacity:4}},recipe:function(t,e){return{type:"recipe",consumes:t,produces:e,workTime:1e3}},spawn:function(){return{type:"spawn"}}}},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(4),a=n(8),c=n(43),u=function(t){function e(e,n){var o=t.call(this,e,n,0,0)||this;return o.buildings=[],o.currentlyConstructing=null,o.traits=o.traits.filter(function(t){return!(t instanceof i.Traits.OffscreenCulling)}),o}return r(e,t),e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n),this.navTree},e.prototype.placeBuilding=function(t){t.built=!0,t.parentSlot&&(t.parentSlot.parent.childrenBuildings.push(t),this.buildNavTree()),this.buildings.push(t),t.afterConstruct(),this.add(t)},e.prototype.closestBuildingByType=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=function(){return!0});var o=this.buildings.filter(function(t){return(!(e.length>0)||e.some(function(e){return t.structure instanceof e}))&&n(t)});if(o&&o.length>0)return s.minBy(o,function(e){return t.distance(e.nodes()[0])})},e.prototype.pathBetween=function(t,e){this.navTree||this.buildNavTree();var n=this.navTree.closestNode(t),o=e.nodes()[0],r=this.navTree.closestNode(o);return this.navTree.seekPath(n,r)},e.prototype.closestDeviceByType=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=function(){return!0});var o=this.findAllDevices();if((o=o.filter(function(t){return(!(e.length>0)||e.some(function(e){return t.machine instanceof e}))&&n(t)}))&&o.length>0)return s.minBy(o,function(e){return t.distance(e)})},e.prototype.buildNavTree=function(){var t=this.buildings.find(function(t){return t.structure instanceof a.MissionControl});t&&(this.navTree=new c.NavigationTree(t))},e.prototype.findAllDevices=function(){return s.flatSingle(this.buildings.map(function(t){return t.getDevices()}))},e}(i.Actor);e.Colony=u},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(4),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.peaks=[],e}return r(e,t),e.prototype.onInitialize=function(){for(var t=this.getWidth()/2,e=this.getWidth()/20,n=0,o=s.range(5);n<o.length;n++)for(var r=o[n],i=100*r,a=3*r*(e/2),c=0,u=s.range(20);c<u.length;c++){var l=u[c];this.peaks.push({x:l*e-t+(Math.random()*a-a/2),height:Math.max(10,1e3+3e3*Math.random()+(Math.random()*i-i/2))})}},e.prototype.draw=function(t,e){var n=this.color.desaturate(.25),o=this.color.saturate(.2).lighten(.5);t.fillStyle=n.toRGBA();var r=this.pos.y-3;this.peaks.forEach(function(e){var i=r-e.height,s=3.4*e.height;t.beginPath(),t.moveTo(e.x,i),t.lineTo(e.x-s,r),t.lineTo(e.x+s,r),t.fillStyle=n.toRGBA(),t.fill(),t.beginPath(),t.moveTo(e.x,i),t.lineTo(e.x+s/4*3,r),t.lineTo(e.x+s,r),t.fillStyle=o.toRGBA(),t.fill()})},e}(function(t){function e(e,n,o){return t.call(this,0,e,n,500,o)||this}return r(e,t),e}(i.Actor));e.Mountains=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(0),a=n(4),c=n(57),u=n(5),l=n(56),p=n(42),h=n(6),f=function(t){function e(e,n,o,r){void 0===o&&(o=2e6),void 0===r&&(r=1e7);var s=t.call(this,0,r/2,o,r,n)||this;s.hud=e,s.color=n,s.width=o,s.depth=r,s.traits=s.traits.filter(function(t){return!(t instanceof i.Traits.OffscreenCulling)});var u=-r/2;s.createLayer(u,20,s.color.lighten(.25));for(var h=r/10,f=0,d=a.range(10);f<d.length;f++){var y=d[f];s.createLayer(u+20+h/2+h*(y+1),h,s.color.darken(.05+.01*y))}return s.add(new c.Mountains(-r/2,s.getWidth(),s.color.lighten(.15))),s.colony=new l.Colony(0,-r/2),s.add(s.colony),s.population=new p.Population(s),s.add(s.population),s}return r(e,t),e.prototype.createLayer=function(t,e,n){var o=new s.Actor(0,t,this.getWidth(),e,n);this.add(o)},e.prototype.draw=function(e,n){t.prototype.draw.call(this,e,n),this.currentlyConstructing&&this.currentlyConstructing.draw(e,n)},Object.defineProperty(e.prototype,"economy",{get:function(){var t=this.colony.findAllDevices().map(function(t){return t.machine.economy}).reduce(u.sumMarkets,u.emptyMarket()),e=this.population.citizens.length;return t.Shelter.demand=e,t.Oxygen.demand+=e,t.Water.demand+=e,t},enumerable:!0,configurable:!0}),e.prototype.update=function(e,n){t.prototype.update.call(this,e,n),this.colony.buildings.forEach(function(t){return t.update(e,n)}),this.population.citizens.forEach(function(t){return t.update(e,n)})},Object.defineProperty(e.prototype,"currentlyConstructing",{get:function(){return this.colony.currentlyConstructing},enumerable:!0,configurable:!0}),e.prototype.gather=function(t){this.hud.resourceGathered(t)},e.prototype.placeBuilding=function(t){this.colony.placeBuilding(t)},e.prototype.populate=function(t){if(this.population.citizens.length<this.maxPop){var e=this.closestDevice(t,[h.CloningVat]);this.population.increase(e)}},Object.defineProperty(e.prototype,"maxPop",{get:function(){var t=this.colony.findAllDevices().map(function(t){return t.machine.economy}).reduce(u.sumMarkets,u.emptyMarket()),e=[u.PureValue.Shelter,u.PureValue.Water,u.PureValue.Oxygen];return Math.max(0,Math.min.apply(Math,e.map(function(e){return u.availableCapacity(t,e)})))},enumerable:!0,configurable:!0}),e.prototype.closestBuildingByType=function(t,e,n){return void 0===n&&(n=function(){return!0}),this.colony.closestBuildingByType(t,e,n)},e.prototype.closestDevice=function(t,e,n){return void 0===e&&(e=[]),void 0===n&&(n=function(){return!0}),this.colony.closestDeviceByType(t,e,n)},e.prototype.pathBetween=function(t,e){return this.colony.pathBetween(t,e)},e}(s.Actor);e.Planet=f},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=n(58),a=n(40),c=n(8),u=n(3),l=n(31),p=n(12),h=n(10),f=n(6),d=n(21),y=n(20),v=n(19),g=n(18),m=n(17),w=n(16),_=n(15),b=n(9),O=n(4),P=n(1),S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dragging=!1,e.defaultMessage="Welcome to the Colony, Commander.",e.placingFunction=null,e}return r(e,t),e.prototype.update=function(e,n){t.prototype.update.call(this,e,n),this.hud.updateDetails(this.planet,!1)},e.prototype.onInitialize=function(t){var e=this;this.game=t,this.hud=new l.Hud(t,function(t){e.startConstructing(t)},function(t){e.startConstructing(t)}),this.add(this.hud),this.planet=new s.Planet(this.hud,t.world.color),this.add(this.planet),this.player=new a.Player,this.add(this.player),this.prepareNextBuilding(),this.camera.zoom(.001),this.camera.zoom(2,1e4)},e.prototype.onActivate=function(){var t=this;this.game.input.pointers.primary.on("move",function(e){if(t.dragging)t.camera.pos=t.camera.pos.add(t.dragOrigin.sub(e.pos));else{t.player.pos=e.pos;var n=t.planet.currentlyConstructing;if(n instanceof u.Building){var o=n.constrainCursor(t.player.pos);t.player.pos=o,n.reshape(t.player.pos)}else n instanceof h.Device&&n.snap(t.planet,t.player.pos)}}),this.game.input.pointers.primary.on("up",function(){t.dragging&&(t.dragging=!1)}),this.game.input.pointers.primary.on("down",function(e){if(e.button==i.Input.PointerButton.Left){var n=t.planet.currentlyConstructing;if(n)if(n instanceof u.Building){var o=n,r=!o.overlapsAny();if(o&&r&&o.handleClick(e.pos)){if(t.planet.placeBuilding(o),t.placingFunction){var s=t.placingFunction;O.zip(s.machines,o.devicePlaces()).forEach(function(t){var e=t[0],n=t[1];console.log("would add machine",{machine:e,place:n});var r=new h.Device(new e,n.position);o.addDevice(r)}),t.placingFunction=null}t.hud.setMessage(t.defaultMessage),t.planet.colony.currentlyConstructing=null,t.prepareNextBuilding(e.pos),t.hud.updateDetails(t.planet)}}else{var a=n;a.snap(t.planet)&&(a.building.addDevice(a),t.planet.colony.currentlyConstructing=null,t.hud.setMessage(t.defaultMessage),t.hud.updateDetails(t.planet))}}else e.button===i.Input.PointerButton.Middle&&(t.dragging=!0,t.dragOrigin=e.pos)}),this.game.input.pointers.primary.on("wheel",function(e){var n=t.camera.getZoom();e.deltaY<0?t.camera.zoom(Math.min(n+.05,8)):e.deltaY>0&&t.camera.zoom(Math.max(n-.05,.05))}),this.game.input.keyboard.on("press",function(e){e.key===i.Input.Keys.H?t.buildings&&t.buildings[0]&&(t.camera.move(t.buildings[0].pos,500),t.camera.zoom(.5,1e3)):e.key===i.Input.Keys.Esc&&(t.planet.colony.currentlyConstructing=null)})},e.prototype.onDeactivate=function(){this.game.input.pointers.primary.off("move"),this.game.input.pointers.primary.off("down"),this.game.input.pointers.primary.off("up"),this.game.input.pointers.primary.off("wheel")},Object.defineProperty(e.prototype,"buildings",{get:function(){return this.planet.colony.buildings},enumerable:!0,configurable:!0}),e.prototype.nextMissingRequiredStructure=function(){var t=e.requiredStructureList.map(function(t){return new t}),n=this.buildings.map(function(t){return t.structure.name});return t.find(function(t){return!n.includes(t.name)})},e.prototype.nextMissingStructureOrFunction=function(){var t=e.requiredStructuresAndFunctions.map(function(t){return new t}),n=this.buildings.map(function(t){return t.structure.name}),o=O.flatSingle(this.buildings.map(function(t){return t.spaceFunction&&t.spaceFunction.name})),r=n.concat(o);return t.find(function(t){return!r.includes(t.name)})},e.prototype.prepareNextBuilding=function(t){void 0===t&&(t=new i.Vector(0,0));var e=null,n=this.nextMissingStructureOrFunction();n&&(e=n),e&&this.startConstructing(e,t)},e.prototype.startConstructing=function(t,e){void 0===e&&(e=new i.Vector(0,0)),this.hud.showCard(t);var n=null;if(t instanceof c.Structure){var o=t;this.hud.setMessage("Place "+o.name+" ("+o.description+")"),n=this.spawnBuilding(o,e),this.camera.zoom(o.zoom,250),this.camera.pos=n.pos}else if(t instanceof f.Machine){var r=t;this.hud.setMessage("Install "+r.name+" ("+r.description+")"),n=this.spawnDevice(r,e)}else if(t instanceof b.SpaceFunction){var s=t;this.hud.setMessage("Place "+s.name+" ("+s.description+")"),n=this.spawnFunction(s,e),this.placingFunction=s}this.planet.colony.currentlyConstructing=null,n&&(this.planet.colony.currentlyConstructing=n)},e.prototype.spawnDevice=function(t,e){var n=new h.Device(t,e);return n.snap(this.planet)&&(this.camera.pos=n.pos),n},e.prototype.spawnBuilding=function(t,e){var n=this.assembleBuildingFromStructure(t,e);return n.reshape(n.constrainCursor(n.pos)),n},e.prototype.assembleBuildingFromStructure=function(t,n){return new(0,e.structureViews[t.view])(n,t,this.planet)},e.prototype.spawnFunction=function(t,e){var n=new c.SmallRoomThree;return t.machines.some(function(t){return(new t).size===P.DeviceSize.Medium})&&(n=new c.MediumRoom),t.machines.some(function(t){return(new t).forDome})&&(n=new c.SmallDomeThree),this.assembleBuildingFromStructure(n,e)},e.structureViews={CorridorView:u.CorridorView,LadderView:u.LadderView,TunnelView:u.TunnelView,SurfaceRoadView:p.SurfaceRoadView,DomeView:u.DomeView,SmallDomeThreeView:_.SmallDomeThreeView,MidDomeView:y.MidDomeView,BigDomeView:w.BigDomeView,MissionControlView:u.MissionControlView,SmallRoomThreeView:d.SmallRoomThreeView,CommonAreaView:u.CommonAreaView,MediumRoomView:v.MediumRoomView,LargeRoomView:g.LargeRoomView,HugeRoomView:m.HugeRoomView,ArcologyView:u.ArcologyView},e.requiredStructureList=[c.MissionControl,c.SurfaceRoad,c.SmallDomeThree,c.MainTunnel,c.Corridor,c.SmallRoomTwo],e.requiredStructuresAndFunctions=[c.MissionControl,c.SurfaceRoad,b.LifeSupportPod,c.MainTunnel,c.Corridor,b.Kitchen,b.LivingQuarters,b.CloneMatrix],e}(i.Scene);e.Construct=S},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=n(4),i=function(){function t(){this.color=r.sample(t.colors).darken(.1).desaturate(.8),this.skyColor=r.sample([o.Color.Cyan,o.Color.Vermillion]).lighten(.15).desaturate(.65)}return t.colors=[o.Color.Red,o.Color.Blue,o.Color.Green],t}();e.World=i},function(t,e,n){t.exports=n.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=n(61),i={Sword:new o.Texture(r)};e.Resources=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(14),r=n(60),i=n(59),s=new r.World,a=new o.Game(s),c=new i.Construct(a);a.add("construct",c),a.start().then(function(){a.goToScene("construct")})}]);
//# sourceMappingURL=main.js.map