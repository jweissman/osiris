{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/values/DeviceSize.ts","webpack:///./src/actors/Building/Building.ts","webpack:///./src/actors/Building/index.ts","webpack:///./src/Util.ts","webpack:///./src/models/Machine.ts","webpack:///./src/values/Orientation.ts","webpack:///./src/models/Economy.ts","webpack:///./src/models/Structure.ts","webpack:///./src/values/Scale.ts","webpack:///./src/actors/Building/SurfaceRoadView.ts","webpack:///./src/actors/Device.ts","webpack:///./src/values/Graph.ts","webpack:///./src/Game.ts","webpack:///./src/actors/Building/SmallDomeThreeView.ts","webpack:///./src/actors/Building/BigDomeView.ts","webpack:///./src/actors/Building/HugeRoomView.ts","webpack:///./src/actors/Building/LargeRoomView.ts","webpack:///./src/actors/Building/MediumRoomView.ts","webpack:///./src/actors/Building/MidDomeView.ts","webpack:///./src/actors/Building/SmallRoomThreeView.ts","webpack:///./src/actors/Hud/CardTitle.ts","webpack:///./src/actors/Hud/Card.ts","webpack:///./src/actors/Hud/EconomicValue.ts","webpack:///./src/actors/Hud/EconomyView.ts","webpack:///./src/actors/Hud/ResourceListEntry.ts","webpack:///./src/actors/Hud/ResourcesList.ts","webpack:///./src/actors/Hud/StatusAnalysisView.ts","webpack:///./src/actors/Hud/Hud.ts","webpack:///./src/actors/Building/MineView.ts","webpack:///./src/actors/Building/LadderView.ts","webpack:///./src/actors/Building/ArcologyView.ts","webpack:///./src/actors/Building/TunnelView.ts","webpack:///./src/actors/Building/MissionControlView.ts","webpack:///./src/actors/Building/DomeView.ts","webpack:///./src/actors/Building/CommonAreaView.ts","webpack:///./src/actors/Building/CorridorView.ts","webpack:///./src/models/SpaceFunction.ts","webpack:///./src/actors/player.ts","webpack:///./src/actors/Citizen.ts","webpack:///./src/actors/Planet/Population.ts","webpack:///./src/actors/Planet/NavigationTree.ts","webpack:///./src/images/workstation-plain.svg","webpack:///./src/images/houseplant-plain.svg","webpack:///./src/images/research-server-plain.svg","webpack:///./src/images/fridge-plain.svg","webpack:///./src/images/bed-plain.svg","webpack:///./src/images/cooking-fire-plain.svg","webpack:///./src/images/cabin-plain.svg","webpack:///./src/images/stove-plain.svg","webpack:///./src/images/bench-simple-plain.svg","webpack:///./src/images/vat-plain.svg","webpack:///./src/images/bookshelf-plain.svg","webpack:///./src/actors/Planet/Colony.ts","webpack:///./src/actors/Planet/PlanetBackground.ts","webpack:///./src/actors/Planet/Planet.ts","webpack:///./src/scenes/Construct.ts","webpack:///./src/models/World.ts","webpack:///./src/images/bookshelf.png","webpack:///./src/images/sword.png","webpack:///./src/Resources.ts","webpack:///./src/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","p","jsonpArray","window","webpackJsonp","oldJsonpFunction","bind","slice","DeviceSize","Scale_1","major","Scale","minor","Small","Medium","Large","Huge","getVisibleDeviceSize","size","sz","third","sixth","eighth","excalibur_1","Orientation_1","Util_1","Graph_1","SpaceFunction_1","DeviceSize_1","DevicePlace","pos","this","Building","_super","structure","planet","_this","x","y","width","height","color","edgeWidth","built","hover","showLabel","facing","Orientation","Right","hideBox","childrenBuildings","level","devices","step","anchor","Vector","setup","traits","filter","trait","Traits","OffscreenCulling","on","collisionType","CollisionType","PreventCollision","nameLabel","Label","Color","White","levelLabel","fontSize","darken","__extends","levelUp","text","draw","ctx","delta","drawRect","aabb","processedColor","forEach","device","getCenter","measureText","update","engine","produce","constrainCursor","cursor","clone","reshape","afterConstruct","handleClick","_pos","slots","nodes","getWidth","getHeight","Math","floor","devicePlaces","graph","supergraph","Graph","g","rootNode","findOrCreate","measureDistance","_i","_a","child","slot","parentSlot","edge","childNode","redeem","res","gather","populate","overlaps","other","rect1","rect2","overlapsAny","colony","buildings","find","bldg","edgeColor","lighten","mainColor","colorBase","clr","Red","a","connections","findSlot","validConnections","slotList","dir","validStructures","flipped","flip","map","closestBuildingByType","building","matchingSlot","compass_1","compass","closest","alignToSlot","theSlot","offset","sub","addEqual","buildSlot","parent","addDevice","finalize","updateName","hasPlaceForDevice","nextDevicePlace","getDevices","fn","allSpaceFunctions","spaceFn","matched","unseenDevices","machines","machine","matchingDevice","deleteByValue","label","Actor","Building_1","CorridorView_1","CorridorView","CommonAreaView_1","CommonAreaView","DomeView_1","DomeView","MissionControlView_1","MissionControlView","TunnelView_1","TunnelView","ArcologyView_1","ArcologyView","LadderView_1","LadderView","MineView_1","MineView","SurfaceRoadView_1","SurfaceRoadView","extremumBy","arr","pluck","extremum","reduce","best","next","pair","_ecRange","minBy","min","maxBy","max","sample","random","range","Array","fill","_val","idx","getVector","predicate","matching","elem","distance","flatSingle","concat","e","eachCons","b","drawLine","lineWidth","beginPath","moveTo","lineTo","strokeStyle","toRGBA","stroke","rectangle","filled","main","fillStyle","fillRect","strokeRect","MachineOperation","Economy_1","images","bookshelf","vat","bench","stove","cabin","fire","bed","fridge","server","plant","workstation","Green","Blue","Orange","Violet","Yellow","Work","SpawnCitizen","CollectResource","CollectMeals","CollectData","Machine","description","LightGray","consumes","produces","generationTime","workTime","capacity","behavior","image","prereqs","economy","emptyMarket","forDome","CommandCenter","arguments","__assign","Power","supply","demand","Oxygen","Hope","OxygenExtractor","WaterCondensingMachine","SolarCell","Water","StudyMachine","ResourceBlock","Hypothesis","Data","Desk","Workstation","Bookshelf","Fridge","Stove","Food","Meal","Bed","Shelter","Houseplant","ResearchServer","Orchard","AlgaeVat","Cabin","Arbor","Botany","CloningVat","productionTime","Fabricator","Ore","Mineral","MiningDrill","Megafabricator","Preserve","Microcity","Joy","Beauty","Wonder","LogicCrystal","allMachines","Left","Up","Down","orientation","Error","PureValue","Wisdom","Wealth","availableCapacity","market","sumMarkets","ea","eb","newMarket","sa","da","_b","Alloy","blockColors","blockColor","block","desaturate","t","setPrototypeOf","__proto__","constructor","create","Machine_1","smallMachines","mediumMachines","largeMachines","hugeMachines","smallDome","smallBelow","midDome","midBelow","largeDome","largeBelow","hugeDome","hugeBelow","Structure","view","zoom","Gray","Corridor","Ladder","MainTunnel","second","MissionControl","SurfaceRoad","fifth","first","Dome","CommonArea","SmallRoomThree","SmallRoomTwo","SmallDome","MediumRoom","LargeRoom","HugeRoom","SmallDomeThree","seventh","MidDome","LargeDome","Arcology","allStructures","majorUnit","fourth","minorUnit","minorScale","Structure_1","Device","initialPos","product","inUse","Image","src","drawImage","bx","by","produced","index","blockSize","interact","citizen","waitToUse","pop","progressBar","sent","carry","carrying","resource","drop","console","warn","setTimeout","snap","some","position","empty","edges","edgesInverse","isEmpty","node","newNode","contains","testNode","includes","measure","tolerance","dfs","dst","indexOf","union","otherGraph","edgeList","theEdges","_c","otherIndex","otherNode","adjacent","adjacentIndices","testNodeIndex","es","esInv","root","visited","rIndex","dfsIndex","rootIndex","childIndex","bfs","cb","bfsIndex","halt","visited_1","visitedNode","adj_1","adjacentNode","shortestPath","maxStep","prevStep","dstIndex","prev","curr","path","steps","srcIndex","reverse","Resources_1","Game","world","displayMode","DisplayMode","FullScreen","backgroundColor","skyColor","start","loader","Loader","key","Resources","addResource","citizenSpeed","Engine","_1","SmallDomeThreeView","w","BigDomeView","HugeRoomView","floorHeight","LargeRoomView","MediumRoomView","MidDomeView","SmallRoomThreeView","CardTitle","entity","Black","add","type","fontStyle","FontStyle","Italic","announce","CardTitle_1","Card","title","x0","y0","ix","iy","present","EconomicValue","valueLabel","setCount","count","EconomicValue_1","EconomyView","valueLabels","updateView","updatedEconomy","ResourceListEntry","resourceBlock","icon","credit","amt","ResourceListEntry_1","ResourcesList","DarkGray","entries","rx","ry","entry","increment","ResourcesList_1","EconomyView_1","StatusAnalysisView","h","brand","ty","version","resources","popLabel","messageLabel","incrementResource","setMessage","showEconomy","showPopCap","cap","StatusAnalysisView_1","Card_1","Hud","game","onBuildingSelect","onMachineSelect","canvasWidth","canvasHeight","restrictConstruction","comprehendedStructures","builtStructures","comprehendedMachines","builtMachines","card","_makeStructurePalette","_makeMachinePalette","status","visible","_structurePaletteElement","left","canvas","offsetLeft","top_1","offsetTop","style","top","_machinePaletteElement","top_2","resourceGathered","updateDetails","rebuildPalettes","updatePalettes","updateEconomy","updateMaxPop","maxPop","showCard","updateBuildingPalette","updateMachinePalette","structuresForPalette","every","prereq","parentElement","removeChild","bldgs","availableMachines","findAllDevices","machinesForPalette","document","createElement","border","body","appendChild","btn","buttonFactory","onmouseenter","onclick","sort","bg","fg","paletteButton","textContent","display","fontFamily","fontWeight","padding","textTransform","background","onmouseover","saturate","onmouseleave","UIActor","originSlot","pickingOrigin","maxHeight","getTop","setHeight","drawShape","xoff","yoff","bezierCurveTo","rect","halfWidth","slotHeights","heights","y1","btm","lst","right","slotCount","theSlots","Device_1","machine_1","place","theDevice","slotY","flagX","flagY","arc","PI","closePath","wallColor","floorColor","leftSlot","rightSlot","originX","newCursor","setWidth","abs","SpaceFunction","LivingQuarters","Barracks","Kitchen","LifeSupportPod","Retreat","CloneMatrix","ReadingRoom","Library","Study","Lab","Archive","Arboretum","AlgaeFarm","SolarArray","Workshop","Nursery","Farm","Factory","ex","Player","Game_1","Citizen","walkSpeed","workInProgress","now","Date","getTime","progress","workStarted","workDuration","vel","px","pw","py","glideTo","actions","asPromise","duration","Promise","resolve","reject","pathTo","pathBetween","all","work","item_1","sink","closestDevice","log","source","Citizen_1","Population","citizens","increase","home","NavigationTree","seekPath","origin","dest","closestNode","NavigationTree_1","Colony","currentlyConstructing","navTree","placeBuilding","buildNavTree","structureTypes","st","destination","srcNode","destNode","closestDeviceByType","machineTypes","ctrl","Mountains","peaks","onInitialize","xOff","peakDistance","times","heightRange","drift","baseColor","brightColor","yBase","peak","mtnWidth","PlanetBackground","PlanetBackground_1","Colony_1","Population_1","Planet","hud","depth","createLayer","layerHeight","population","theLayer","theEconomy","popularDemand","theEconomyWithoutPeople","values","val","Planet_1","player_1","Hud_1","SmallRoomThreeView_1","MidDomeView_1","MediumRoomView_1","LargeRoomView_1","HugeRoomView_1","BigDomeView_1","SmallDomeThreeView_1","Construct","dragging","defaultMessage","startConstructing","player","prepareNextBuilding","camera","onActivate","input","pointers","primary","dragOrigin","currentlyBuilding","constrained","button","Input","PointerButton","buildingUnderConstruction","placementValid","deviceUnderConstruction","Middle","z","getZoom","deltaY","keyboard","Keys","H","move","Esc","onDeactivate","off","nextMissingRequiredStructure","requiredStructures","requiredStructureList","actualStructureNames","nextMissing","structureOrMachine","theNextOne","spawnBuilding","spawnDevice","anotherBuilding","assembleBuildingFromStructure","structureViews","Scene","World","colors","Cyan","Vermillion","sword","Sword","Texture","World_1","Construct_1","theWorld","construct","then","goToScene"],"mappings":"aACA,SAAAA,EAAAC,GAOA,IANA,IAKAC,EAAAC,EALAC,EAAAH,EAAA,GACAI,EAAAJ,EAAA,GACAK,EAAAL,EAAA,GAGAM,EAAA,EAAAC,KACQD,EAAAH,EAAAK,OAAoBF,IAC5BJ,EAAAC,EAAAG,GACAG,EAAAP,IACAK,EAAAG,KAAAD,EAAAP,GAAA,IAEAO,EAAAP,GAAA,EAEA,IAAAD,KAAAG,EACAO,OAAAC,UAAAC,eAAAC,KAAAV,EAAAH,KACAc,EAAAd,GAAAG,EAAAH,IAIA,IADAe,KAAAhB,GACAO,EAAAC,QACAD,EAAAU,OAAAV,GAOA,OAHAW,EAAAR,KAAAS,MAAAD,EAAAb,OAGAe,IAEA,SAAAA,IAEA,IADA,IAAAC,EACAf,EAAA,EAAiBA,EAAAY,EAAAV,OAA4BF,IAAA,CAG7C,IAFA,IAAAgB,EAAAJ,EAAAZ,GACAiB,KACAC,EAAA,EAAkBA,EAAAF,EAAAd,OAA2BgB,IAAA,CAC7C,IAAAC,EAAAH,EAAAE,GACA,IAAAf,EAAAgB,KAAAF,MAEAA,IACAL,EAAAQ,OAAApB,IAAA,GACAe,EAAAM,IAAAC,EAAAN,EAAA,KAGA,OAAAD,EAIA,IAAAQ,KAKApB,GACAqB,EAAA,GAGAZ,KAGA,SAAAS,EAAA1B,GAGA,GAAA4B,EAAA5B,GACA,OAAA4B,EAAA5B,GAAA8B,QAGA,IAAAC,EAAAH,EAAA5B,IACAK,EAAAL,EACAgC,KACAF,YAUA,OANAhB,EAAAd,GAAAa,KAAAkB,EAAAD,QAAAC,IAAAD,QAAAJ,GAGAK,EAAAC,KAGAD,EAAAD,QAKAJ,EAAAO,EAAAnB,EAGAY,EAAAQ,EAAAN,EAGAF,EAAAS,EAAA,SAAAL,EAAAM,EAAAC,GACAX,EAAAY,EAAAR,EAAAM,IACA1B,OAAA6B,eAAAT,EAAAM,GACAI,gBACAC,cACAC,IAAAL,KAMAX,EAAAiB,EAAA,SAAAb,GACApB,OAAA6B,eAAAT,EAAA,cAAiDc,YAIjDlB,EAAAmB,EAAA,SAAAd,GACA,IAAAM,EAAAN,KAAAe,WACA,WAA2B,OAAAf,EAAAgB,SAC3B,WAAiC,OAAAhB,GAEjC,OADAL,EAAAS,EAAAE,EAAA,IAAAA,GACAA,GAIAX,EAAAY,EAAA,SAAAU,EAAAC,GAAsD,OAAAvC,OAAAC,UAAAC,eAAAC,KAAAmC,EAAAC,IAGtDvB,EAAAwB,EAAA,GAEA,IAAAC,EAAAC,OAAAC,aAAAD,OAAAC,iBACAC,EAAAH,EAAA1C,KAAA8C,KAAAJ,GACAA,EAAA1C,KAAAX,EACAqD,IAAAK,QACA,QAAAnD,EAAA,EAAgBA,EAAA8C,EAAA5C,OAAuBF,IAAAP,EAAAqD,EAAA9C,IACvC,IAAAU,EAAAuC,EAIArC,EAAAR,MAAA,OAEAU,qFCrIA,IAGYsC,EAHZC,EAAAhC,EAAA,GACMiC,EAAAD,EAAAE,MAAAD,MAAOD,EAAAE,MAAAC,MAEb,SAAYJ,GACRA,IAAAK,MAAA,WACAL,IAAAM,OAAA,YACAN,IAAAO,MAAA,WACAP,IAAAQ,KAAA,UAJJ,CAAYR,EAAA3B,EAAA2B,aAAA3B,EAAA2B,gBAQZ3B,EAAAoC,qBAAA,SAAqCC,GACjC,IAAIC,EAAK,GACT,OAAQD,GACJ,KAAKV,EAAWK,MAAOM,EAAKT,EAAMU,MAAO,MACzC,KAAKZ,EAAWM,OAAQK,EAAKT,EAAMW,MAAO,MAC1C,KAAKb,EAAWO,MAAOI,EAAK,EAAIT,EAAMY,OAAQ,MAC9C,KAAKd,EAAWQ,KAAMG,EAAK,EAAIT,EAAMY,OAEzC,OAAOH,kaCnBX,IAAAI,EAAA9C,EAAA,GAIA+C,EAAA/C,EAAA,GAGAgD,EAAAhD,EAAA,GACAiD,EAAAjD,EAAA,IAGAkD,EAAAlD,EAAA,IACAmD,EAAAnD,EAAA,GAEAoD,EAAA,WACI,SAAAA,EAAoBC,EAAqBZ,GAArBa,KAAAD,MAAqBC,KAAAb,OAI7C,OAHIzD,OAAA6B,eAAIuC,EAAAnE,UAAA,YAAA+B,IAAJ,WAAiB,OAAOsC,KAAKD,qCAC7BrE,OAAA6B,eAAIuC,EAAAnE,UAAA,eAAA+B,IAAJ,WAAoB,OAAOmC,EAAAX,qBAAqBc,KAAKb,uCAEzDW,EALA,GAAahD,EAAAgD,cAOb,IAAAG,EAAA,SAAAC,GAkBI,SAAAD,EAAYF,EAAoBI,EAAgCC,GAAhE,IAAAC,EACIH,EAAArE,KAAAmE,KACED,EAAIO,EACJP,EAAIQ,EACJJ,EAAUK,MACVL,EAAUM,OACVL,EAAOM,QACRV,YAP2BK,EAAAF,YAAgCE,EAAAD,SAjBhEC,EAAAM,UAAoB,EAKpBN,EAAAO,SACAP,EAAAQ,SACAR,EAAAS,aACAT,EAAAU,OAAsBtB,EAAAuB,YAAYC,MAClCZ,EAAAa,WAEAb,EAAAc,qBAEAd,EAAAe,MAAgB,EAERf,EAAAgB,WAkGRhB,EAAAiB,KAAe,EAxFXjB,EAAKkB,OAAS,IAAI/B,EAAAgC,OAAO,EAAE,GAE3BnB,EAAKoB,QACLpB,EAAKqB,OAASrB,EAAKqB,OAAOC,OAAO,SAAAC,GAAS,QAAEA,aAAiBpC,EAAAqC,OAAOC,oBAEpEzB,EAAK0B,GAAG,eAAgB,WACpB1B,EAAKQ,WASTR,EAAK0B,GAAG,eAAgB,WACpB1B,EAAKQ,WAGTR,EAAK2B,cAAgBxC,EAAAyC,cAAcC,iBAEnC7B,EAAK8B,UAAY,IAAI3C,EAAA4C,MAAM/B,EAAKF,UAAU/C,KAAM,EAAG,EAAG,aAEtDiD,EAAK8B,UAAUzB,MAAQlB,EAAA6C,MAAMC,MAE7BjC,EAAKkC,WAAa,IAAI/C,EAAA4C,MAAM,QAAQ/B,EAAKe,MAAS,EAAG,EAAG,aACxDf,EAAKkC,WAAWC,SAAW,EAC3BnC,EAAKkC,WAAW7B,MAAQlB,EAAA6C,MAAMC,MAAMG,OAAO,IAAAnF,EAmRnD,OAxU8BoF,EAAAzC,EAAAC,GAwD1BD,EAAAtE,UAAAgH,QAAA,WACI3C,KAAKoB,OAAS,EACdpB,KAAKuC,WAAWK,KAAO,QAAQ5C,KAAKoB,OAIxCnB,EAAAtE,UAAAkH,KAAA,SAAKC,EAA+BC,GAC3B/C,KAAKkB,SACNxB,EAAAsD,SAASF,EAAK9C,KAAKiD,OAAQjD,KAAKW,UAAWX,KAAKkD,kBAEpDlD,KAAKqB,QAAQ8B,QAAQ,SAAAC,GAAU,OAAAA,EAAOP,KAAKC,EAAKC,KAE5C/C,KAAKc,YACLd,KAAKmC,UAAUpC,IAAMC,KAAKqD,YAC1BrD,KAAKmC,UAAUpC,IAAIO,GAAKwC,EAAIQ,YAAYtD,KAAKG,UAAU/C,MAAMoD,MAAQ,EACrER,KAAKmC,UAAUU,KAAKC,EAAKC,KA4CjC9C,EAAAtE,UAAA4H,OAAA,SAAOC,EAAcT,GAArB,IAAA1C,EAAAL,KACIE,EAAAvE,UAAM4H,OAAM1H,KAAAmE,KAACwD,EAAQT,GACJ/C,KAAKY,OAElBZ,KAAKqB,QAAQ8B,QAAQ,SAAAC,GAAU,OAAAA,EAAOK,QAAQpD,EAAKiB,QAEvDtB,KAAKsB,MAAQ,GAGjBrB,EAAAtE,UAAA8F,MAAA,aAEAxB,EAAAtE,UAAA+H,gBAAA,SAAgBC,GACZ,OAAOA,EAAOC,SAElB3D,EAAAtE,UAAAkI,QAAA,SAAQF,GACJ3D,KAAKD,IAAM4D,EAAOC,SAGtB3D,EAAAtE,UAAAmI,eAAA,aAEA7D,EAAAtE,UAAAoI,YAAA,SAAYC,GAAiB,UAE7B/D,EAAAtE,UAAAsI,MAAA,WACI,UAGJhE,EAAAtE,UAAAuI,MAAA,WACI,IAAI5D,EAAIN,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EACjC5D,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAC1B,OACI,IAAI5E,EAAAgC,OAAO6C,KAAKC,MAAMhE,GAAI+D,KAAKC,MAAM/D,GAAG,KAIhDN,EAAAtE,UAAA4I,aAAA,WACI,UAIJtE,EAAAtE,UAAA6I,MAAA,SAAMC,kBAAA,IAAgC9E,EAAA+E,OAKlC,IAJA,IAAIC,EAAIF,EAEJP,EAAQlE,KAAKkE,QACbU,EAAWD,EAAEE,aAAaX,EAAM,GAAIxE,EAAAoF,iBACtBC,EAAA,EAAAC,EAAAhF,KAAKmB,kBAAL4D,EAAAC,EAAAzJ,OAAAwJ,IAAwB,CAArC,IAAIE,EAAKD,EAAAD,GACNG,EAAOP,EAAEE,aAAaI,EAAME,WAAWpF,IAAKL,EAAAoF,iBAChDH,EAAES,KAAKR,EAAUM,GAEjB,IAAIG,EAAYV,EAAEE,aAAaI,EAAMf,QAAQ,GAAIxE,EAAAoF,iBACjDH,EAAES,KAAKF,EAAMG,GAEbJ,EAAMT,MAAMG,GAEhB,OAAOA,GAIJ1E,EAAAtE,UAAA2J,OAAP,SAAcC,GACVvF,KAAKI,OAAOoF,OAAOD,IAGhBtF,EAAAtE,UAAA8J,SAAP,SAAgB1F,GACZC,KAAKI,OAAOqF,SAAS1F,IAIfE,EAAAtE,UAAAsH,KAAV,WACI,OACI3C,EAAGN,KAAKD,IAAIO,EACZC,EAAGP,KAAKD,IAAIQ,EACZC,MAAOR,KAAKmE,WACZ1D,OAAQT,KAAKoE,cAIXnE,EAAAtE,UAAA+J,SAAV,SAAmBC,GACf,IAAIC,EAAQ5F,KAAKiD,OAAQ4C,EAAQF,EAAM1C,OAOvC,SALI2C,EAAMtF,EAAIuF,EAAMvF,EAAIuF,EAAMrF,OAC1BoF,EAAMtF,EAAIsF,EAAMpF,MAAQqF,EAAMvF,GAC9BsF,EAAMrF,EAAIsF,EAAMtF,EAAIsF,EAAMpF,QAC1BmF,EAAMrF,EAAIqF,EAAMnF,OAASoF,EAAMtF,IAKhCN,EAAAtE,UAAAmK,YAAP,eAAAzF,EAAAL,KACI,QAASA,KAAKI,OAAO2F,OAAOC,UAAUC,KAAK,SAAAC,GAAQ,OAAAA,IAAS7F,GAAQA,EAAKqF,SAASQ,MAG5EjG,EAAAtE,UAAAwK,UAAV,WAEI,OADWnG,KAAKkD,iBAAiBkD,QAAQ,MAInCnG,EAAAtE,UAAA0K,UAAV,WAEI,OADWrG,KAAKkD,iBAAiBT,OAAO,MAIlCxC,EAAAtE,UAAA2K,UAAV,WACI,OAAOtG,KAAKU,OAGNT,EAAAtE,UAAAuH,eAAV,WACI,IAAIqD,EAAMvG,KAAKsG,YAAY1C,QAM3B,OALK5D,KAAKY,QACFZ,KAAK8F,gBAAiBS,EAAM/G,EAAA6C,MAAMmE,KACtCD,EAAIE,EAAI,IAERzG,KAAKa,QAAS0F,EAAIE,EAAI,IACnBF,GAGX7K,OAAA6B,eAAI0C,EAAAtE,UAAA,eAAA+B,IAAJ,WACI,OAAOsC,KAAKG,UAAUuG,6CAIhBzG,EAAAtE,UAAAgL,SAAV,SACI5G,EACA6G,GAFJ,IAAAvG,EAAAL,cAEI4G,MAAmE5G,KAAK0G,aAGpE,IADJ,IAAIG,gBACSC,GACL,IAAMC,EAAkBH,EAAiBE,GACrCE,EAAUvH,EAAAwH,KAAKH,GACDC,EAAgBG,IAAI,SAAA/G,GAClC,OAAAE,EAAKD,OAAO+G,sBAAsBpH,GAAMI,MAElCgD,QAAQ,SAAAiE,GACVA,GACoBA,EAASnD,QACftC,OAAO,SAAAuD,GAAQ,OAAAA,EAAKnE,SAAWiG,IAC5C7D,QAAQ,SAAAkE,GACLR,EAASpL,KAAK4L,QAXdtC,EAAA,EAAAuC,EAAA7H,EAAA8H,QAAAxC,EAAAuC,EAAA/L,OAAAwJ,IAAOzH,EAAXgK,EAAAvC,IAiBhB,GAAI8B,EAAStL,OAAS,EAClB,OAAOmE,EAAA8H,QAAQzH,EAAK8G,EAAU,SAAC3B,GAAS,OAAAA,EAAKnF,OAM3CE,EAAAtE,UAAA8L,YAAV,SACI9D,EACAiD,kBAAmE5G,KAAK0G,aAExE,IAAIgB,EAAU1H,KAAK2G,SAAShD,EAAQiD,GACpC,GAAIc,EAAS,CACT,IAAIL,EAAerH,KAAKiE,QACnBgC,KAAK,SAAAtJ,GAAK,OAAAA,EAAEoE,QAAUtB,EAAAwH,KAAKS,EAAQ3G,UACxC,GAAIsG,EAAc,CACd,IAAIM,EAASD,EAAQ3H,IAAI6H,IAAIP,EAAatH,KAI1C,OAHAC,KAAKD,IAAI8H,SAASF,GAElB3H,KAAKmF,WAAauC,EACXA,KAKTzH,EAAAtE,UAAAmM,UAAV,SAAoBxH,EAAWC,EAAWQ,GACtC,gBADsCA,MAAsBtB,EAAAuB,YAAYC,QAEpElB,IAAK,IAAIP,EAAAgC,OAAOlB,EAAEC,GAClBQ,OAAMA,EACNgH,OAAQ/H,OAITC,EAAAtE,UAAAqM,UAAP,SAAiB5E,GACbA,EAAO6E,WACH7E,EAAOgE,WAAapH,OACpBoD,EAAOgE,SAAWpH,MAEtBA,KAAKqB,QAAQ5F,KAAK2H,GAClBpD,KAAKkI,cAGFjI,EAAAtE,UAAAwM,kBAAP,WACI,OAAOnI,KAAKqB,QAAQ9F,OAASyE,KAAKuE,eAAehJ,QAG9C0E,EAAAtE,UAAAyM,gBAAP,WAEI,OAAOpI,KAAKuE,eACRvE,KAAKqB,QAAQ9F,SAId0E,EAAAtE,UAAA0M,WAAP,WACI,OAAOrI,KAAKqB,SAGRpB,EAAAtE,UAAAuM,WAAR,eAAA7H,EAAAL,KACQsI,EAAK1I,EAAA2I,kBAAkBtC,KAAK,SAAAuC,GAC5B,IAAIC,KACAC,EAAgBrI,EAAKgB,QAAQ7C,QAMjC,OALAgK,EAAQG,SAASxF,QAAQ,SAAAyF,GACrB,IAAIC,EAAiBH,EAAczC,KAAK,SAAA9I,GAAK,OAAAA,EAAEyL,mBAAmBA,IAC7DC,IAAkBJ,MACvBC,EAAgBhJ,EAAAoJ,cAAcJ,EAAeG,KAE1CJ,IAEPH,IACAtI,KAAKmC,UAAUS,KAAO0F,EAAGS,QAGrC9I,EAxUA,CAA8BT,EAAAwJ,OAAjBlM,EAAAmD,0FCrBb,IAAAgJ,EAAAvM,EAAA,GAgBII,EAAAmD,SAhBKgJ,EAAAhJ,SAET,IAAAiJ,EAAAxM,EAAA,IAgBII,EAAAqM,aAhBKD,EAAAC,aACT,IAAAC,EAAA1M,EAAA,IAgBII,EAAAuM,eAhBKD,EAAAC,eACT,IAAAC,EAAA5M,EAAA,IAgBII,EAAAyM,SAhBKD,EAAAC,SACT,IAAAC,EAAA9M,EAAA,IAgBII,EAAA2M,mBAhBKD,EAAAC,mBACT,IAAAC,EAAAhN,EAAA,IAgBII,EAAA6M,WAhBKD,EAAAC,WACT,IAAAC,EAAAlN,EAAA,IAgBII,EAAA+M,aAhBKD,EAAAC,aACT,IAAAC,EAAApN,EAAA,IAgBII,EAAAiN,WAhBKD,EAAAC,WACT,IAAAC,EAAAtN,EAAA,IAgBII,EAAAmN,SAhBKD,EAAAC,SACT,IAAAC,EAAAxN,EAAA,IAgBII,EAAAqN,gBAhBKD,EAAAC,+FCVT,IAAA3K,EAAA9C,EAAA,GAGM0N,EAAa,SAACC,EAAKC,EAAOC,GAC9B,OAAOF,EAAIG,OAAO,SAASC,EAAMC,GAC/B,IAAIC,GAASL,EAAMI,GAAOA,GAC1B,OAAKD,GAEMF,EAASrO,MAAM,MAAQuO,EAAK,GAAIE,EAAK,MAASF,EAAK,GACpDA,EAFAE,GAMV,MAAM,IAgCV,SAASC,EAAUnE,EAAGpL,EAAGwC,GAEvB,IADA,IAAIF,KACKpB,EAAI,EAAGA,EAAIsB,EAAGtB,IACrBoB,EAAElC,KAAKgL,EAAEpL,EAAIkB,IAEf,OAAOoB,EAlCIb,EAAA+N,MAAQ,SAACR,EAAK/B,GAAO,OAAA8B,EAAWC,EAAK/B,EAAIjE,KAAKyG,MAC9ChO,EAAAiO,MAAQ,SAACV,EAAK/B,GAAO,OAAA8B,EAAWC,EAAK/B,EAAIjE,KAAK2G,MAG9ClO,EAAAmO,OAAS,SAACZ,GAAQ,OAAAA,EAAIhG,KAAKC,MAAMD,KAAK6G,SAAWb,EAAI9O,UAErDuB,EAAAqO,MAAQ,SAACtN,GAAM,OAAAuN,MAAMvN,GAAGwN,KAAK,GAAGnE,IAAI,SAACoE,EAAKC,GAAQ,OAAAA,KAE/DzO,EAAA0K,QAAA,SAA2B7D,EAAgB0G,EAAemB,EAA0BC,GACjF,IAAIC,EAAqBrB,EAEzB,GADIoB,IAAapB,EAAMA,EAAI1I,OAAO8J,IAC9BC,EAED,OAAO5O,EAAA+N,MAAMa,EADU,SAACC,GAAY,OAAAhI,EAAOiI,SAASJ,EAAUG,OAKvD7O,EAAA+O,WAAa,SAAAxB,GAAO,SAAGyB,OAAM5P,SAAImO,IAEjCvN,EAAAgM,cAAgB,SAACuB,EAAKsB,GAAS,OAAAtB,EAAI1I,OAAO,SAAAoK,GAAK,OAAAA,IAAMJ,KAElE7O,EAAAkP,SAAA,SAAyBvF,EAAG5I,GAE1B,IADA,IAAIF,KACKtC,EAAI,EAAGA,EAAIoL,EAAElL,OAASsC,EAAI,EAAGxC,IACpCsC,EAAElC,KAAKmP,EAASnE,EAAGpL,EAAGwC,IAExB,OAAOF,GAWIb,EAAAgI,gBAAkB,SAAC2B,EAAWwF,GAAc,OAAAxF,EAAEmF,SAASK,IAIpEnP,EAAAoP,SAAA,SAAyBpJ,EAA+B2D,EAAWwF,EAAW/O,EAAwBiP,YAAxBjP,MAAWsC,EAAA6C,MAAMC,gBAAO6J,MAAA,GACpGjP,EAAEuJ,EAAI,GACN3D,EAAIsJ,YACJtJ,EAAIuJ,OAAO5F,EAAEnG,EAAGmG,EAAElG,GAClBuC,EAAIwJ,OAAOL,EAAE3L,EAAG2L,EAAE1L,GAClBuC,EAAIyJ,YAAcrP,EAAEsP,SACpB1J,EAAIqJ,UAAYA,EAChBrJ,EAAI2J,UAGN3P,EAAAkG,SAAA,SACEF,EACA4J,EACA/L,EACAD,EACAiM,YAFAhM,MAAA,YACAD,MAAelB,EAAA6C,MAAMC,gBACrBqK,UAEM,IAAArM,EAAAoM,EAAApM,EAAGC,EAAAmM,EAAAnM,EAAGC,EAAAkM,EAAAlM,MAAOC,EAAAiM,EAAAjM,OAQnB,GAAIkM,EAAQ,CACV,IAAIC,EAAOlM,EACXoC,EAAI+J,UAAYD,EAAKJ,SACrB1J,EAAIgK,SACFxM,EACAC,EACAC,EACAC,GAIJ,GAAIE,EAAY,EAAG,CACjB,IAAIyE,EAAO5F,EAAA6C,MAAMC,MACjBQ,EAAIyJ,YAAcnH,EAAKoH,SACvB1J,EAAIqJ,UAAUxL,EAEdmC,EAAIiK,WACFzM,EAAGC,EAAGC,EAAOC,woBCnGnB,IAmCYuM,EAnCZC,EAAAvQ,EAAA,GAEA8C,EAAA9C,EAAA,GACAmD,EAAAnD,EAAA,GAeMwQ,GACFC,UAbiBzQ,EAAQ,IAczB0Q,IAbW1Q,EAAQ,IAcnB2Q,MAbgB3Q,EAAQ,IAcxB4Q,MAbU5Q,EAAQ,IAclB6Q,MAbU7Q,EAAQ,IAclB8Q,KAbS9Q,EAAQ,IAcjB+Q,IAbQ/Q,EAAQ,IAchBgR,OAbWhR,EAAQ,IAcnBiR,OAbWjR,EAAQ,IAcnBkR,MAbUlR,EAAQ,IAclBmR,YAbgBnR,EAAQ,KAiBpB8J,EAAAhH,EAAA6C,MAAAmE,IAAKsH,EAAAtO,EAAA6C,MAAAyL,MAAOC,EAAAvO,EAAA6C,MAAA0L,KAAMC,EAAAxO,EAAA6C,MAAA2L,OAAQC,EAAAzO,EAAA6C,MAAA4L,OAAQC,EAAA1O,EAAA6C,MAAA6L,QAE1C,SAAYlB,GAERA,IAAAmB,KAAA,UAEAnB,IAAAoB,aAAA,kBACApB,IAAAqB,gBAAA,qBACArB,IAAAsB,aAAA,kBACAtB,IAAAuB,YAAA,iBAPJ,CAAYvB,EAAAlQ,EAAAkQ,mBAAAlQ,EAAAkQ,sBAUZ,IAAAwB,EAAA,WACIxO,KAAA5C,KAAe,iBACf4C,KAAAyO,YAAsB,wBACtBzO,KAAAU,MAAelB,EAAA6C,MAAMqM,UAErB1O,KAAAb,KAAmBU,EAAApB,WAAWK,MAE9BkB,KAAA2O,SAA0B,KAC1B3O,KAAA4O,SAA0B,KAI1B5O,KAAA6O,eAAyB,IACzB7O,KAAA8O,SAAmB,IACnB9O,KAAA+O,SAAmB,EAEnB/O,KAAAgP,SAA6BhC,EAAiBmB,KAE9CnO,KAAAiP,MAAQ/B,EAAOE,IAEfpN,KAAAkP,WAEAlP,KAAAmP,QAAmBlC,EAAAmC,cAEnBpP,KAAAqP,YAxBSvS,EAAA0R,UA2Bb,IAAAc,EAAA,SAAApP,GAAA,SAAAoP,IAAA,IAAAjP,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,UACPiD,EAAAoO,YAAc,sBACdpO,EAAA2O,SAAWhC,EAAiBqB,gBAC5BhO,EAAA4O,MAAQ/B,EAAOG,MAEfhN,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,GAC5BC,QAAUF,OAAQ,EAAGC,OAAQ,GAE7BE,MAAQH,OAAQ,EAAGC,OAAQ,KAAA5D,EAEnC,OAdmCrJ,EAAA4M,EAAApP,GAcnCoP,EAdA,CAAmCd,GAAtB1R,EAAAwS,gBAmBb,IAAAQ,EAAA,SAAA5P,GAAA,SAAA4P,IAAA,IAAAzP,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,eACPiD,EAAAoO,YAAc,eACdpO,EAAA4O,MAAQ/B,EAAOE,IACf/M,EAAA6O,SAAYa,EAAwBC,GAEpC3P,EAAAgP,WACAhP,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHQ,QAAUF,OAAQ,EAAGC,OAAQ,GAC7BF,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAZqCrJ,EAAAoN,EAAA5P,GAYrC4P,EAZA,CAAqCtB,GAAxB1R,EAAAgT,kBAcb,IAAAE,EAAA,SAAA9P,GAAA,SAAA8P,IAAA,IAAA3P,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,aACPiD,EAAAoO,YAAc,kBAEdpO,EAAAgP,WACAhP,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAT+BrJ,EAAAsN,EAAA9P,GAS/B8P,EATA,CAA+BxB,GAAlB1R,EAAAkT,YAYb,IAAAD,EAAA,SAAA7P,GAAA,SAAA6P,IAAA,IAAA1P,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,gBACPiD,EAAAoO,YAAc,eACdpO,EAAA6O,SAAYc,GAEZ3P,EAAAgP,WACAhP,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHa,OAASP,OAAQ,EAAGC,OAAQ,GAC5BF,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAX4CrJ,EAAAqN,EAAA7P,GAW5C6P,EAXA,CAA4CvB,GAA/B1R,EAAAiT,yBAcb,IAAAG,EAAA,SAAAhQ,GAAA,SAAAgQ,IAAA,IAAA7P,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAsO,SAAW1B,EAAAkD,cAAcC,WACzB/P,EAAAuO,SAAW3B,EAAAkD,cAAcE,OAC7B,OAHkC3N,EAAAwN,EAAAhQ,GAGlCgQ,EAHA,CAAkC1B,GAArB1R,EAAAoT,eAKb,IAAAI,EAAA,SAAApQ,GAAA,SAAAoQ,IAAA,IAAAjQ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,OACPiD,EAAAoO,YAAc,cACdpO,EAAA4O,MAAQ/B,EAAOG,MACfhN,EAAA6O,SAAYY,KAGhB,OAP0BpN,EAAA4N,EAAApQ,GAO1BoQ,EAPA,CAA0BJ,GAAbpT,EAAAwT,OASb,IAAAC,EAAA,SAAArQ,GAAA,SAAAqQ,IAAA,IAAAlQ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,cACPiD,EAAAoO,YAAc,eACdpO,EAAA6O,SAAYsB,GACZnQ,EAAAK,MAAQqN,EACR1N,EAAA4O,MAAQ/B,EAAOW,cACnB,OANiCnL,EAAA6N,EAAArQ,GAMjCqQ,EANA,CAAiCL,GAApBpT,EAAAyT,cAUb,IAAAC,EAAA,SAAAtQ,GAAA,SAAAsQ,IAAA,IAAAnQ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,QACPiD,EAAAoO,YAAc,aACdpO,EAAAuO,SAAW3B,EAAAkD,cAAcC,WACzB/P,EAAA4O,MAAQ/B,EAAOC,UACf9M,EAAA6O,SAAYY,EAAiBQ,GAC7BjQ,EAAAK,MAAQqN,IACZ,OAP+BrL,EAAA8N,EAAAtQ,GAO/BsQ,EAPA,CAA+BhC,GAAlB1R,EAAA0T,YAUb,IAAAC,EAAA,SAAAvQ,GAAA,SAAAuQ,IAAA,IAAApQ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,SACPiD,EAAAoO,YAAc,cACdpO,EAAA2O,SAAWhC,EAAiBsB,aAC5BjO,EAAA4O,MAAQ/B,EAAOQ,OACfrN,EAAA6O,SAAWsB,GACXnQ,EAAAK,MAAQwN,EACR7N,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAX4BrJ,EAAA+N,EAAAvQ,GAW5BuQ,EAXA,CAA4BjC,GAAf1R,EAAA2T,SAab,IAAAC,EAAA,SAAAxQ,GAAA,SAAAwQ,IAAA,IAAArQ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,QACPiD,EAAAoO,YAAc,cACdpO,EAAAsO,SAAW1B,EAAAkD,cAAcQ,KACzBtQ,EAAAuO,SAAW3B,EAAAkD,cAAcS,KACzBvQ,EAAA4O,MAAQ/B,EAAOI,MAEfjN,EAAA6O,SAAWsB,EAAWC,GACtBpQ,EAAAK,MAAQwN,EACR7N,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAb2BrJ,EAAAgO,EAAAxQ,GAa3BwQ,EAbA,CAA2BlC,GAAd1R,EAAA4T,QAeb,IAAAG,EAAA,SAAA3Q,GAAA,SAAA2Q,IAAA,IAAAxQ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,MACPiD,EAAAoO,YAAc,eACdpO,EAAA4O,MAAQ/B,EAAOO,IACfpN,EAAA6O,SAAYY,GACZzP,EAAAK,MAAQsN,EACR3N,EAAA8O,QAAOK,KACAvC,EAAAmC,eACH0B,SAAWpB,OAAQ,EAAGC,OAAQ,KAAA5D,EAEtC,OAVyBrJ,EAAAmO,EAAA3Q,GAUzB2Q,EAVA,CAAyBrC,GAAZ1R,EAAA+T,MAYb,IAAAE,EAAA,SAAA7Q,GAAA,SAAA6Q,IAAA,IAAA1Q,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,cACPiD,EAAAoO,YAAc,UACdpO,EAAA6O,SAAY2B,GACZxQ,EAAAuO,SAAW3B,EAAAkD,cAAcQ,KACzBtQ,EAAA0O,SAAW,EACX1O,EAAAK,MAAQoN,EACRzN,EAAA4O,MAAQ/B,EAAOU,MACfvN,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHQ,QAAUF,OAAQ,EAAGC,OAAQ,KAAA5D,EAErC,OAZgCrJ,EAAAqO,EAAA7Q,GAYhC6Q,EAZA,CAAgCvC,GAAnB1R,EAAAiU,aAiBb,IAAAC,EAAA,SAAA9Q,GAAA,SAAA8Q,IAAA,IAAA3Q,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,kBACPiD,EAAAoO,YAAc,YACdpO,EAAAuO,SAAW3B,EAAAkD,cAAcC,WACzB/P,EAAA2O,SAAWhC,EAAiBuB,YAC5BlO,EAAA4O,MAAQ/B,EAAOS,OACftN,EAAA6O,SAAWsB,GACXnQ,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAAK,MAAQqN,EACR1N,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAboCrJ,EAAAsO,EAAA9Q,GAapC8Q,EAbA,CAAoCxC,GAAvB1R,EAAAkU,iBAeb,IAAAC,EAAA,SAAA/Q,GAAA,SAAA+Q,IAAA,IAAA5Q,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACGK,EAAAjD,KAAO,UACPiD,EAAAoO,YAAc,iBACdpO,EAAAuO,SAAW3B,EAAAkD,cAAcQ,KACzBtQ,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAA6O,SAAWgC,GACX7Q,EAAAK,MAAQoN,EACPzN,EAAAgP,WACAhP,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAZ6BrJ,EAAAuO,EAAA/Q,GAY7B+Q,EAZA,CAA6BzC,GAAhB1R,EAAAmU,UAcb,IAAAE,EAAA,SAAAjR,GAAA,SAAAiR,IAAA,IAAA9Q,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACGK,EAAAjD,KAAO,QACPiD,EAAAoO,YAAc,qBACdpO,EAAAsO,SAAW1B,EAAAkD,cAAcQ,KACzBtQ,EAAAuO,SAAW3B,EAAAkD,cAAcS,KACzBvQ,EAAA4O,MAAQ/B,EAAOK,MACflN,EAAA6O,SAAW+B,GACX5Q,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAAK,MAAQsN,EACP3N,EAAAgP,WACAhP,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,GAC5BM,OAASP,OAAQ,EAAGC,OAAQ,GAC5BmB,SAAWpB,OAAQ,EAAGC,OAAQ,KAAA5D,EAEtC,OAhB2BrJ,EAAAyO,EAAAjR,GAgB3BiR,EAhBA,CAA2B3C,GAAd1R,EAAAqU,QAkBb,IAAAC,EAAA,SAAAlR,GAAA,SAAAkR,IAAA,IAAA/Q,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,QACPiD,EAAAoO,YAAc,yBACdpO,EAAAuO,SAAW3B,EAAAkD,cAAcQ,KACzBtQ,EAAA6O,SAAW+B,GACX5Q,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAAK,MAAQoN,EACRzN,EAAAgP,WAAUtD,EACd,OAR2BrJ,EAAA0O,EAAAlR,GAQ3BkR,EARA,CAA2B5C,GAAd1R,EAAAsU,QAUb,IAAAF,EAAA,SAAAhR,GAAA,SAAAgR,IAAA,IAAA7Q,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,YACPiD,EAAAoO,YAAc,wBACdpO,EAAAuO,SAAW3B,EAAAkD,cAAcQ,KACzBtQ,EAAA6O,SAAYY,EAAiBU,EAAWC,GACxCpQ,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAAK,MAAQuN,EACR5N,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAX8BrJ,EAAAwO,EAAAhR,GAW9BgR,EAXA,CAA8B1C,GAAjB1R,EAAAoU,WAab,IAAAG,EAAA,SAAAnR,GAAA,SAAAmR,IAAA,IAAAhR,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,SACPiD,EAAAoO,YAAc,YACdpO,EAAAuO,SAAW3B,EAAAkD,cAAcQ,KACzBtQ,EAAA6O,SAAYY,EAAiBU,GAC7BnQ,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAAK,MAAQoN,IACZ,OAP4BpL,EAAA2O,EAAAnR,GAO5BmR,EAPA,CAA4B7C,GAAf1R,EAAAuU,SASb,IAAAC,EAAA,SAAApR,GAAA,SAAAoR,IAAA,IAAAjR,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,cACPiD,EAAAoO,YAAc,cACdpO,EAAA2O,SAAWhC,EAAiBoB,aAC5B/N,EAAAkR,eAAiB,KACjBlR,EAAA4O,MAAQ/B,EAAOE,IACf/M,EAAA6O,SAAWgC,GACX7Q,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAAK,MAAQuN,EACR5N,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAbgCrJ,EAAA4O,EAAApR,GAahCoR,EAbA,CAAgC9C,GAAnB1R,EAAAwU,aAgBb,IAAAE,EAAA,SAAAtR,GAAA,SAAAsR,IAAA,IAAAnR,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,aACPiD,EAAAoO,YAAc,gBACdpO,EAAAsO,SAAW1B,EAAAkD,cAAcsB,IACzBpR,EAAAuO,SAAW3B,EAAAkD,cAAcuB,QACzBrR,EAAAlB,KAAOU,EAAApB,WAAWM,OAClBsB,EAAAK,MAAQ8F,EACRnG,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAGpC,OAZgCrJ,EAAA8O,EAAAtR,GAYhCsR,EAZA,CAAgChD,GAAnB1R,EAAA0U,aAsBb,IAAAG,EAAA,SAAAzR,GAAA,SAAAyR,IAAA,IAAAtR,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,eACPiD,EAAAoO,YAAc,WACdpO,EAAAlB,KAAOU,EAAApB,WAAWO,MAClBqB,EAAA6O,SAAYsC,GACZnR,EAAAuO,SAAW3B,EAAAkD,cAAcsB,IACzBpR,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAGpC,OAXiCrJ,EAAAiP,EAAAzR,GAWjCyR,EAXA,CAAiCnD,GAApB1R,EAAA6U,cAab,IAAAC,EAAA,SAAA1R,GAAA,SAAA0R,IAAA,IAAAvR,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,kBACPiD,EAAAlB,KAAOU,EAAApB,WAAWO,MAClBqB,EAAA6O,SAAYsC,GACZnR,EAAAK,MAAQ8F,EACRnG,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHK,OAASC,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAToCrJ,EAAAkP,EAAA1R,GASpC0R,EATA,CAAoCpD,GAAvB1R,EAAA8U,iBAWb,IAAAC,EAAA,SAAA3R,GAAA,SAAA2R,IAAA,IAAAxR,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,WACPiD,EAAAlB,KAAOU,EAAApB,WAAWO,MAClBqB,EAAA6O,SAAYkC,GACZ/Q,EAAAK,MAAQoN,EACRzN,EAAAgP,WACAhP,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHa,OAASP,OAAQ,EAAGC,OAAQ,KAAA5D,EAEpC,OAV8BrJ,EAAAmP,EAAA3R,GAU9B2R,EAVA,CAA8BrD,GAAjB1R,EAAA+U,WAcb,IAAAC,EAAA,SAAA5R,GAAA,SAAA4R,IAAA,IAAAzR,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,YACPiD,EAAAlB,KAAOU,EAAApB,WAAWQ,KAClBoB,EAAA6O,SAAY0C,GACZvR,EAAAK,MAAQsN,EACR3N,EAAAgP,WACAhP,EAAA8O,QAAOK,KACAvC,EAAAmC,eACHa,OAASP,OAAQ,EAAGC,OAAQ,GAC5BF,OAASC,OAAQ,EAAGC,OAAQ,GAC5BoC,KAAOrC,OAAQ,EAAGC,OAAQ,GAC1BE,MAAQH,OAAQ,EAAGC,OAAQ,GAC3BqC,QAAUtC,OAAQ,EAAGC,OAAQ,GAC7BsC,QAAUvC,OAAQ,EAAGC,OAAQ,KAAA5D,EAErC,OAf+BrJ,EAAAoP,EAAA5R,GAe/B4R,EAfA,CAA+BtD,GAAlB1R,EAAAgV,YAiBb,IAAAI,EAAA,SAAAhS,GAAA,SAAAgS,IAAA,IAAA7R,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,gBACPiD,EAAAlB,KAAOU,EAAApB,WAAWQ,KAClBoB,EAAA6O,SAAY0C,GACZvR,EAAAK,MAAQqN,IACZ,OALkCrL,EAAAwP,EAAAhS,GAKlCgS,EALA,CAAkC1D,GAArB1R,EAAAoV,eASApV,EAAAqV,aACTjB,EACAE,EACAP,EACAL,EACAW,EACAG,EACAhB,EACAkB,EACAf,EACAM,EACAa,EACAD,EACAV,EACAnB,EACA+B,EACAb,EACAhB,EACAU,EACAX,EACAQ,EACAuB,EACAI,EACAb,iCCzaJ,IAAYrQ,mDAAZ,SAAYA,GAAcA,IAAAoR,KAAA,UAAMpR,IAAAqR,GAAA,QAAIrR,IAAAC,MAAA,WAAOD,IAAAsR,KAAA,UAA3C,CAAYtR,EAAAlE,EAAAkE,cAAAlE,EAAAkE,iBAEClE,EAAAyK,SACTvG,EAAYoR,KACZpR,EAAYC,MACZD,EAAYqR,GACZrR,EAAYsR,MAIhBxV,EAAAmK,KAAA,SAAqBsL,GACjB,OAAQA,GACJ,KAAKvR,EAAYoR,KAAM,OAAOpR,EAAYC,MAC1C,KAAKD,EAAYC,MAAO,OAAOD,EAAYoR,KAC3C,KAAKpR,EAAYqR,GAAI,OAAOrR,EAAYsR,KACxC,KAAKtR,EAAYsR,KAAM,OAAOtR,EAAYqR,GAE9C,MAAM,IAAIG,MAAM,0BAA2BD,mFClB/C,IAGYE,EAHZjT,EAAA9C,EAAA,IAGA,SAAY+V,GACRA,EAAAhD,MAAA,QACAgD,EAAA7C,OAAA,SACA6C,EAAAxC,MAAA,QACAwC,EAAA3B,QAAA,UACA2B,EAAA5C,KAAA,OACA4C,EAAAV,IAAA,MACAU,EAAAC,OAAA,SACAD,EAAAE,OAAA,SACAF,EAAAT,OAAA,SACAS,EAAAR,OAAA,SAVJ,CAAYQ,EAAA3V,EAAA2V,YAAA3V,EAAA2V,eAkBZ3V,EAAAsS,YAAA,WACI,OACIK,OAASC,OAAQ,EAAGC,OAAQ,GAC5BC,QAAUF,OAAQ,EAAGC,OAAQ,GAC7BM,OAASP,OAAQ,EAAGC,OAAQ,GAC5BmB,SAAWpB,OAAQ,EAAGC,OAAQ,GAC9BE,MAAQH,OAAQ,EAAGC,OAAQ,GAC3BoC,KAAOrC,OAAQ,EAAGC,OAAQ,GAC1BgD,QAAUjD,OAAQ,EAAGC,OAAQ,GAC7B+C,QAAUhD,OAAQ,EAAGC,OAAQ,GAC7BqC,QAAUtC,OAAQ,EAAGC,OAAQ,GAC7BsC,QAAUvC,OAAQ,EAAGC,OAAQ,KAIrC7S,EAAA8V,kBAAA,SAAkCC,EAAiBjV,GAC/C,OAAOiV,EAAOjV,GAAO8R,OAASmD,EAAOjV,GAAO+R,QAGnC7S,EAAAgW,WAAoD,SAACC,EAAIC,GAClE,IAAIC,GAlBAxD,OAASC,OAAQ,EAAGC,OAAQ,GAC5BC,QAAUF,OAAQ,EAAGC,OAAQ,GAC7BM,OAASP,OAAQ,EAAGC,OAAQ,GAC5BmB,SAAWpB,OAAQ,EAAGC,OAAQ,GAC9BE,MAAQH,OAAQ,EAAGC,OAAQ,GAC3BoC,KAAOrC,OAAQ,EAAGC,OAAQ,GAC1BgD,QAAUjD,OAAQ,EAAGC,OAAQ,GAC7B+C,QAAUhD,OAAQ,EAAGC,OAAQ,GAC7BqC,QAAUtC,OAAQ,EAAGC,OAAQ,GAC7BsC,QAAUvC,OAAQ,EAAGC,OAAQ,IAUjC,IAAK,IAAI/R,KAAS6U,EAAW,CACrB,IAAAzN,EAAA+N,EAAAnV,GAAEsV,EAAAlO,EAAA0K,OAAYyD,EAAAnO,EAAA2K,OACdyD,EAAAJ,EAAApV,GACA8R,EAASwD,EADPE,EAAA1D,OAEFC,EAASwD,EAFKC,EAAAzD,OAGlBsD,EAAUrV,IACN8R,OAAMA,EACNC,OAAMA,GAGd,OAAOsD,GAGX,SAAY9C,GAERA,EAAAQ,KAAA,OACAR,EAAAsB,IAAA,MACAtB,EAAAE,KAAA,OAEAF,EAAAS,KAAA,OACAT,EAAAC,WAAA,aACAD,EAAAuB,QAAA,UACAvB,EAAAkD,MAAA,QATJ,CAAYvW,EAAAqT,gBAAArT,EAAAqT,mBAYZ,IAAMmD,GACF3C,KAAMnR,EAAA6C,MAAMyL,MACZuC,KAAM7Q,EAAA6C,MAAM0L,KACZ2D,QAASlS,EAAA6C,MAAMmE,IAEfoK,KAAMpR,EAAA6C,MAAM6L,OAAOzL,OAAO,IAC1B2N,WAAY5Q,EAAA6C,MAAM4L,OAAOxL,OAAO,IAChCgP,IAAKjS,EAAA6C,MAAMmE,IAAI/D,OAAO,IAEtB4Q,MAAO7T,EAAA6C,MAAMqM,UAAUjM,OAAO,KAGlC3F,EAAAyW,WAAA,SAA2BC,GASvB,OARgBF,EAAYE,GAQXC,WAAW,KAAMrN,QAAQ,iBAAAsN,EAAA3H,EAAAlO,GAAA,iBAAAF,EAAAL,EAAA0C,WAAA0C,YAAA/E,EAAA,SAAA+V,EAAA3H,GAAA,OAAApO,EAAAjC,OAAAiY,iBAAAC,wBAAAxI,OAAA,SAAAsI,EAAA3H,GAAA2H,EAAAE,UAAA7H,IAAA,SAAA2H,EAAA3H,GAAA,QAAAlO,KAAAkO,IAAAnQ,eAAAiC,KAAA6V,EAAA7V,GAAAkO,EAAAlO,MAAA6V,EAAA3H,IAAA,SAAA2H,EAAA3H,GAAA,SAAAlO,IAAAmC,KAAA6T,YAAAH,EAAA/V,EAAA+V,EAAA3H,GAAA2H,EAAA/X,UAAA,OAAAoQ,EAAArQ,OAAAoY,OAAA/H,IAAAlO,EAAAlC,UAAAoQ,EAAApQ,UAAA,IAAAkC,KAAAnC,OAAA6B,eAAAwO,EAAA,cAAAnO,OAAA,ICxF9C,IAAA4B,EAAA9C,EAAA,GAEAgC,EAAAhC,EAAA,GACA+C,EAAA/C,EAAA,GACAqX,EAAArX,EAAA,GAEAmD,EAAAnD,EAAA,GAEQiC,EAAAD,EAAAE,MAAAD,MAAOE,EAAAH,EAAAE,MAAAC,MAETmV,EAAgBD,EAAA5B,YAAYxQ,OAAO,SAAAiH,GAAW,WAAKA,GAAWzJ,OAASU,EAAApB,WAAWK,QAClFmV,EAAiBF,EAAA5B,YAAYxQ,OAAO,SAAAiH,GAAW,WAAKA,GAAWzJ,OAASU,EAAApB,WAAWM,SACnFmV,EAAgBH,EAAA5B,YAAYxQ,OAAO,SAAAiH,GAAW,WAAKA,GAAWzJ,OAASU,EAAApB,WAAWO,QAClFmV,EAAeJ,EAAA5B,YAAYxQ,OAAO,SAAAiH,GAAW,WAAKA,GAAWzJ,OAASU,EAAApB,WAAWQ,OAEjFmV,EAAYJ,EAAcrS,OAAO,SAAAiH,GAAW,WAAKA,GAAWyG,UAC5DgF,EAAaL,EAAcrS,OAAO,SAAAiH,GAAW,YAAMA,GAAWyG,UAE9DiF,EAAUL,EAAetS,OAAO,SAAAiH,GAAW,WAAKA,GAAWyG,UAC3DkF,EAAWN,EAAetS,OAAO,SAAAiH,GAAW,YAAMA,GAAWyG,UAE7DmF,EAAYN,EAAcvS,OAAO,SAAAiH,GAAW,WAAKA,GAAWyG,UAC5DoF,EAAaP,EAAcvS,OAAO,SAAAiH,GAAW,YAAMA,GAAWyG,UAE9DqF,EAAWP,EAAaxS,OAAO,SAAAiH,GAAW,WAAKA,GAAWyG,UAC1DsF,EAAYR,EAAaxS,OAAO,SAAAiH,GAAW,YAAMA,GAAWyG,UAElEuF,EAAA,eAAAlB,EACI1T,KAAA5C,KAAe,mBACf4C,KAAAyO,YAAsB,0BACtBzO,KAAA6U,KAAe,0BACf7U,KAAAQ,MAAgB,GAChBR,KAAAS,OAAiB,GACjBT,KAAA8U,KAAe,EACf9U,KAAAU,MAAelB,EAAA6C,MAAM0S,KAErB/U,KAAA2O,SAA0B,KAC1B3O,KAAA4O,SAA0B,KAC1B5O,KAAAuR,eAAyB,IAIzBvR,KAAA0G,cAAW1B,MACNvF,EAAAuB,YAAYoR,OAAS4C,GACtBhQ,EAACvF,EAAAuB,YAAYC,QAAU+T,GACvBhQ,EAACvF,EAAAuB,YAAYqR,KAAO4C,GACpBjQ,EAACvF,EAAAuB,YAAYsR,OAAS2C,MAG1BjV,KAAA2I,YAEA3I,KAAAkP,YAxBSpS,EAAA8X,YA8Bb,IAAAM,EAAA,SAAAhV,GAAA,SAAAgV,UAAA7U,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAe,cACfiD,EAAAoO,YAAsB,YACtBpO,EAAAwU,KAAe,aACfxU,EAAAG,MAAgB7B,EAAMwW,OACtB9U,EAAAI,OAAiB9B,EAAMY,OACvBc,EAAAyU,KAAO,IACPzU,EAAAqG,cAAW1B,MACNvF,EAAAuB,YAAYoR,OAAS4C,GACtBhQ,EAACvF,EAAAuB,YAAYC,QAAU+T,GACvBhQ,EAACvF,EAAAuB,YAAYqR,KAAO+C,GACpBpQ,EAACvF,EAAAuB,YAAYsR,cAErB,OAbgC5P,EAAAwS,EAAAhV,GAahCgV,EAbA,CAAgCN,GAAnB9X,EAAAoY,aAgBb,IAAAG,EAAA,SAAAnV,GAAA,SAAAmV,UAAAhV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAe,OACfiD,EAAAoO,YAAsB,gBACtBpO,EAAAwU,KAAe,kBACfxU,EAAAG,MAAgB3B,EAAMyW,MACtBjV,EAAAI,OAAiB5B,EAAM0W,MACvBlV,EAAAqG,cAAW1B,MACNvF,EAAAuB,YAAYoR,OAASoD,EAAMJ,GAC5BpQ,EAACvF,EAAAuB,YAAYC,QAAWuU,EAAMJ,GAC9BpQ,EAACvF,EAAAuB,YAAYqR,OACbrN,EAACvF,EAAAuB,YAAYsR,cAErB,OAZiC5P,EAAA2S,EAAAnV,GAYjCmV,EAZA,CAAiCT,GAApB9X,EAAAuY,cAcb,IAAAL,EAAA,SAAA9U,GAAA,SAAA8U,UAAA3U,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAe,WACfiD,EAAAoO,YAAsB,iBACtBpO,EAAAwU,KAAe,eACfxU,EAAAG,MAAgB3B,EAAMyW,MACtBjV,EAAAI,OAAiB5B,EAAMQ,MACvBgB,EAAAyU,KAAO,GACPzU,EAAAqG,cAAW1B,MACNvF,EAAAuB,YAAYoR,OACT8C,EACAO,GAEJzQ,EAACvF,EAAAuB,YAAYC,QACTiU,EACAO,GAEJzQ,EAACvF,EAAAuB,YAAYqR,OACbrN,EAACvF,EAAAuB,YAAYsR,YAEjBjS,EAAA6O,SAAWmG,KACf,OApB8B3S,EAAAsS,EAAA9U,GAoB9B8U,EApBA,CAA8BJ,GAAjB9X,EAAAkY,WAsBb,IAAAC,EAAA,SAAA/U,GAAA,SAAA+U,UAAA5U,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,SACPiD,EAAAoO,YAAc,qBACdpO,EAAAwU,KAAO,aACPxU,EAAAG,MAAQ3B,EAAMQ,MACdgB,EAAAI,OAAS,IAAM9B,EAAMU,MACrBgB,EAAAyU,KAAO,GACPzU,EAAAqG,cAAW1B,MACNvF,EAAAuB,YAAYqR,KAAOoD,GACpBzQ,EAACvF,EAAAuB,YAAYsR,OAASmD,GACtBzQ,EAACvF,EAAAuB,YAAYoR,SACbpN,EAACvF,EAAAuB,YAAYC,aAEjBZ,EAAA6O,SAAW8F,EAAUU,KACzB,OAd4BhT,EAAAuS,EAAA/U,GAc5B+U,EAdA,CAA4BL,GAAf9X,EAAAmY,SAkBb,IAAAO,EAAA,SAAAtV,GAAA,SAAAsV,UAAAnV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YAEIK,EAAAoO,YAAsB,oBAGtBpO,EAAAwU,KAAe,WACfxU,EAAAG,MAAiB,EAAI7B,EAAMY,OAC3Bc,EAAAI,OAAiB9B,EAAMY,OACvBc,EAAAyU,KAAO,GACPzU,EAAAqG,cAAW1B,MACNvF,EAAAuB,YAAYoR,OAASiD,GACtBrQ,EAACvF,EAAAuB,YAAYC,QAAUoU,GACvBrQ,EAACvF,EAAAuB,YAAYqR,OACbrN,EAACvF,EAAAuB,YAAYsR,YAGjBjS,EAAAsI,UACIoL,EAAA/D,UACA+D,EAAAjE,gBAAiBiE,EAAAhE,0BAGzB,OArBmBrN,EAAA8S,EAAAtV,GAqBnBsV,EArBA,CAAmBZ,GAwBnBa,EAAA,SAAAvV,GAAA,SAAAuV,UAAApV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAe,UACfiD,EAAAoO,YAAsB,cACtBpO,EAAAwU,KAAe,iBACfxU,EAAAG,MAAgB7B,EAAMY,OACtBc,EAAAI,OAAiB9B,EAAM2W,MAEvBjV,EAAAqG,cAAW1B,MACNvF,EAAAuB,YAAYoR,OACT4C,EAAUS,GAEdzQ,EAACvF,EAAAuB,YAAYC,QACT+T,EACAS,GAEJzQ,EAACvF,EAAAuB,YAAYqR,KAAO4C,GACpBjQ,EAACvF,EAAAuB,YAAYsR,OAAS2C,MAG1B5U,EAAAsI,YAUAtI,EAAA6O,aAGJ,OAhCyBxM,EAAA+S,EAAAvV,GAgCzBuV,EAhCA,CAAyBb,GAkCzBe,EAAA,SAAAzV,GAAA,SAAAyV,IAAA,IAAAtV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,eACPiD,EAAAG,MAAQ7B,EAAMY,OACdc,EAAA6O,SAAY0G,GACZvV,EAAAsI,SAAW0L,IAEf,OANkC3R,EAAAiT,EAAAzV,GAMlCyV,EANA,CAAkCF,GAArB3Y,EAAA6Y,eAQb,IAAAD,EAAA,SAAAxV,GAAA,SAAAwV,IAAA,IAAArV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,eACPiD,EAAA6O,SAAWyG,GACXtV,EAAAwU,KAAO,qBACPxU,EAAAG,MAAQ,EAAI7B,EAAMY,OAClBc,EAAAsI,SAAW0L,IACf,OANoC3R,EAAAgT,EAAAxV,GAMpCwV,EANA,CAAoCD,GAAvB3Y,EAAA4Y,iBAQb,IAAAG,EAAA,SAAA3V,GAAA,SAAA2V,IAAA,IAAAxV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,WACPiD,EAAA6O,SAAYwG,GACZrV,EAAAwU,KAAO,iBACPxU,EAAAG,MAAQ,EAAI7B,EAAMY,OAClBc,EAAAI,OAAS,EAAI9B,EAAMU,MAGnBgB,EAAAsI,SAAW4L,IACf,OATgC7R,EAAAmT,EAAA3V,GAShC2V,EATA,CAAgCJ,GAAnB3Y,EAAA+Y,aAWb,IAAAC,EAAA,SAAA5V,GAAA,SAAA4V,IAAA,IAAAzV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,WACPiD,EAAAwU,KAAO,gBACPxU,EAAA6O,SAAY2G,GACZxV,EAAAG,MAAQ,EAAI7B,EAAMY,OAClBc,EAAAI,OAAS,EAAI9B,EAAM2W,MAGnBjV,EAAAsI,SAAW8L,IAMf,OAd+B/R,EAAAoT,EAAA5V,GAc/B4V,EAdA,CAA+BL,GAAlB3Y,EAAAgZ,YAgBb,IAAAC,EAAA,SAAA7V,GAAA,SAAA6V,IAAA,IAAA1V,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,YACPiD,EAAAwU,KAAO,eACPxU,EAAAG,MAAQ,GAAK7B,EAAMY,OACnBc,EAAAI,OAAS,EAAI9B,EAAMY,OAEnBc,EAAA6O,SAAW4G,GACXzV,EAAAsI,SAAWgM,IAEf,OAT8BjS,EAAAqT,EAAA7V,GAS9B6V,EATA,CAA8BN,GAAjB3Y,EAAAiZ,WAab,IAAAH,EAAA,SAAA1V,GAAA,SAAA0V,IAAA,IAAAvV,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,WACPiD,EAAAG,MAAQ,EAAI7B,EAAMY,OAClBc,EAAAI,OAAS,EAAI9B,EAAMY,OACnBc,EAAAsI,SAAWyL,IACf,OAL+B1R,EAAAkT,EAAA1V,GAK/B0V,EALA,CAA+BJ,GAAlB1Y,EAAA8Y,YAOb,IAAAI,EAAA,SAAA9V,GAAA,SAAA8V,IAAA,IAAA3V,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,eACPiD,EAAAwU,KAAO,qBACPxU,EAAAG,MAAQ,EAAI7B,EAAMsX,QAClB5V,EAAAI,OAAS,EAAI9B,EAAMsX,QACnB5V,EAAAsI,SAAWyL,IACf,OANoC1R,EAAAsT,EAAA9V,GAMpC8V,EANA,CAAoCR,GAAvB1Y,EAAAkZ,iBAQb,IAAAE,EAAA,SAAAhW,GAAA,SAAAgW,IAAA,IAAA7V,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,WACPiD,EAAAwU,KAAO,cACPxU,EAAAG,MAAQ,EAAI7B,EAAMY,OAClBc,EAAAI,OAAS,EAAI9B,EAAMY,OACnBc,EAAA6O,SAAY0G,EAAWC,GAOvBxV,EAAAsI,SAAW2L,IACf,OAb6B5R,EAAAwT,EAAAhW,GAa7BgW,EAbA,CAA6BV,GAAhB1Y,EAAAoZ,UAeb,IAAAC,EAAA,SAAAjW,GAAA,SAAAiW,IAAA,IAAA9V,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,WACPiD,EAAAwU,KAAO,cACPxU,EAAAG,MAAQ,EAAI7B,EAAMY,OAClBc,EAAAI,OAAS,EAAI9B,EAAMY,OACnBc,EAAA6O,SAAWgH,EAASJ,GACpBzV,EAAAsI,SAAW6L,IACf,OAP+B9R,EAAAyT,EAAAjW,GAO/BiW,EAPA,CAA+BX,GAAlB1Y,EAAAqZ,YASb,IAAAC,EAAA,SAAAlW,GAAA,SAAAkW,IAAA,IAAA/V,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAO,WACPiD,EAAAwU,KAAO,eACPxU,EAAAG,MAAQ,GAAK7B,EAAMY,OACnBc,EAAAI,OAAS,GAAK9B,EAAMY,OACpBc,EAAA6O,SAAWiH,EAAWJ,GACtB1V,EAAAsI,SAAW+L,IAIf,OAV8BhS,EAAA0T,EAAAlW,GAU9BkW,EAVA,CAA8BZ,GAAjB1Y,EAAAsZ,WAcb,IAAAhB,EAAA,SAAAlV,GAAA,SAAAkV,UAAA/U,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAjD,KAAe,kBACfiD,EAAAoO,YAAsB,8BACtBpO,EAAAwU,KAAe,qBACfxU,EAAAG,MAAgB,EAAI7B,EAAMY,OAC1Bc,EAAAI,OAAiB,EAAI9B,EAAMW,MAC3Be,EAAAyU,KAAO,GACPzU,EAAAqG,cAAW1B,MACNvF,EAAAuB,YAAYoR,OAASiD,GACtBrQ,EAACvF,EAAAuB,YAAYC,QAAUoU,GACvBrQ,EAACvF,EAAAuB,YAAYqR,KAAO6C,GACpBlQ,EAACvF,EAAAuB,YAAYsR,OAAS4C,MAG1B7U,EAAAsI,UAAaoL,EAAAzE,iBACjB,OAfoC5M,EAAA0S,EAAAlV,GAepCkV,EAfA,CAAoCR,GAAvB9X,EAAAsY,iBAiBAtY,EAAAuZ,eAELT,EACAI,EACAE,EACAC,EACAC,EAEAT,EACAD,EACAG,EACAC,EACAC,kFC1SKjZ,EAAA8B,OACTD,OAtBA4W,MAJc,GAKdJ,OAAQmB,GACRjX,MAAOiX,GACPC,OAAQD,GACRhB,MAAOgB,GACPhX,MAAOgX,GACPL,QAASK,IACT/W,OAAQ+W,KAgBRzX,OAZA0W,MAdc,EAedJ,OAASqB,EACTnX,MAASmX,GACTD,OAASC,GACTlB,MAASkB,GACTlX,MAASkX,GACTP,QAASO,GACTjX,OAASiX,MAKFC,8ZC3BX,IAEAtM,EAAA,SAAAjK,GAAA,SAAAiK,mDAIA,OAJqCzH,EAAAyH,EAAAjK,GAEjCiK,EAAAxO,UAAA2K,UAAA,WAAc,OAAOtG,KAAKU,MAAM0F,QAAQ,KAE5C+D,EAJA,CAFAzN,EAAA,GAEqCyM,cAAxBrM,EAAAqN,2wDCFb,IAAA3K,EAAA9C,EAAA,GACAqX,EAAArX,EAAA,GAEAuQ,EAAAvQ,EAAA,GAGAga,EAAAha,EAAA,GACAmD,EAAAnD,EAAA,GAEAia,EAAA,SAAAzW,GAaI,SAAAyW,EAEW/N,EACCgO,GAHZ,IAAAvW,EAKIH,EAAArE,KAAAmE,KACI4W,EAAWtW,EACXsW,EAAWrW,EACXV,EAAAX,qBAAqB0J,EAAQzJ,MAC7BU,EAAAX,qBAAqB0J,EAAQzJ,MAE7ByJ,EAAQlI,QACXV,YAVMK,EAAAuI,UACCvI,EAAAuW,aAfZvW,EAAAwW,WAUAxW,EAAAyW,SAgBIzW,EAAK8B,UAAY,IAAI3C,EAAA4C,MAAM/B,EAAKuI,QAAQxL,KAAM,EAAG,EAAG,aACpDiD,EAAK8B,UAAUK,SAAW,EAC1BnC,EAAK8B,UAAUzB,MAAQlB,EAAA6C,MAAMC,MAE7BjC,EAAK4O,MAAQ,IAAI8H,MAIjB1W,EAAK4O,MAAM+H,IAAMpO,EAAQqG,QA8HjC,OAjK4BvM,EAAAiU,EAAAzW,GAsCxByW,EAAAhb,UAAAkH,KAAA,SAAKC,EAA+BC,GAEhCD,EAAImU,UACAjX,KAAKiP,MACLjP,KAAKD,IAAIO,EAAIN,KAAKmE,WAAa,EAC/BnE,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAc,EAAI,GACpCpE,KAAKmE,WAAYnE,KAAKoE,aAKtBpE,KAAKmC,UAAUpC,IAAMC,KAAKqD,YAC1BrD,KAAKmC,UAAUpC,IAAIO,GAAK,GACxBN,KAAKmC,UAAUpC,IAAIQ,GAAK,EAAIP,KAAKoE,YAAY,EAC7CpE,KAAKmC,UAAUU,KAAKC,EAAKC,GAG7B,IAAImU,EAAKlX,KAAKM,EAAIN,KAAKmE,WAAW,EAAI,EAAGgT,EAAKnX,KAAKO,EAAI,GAEvDP,KAAK6W,QAAQ1T,QAAQ,SAACiU,EAAUC,GAC5BvU,EAAI+J,UAAYI,EAAAsG,WAAW6D,GAAU3D,WAAW,IAAKrN,QAAQ,IAAKoG,SAClE1J,EAAIgK,SAASoK,EAHD,EAGkBG,EAAOF,EAHzB,EAGyCG,EAAaA,MAI1E5b,OAAA6B,eAAIoZ,EAAAhb,UAAA,YAAA+B,IAAJ,WAAuB,OAAOsC,KAAK4I,QAAQgG,0CAC3ClT,OAAA6B,eAAIoZ,EAAAhb,UAAA,YAAA+B,IAAJ,WAAuB,OAAOsC,KAAK4I,QAAQ+F,0CAC3CjT,OAAA6B,eAAIoZ,EAAAhb,UAAA,YAAA+B,IAAJ,WAAuB,OAAOsC,KAAK4I,QAAQkG,0CAC3CpT,OAAA6B,eAAIoZ,EAAAhb,UAAA,kBAAA+B,IAAJ,WAAuB,OAAOsC,KAAK4I,QAAQiG,gDAE3CnT,OAAA6B,eAAIoZ,EAAAhb,UAAA,YAAA+B,IAAJ,WAAuB,OAAOsC,KAAK4I,QAAQmG,0CAErC4H,EAAAhb,UAAA4b,SAAN,SAAeC,iGACX,OAAIxX,KAAK8W,OACLU,EAAQC,UAAUzX,OAClB,IAGAA,KAAK6W,QAAQtb,OAAS,GACtByE,KAAK6W,QAAQa,MACb1X,KAAK8W,UACL,EAAMU,EAAQG,YAAY,QAH1B,mBAGA3S,EAAA4S,OACA5X,KAAK8W,SACLU,EAAQK,MAAM7X,KAAK4O,8BAEf5O,KAAK2O,UAAY6I,EAAQM,WAAa9X,KAAK2O,UAC3C3O,KAAK8W,UACL,EAAMU,EAAQG,YAAY3X,KAAK8O,aAF/B,YAEA9J,EAAA4S,OACAJ,EAAQK,MAAM7X,KAAK4O,UACnB5O,KAAK8W,SAAQjZ,EAAAkL,MAAA,gBAIjB/I,KAAK4I,QAAQoG,WAAa+E,EAAA/G,iBAAiBmB,OAGpCnO,KAAK4I,QAAQoG,WAAa+E,EAAA/G,iBAAiBqB,iBAE9C0J,EAAWP,EAAQQ,SAEnBhY,KAAKoH,SAAS9B,OAAOyS,GAElB/X,KAAK4I,QAAQoG,WAAa+E,EAAA/G,iBAAiBsB,aAE9CkJ,EAAQM,WAAa7K,EAAAkD,cAAcS,OAC/BmH,EAAWP,EAAQQ,SAEnBhY,KAAKoH,SAAS9B,OAAOyS,GAGtB/X,KAAK4I,QAAQoG,WAAa+E,EAAA/G,iBAAiBuB,YAE9CiJ,EAAQM,WAAa7K,EAAAkD,cAAcE,OAC/B0H,EAAWP,EAAQQ,SAEnBhY,KAAKoH,SAAS9B,OAAOyS,GAI7BE,QAAQC,KAAK,mCAAqC9U,OAAQpD,kBAI3D2W,EAAAhb,UAAA8H,QAAP,SAAenC,GAAf,IAAAjB,EAAAL,KACQsB,EAAOtB,KAAK6O,gBAAmB,IAC3B7O,KAAK4I,QAAQoG,WAAa+E,EAAA/G,iBAAiBmB,KAEvCnO,KAAK4O,WAAa5O,KAAK2O,UAAY3O,KAAK6W,QAAQtb,OAASyE,KAAK+O,UAC9D/O,KAAK6W,QAAQpb,KAAKuE,KAAK4O,UAEpB5O,KAAK4I,QAAQoG,WAAa+E,EAAA/G,iBAAiBoB,cAClD+J,WAAW,WAAM,OAAA9X,EAAK+G,SAAS3B,SAASpF,EAAKN,MAAM,OAM/D4W,EAAAhb,UAAAyc,KAAA,SAAKhY,EAAgBL,GAArB,IAAAM,EAAAL,cAAqBD,MAAcC,KAAKD,KACpC,IAAImG,EAAO9F,EAAO2F,OAAOoB,sBAAsBpH,EAE3C2W,EAAAL,cAEA,SAACnQ,GAEG,OADeA,EAAKiC,qBACDjC,EAAK/F,UAAUwI,SAAS0P,KAAK,SAAA7J,GAAW,OAAAnO,EAAKuI,mBAAmB4F,MAa3F,OARItI,IACAlG,KAAKoH,SAAWlB,EAChBlG,KAAKD,IAAMC,KAAKoH,SAASgB,kBAAkBkQ,YAMtCpS,GAGbyQ,EAAAhb,UAAAsM,SAAA,aAGJ0O,EAjKA,CAA4BnX,EAAAwJ,OAAflM,EAAA6Z,wFCTb,IAAAjX,EAAAhD,EAAA,GAEAgI,EAAA,oBAAAA,IACY1E,KAAAuY,SACDvY,KAAAkE,SACClE,KAAAwY,SACAxY,KAAAyY,gBA8IZ,OA5IW/T,EAAA/I,UAAA+c,QAAP,WACI,OAAO1Y,KAAKuY,OAGhB7c,OAAA6B,eAAWmH,EAAA/I,UAAA,QAAA+B,IAAX,WAAoB,OAAOsC,KAAKkE,MAAM3I,wCAE/BmJ,EAAA/I,UAAAgd,KAAP,SAAYC,GACR5Y,KAAKuY,SACAvY,KAAK6Y,SAASD,IACf5Y,KAAKkE,MAAMzI,KAAKmd,IAIjBlU,EAAA/I,UAAAkd,SAAP,SAAgBC,GACZ,OAAO9Y,KAAKkE,MAAM6U,SAASD,IAGxBpU,EAAA/I,UAAAkJ,aAAP,SAAoBiU,EAAaE,EAAiCC,kBAAA,GAC9D,IAAI/U,EAAQlE,KAAKkZ,MACb1R,EAAU9H,EAAAmL,MAAM3G,EAAO,SAACyU,GAAY,OAAAK,EAAQF,EAAUH,KAC1D,OAAInR,GAAWwR,EAAQxR,EAASsR,GAAYG,EACjCzR,EAEJsR,GAGJpU,EAAA/I,UAAAyJ,KAAP,SAAY4R,EAAQmC,GAChBnZ,KAAK2Y,KAAK3B,GACVhX,KAAK2Y,KAAKQ,GAEV,IAAIxc,EAAIqD,KAAKoZ,QAAQpC,GAAM7Z,EAAI6C,KAAKoZ,QAAQD,GAC5CnZ,KAAKwY,MAAM7b,GAAKqD,KAAKwY,MAAM7b,OAC3BqD,KAAKwY,MAAM7b,GAAGlB,KAAK0B,GAEnB6C,KAAKyY,aAAatb,GAAK6C,KAAKyY,aAAatb,OACzC6C,KAAKyY,aAAatb,GAAG1B,KAAKkB,IAGvB+H,EAAA/I,UAAA0d,MAAP,SAAaC,GAAb,IAAAjZ,EAAAL,KACGsZ,EAAWC,WAAWpW,QAAQ,SAAC6B,OAACyB,EAAAzB,EAAA,GAAEiH,EAAAjH,EAAA,GAAO,OAAA3E,EAAK+E,KAAKqB,EAAEwF,MAGjDvH,EAAA/I,UAAA4d,SAAP,WAEI,IADA,IAAIC,KACazU,EAAA,EAAAC,EAAAhF,KAAKkE,MAALa,EAAAC,EAAAzJ,OAAAwJ,IAAY,CAAxB,IAAI4T,EAAI3T,EAAAD,GACLsS,EAAQrX,KAAKoZ,QAAQT,GACzB,GAAI3Y,KAAKwY,MAAMnB,GACX,IAAuB,IAAAjE,EAAA,EAAAqG,EAAAzZ,KAAKwY,MAAMnB,GAAXjE,EAAAqG,EAAAle,OAAA6X,IAAmB,CAArC,IAAIsG,EAAUD,EAAArG,GACXuG,EAAY3Z,KAAKkE,MAAMwV,GACtBF,EAAST,UAAUY,EAAWhB,KAC/Ba,EAAS/d,MAAMkd,EAAMgB,KAKrC,OAAOH,GAGJ9U,EAAA/I,UAAAie,SAAP,SAAgBd,GAAhB,IAAAzY,EAAAL,KACQqX,EAAQrX,KAAKoZ,QAAQN,GAEzB,OADa9Y,KAAK6Z,gBAAgBxC,GACpBnQ,IAAI,SAACrJ,GAAM,OAAAwC,EAAK6D,MAAMrG,MAGhC6G,EAAA/I,UAAAke,gBAAR,SAAwBC,GACpB,IAAIC,EAAK/Z,KAAKwY,MAAMsB,OAChBE,EAAQha,KAAKyY,aAAaqB,OAE9B,OADiBC,EAAEjO,OAAKkO,IAIrBtV,EAAA/I,UAAAud,IAAP,SAAWe,EAAaC,GAAxB,IAAA7Z,EAAAL,cAAWia,MAAA,eAAaC,UACpB,IAAIC,EAASF,EAAOja,KAAKoZ,QAAQa,GAAQ,EACzC,OAAOja,KAAKoa,SAASD,GAAQjT,IAAI,SAAArJ,GAAK,OAAAwC,EAAK6D,MAAMrG,MAG7C6G,EAAA/I,UAAAye,SAAR,SAAiBC,EAAoBH,GAArC,IAAA7Z,EAAAL,KASI,gBATaqa,MAAA,YAAoBH,UACjCA,EAAQze,KAAK4e,GACEra,KAAK6Z,gBAAgBQ,GAC3BlX,QAAQ,SAACmX,GACTJ,EAAQnB,SAASuB,IAClBja,EAAK+Z,SAASE,EAAYJ,KAI3BA,GAGJxV,EAAA/I,UAAA4e,IAAP,SAAWN,EAAaO,GAAxB,IAAAna,EAAAL,cAAWia,MAAA,eAAaO,MAAA,WAAyC,WAC7D,IAAIL,EAASF,EAAOja,KAAKoZ,QAAQa,GAAQ,EACzC,OAAOja,KAAKya,SAASN,EAAQK,GAAItT,IAAI,SAAArJ,GAAK,OAAAwC,EAAK6D,MAAMrG,MAGjD6G,EAAA/I,UAAA8e,SAAR,SAAiBJ,EAAuBG,YAAvBH,MAAA,eAAuBG,MAAA,WAA8C,WAClF,IAAIE,KACAR,KAEJ,IADAA,EAAQze,KAAK4e,GACNH,EAAQ3e,OAASyE,KAAKkE,MAAM3I,QAAQ,CACvC,IAAwB,IAAAwJ,EAAA,EAAA4V,EAAAT,EAAAnV,EAAA4V,EAAApf,OAAAwJ,IAAS,CAE7B,IAFC,IAAI6V,EAAWD,EAAA5V,GAESC,EAAA,EAAA6V,EADL7a,KAAK6Z,gBAAgBe,GAChB5V,EAAA6V,EAAAtf,OAAAyJ,IAAK,CAAzB,IAAI8V,EAAYD,EAAA7V,GACjB,IAAKkV,EAAQnB,SAAS+B,GAAe,CACjC,IAAKN,EAAGI,EAAaE,GAAe,CAChCJ,KACA,MAEJR,EAAQze,KAAKqf,IAGrB,GAAIJ,EAAM,MAEd,GAAIA,EAAM,MAEd,OAAOR,GAGJxV,EAAA/I,UAAAof,aAAP,SAAoB/D,EAAQmC,EAAQ6B,GAApC,IAAA3a,EAAAL,cAAoCgb,MAAA,KAChC,IAAIC,KACAC,EAAWlb,KAAKoZ,QAAQD,GAC5BnZ,KAAKua,IAAIvD,EAAK,SAACmE,EAAMC,GAEjB,OADAH,EAASG,GAAQD,EACVC,IAASF,IAMpB,IAJA,IAAIG,KACAD,EAAOF,EACPI,EAAQ,EACRC,EAAWvb,KAAKoZ,QAAQpC,IACpBqE,EAAKtC,SAASwC,IAAaD,EAAQN,GACvCK,EAAK5f,KAAK2f,GACVA,EAAOH,EAASG,GAChBE,GAAS,EAGb,OADgBD,EAAKnU,IAAI,SAAArJ,GAAK,OAAAwC,EAAK6D,MAAMrG,KACxB2d,WAGb9W,EAAA/I,UAAAyd,QAAR,SAAgBT,GACZ,OAAO3Y,KAAKkE,MAAMkV,QAAQT,IAGlCjU,EAlJA,GAAa5H,EAAA4H,uaCFb,IAAAlF,EAAA9C,EAAA,GAEA+e,EAAA/e,EAAA,IAEAgf,EAAA,SAAAxb,GAIE,SAAAwb,EAAmBC,GAAnB,IAAAtb,EACEH,EAAArE,KAAAmE,MACEQ,MAAO,IACPC,OAAQ,IACRmb,YAAapc,EAAAqc,YAAYC,WACzBC,gBAAiBJ,EAAMK,YACvBhc,YANeK,EAAAsb,UAerB,OAnB0BjZ,EAAAgZ,EAAAxb,GAYjBwb,EAAA/f,UAAAsgB,MAAP,WACE,IAAIC,EAAS,IAAI1c,EAAA2c,OACjB,IAAK,IAAIC,KAAOX,EAAAY,UACdH,EAAOI,YAAYb,EAAAY,UAAUD,IAE/B,OAAOlc,EAAAvE,UAAMsgB,MAAKpgB,KAAAmE,KAACkc,IAfdR,EAAAa,aAAuB,IAiBhCb,EAnBA,CAA0Blc,EAAAgd,QAAb1f,EAAA4e,saCJb,IAAAe,EAAA/f,EAAA,GACA8C,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACAmD,EAAAnD,EAAA,GAEAggB,EAAA,SAAAxc,GAAA,SAAAwc,mDAcA,OAdwCha,EAAAga,EAAAxc,GAEpCwc,EAAA/gB,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAc,EAOxC,OALI,IAAI5E,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GACpB,IAAIf,EAAAgC,OAAOlB,EAAGC,GACd,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWK,UAEzD4d,EAdA,CAAwCD,EAAAlT,UAA3BzM,EAAA4f,obCLb,IAAA7c,EAAAnD,EAAA,GACAuM,EAAAvM,EAAA,GACA8C,EAAA9C,EAAA,GAGAkgB,EAAA,SAAA1c,GAAA,SAAA0c,mDAcA,OAdiCla,EAAAka,EAAA1c,GAE7B0c,EAAAjhB,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAc,GAOxC,OALI,IAAI5E,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GAEpB,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWO,UAEzD4d,EAdA,CAFAlgB,EAAA,GAEiC6M,UAApBzM,EAAA8f,6aCLb,IAAAH,EAAA/f,EAAA,GACA8C,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACAmD,EAAAnD,EAAA,GAEAmgB,EAAA,SAAA3c,GAAA,SAAA2c,mDAcA,OAdkCna,EAAAma,EAAA3c,GAE9B2c,EAAAlhB,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAcpE,KAAK8c,YAAcjd,EAAAX,qBAAqBW,EAAApB,WAAWQ,MAAM,EAOjG,OALI,IAAIO,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GAEpB,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWQ,SAEzD4d,EAdA,CAAkCJ,EAAApT,gBAArBvM,EAAA+f,8aCLb,IAAAJ,EAAA/f,EAAA,GACA8C,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACAmD,EAAAnD,EAAA,GAEAqgB,EAAA,SAAA7c,GAAA,SAAA6c,mDAcA,OAdmCra,EAAAqa,EAAA7c,GAE/B6c,EAAAphB,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAcpE,KAAK8c,YAAcjd,EAAAX,qBAAqBW,EAAApB,WAAWO,OAAO,EAOlG,OALI,IAAIQ,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GAEpB,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWO,UAEzD+d,EAdA,CAAmCN,EAAApT,gBAAtBvM,EAAAigB,+aCLb,IAAAN,EAAA/f,EAAA,GACAmD,EAAAnD,EAAA,GACAuM,EAAAvM,EAAA,GACA8C,EAAA9C,EAAA,GAEAsgB,EAAA,SAAA9c,GAAA,SAAA8c,mDAcA,OAdoCta,EAAAsa,EAAA9c,GAEhC8c,EAAArhB,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAcpE,KAAK8c,YAAc,GAO3D,OALI,IAAItd,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GAEpB,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWM,WAEzDie,EAdA,CAAoCP,EAAApT,gBAAvBvM,EAAAkgB,gbCLb,IAAAP,EAAA/f,EAAA,GACA8C,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACAmD,EAAAnD,EAAA,GAEAugB,EAAA,SAAA/c,GAAA,SAAA+c,mDAcA,OAdiCva,EAAAua,EAAA/c,GAE7B+c,EAAAthB,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAc,GAOxC,OALI,IAAI5E,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GAEpB,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWM,WAEzDke,EAdA,CAAiCR,EAAAlT,UAApBzM,EAAAmgB,6aCLb,IAAAR,EAAA/f,EAAA,GACA8C,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACAmD,EAAAnD,EAAA,GAEAwgB,EAAA,SAAAhd,GAAA,SAAAgd,mDAaA,OAbwCxa,EAAAwa,EAAAhd,GACpCgd,EAAAvhB,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAcpE,KAAK8c,YAAc,GAO3D,OALI,IAAItd,EAAAgC,OAAOlB,EAAIqc,EAAI,EAAGpc,GACtB,IAAIf,EAAAgC,OAAOlB,EAAGC,GACd,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAI,EAAGpc,IAGhB2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWK,UAEzDoe,EAbA,CAAwCT,EAAApT,gBAA3BvM,EAAAogB,obCLb,IAAA1d,EAAA9C,EAAA,GACAga,EAAAha,EAAA,GACAqX,EAAArX,EAAA,GACAygB,EAAA,SAAAjd,GAII,SAAAid,EAAoBC,EAA6B9c,EAAWC,GAA5D,IAAAF,EACIH,EAAArE,KAAAmE,KAAMM,EAAGC,EAAG,GAAI,GAAI6c,GAAUA,EAAO1c,OAASlB,EAAA6C,MAAM0S,OAAK/U,YADzCK,EAAA+c,SAGhB/c,EAAKjD,KAAO,IAAIoC,EAAA4C,MAAMgb,GAAUA,EAAOhgB,MAAQ,KAAM,GAAI,IACzDiD,EAAKjD,KAAKoF,SAAW,GACrBnC,EAAKjD,KAAKsD,MAAQlB,EAAA6C,MAAMgb,MACxBhd,EAAKid,IAAIjd,EAAKjD,MAEdiD,EAAKkd,KAAO,IAAI/d,EAAA4C,MAAM,KAAM,IAAK,IACjC/B,EAAKkd,KAAK/a,SAAW,GACrBnC,EAAKkd,KAAK7c,MAAQlB,EAAA6C,MAAM0S,KACxB1U,EAAKkd,KAAKC,UAAYhe,EAAAie,UAAUC,OAChCrd,EAAKid,IAAIjd,EAAKkd,QAStB,OAzB+B7a,EAAAya,EAAAjd,GAmB3Bid,EAAAxhB,UAAAgiB,SAAA,SAASP,GACLpd,KAAK5C,KAAKwF,KAAOwa,EAAOhgB,KACxB4C,KAAKU,MAAQ0c,EAAO1c,MAAM+S,WAAW,IAAKhR,OAAO,IAC7C2a,aAAkBrJ,EAAAvF,UAAWxO,KAAKud,KAAK3a,KAAO,WAC9Cwa,aAAkB1G,EAAA9B,YAAa5U,KAAKud,KAAK3a,KAAO,cAE5Dua,EAzBA,CAA+B3d,EAAAwJ,OAAlBlM,EAAAqgB,2aCHb,IAAA3d,EAAA9C,EAAA,GAEAqX,EAAArX,EAAA,GACAkhB,EAAAlhB,EAAA,IACAgD,EAAAhD,EAAA,GAEAmhB,EAAA,SAAA3d,GAII,SAAA2d,EAAoBT,EAA6B9c,EAAWC,GAA5D,IAAAF,EACIH,EAAArE,KAAAmE,KAAMM,EAAI,IAAKC,EAAG,IAAK,IAAKf,EAAA6C,MAAMC,QAAMtC,KADxBod,OAAA/c,EAAA+c,SAGhB/c,EAAKyd,MAAQ,IAAIF,EAAAT,UAAUC,GAAQW,KADf,IAEpB1d,EAAKid,IAAIjd,EAAKyd,OACdzd,EAAKoO,YAAc,IAAIjP,EAAA4C,MAAMgb,GAAUA,EAAO3O,aAAe,QAAQsP,KAASC,IAC9E3d,EAAKoO,YAAYjM,SAAW,GAC5BnC,EAAKoO,YAAY+O,UAAYhe,EAAAie,UAAUC,OACvCrd,EAAKid,IAAIjd,EAAKoO,aAGdpO,EAAK4O,MAAQ,IAAI8H,QA6BzB,OA5C0BrU,EAAAmb,EAAA3d,GAqBtB2d,EAAAliB,UAAAkH,KAAA,SAAKC,EAA+BC,GAEhC,GADA7C,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,GACZ/C,KAAKod,QAEDpd,KAAKod,kBAAkBrJ,EAAAvF,SAAWxO,KAAKiP,MAAO,CAC9C,IAAIgP,EAAKje,KAAKD,IAAIO,EAAI,GAAI4d,EAAKle,KAAKD,IAAIQ,EAAI,GAE5Cb,EAAAsD,SAASF,GAAOxC,EAAG2d,EAAI1d,EAAG2d,EAAI1d,MADpB,GACgCC,OADhC,IAC+C,EAAGjB,EAAA6C,MAAMqM,UAAUtI,QAAQ,KACpFtD,EAAImU,UAAUjX,KAAKiP,MAAOgP,EAAIC,EAFpB,SAOtBL,EAAAliB,UAAAwiB,QAAA,SAAQf,GACJpd,KAAK8d,MAAMH,SAASP,GACpBpd,KAAKyO,YAAY7L,KAAOwa,EAAO3O,YAE/BzO,KAAKod,OAASA,EACVpd,KAAKod,kBAAkBrJ,EAAAvF,UACvBxO,KAAKiP,MAAM+H,IAAMhX,KAAKod,OAAOnO,QAIzC4O,EA5CA,CAA0Bre,EAAAwJ,OAAblM,EAAA+gB,saCNb,IAAAre,EAAA9C,EAAA,GACA0hB,EAAA,SAAAle,GAGI,SAAAke,EAAYhhB,EAAckD,EAAWC,GAArC,IAAAF,EACIH,EAAArE,KAAAmE,KAAMM,EAAGC,EAAG,EAAG,IAAEP,YACjBK,EAAK8B,UAAY,IAAI3C,EAAA4C,MAAMhF,EAAMkD,EAAGC,GACpCF,EAAK8B,UAAUK,SAAW,GAC1BnC,EAAK8B,UAAUzB,MAAQlB,EAAA6C,MAAMC,MAAMG,OAAO,IAC1CpC,EAAKid,IAAIjd,EAAK8B,WACd9B,EAAKge,WAAa,IAAI7e,EAAA4C,MAAM,IAAK9B,EAAI,GAAIC,GACzCF,EAAKge,WAAW7b,SAAW,GAC3BnC,EAAKge,WAAW3d,MAAQlB,EAAA6C,MAAMC,MAAMG,OAAO,IAC3CpC,EAAKid,IAAIjd,EAAKge,cAatB,OAzBmC3b,EAAA0b,EAAAle,GAc/Bke,EAAAziB,UAAA2iB,SAAA,SAASC,GACLve,KAAKqe,WAAWzb,KAAO,GAAG2b,EAC1B,IAAIrhB,EAAIsC,EAAA6C,MAAM0S,KACVwJ,EAAQ,EACRrhB,EAAIsC,EAAA6C,MAAMyL,MAELyQ,EAAQ,IACbrhB,EAAIsC,EAAA6C,MAAMmE,KAEdxG,KAAKqe,WAAW3d,MAAQxD,GAEhCkhB,EAzBA,CAAmC5e,EAAAwJ,OAAtBlM,EAAAshB,+aCDb,IAAA5e,EAAA9C,EAAA,GACAuQ,EAAAvQ,EAAA,GACA8hB,EAAA9hB,EAAA,IAEA+hB,EAAA,SAAAve,GAcI,SAAAue,EAAY5L,EAAiBvS,EAAWC,GAAxC,IAAAF,EACIH,EAAArE,KAAAmE,KAAMM,EAAGC,EAAG,EAAG,IAAEP,KAdbK,EAAAqe,aACJjP,MAAO,KACPG,OAAQ,KACRK,MAAO,KACPa,QAAS,KACTjB,KAAM,KACNkC,IAAK,KACLW,OAAQ,KACRC,OAAQ,KACRX,OAAQ,KACRC,OAAQ,MAMR,IAAIoF,EAAQ,EACZ,IAAK,IAAIzZ,KAASqP,EAAAwF,UAAW,CACzB,IAAI4L,EAA6B,IAAIG,EAAAJ,cAAcxgB,EAAkB,GAAVyZ,IAAe,GAC1EhX,EAAKqe,YAAY9gB,GAASygB,EAC1Bhe,EAAKid,IAAIe,UAGbhe,EAAKse,WAAW9L,KAYxB,OApCiCnQ,EAAA+b,EAAAve,GA2B7Bue,EAAA9iB,UAAAgjB,WAAA,SAAWC,GACP,IAAI/L,EAAS+L,EAEb,IAAK,IAAIhhB,KAASqP,EAAAwF,UAAW,CACrB,IAAAzN,EAAA6N,EAAAjV,GAAE+R,EAAA3K,EAAA2K,OAAQD,EAAA1K,EAAA0K,OACd1P,KAAK0e,YAAY9gB,GAAO0gB,SAAS5O,EAAOC,KAIpD8O,EApCA,CAAiCjf,EAAAwJ,OAApBlM,EAAA2hB,6aCJb,IAAAjf,EAAA9C,EAAA,GACAuQ,EAAAvQ,EAAA,GACAmiB,EAAA,SAAA3e,GAGI,SAAA2e,EAAYve,EAAWC,EAAWue,EAAwClhB,GAA1E,IAAAyC,EACIH,EAAArE,KAAAmE,KAAMM,EAAGC,EAAG,GAAI,KAAGP,KADmDK,EAAAzC,QAEtE,IAAImhB,EAAO,IAAIvf,EAAAwJ,MAAM1I,EAAGC,EAAG,GAAI,GAAI0M,EAAAsG,WAAWuL,WAC9Cze,EAAKid,IAAIyB,GACT1e,EAAKke,MAAQ,IAAI/e,EAAA4C,MAAM,IAAIxE,EAAS0C,EAAI,GAAIC,EAAI,EAAG,aACnDF,EAAKke,MAAM/b,SAAW,GACtBnC,EAAKke,MAAM7d,MAAQlB,EAAA6C,MAAMC,MACzBjC,EAAKid,IAAIjd,EAAKke,SAMtB,OAhBuC7b,EAAAmc,EAAA3e,GAYnC2e,EAAAljB,UAAAqjB,OAAA,SAAOC,GACHjf,KAAKpC,OAASqhB,EACdjf,KAAKue,MAAM3b,KAAO,IAAI5C,KAAKpC,OAEnCihB,EAhBA,CAAuCrf,EAAAwJ,OAA1BlM,EAAA+hB,mbCFb,IAAArf,EAAA9C,EAAA,GACAuQ,EAAAvQ,EAAA,GACAwiB,EAAAxiB,EAAA,IACAyiB,EAAA,SAAAjf,GAkBI,SAAAif,EAAY7e,EAAWC,SAAvBF,EACIH,EAAArE,KAAAmE,KAAMM,EAAGC,EAAG,EAAG,EAAGf,EAAA6C,MAAM+c,SAAS3c,OAAO,MAAKzC,KAJlB,OAd/BK,EAAAgf,UAAOra,MAIEiI,EAAAkD,cAAcQ,MAAO,KACtB3L,EAACiI,EAAAkD,cAAcC,YAAa,KAC5BpL,EAACiI,EAAAkD,cAAcsB,KAAM,KAGrBzM,EAACiI,EAAAkD,cAAcS,MAAO,KACtB5L,EAACiI,EAAAkD,cAAcuB,SAAU,KACzB1M,EAACiI,EAAAkD,cAAcE,MAAO,KAGtBrL,EAACiI,EAAAkD,cAAckD,OAAQ,KAAA1V,IAMVsP,EAAAkD,cAAcS,KAAM3D,EAAAkD,cAAcE,KAAMpD,EAAAkD,cAAcuB,SAC7DvO,QAAQ,SAAC4U,EAAUV,GACzB,IAAIiI,EAHE,EAGiB,GAARjI,EAAYkI,EAAmB,EAARlI,EAHvB,IAIXmI,EAAQ,IAAIN,EAAAL,kBAAkBS,EAAIC,EAAIxH,EAAU,GACpD1X,EAAKid,IAAIkC,GACTnf,EAAKgf,QAAQtH,GAAYyH,MAWrC,OArCmC9c,EAAAyc,EAAAjf,GA8B/Bif,EAAAxjB,UAAA8jB,UAAA,SAAU1H,GAEN,IAAIxS,EAAMvF,KAAKqf,QAAQtH,GACnBxS,GACAA,EAAIyZ,OAAO,IAGvBG,EArCA,CAAmC3f,EAAAwJ,OAAtBlM,EAAAqiB,+aCHb,IAAA3f,EAAA9C,EAAA,GAEAgjB,EAAAhjB,EAAA,IACAijB,EAAAjjB,EAAA,IAEAkjB,EAAA,SAAA1f,GAQI,SAAA0f,EAAY/M,EAAiB8J,EAAmBkD,YAAnBlD,MAAA,cAAmBkD,MAAA,IAAhD,IAAAxf,EACIH,EAAArE,KAAAmE,KAAM,EAAE,EAAG2c,EAAGkD,EAAGrgB,EAAA6C,MAAM+c,SAAS3c,OAAO,MAAKzC,KAIxC8f,EAAQ,IAAItgB,EAAA4C,MAAM,SAAU,EAAG2d,IACnCD,EAAMtd,SAAW,GACjBsd,EAAMpf,MAAQlB,EAAA6C,MAAM0S,KACpB+K,EAAMtC,UAAYhe,EAAAie,UAAUC,OAC5Brd,EAAKid,IAAIwC,GAET,IAAIE,EAAU,IAAIxgB,EAAA4C,MAAM,SAAU,GAAI2d,WACtCC,EAAQxd,SAAW,EACnBwd,EAAQtf,MAAQlB,EAAA6C,MAAM0S,KAAKtS,OAAO,IAClCpC,EAAKid,IAAI0C,GAGT3f,EAAK4f,UAAY,IAAIP,EAAAP,cAAc,GAd1B,IAeT9e,EAAKid,IAAIjd,EAAK4f,WAEd5f,EAAK8O,QAAU,IAAIwQ,EAAAlB,YAAY5L,EAAQ,IAjB9B,IAkBTxS,EAAKid,IAAIjd,EAAK8O,SAEd9O,EAAK6f,SAAW,IAAI1gB,EAAA4C,MAAM,GAAI,IApBrB,GAoB8B,aACvC/B,EAAK6f,SAAS1d,SAAW,GACzBnC,EAAK6f,SAASxf,MAAQlB,EAAA6C,MAAMC,MAC5BjC,EAAKid,IAAIjd,EAAK6f,UAEd7f,EAAK8f,aAAe,IAAI3gB,EAAA4C,MAAM,KAAM,IAzB3B,GAyBqC,aAC9C/B,EAAK8f,aAAa3d,SAAW,GAC7BnC,EAAK8f,aAAazf,MAAQlB,EAAA6C,MAAMC,MAChCjC,EAAKid,IAAIjd,EAAK8f,gBAiBtB,OAxDwCzd,EAAAkd,EAAA1f,GA0CpC0f,EAAAjkB,UAAAykB,kBAAA,SAAkB7a,GACdvF,KAAKigB,UAAUR,UAAUla,IAG7Bqa,EAAAjkB,UAAA0kB,WAAA,SAAWzd,GAAgB5C,KAAKmgB,aAAavd,KAAOA,GAEpDgd,EAAAjkB,UAAA2kB,YAAA,SAAY1B,GACR5e,KAAKmP,QAAQwP,WAAWC,IAG5BgB,EAAAjkB,UAAA4kB,WAAA,SAAWnF,EAAWoF,GAClBxgB,KAAKkgB,SAAStd,KAAO,QAAQwY,EAAI,IAAIoF,GAG7CZ,EAxDA,CAAwCpgB,EAAAwJ,OAA3BlM,EAAA8iB,obCLb,IAAApgB,EAAA9C,EAAA,GACAga,EAAAha,EAAA,GAEAuQ,EAAAvQ,EAAA,GAEAqX,EAAArX,EAAA,GACAgD,EAAAhD,EAAA,GAEA+jB,EAAA/jB,EAAA,IAGAgkB,EAAAhkB,EAAA,IAEAikB,EAAA,SAAAzgB,GAuBI,SAAAygB,EAAoBC,EAAsBC,EAAmCC,YAAnCD,MAAA,eAAmCC,MAAA,MAA7E,IAAAzgB,EACIH,EAAArE,KAAAmE,KAAM,EAAG,EAAG4gB,EAAKG,YAAaH,EAAKI,eAAahhB,YADhCK,EAAAugB,OAAsBvgB,EAAAwgB,mBAAmCxgB,EAAAygB,kBAtBrEzgB,EAAA4gB,wBAYR5gB,EAAA6gB,0BACA7gB,EAAA8gB,mBAIA9gB,EAAA+gB,wBACA/gB,EAAAghB,iBAEAhhB,EAAAihB,KAAa,IAAIZ,EAAA7C,KAAK,KAAM,GAAI,KAI5Bxd,EAAKkhB,sBAAsBV,GAC3BxgB,EAAKmhB,oBAAoBV,GACzBzgB,EAAKohB,OAAS,IAAIhB,EAAAb,mBAAmB3S,EAAAmC,eACrC/O,EAAKid,IAAIjd,EAAKohB,QAEdphB,EAAKihB,KAAKI,WACVrhB,EAAKid,IAAIjd,EAAKihB,QA4KtB,OA3MyB5e,EAAAie,EAAAzgB,GAkCrBygB,EAAAhlB,UAAA0kB,WAAA,SAAWzd,GAAgB5C,KAAKyhB,OAAOpB,WAAWzd,IAElD+d,EAAAhlB,UAAAkH,KAAA,SAAKC,EAA+BC,GAEhC,GADA7C,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,GACZ/C,KAAK2hB,yBAA0B,CAC/B,IAAIC,EAAO9e,EAAI+e,OAAOC,WAClBC,EAAMjf,EAAI+e,OAAOG,UACrBhiB,KAAK2hB,yBAAyBM,MAAML,KAAUA,EAAO,GAAE,KACvD5hB,KAAK2hB,yBAAyBM,MAAMC,IAASH,EAAM,GAAE,KAEzD,GAAI/hB,KAAKmiB,uBAAwB,CACzBP,EAAO9e,EAAI+e,OAAOC,WAAtB,IACIM,EAAMtf,EAAI+e,OAAOG,UACrBhiB,KAAKmiB,uBAAuBF,MAAML,KAAUA,EAAO,GAAE,KACrD5hB,KAAKmiB,uBAAuBF,MAAMC,IAASE,EAAM,IAAG,OAK5DzB,EAAAhlB,UAAA0mB,iBAAA,SAAiBtK,GACb/X,KAAKyhB,OAAOrB,kBAAkBrI,IAGlC4I,EAAAhlB,UAAA2mB,cAAA,SAAcliB,EAAgBmiB,sBACtBA,GACAviB,KAAKwiB,eAAepiB,EAAO2F,QAE/B/F,KAAKyiB,cAAcriB,GACnBJ,KAAK0iB,aAAatiB,EAAO+O,QAAQlC,EAAAwF,UAAU3B,SAASnB,OAAQvP,EAAOuiB,SAGvEhC,EAAAhlB,UAAAinB,SAAA,SAASxF,GACLpd,KAAKshB,KAAKnD,QAAQf,GAClBpd,KAAKshB,KAAKI,YAINf,EAAAhlB,UAAA+mB,aAAR,SAAqBtH,EAAMoF,GACvBxgB,KAAKyhB,OAAOlB,WAAWnF,EAAMoF,IAGzBG,EAAAhlB,UAAA8mB,cAAR,SAAsBriB,GAClBJ,KAAKyhB,OAAOnB,YAAYlgB,EAAO+O,UAG3BwR,EAAAhlB,UAAA6mB,eAAR,SAAuBzc,GACnB/F,KAAK6iB,sBAAsB9c,GAC3B/F,KAAK8iB,qBAAqB/c,IAGtB4a,EAAAhlB,UAAAknB,sBAAR,SAA8B9c,GAA9B,IAAA1F,EAAAL,KACIA,KAAKkhB,uBAAyBP,EAAIoC,qBAC9B/iB,KAAKihB,uBACLjhB,KAAKmhB,gBACDR,EAAIoC,qBAAqBphB,OAAO,SAACxB,GAAc,OAAA4F,EAAOC,UAAUqS,KAAK,SAAApM,GAAK,OAAAA,EAAE9L,qBAAqBA,MACrGH,KAAKkhB,uBAAyBlhB,KAAKkhB,uBAAuBvf,OAAO,SAACxB,GAG9D,WAFYA,GAC0B+O,QACvB8T,MAAM,SAACC,GAElB,OADY5iB,EAAK8gB,gBAAgB9I,KAAK,SAAC1b,GAA0B,OAAAA,IAAMsmB,SAKnFjjB,KAAK2hB,yBAAyBuB,cAAcC,YAAYnjB,KAAK2hB,0BAC7D3hB,KAAKuhB,sBAAsBvhB,KAAK6gB,mBAG5BF,EAAAhlB,UAAAmnB,qBAAR,SAA6B/c,GAA7B,IAAA1F,EAAAL,KACQojB,EAAQrd,EAAOC,UACfqd,EAAoB3jB,EAAAmM,WAAWuX,EAAMlc,IAAI,SAAA+E,GAAK,OAAAA,EAAE9L,UAAUwI,YAC1DtH,EAAU0E,EAAOud,iBACrBtjB,KAAKqhB,cAAgBV,EAAI4C,mBAAmB5hB,OAAO,SAACiH,GAAY,OAAAvH,EAAQgX,KAAK,SAAAlb,GAAK,OAAAA,EAAEyL,mBAAmBA,MACvG5I,KAAKohB,qBAAuBT,EAAI4C,mBAAmB5hB,OAAO,SAACiH,GAEvD,OADeya,EAAkBtK,SAASnQ,SAClBA,GAAWsG,QAAQ8T,MAAM,SAACC,GAC9C,OAAO5iB,EAAKghB,cAAchJ,KAAK,SAACpb,GAAwB,OAAAA,IAAMgmB,QAItEjjB,KAAKmiB,uBAAuBe,cAAcC,YAAYnjB,KAAKmiB,wBAC3DniB,KAAKwhB,oBAAoBxhB,KAAK8gB,kBAIxBH,EAAAhlB,UAAA4lB,sBAAV,SAAgCjZ,GAAhC,IAAAjI,EAAAL,KACIA,KAAK2hB,yBAA2B6B,SAASC,cAAc,OACvDzjB,KAAK2hB,yBAAyBM,MAAM3J,SAAW,WAC/CtY,KAAK2hB,yBAAyBM,MAAMyB,OAAS,kBAC7CF,SAASG,KAAKC,YAAY5jB,KAAK2hB,0BAC/B3hB,KAAKkhB,uBACJha,IAAI,SAAA/G,GAAa,WAAIA,IACrBgD,QAAQ,SAAChD,GACN,IAAI4I,EAAQ5I,EAAU/C,KACjBiD,EAAK8gB,gBAAgBja,IAAI,SAAAvK,GAAK,WAAIA,GAAIS,OAAM2b,SAAS5Y,EAAU/C,QAChE2L,GAAS,MAEb,IAAIxC,EAAMpG,EAAUO,MAChBmjB,EAAMxjB,EAAKyjB,cAAc/a,EAAOxC,GACpClG,EAAKshB,yBAAyBiC,YAC1BC,GAGJA,EAAIE,aAAe,WAAQ1jB,EAAKuiB,SAASziB,IAErCmI,IACAub,EAAIG,QAAU,WACV1b,EAAGnI,QAMTwgB,EAAAhlB,UAAA6lB,oBAAV,SAA8BlZ,GAA9B,IAAAjI,EAAAL,KACIA,KAAKmiB,uBAAyBqB,SAASC,cAAc,OACrDzjB,KAAKmiB,uBAAuBF,MAAM3J,SAAW,WAC7CtY,KAAKmiB,uBAAuBF,MAAMyB,OAAS,kBAC3CF,SAASG,KAAKC,YAAY5jB,KAAKmiB,wBAE/BniB,KAAKohB,qBACAla,IAAI,SAAAsH,GAAW,WAAIA,IACnByV,KAAK,SAACxd,EAAEwF,GAAM,OAAAxF,EAAE/F,MAAQuL,EAAEvL,OAAS,EAAI,IACvCyC,QAAQ,SAAAyF,GACL,IAAIG,EAAQH,EAAQxL,KACfiD,EAAKghB,cAAcna,IAAI,SAAAjK,GAAK,WAAIA,GAAIG,OAAM2b,SAASnQ,EAAQxL,QAC5D2L,GAAS,MAEb,IAAIxC,EAAMqC,EAAQlI,MACdmjB,EAAMxjB,EAAKyjB,cAAc/a,EAAOxC,GACpClG,EAAK8hB,uBAAuByB,YAAYC,GACxCA,EAAIE,aAAe,WAAQ1jB,EAAKuiB,SAASha,IAErCN,IACAub,EAAIG,QAAU,WAAQ1b,EAAGM,QAKjC+X,EAAAhlB,UAAAmoB,cAAR,SAAsB/a,EAAerI,GACjC,IAAIwjB,EAAKxjB,EAAM+B,OAAO,IAAKgR,WAAW,IAAK7P,QAC3CsgB,EAAGzd,EAAI,GACP,IAAI0d,EAAKzjB,EAAM0F,QAAQ,IAAKqN,WAAW,IAAK7P,QACxCwgB,EAAgBZ,SAASC,cAAc,UAyB3C,OAvBAW,EAAcC,YAActb,EAE5Bqb,EAAcnC,MAAMqC,QAAU,QAC9BF,EAAcnC,MAAMzf,SAAW,MAE/B4hB,EAAcnC,MAAMsC,WAAa,YACjCH,EAAcnC,MAAMuC,WAAa,MACjCJ,EAAcnC,MAAMwC,QAAU,MAC9BL,EAAcnC,MAAMzhB,MAAQ,QAC5B4jB,EAAcnC,MAAMyC,cAAgB,YACpCN,EAAcnC,MAAMyB,OAAS,mCAE7BU,EAAcnC,MAAM0C,WAAaT,EAAG1X,SACpC4X,EAAcnC,MAAMvhB,MAAQyjB,EAAG3X,SAC/B4X,EAAcQ,YAAc,WACxBR,EAAcnC,MAAM0C,WAAaT,EAAGW,SAAS,IAAKze,QAAQ,KAAMoG,SAChE4X,EAAcnC,MAAMvhB,MAAQyjB,EAAG/d,QAAQ,IAAKoG,UAEhD4X,EAAcU,aAAe,WACzBV,EAAcnC,MAAM0C,WAAaT,EAAG1X,SACpC4X,EAAcnC,MAAMvhB,MAAQyjB,EAAG3X,UAG5B4X,GAnMJzD,EAAAoC,sBACHrM,EAAArB,YACAqB,EAAA1B,SACA0B,EAAAzB,eACGyB,EAAAL,eAMAsK,EAAA4C,mBAAqBxP,EAAA5B,YA2LhCwO,EA3MA,CAAyBnhB,EAAAulB,SAAZjoB,EAAA6jB,qaCbb,IAAAlE,EAAA/f,EAAA,GACA8C,EAAA9C,EAAA,GAGAuN,EAAA,SAAA/J,GAAA,SAAA+J,IAAA,IAAA5J,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAyc,YAAc,IAAA/Q,EAWlB,OAZ8BrJ,EAAAuH,EAAA/J,GAG1B+J,EAAAtO,UAAAuI,MAAA,WACI,IAAI5D,EAAIN,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EACjC5D,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAcpE,KAAK8c,YAC7C,OACI,IAAItd,EAAAgC,OAAO6C,KAAKC,MAAMhE,GAAI+D,KAAKC,MAAM/D,GAAG,KAKpD0J,EAZA,CAA8BwS,EAAApT,gBAAjBvM,EAAAmN,0aCJb,IAAAwS,EAAA/f,EAAA,GACA+C,EAAA/C,EAAA,GAIAqN,EAAA,SAAA7J,GAAA,SAAA6J,IAAA,IAAA1J,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YAEIK,EAAA2kB,WAAmB,KAAAjZ,EAiCvB,OAnCgCrJ,EAAAqH,EAAA7J,GAG5B6J,EAAApO,UAAA+H,gBAAA,SAAgBC,GAMb,OALI3D,KAAKilB,gBAGLthB,EAAOrD,EAAIN,KAAKD,IAAIO,GAEjBqD,GAGVoG,EAAApO,UAAAkI,QAAA,SAAQF,GACJ,GAAI3D,KAAKilB,cAAe,CACpB,IAAIvd,EAAU1H,KAAKyH,YAAY9D,GAC3B+D,IACA1H,KAAKe,OAAS2G,EAAQ3G,OAElB2G,IACA1H,KAAKglB,WAAatd,SAI1B,GAAI1H,KAAKe,SAAWtB,EAAAuB,YAAYqR,GAAI,CAChC,IAAI6S,EAAYllB,KAAKglB,WAAWjlB,IAAIQ,EAAIP,KAAKI,OAAO+kB,SAAW,GAE3DtF,EAAIxb,KAAKyG,IAAIoa,EAAW7gB,KAAK2G,IAAI,IAAKhL,KAAKglB,WAAWjlB,IAAIQ,EAAIoD,EAAOpD,IACzEP,KAAKolB,UAAWvF,EAAE,GAAI,IACtB7f,KAAKD,IAAIQ,EAAIP,KAAKglB,WAAWjlB,IAAIQ,EAAIP,KAAKoE,iBAEtCyb,EAAIxb,KAAK2G,IAAI,IAAKrH,EAAOpD,EAAIP,KAAKglB,WAAWjlB,IAAIQ,GACrDP,KAAKolB,UAAWvF,EAAE,GAAI,KAItC9V,EAnCA,CAAgC0S,EAAA9S,YAAnB7M,EAAAiN,4aCLb,IAAA0S,EAAA/f,EAAA,GACA8C,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACAmD,EAAAnD,EAAA,GAEAmN,EAAA,SAAA3J,GAAA,SAAA2J,mDAoCA,OApCkCnH,EAAAmH,EAAA3J,GAE9B2J,EAAAlO,UAAA4I,aAAA,WACI,IAAIoY,EAAI,EAAE3c,KAAKmE,WAAW,EACtB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAY,EAOtC,OALI,IAAI5E,EAAAgC,OAAOlB,EAAGC,EAAE,KAChB,IAAIf,EAAAgC,OAAOlB,EAAGC,GACd,IAAIf,EAAAgC,OAAOlB,EAAGC,EAAE,MAGV2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWQ,SAGrD4K,EAAAlO,UAAAkH,KAAA,SAAKC,EAA+BC,GAGhC/C,KAAKqlB,UAAUviB,EAAK9C,KAAKD,IAAIO,EAAGN,KAAKD,IAAIQ,GACzCP,KAAKqI,aAAalF,QAAQ,SAAAC,GAAU,OAAAA,EAAOP,KAAKC,EAAKC,MAIjD8G,EAAAlO,UAAA0pB,UAAR,SAAkBviB,EAAKwiB,EAAMC,GACzB,IAAI1F,EAAI7f,KAAKoE,YACTuY,EAAI3c,KAAKmE,WACbrB,EAAIsJ,YACJtJ,EAAIuJ,OAAO,EAAIiZ,EAAMzF,EAAI0F,GAEzBziB,EAAI0iB,cAAc,EAAIF,EAAMzF,EAAI,IAAM0F,EAAM,IAAMD,EAAM,GAAKC,EAAM5I,EAAI,GAAK2I,EAAM,EAAIC,GACtFziB,EAAI0iB,cAAc7I,EAAI,GAAK2I,EAAM,EAAIC,EAAM5I,EAAI,EAAI2I,EAAM,GAAKC,EAAM5I,EAAI,GAAK2I,EAAM,GAAKC,GACxFziB,EAAI0iB,cAAc7I,EAAI,EAAI2I,EAAM,GAAKC,EAAM5I,EAAI2I,EAAOzF,EAAE,GAAM0F,EAAM5I,EAAI2I,EAAMzF,EAAI0F,GAClFziB,EAAIwJ,OAAO,EAAIgZ,EAAMzF,EAAI0F,GACzBziB,EAAI+J,UAAY7M,KAAKqG,YAAYmG,SACjC1J,EAAIuI,QAEZxB,EApCA,CAAkC4S,EAAAlT,UAArBzM,EAAA+M,8aCLb,IAAArK,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GAEAgD,EAAAhD,EAAA,GAEA+C,EAAA/C,EAAA,GACAiD,EAAAjD,EAAA,IAEAiN,EAAA,SAAAzJ,GAAA,SAAAyJ,IAAA,IAAAtJ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAA4kB,iBACA5kB,EAAAa,WAAU6K,EAiJd,OAnJgCrJ,EAAAiH,EAAAzJ,GAK5ByJ,EAAAhO,UAAA2K,UAAA,WAAc,OAAOtG,KAAKU,MAAM+B,OAAO,KAEvCkH,EAAAhO,UAAAkH,KAAA,SAAKC,EAAKC,GACN,IAAI0iB,EAAOzlB,KAAKiD,OAChBvD,EAAAsD,SAASF,EAAK2iB,EAAM,EAAGzlB,KAAKU,MAAM+B,OAAO,KAGzCgjB,EAAKnlB,EAAImlB,EAAKnlB,EAAIN,KAAKmE,WADf,EAERshB,EAAKjlB,OAAgBR,KAAKmE,WAFlB,EAEM,EACdzE,EAAAsD,SAASF,EAAK2iB,EAAM,EAAGzlB,KAAKU,MAAM+B,OAAO,KACzCvC,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,IAGpB4G,EAAAhO,UAAAuI,MAAA,WACI,IAAI5D,EAAIN,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EACjC5D,EAAIP,KAAKD,IAAIQ,EACjB,OACI,IAAIf,EAAAgC,OAAO6C,KAAKC,MAAMhE,GAAIC,KAIlCoJ,EAAAhO,UAAA6I,MAAA,SAAMC,kBAAA,IAAgC9E,EAAA+E,OAClC,IAAIC,EAAIF,EAEJihB,EAAY1lB,KAAKmE,WAAW,EAC5B7D,EAAIN,KAAKD,IAAIO,EAAIolB,EAGjBzL,EAAOtV,EAAEE,aAAa7E,KAAKkE,QAAQ,GAAIxE,EAAAoF,iBACvCyQ,EAAQ5Q,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAEN,KAAK2lB,cAAc,IAAKjmB,EAAAoF,iBAChEH,EAAES,KAAK6U,EAAK1E,GAEZ,IAAIqQ,EAAU5lB,KAAK2lB,cAEnBjmB,EAAAsM,SAAS4Z,EAAS,GAAGziB,QAAQ,SAAC6B,OAACgZ,EAAAhZ,EAAA,GAAG6gB,EAAA7gB,EAAA,GAC1Bkd,EAAMvd,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAE0d,GAAKte,EAAAoF,iBACvCghB,EAAMnhB,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAEulB,GAAKnmB,EAAAoF,iBAC3CH,EAAES,KAAK8c,EAAK4D,KAGhB,IAAIA,EAAMnhB,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAGN,KAAKD,IAAIQ,EAAIP,KAAKoE,aAAc1E,EAAAoF,iBACnEihB,EAAMphB,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAGslB,EAAQA,EAAQrqB,OAAO,IAAKmE,EAAAoF,iBACnEH,EAAES,KAAK0gB,EAAIC,GAEXH,EAAQziB,QAAQ,SAAA0iB,GACZ,IAAIC,EAAMnhB,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAEulB,GAAKnmB,EAAAoF,iBAEvC8c,EAAOjd,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAEolB,EAAUG,GAAKnmB,EAAAoF,iBACtDH,EAAES,KAAKwc,EAAKkE,GAEZ,IAAIE,EAAQrhB,EAAEE,aAAa,IAAIrF,EAAAgC,OAAOlB,EAAEolB,EAAUG,GAAKnmB,EAAAoF,iBACvDH,EAAES,KAAK0gB,EAAIE,KAGf,IAAkB,IAAAjhB,EAAA,EAAAC,EAAAhF,KAAKmB,kBAAL4D,EAAAC,EAAAzJ,OAAAwJ,IAAwB,CAArC,IAAIE,EAAKD,EAAAD,GACNG,EAAOP,EAAEE,aAAaI,EAAME,WAAWpF,IAAKL,EAAAoF,iBAC5CO,EAAYV,EAAEE,aAAaI,EAAMf,QAAQ,GAAIxE,EAAAoF,iBACjDH,EAAES,KAAKC,EAAWH,GAClBP,EAAES,KAAKF,EAAMG,GAEbJ,EAAMT,MAAMG,GAGhB,OAAOA,GAGHgF,EAAAhO,UAAAgqB,YAAR,WAII,IAHA,IACIM,EAAY5hB,KAAKC,MAAOtE,KAAKoE,YADlB,IAEXwhB,KACU7gB,EAAA,EAAAC,EAAAtF,EAAAyL,MAAM8a,GAANlhB,EAAAC,EAAAzJ,OAAAwJ,IAAkB,CAA3B,IAAI1J,EAAC2J,EAAAD,GACN6gB,EAAQnqB,KACJ,GAAKuE,KAAKD,IAAIQ,EALP,GAKWlF,GAG1B,OAAOuqB,GAGXjc,EAAAhO,UAAAsI,MAAA,WACI,IAAIiiB,KAEJA,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EAC7BnE,KAAKD,IAAIQ,EACTd,EAAAuB,YAAYqR,KAIpB,IAAc,IAAAtN,EAAA,EAAAC,EAAAhF,KAAK2lB,cAAL5gB,EAAAC,EAAAzJ,OAAAwJ,IAAoB,CAA7B,IAAIxE,EAACyE,EAAAD,GACNmhB,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAGC,EACZd,EAAAuB,YAAYoR,OAIpB8T,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAClB5D,EACAd,EAAAuB,YAAYC,QAYxB,OAPAilB,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EAC7BnE,KAAKD,IAAIQ,EAAIP,KAAKoE,YAClB3E,EAAAuB,YAAYsR,OAGb4T,GAGXvc,EAAAhO,UAAAoI,YAAA,SAAYJ,GACR,OAAI3D,KAAKilB,gBACLjlB,KAAKilB,kBAAgB,IAM7Btb,EAAAhO,UAAA+H,gBAAA,SAAgBC,GAOZ,OANI3D,KAAKilB,cACLjlB,KAAKyH,YAAY9D,GAGjBA,EAAOpD,EAAI8D,KAAK2G,IAAIhL,KAAKI,OAAO+kB,SAAW,IAAKxhB,EAAOpD,GAEpDoD,GAIXgG,EAAAhO,UAAAkI,QAAA,SAAQF,GACJ3D,KAAKD,IAAIQ,EAAIP,KAAKI,OAAO+kB,SAAW,EAC/BnlB,KAAKilB,eACRjlB,KAAKolB,UAAUzhB,EAAOpD,EAAIP,KAAKI,OAAO+kB,WAIhDxb,EAnJA,CAAgCV,EAAAhJ,UAAnBnD,EAAA6M,4aCRb,IAAAnK,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACA+C,EAAA/C,EAAA,GAEAypB,EAAAzpB,EAAA,IACAmD,EAAAnD,EAAA,GAEA+M,EAAA,SAAAvJ,GAAA,SAAAuJ,IAAA,IAAApJ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAa,WAAU6K,EAsFd,OAvFwCrJ,EAAA+G,EAAAvJ,GAGpCuJ,EAAA9N,UAAA4I,aAAA,WACI,OAAOvE,KAAKkE,QAAQgD,IAAI,SAAArJ,GAEpB,OADAA,EAAE0C,GAAK,GACA,IAAI0I,EAAAnJ,YAAYjC,EAAGgC,EAAApB,WAAWM,WAI7C0K,EAAA9N,UAAAmI,eAAA,eAAAzD,EAAAL,KAEU2I,EAAA3I,KAAAG,UAAAwI,SACN,GAAIA,GAAYA,EAASpN,OAAS,EAAG,CACjC,IAAI6qB,EAAU,IAAIzd,EAAS,GAC3B3I,KAAKuE,eAAepB,QAAQ,SAAAkjB,GACxB,IAAIC,EAAY,IAAIH,EAAAxP,OAAOyP,EAASC,EAAM/N,UAC1CjY,EAAK2H,UAAUse,OAS3B7c,EAAA9N,UAAAsI,MAAA,WACI,IAAIiiB,KACJA,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAAa,EAC/BnE,KAAKD,IAAIQ,EAAIP,KAAKoE,YAClB3E,EAAAuB,YAAYsR,OAIpB,IAAIiU,EAAQvmB,KAAKoE,YAiBjB,OAhBA8hB,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAGN,KAAKD,IAAIQ,EAAIgmB,EACzB9mB,EAAAuB,YAAYoR,OAIpB8T,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAClBnE,KAAKD,IAAIQ,EAAIgmB,EACb9mB,EAAAuB,YAAYC,QAKbilB,GAGXzc,EAAA9N,UAAA+H,gBAAA,SAAgBC,GAEZ,OADAA,EAAOpD,EAAIP,KAAKI,OAAO+kB,SAChBxhB,GAGX8F,EAAA9N,UAAAkI,QAAA,SAAQF,GACJ3D,KAAKD,IAAM4D,EACX3D,KAAKD,IAAIQ,GAAKP,KAAKoE,YAAc,GAMrCqF,EAAA9N,UAAAkH,KAAA,SAAKC,EAA+BC,GAChC,IAAIrC,EAAQV,KAAKqG,YAEjBvD,EAAI+J,UAAYnM,EAAM8L,SAEtB1J,EAAIgK,SAAS9M,KAAKD,IAAIO,EAAGN,KAAKD,IAAIQ,EAAGP,KAAKmE,WAAYnE,KAAKoE,aAG3D,IACIoiB,EAAQxmB,KAAKD,IAAIO,EAASN,KAAKmE,WAAa,EAAvB,EACrBsiB,EAAQzmB,KAAKD,IAAIQ,EAFA,GAGrBuC,EAAIgK,SAAS0Z,EAAOC,EAAO,EAHN,IAIrB3jB,EAAIgK,SAAS0Z,EAAOC,EAAO,GAAI,GAE/BvmB,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,IAGpB0G,EAAA9N,UAAA2K,UAAA,WAAc,OAAO9G,EAAA6C,MAAMC,OAC/BmH,EAvFA,CAAwCR,EAAAhJ,UAA3BnD,EAAA2M,obCPb,IAAAjK,EAAA9C,EAAA,GACAuM,EAAAvM,EAAA,GACA+C,EAAA/C,EAAA,GACAmD,EAAAnD,EAAA,GAEA6M,EAAA,SAAArJ,GAAA,SAAAqJ,IAAA,IAAAlJ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAa,WACAb,EAAAS,aAAYiL,EA8DhB,OAhE8BrJ,EAAA6G,EAAArJ,GAI1BqJ,EAAA5N,UAAAsI,MAAA,WACI,IAAIiiB,KACAK,EAAQvmB,KAAKoE,YAkBjB,OAfA8hB,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAGN,KAAKD,IAAIQ,EAAIgmB,EACzB9mB,EAAAuB,YAAYoR,OAIpB8T,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAClBnE,KAAKD,IAAIQ,EAAIgmB,EACb9mB,EAAAuB,YAAYC,QAIbilB,GAGX3c,EAAA5N,UAAAkI,QAAA,SAAQF,GACJ3D,KAAKyH,YAAY9D,IAGrB4F,EAAA5N,UAAAkH,KAAA,SAAKC,EAA+BC,GAChC,IAAIrC,EAAeV,KAAKqG,YAExBvD,EAAIsJ,YACJtJ,EAAI4jB,IACA1mB,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EAC7BnE,KAAKD,IAAIQ,EAAIP,KAAKoE,YAClBpE,KAAKoE,YAAY,IACjB,EACAC,KAAKsiB,OAGT7jB,EAAI8jB,YACJ9jB,EAAI+J,UAAYnM,EAAM8L,SACtB1J,EAAIuI,OAEJnL,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,IAGpBwG,EAAA5N,UAAA2K,UAAA,WAAc,OAAO9G,EAAA6C,MAAMC,MAAMG,OAAO,MAExC8G,EAAA5N,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAc,EAOxC,OALI,IAAI5E,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GAEpB,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWK,UAEzDyK,EAhEA,CAA8BN,EAAAhJ,UAAjBnD,EAAAyM,0aCLb,IAAAN,EAAAvM,EAAA,GACA+C,EAAA/C,EAAA,GAEA8C,EAAA9C,EAAA,GACAmD,EAAAnD,EAAA,GACAgD,EAAAhD,EAAA,GAEA2M,EAAA,SAAAnJ,GAAA,SAAAmJ,IAAA,IAAAhJ,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAyc,YAAsB,GACtBzc,EAAAM,UAAoB,GACpBN,EAAAS,aACAT,EAAAa,WAAU6K,EAmFd,OAvFoCrJ,EAAA2G,EAAAnJ,GAMhCmJ,EAAA1N,UAAA2K,UAAA,WAAc,OAAOtG,KAAKU,MAAM+B,OAAO,KAEvC4G,EAAA1N,UAAAkH,KAAA,SAAKC,EAA+BC,GAEhC,IAAI8jB,EAAY7mB,KAAKkD,iBACjB4jB,EAAa9mB,KAAKkD,iBAAiBT,OAAO,IAE9C/C,EAAAsD,SAASF,EAAK9C,KAAKiD,OAAQ,GAAK4jB,GAEhCnnB,EAAAsD,SACIF,GACExC,EAAGN,KAAKM,EAAGC,EAAGP,KAAKO,EAAIP,KAAKoE,YAAcpE,KAAK8c,YAC/Ctc,MAAOR,KAAKmE,WAAY1D,OAAQT,KAAK8c,aACrC,GACAgK,GAGN5mB,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,IAGpBsG,EAAA1N,UAAAsI,MAAA,WACI,IAAIiiB,KACAK,EAAQvmB,KAAKoE,YAAcpE,KAAK8c,YAChCiK,EAAiB/mB,KAAK8H,UACtB9H,KAAKD,IAAIO,EACTN,KAAKD,IAAIQ,EAAIgmB,EACb9mB,EAAAuB,YAAYoR,MAEhB8T,EAASzqB,KAAKsrB,GAEd,IAAIC,EAAkBhnB,KAAK8H,UACvB9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAClBnE,KAAKD,IAAIQ,EAAIgmB,EACb9mB,EAAAuB,YAAYC,OAqBhB,OAnBAilB,EAASzqB,KAAKurB,GAGdd,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EAC7BnE,KAAKD,IAAIQ,EACTd,EAAAuB,YAAYqR,KAKpB6T,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EAC7BnE,KAAKD,IAAIQ,EAAIP,KAAKoE,YAClB3E,EAAAuB,YAAYsR,OAGb4T,GAGX7c,EAAA1N,UAAAuI,MAAA,WACI,IAAI5D,EAAIN,KAAKD,IAAIO,EAAIN,KAAKmE,WAAW,EACjC5D,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAYpE,KAAK8c,YAC3C,OACI,IAAItd,EAAAgC,OAAO6C,KAAKC,MAAMhE,GAAI+D,KAAKC,MAAM/D,MAI7C8I,EAAA1N,UAAAkI,QAAA,SAAQF,GACJ3D,KAAKyH,YAAY9D,IAGrB0F,EAAA1N,UAAA4I,aAAA,WACI,IAAIoY,EAAI3c,KAAKmE,WAAW,EACpB7D,EAAIN,KAAKD,IAAIO,EAAIqc,EACjBpc,EAAIP,KAAKD,IAAIQ,EAAIP,KAAKoE,YAAcpE,KAAK8c,YAAc,GAO3D,OALI,IAAItd,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,GAEpB,IAAIf,EAAAgC,OAAOlB,EAAIqc,EAAE,EAAGpc,IAGd2G,IAAI,SAAA/J,GAAK,WAAI8L,EAAAnJ,YAAY3C,EAAG0C,EAAApB,WAAWK,UAEzDuK,EAvFA,CAAoCJ,EAAAhJ,UAAvBnD,EAAAuM,gbCPb,IAAAJ,EAAAvM,EAAA,GAEA+C,EAAA/C,EAAA,GAGAyM,EAAA,SAAAjJ,GAAA,SAAAiJ,IAAA,IAAA9I,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAAM,UAAoB,EAEpBN,EAAA4kB,iBACA5kB,EAAAU,OAAsBtB,EAAAuB,YAAYoR,KA+ClC/R,EAAA4mB,QAAkB,EAAAlb,EAsBtB,OAzEkCrJ,EAAAyG,EAAAjJ,GAM9BiJ,EAAAxN,UAAA2K,UAAA,WAAc,OAAOtG,KAAKU,MAAM+B,OAAO,KAEvC0G,EAAAxN,UAAAsI,MAAA,WAEI,IAAIiiB,KACAK,EAAQvmB,KAAKoE,YAAc,EAiB/B,OAfA8hB,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAGN,KAAKD,IAAIQ,EAAIgmB,EACzB9mB,EAAAuB,YAAYoR,OAIpB8T,EAASzqB,KACLuE,KAAK8H,UACD9H,KAAKD,IAAIO,EAAIN,KAAKmE,WAClBnE,KAAKD,IAAIQ,EAAIgmB,EACb9mB,EAAAuB,YAAYC,QAIbilB,GAIX/c,EAAAxN,UAAAoI,YAAA,SAAYJ,GACR,OAAI3D,KAAKilB,gBACLjlB,KAAKilB,iBACLjlB,KAAK6D,QAAQ7D,KAAK0D,gBAAgBC,SAM1CwF,EAAAxN,UAAA+H,gBAAA,SAAgBC,GACZ,IAAIujB,EAAYvjB,EAAOC,QAMvB,OALI5D,KAAKilB,gBAELiC,EAAU3mB,EAAIP,KAAKD,IAAIQ,GAGpB2mB,GAIX/d,EAAAxN,UAAAkI,QAAA,SAAQF,GAEJ,GAAI3D,KAAKilB,cAAe,CACpB,IAAIvd,EAAU1H,KAAKyH,YAAY9D,GAC3B+D,IACA1H,KAAKe,OAAS2G,EAAQ3G,OAElB2G,GAAW1H,KAAKe,SAAWtB,EAAAuB,YAAYoR,OACvCpS,KAAKinB,QAAUvf,EAAQ3H,IAAIO,SAK/BN,KAAKe,SAAWtB,EAAAuB,YAAYoR,MAC5BpS,KAAKmnB,SAAS9iB,KAAK+iB,IAAIpnB,KAAKinB,QAAUtjB,EAAOrD,IAC7CN,KAAKD,IAAIO,EAAIN,KAAKinB,QAAUjnB,KAAKmE,YAEjCnE,KAAKmnB,SAAS9iB,KAAK+iB,IAAIpnB,KAAKD,IAAIO,EAAIqD,EAAOrD,KAI3D6I,EAzEA,CAAkCF,EAAAhJ,UAArBnD,EAAAqM,8aCLb,IAAA4K,EAAArX,EAAA,GAEA2qB,EAAA,oBAAAA,KAGA,OAFWA,EAAAte,MAAgB,YAChBse,EAAA1e,YACX0e,EAHA,GAAavqB,EAAAuqB,gBAKb,IAAAC,EAAA,SAAApnB,GAAA,SAAAonB,mDAGA,OAH6B5kB,EAAA4kB,EAAApnB,GAClBonB,EAAAve,MAAQ,kBACRue,EAAA3e,UAAaoL,EAAAlD,KACxByW,EAHA,CAA6BD,GAK7BE,EAAA,SAAArnB,GAAA,SAAAqnB,mDAGA,OAHuB7kB,EAAA6kB,EAAArnB,GACZqnB,EAAAxe,MAAQ,WACRwe,EAAA5e,UAAaoL,EAAAlD,IAAKkD,EAAAlD,IAAKkD,EAAAlD,KAClC0W,EAHA,CAAuBF,GAKvBG,EAAA,SAAAtnB,GAAA,SAAAsnB,mDAGA,OAHsB9kB,EAAA8kB,EAAAtnB,GACXsnB,EAAAze,MAAQ,UACRye,EAAA7e,UAAaoL,EAAArD,MAAOqD,EAAAtD,QAC/B+W,EAHA,CAAsBH,GAKtBI,EAAA,SAAAvnB,GAAA,SAAAunB,mDAGA,OAH6B/kB,EAAA+kB,EAAAvnB,GAClBunB,EAAA1e,MAAQ,sBACR0e,EAAA9e,UAAaoL,EAAAjE,gBAAiBiE,EAAAhE,wBACzC0X,EAHA,CAA6BJ,GAK7BK,EAAA,SAAAxnB,GAAA,SAAAwnB,mDAGA,OAHsBhlB,EAAAglB,EAAAxnB,GACXwnB,EAAA3e,MAAQ,UACR2e,EAAA/e,UAAaoL,EAAA5C,MAAO4C,EAAA5C,OAC/BuW,EAHA,CAAsBL,GAKtBM,EAAA,SAAAznB,GAAA,SAAAynB,mDAGA,OAH0BjlB,EAAAilB,EAAAznB,GACfynB,EAAA5e,MAAQ,eACR4e,EAAAhf,UAAaoL,EAAAzC,WAAYyC,EAAAzC,YACpCqW,EAHA,CAA0BN,GAK1BO,EAAA,SAAA1nB,GAAA,SAAA0nB,mDAGA,OAH0BllB,EAAAklB,EAAA1nB,GACf0nB,EAAA7e,MAAQ,eACR6e,EAAAjf,UAAaoL,EAAAvD,UAAWuD,EAAAvD,WACnCoX,EAHA,CAA0BP,GAK1BQ,EAAA,SAAA3nB,GAAA,SAAA2nB,mDAGA,OAHsBnlB,EAAAmlB,EAAA3nB,GACX2nB,EAAA9e,MAAQ,UACR8e,EAAAlf,UAAaoL,EAAAvD,UAAWuD,EAAAvD,UAAWuD,EAAAvD,WAC9CqX,EAHA,CAAsBR,GAKtBS,EAAA,SAAA5nB,GAAA,SAAA4nB,mDAGA,OAHoBplB,EAAAolB,EAAA5nB,GACT4nB,EAAA/e,MAAQ,QACR+e,EAAAnf,UAAaoL,EAAA7D,aAAc6D,EAAAvD,WACtCsX,EAHA,CAAoBT,GAKpBU,EAAA,SAAA7nB,GAAA,SAAA6nB,mDAGA,OAHkBrlB,EAAAqlB,EAAA7nB,GACP6nB,EAAAhf,MAAQ,MACRgf,EAAApf,UAAaoL,EAAAxD,YAAawD,EAAAxD,YAAawD,EAAAxD,aAClDwX,EAHA,CAAkBV,GAKlBW,EAAA,SAAA9nB,GAAA,SAAA8nB,mDAGA,OAHsBtlB,EAAAslB,EAAA9nB,GACX8nB,EAAAjf,MAAQ,UACRif,EAAArf,UAAaoL,EAAA/C,eAAgB+C,EAAA/C,gBACxCgX,EAHA,CAAsBX,GAKtBY,EAAA,SAAA/nB,GAAA,SAAA+nB,mDAGA,OAHwBvlB,EAAAulB,EAAA/nB,GACb+nB,EAAAlf,MAAQ,YACRkf,EAAAtf,UAAaoL,EAAA3C,MAAO2C,EAAA3C,OAC/B6W,EAHA,CAAwBZ,GAKxBa,EAAA,SAAAhoB,GAAA,SAAAgoB,mDAGA,OAHwBxlB,EAAAwlB,EAAAhoB,GACbgoB,EAAAnf,MAAQ,aACRmf,EAAAvf,UAAaoL,EAAA7C,SAAU6C,EAAA7C,UAClCgX,EAHA,CAAwBb,GAKxBc,EAAA,SAAAjoB,GAAA,SAAAioB,mDAGA,OAHyBzlB,EAAAylB,EAAAjoB,GACdioB,EAAApf,MAAQ,cACRof,EAAAxf,UAAaoL,EAAA/D,UAAW+D,EAAA/D,WACnCmY,EAHA,CAAyBd,GAKzBe,EAAA,SAAAloB,GAAA,SAAAkoB,mDAGA,OAHuB1lB,EAAA0lB,EAAAloB,GACZkoB,EAAArf,MAAQ,WACRqf,EAAAzf,UAAaoL,EAAAvC,WAAYuC,EAAAvC,YACpC4W,EAHA,CAAuBf,GAMvBgB,EAAA,SAAAnoB,GAAA,SAAAmoB,mDAGA,OAHsB3lB,EAAA2lB,EAAAnoB,GACXmoB,EAAAtf,MAAQ,UACRsf,EAAA1f,UAAaoL,EAAAhD,WAAYgD,EAAAhD,WAAYgD,EAAAhD,YAChDsX,EAHA,CAAsBhB,GAKtBiB,EAAA,SAAApoB,GAAA,SAAAooB,mDAGA,OAHmB5lB,EAAA4lB,EAAApoB,GACRooB,EAAAvf,MAAQ,OACRuf,EAAA3f,UAAaoL,EAAA9C,QAAS8C,EAAA9C,SACjCqX,EAHA,CAAmBjB,GAKnBkB,EAAA,SAAAroB,GAAA,SAAAqoB,mDAGA,OAHsB7lB,EAAA6lB,EAAAroB,GACXqoB,EAAAxf,MAAQ,UACRwf,EAAA5f,UAAaoL,EAAAnC,eAAgBmC,EAAAnC,gBACxC2W,EAHA,CAAsBlB,GAKTvqB,EAAAyL,mBACTsf,EACAN,EACAE,EACAE,EACAL,EACAE,EACAU,EACAF,EACAC,EACAE,EACAT,EACAI,EACAM,EACAR,EACAS,EACAC,EACAC,EACAR,kaCpHJ,IAAAS,EAAA9rB,EAAA,GAEA+rB,EAAA,SAAAvoB,GACE,SAAAuoB,IAAA,IAAApoB,EACEH,EAAArE,KAAAmE,OAAOA,YACPK,EAAK8mB,SAAS,GACd9mB,EAAK+kB,UAAU,GACf/kB,EAAKC,EAAI,EACTD,EAAKE,EAAI,EACTF,EAAKK,MAAQ,IAAI8nB,EAAGnmB,MAAM,IAAK,IAAK,KAAA0J,EAExC,OAT4BrJ,EAAA+lB,EAAAvoB,GAS5BuoB,EATA,CAA4BD,EAAGxf,OAAlBlM,EAAA2rB,kwDCFb,IAAAjpB,EAAA9C,EAAA,GAGAuQ,EAAAvQ,EAAA,GACAgsB,EAAAhsB,EAAA,IAIAgC,GAHAhC,EAAA,GAGAA,EAAA,IACAqX,EAAArX,EAAA,GAIAisB,EAAA,SAAAzoB,GAWI,SAAAyoB,EAAoBvlB,EAA0BhD,GAA9C,IAAAC,EACIH,EAAArE,KAAAmE,KAAMoD,EAAO9C,EAAG8C,EAAO7C,EAAG7B,EAAAE,MAAMC,MAAM0W,MAAO7W,EAAAE,MAAMC,MAAMQ,MAAOG,EAAA6C,MAAMC,QAAMtC,YAD5DK,EAAA+C,SAA0B/C,EAAAD,SAT9CC,EAAAuoB,UAAoBF,EAAAhN,KAAKa,aACzBlc,EAAAyX,SAA0B,KAC1BzX,EAAAgb,QAEAhb,EAAAwoB,kBAOIxoB,EAAKqB,OAASrB,EAAKqB,OAAOC,OAAO,SAAAC,GAAS,QAAEA,aAAiBpC,EAAAqC,OAAOC,sBA4I5E,OAzJ6BY,EAAAimB,EAAAzoB,GAgBzByoB,EAAAhtB,UAAA4H,OAAA,SAAOC,EAAQT,GAIX,GAHA7C,EAAAvE,UAAM4H,OAAM1H,KAAAmE,KAACwD,EAAQT,GAGjB/C,KAAK6oB,eAAgB,CACrB,IAAIC,OAAWC,MAAQC,UACvBhpB,KAAKipB,UAAYH,EAAM9oB,KAAKkpB,aAAelpB,KAAKmpB,aAChDnpB,KAAKopB,IAAI9oB,GAA6B,IAAtB+D,KAAK6G,SAAU,MAIvCyd,EAAAhtB,UAAAkH,KAAA,SAAKC,EAA+BC,GAOhC,GANA7C,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,GACZ/C,KAAK8X,WACLhV,EAAI+J,UAAYI,EAAAsG,WAAWvT,KAAK8X,UAAUtL,SAC1C1J,EAAIgK,SAAS9M,KAAKM,EAAE,EAAGN,KAAKO,EAAE,EAAG,EAAG,IAGpCP,KAAK6oB,eAAgB,CACrB/lB,EAAIqJ,UAAY,EAChB,IACIkd,EAAKrpB,KAAKM,EAAIgpB,EAAMC,EAAKvpB,KAAKO,EAAI,GACtCuC,EAAIyJ,YAAc/M,EAAA6C,MAAMC,MAAMkK,SAC9B1J,EAAIiK,WAAWsc,EAAIE,EAHV,GAAS,GAIlBzmB,EAAI+J,UAAYrN,EAAA6C,MAAM4L,OAAOxL,OAAO,IAAK+J,SACzC1J,EAAIgK,SAASuc,EAAIE,EALR,GAAS,GAMlBzmB,EAAI+J,UAAYrN,EAAA6C,MAAM4L,OAAOzB,SAC7B1J,EAAIgK,SAASuc,EAAIE,EAPR,GAOYvpB,KAAKipB,SAPR,GAWlBjpB,KAAKqb,MAcbsN,EAAAhtB,UAAAkc,MAAA,SAAM3a,GACF8C,KAAK8X,SAAW5a,GAGpByrB,EAAAhtB,UAAAqc,KAAA,WACI,GAAIhY,KAAK8X,SAAU,CACf,IAAI5a,EAAI8C,KAAK8X,SAEb,OADA9X,KAAK8X,SAAW,KACT5a,EAEX,OAAO,MAGXyrB,EAAAhtB,UAAA6tB,QAAA,SAAQzpB,GACJ,OAAOC,KAAKypB,QAAQpd,OAAOtM,EAAIO,EAAGP,EAAIQ,EAAGP,KAAK4oB,WAAWc,aAGvDf,EAAAhtB,UAAAgc,YAAN,SAAkBgS,2FAKd,OAHA3pB,KAAK6oB,kBACL7oB,KAAKkpB,iBAAmBH,MAAQC,UAChChpB,KAAKmpB,aAAeQ,GACpB,EAAM,IAAIC,QAAQ,SAACC,EAASC,GAAW,OAAA3R,WAAW0R,EAASF,oBAA3D3kB,EAAA4S,OAEA5X,KAAK6oB,mBAAiB,SAGpBF,EAAAhtB,UAAAouB,OAAN,SAAa3iB,+GAGLiU,EAAOrb,KAAKI,OAAO4pB,YAAYhqB,KAAKD,IAAI6D,QAASwD,IAE5C7L,OAAS,GACdyE,KAAKqb,KAAOA,EACZA,EAAK3D,MACL2D,EAAKrf,SACL,EAAM4tB,QAAQK,IACV5O,EAAKnU,IAAI,SAAA5F,GAAQ,OAAAjB,EAAKmpB,QAAQloB,SALlC,YAIA0D,EAAA4S,OAGA5X,KAAKqb,KAAO,KAAA1d,EAAAoL,MAAA,SAIhB,mBAGJ4f,EAAAhtB,UAAA8b,UAAA,SAAUrU,GAAV,IAAA/C,EAAAL,KACImY,WAAW,WAAM,OAAA/U,EAAOmU,SAASlX,IAAO,MAGtCsoB,EAAAhtB,UAAAuuB,KAAN,kBAAA7uB,EAAA2E,UAAA,wBAAA0T,EAAA3H,EAAAlO,EAAAF,EAAAqC,KAAA,OAAArD,EAAAqD,KAAA,SAAA1C,GAAA,OAAAA,EAAAyL,OAAA,cACQ/I,KAAK8X,UACDqS,EAAsBnqB,KAAK8X,UAC3BsS,EAAepqB,KAAKI,OAAOiqB,cAAcrqB,KAAKD,OAE9C,SAACqD,GACG,OAAAA,EAAOwF,QAAQ+F,WAAawb,IAExBA,IAASld,EAAAkD,cAAcS,MACvBuZ,IAASld,EAAAkD,cAAcE,MACvB8Z,IAASld,EAAAkD,cAAcuB,UACtBtO,EAAOwF,QAAQoG,WAAa+E,EAAA/G,iBAAiBqB,iBAClD8b,IAASld,EAAAkD,cAAcS,MAAQxN,EAAOwF,QAAQoG,WAAa+E,EAAA/G,iBAAiBsB,cAC5E6b,IAASld,EAAAkD,cAAcE,MAAQjN,EAAOwF,QAAQoG,WAAa+E,EAAA/G,iBAAiBuB,gBAIhF,EAAMvO,KAAK+pB,OAAOK,EAAKhjB,YADvB,OAfJ,YAiBI,OADApC,EAAA4S,QACA,EAAM5X,KAAKwpB,QAAQY,EAAKrqB,aACxB,OADAiF,EAAA4S,QACA,EAAMwS,EAAK7S,SAASvX,qBAApBgF,EAAA4S,oBAEAK,QAAQqS,IAAI,wBAAyBtqB,KAAK8X,sDAG1CyS,EAAiBvqB,KAAKI,OAAOiqB,cAAcrqB,KAAKD,OAGhD,SAAC5C,GAAM,OAAAA,EAAE0Z,QAAQtb,OAAS,MAI1B,EAAMyE,KAAK+pB,OAAOQ,EAAOnjB,YADzB,aAEA,OADApC,EAAA4S,QACA,EAAM5X,KAAKwpB,QAAQe,EAAOxqB,aAC1B,OADAiF,EAAA4S,QACA,EAAM2S,EAAOhT,SAASvX,qBAAtBgF,EAAA4S,sBAGA,OADAK,QAAQqS,IAAI,qDACZ,EAAM,IAAIV,QAAQ,SAACC,EAASC,GAAW,OAAA3R,WAAW0R,EAAS,gBAA3D7kB,EAAA4S,iCAIRO,WAAW,WAAM,OAAA9X,EAAK6pB,QAAQ,eAEtCvB,EAzJA,CAA6BnpB,EAAAwJ,OAAhBlM,EAAA6rB,yaCbb,IAAAnpB,EAAA9C,EAAA,GACA8tB,EAAA9tB,EAAA,IAIA+tB,EAAA,SAAAvqB,GAEI,SAAAuqB,EAAoBrqB,GAApB,IAAAC,EACIH,EAAArE,KAAAmE,KAAM,GAAII,EAAOgE,YAAc,EAAG,EAAG,IAAEpE,YADvBK,EAAAD,SADpBC,EAAAqqB,YAGIrqB,EAAKqB,OAASrB,EAAKqB,OAAOC,OAAO,SAAAC,GAAS,QAAEA,aAAiBpC,EAAAqC,OAAOC,sBAS5E,OAbgCY,EAAA+nB,EAAAvqB,GAO5BuqB,EAAA9uB,UAAAgvB,SAAA,SAASC,GACL,IAAIpT,EAAU,IAAIgT,EAAA7B,QAAQiC,EAAM5qB,KAAKI,QACrCoX,EAAQ0S,OACRlqB,KAAK0qB,SAASjvB,KAAK+b,GACnBxX,KAAKsd,IAAI9F,IAEjBiT,EAbA,CAAgCjrB,EAAAwJ,OAAnBlM,EAAA2tB,4FCFb,IAAA/qB,EAAAhD,EAAA,GAEAmuB,EAAA,WAGG,SAAAA,EAAY5Q,GACRja,KAAKwE,MAAQyV,EAAKzV,QAiBzB,OAdGqmB,EAAAlvB,UAAAmvB,SAAA,SAASC,EAAgBC,GACtB,OAAOhrB,KAAKwE,MAAMuW,aAAagQ,EAAQC,IAG1CH,EAAAlvB,UAAAsvB,YAAA,SAAYnS,GACR,IAAI5U,EAAQlE,KAAKwE,MAAM0U,MAIvB,OAHcxZ,EAAAmL,MAAM3G,EAChB,SAACyU,GAAiB,OAAAtU,KAAK+iB,IAAItO,EAASlN,SAAS+M,QAE7CnR,GAKXqjB,EArBA,GAAa/tB,EAAA+tB,kCCLb9tB,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GAAA,iBAAAF,EAAAL,EAAA0C,WAAA0C,YAAA/E,EAAA,SAAA+V,EAAA3H,GAAA,OAAApO,EAAAjC,OAAAiY,iBAAAC,wBAAAxI,OAAA,SAAAsI,EAAA3H,GAAA2H,EAAAE,UAAA7H,IAAA,SAAA2H,EAAA3H,GAAA,QAAAlO,KAAAkO,IAAAnQ,eAAAiC,KAAA6V,EAAA7V,GAAAkO,EAAAlO,MAAA6V,EAAA3H,IAAA,SAAA2H,EAAA3H,GAAA,SAAAlO,IAAAmC,KAAA6T,YAAAH,EAAA/V,EAAA+V,EAAA3H,GAAA2H,EAAA/X,UAAA,OAAAoQ,EAAArQ,OAAAoY,OAAA/H,IAAAlO,EAAAlC,UAAAoQ,EAAApQ,UAAA,IAAAkC,KAAAnC,OAAA6B,eAAAwO,EAAA,cAAAnO,OAAA,ICAxC,IAAA4B,EAAA9C,EAAA,GAEAgD,EAAAhD,EAAA,GACAga,EAAAha,EAAA,GACAwuB,EAAAxuB,EAAA,IAGAyuB,EAAA,SAAAjrB,GAKI,SAAAirB,EAAY7qB,EAAWC,GAAvB,IAAAF,EACIH,EAAArE,KAAAmE,KAAMM,EAAGC,EAAG,EAAG,IAAEP,YAJrBK,EAAA2F,aACA3F,EAAA+qB,sBAA2C,KAIvC/qB,EAAKqB,OAASrB,EAAKqB,OAAOC,OAAO,SAAAC,GAAS,QAAEA,aAAiBpC,EAAAqC,OAAOC,sBAyF5E,OAhG4BY,EAAAyoB,EAAAjrB,GAUxBirB,EAAAxvB,UAAAkH,KAAA,SAAKC,EAA+BC,GAChC7C,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,GAGZ/C,KAAKqrB,SAsBbF,EAAAxvB,UAAA2vB,cAAA,SAAclkB,GACVA,EAASxG,SACLwG,EAASjC,aACTiC,EAASjC,WAAW4C,OAAO5G,kBAAkB1F,KAAK2L,GAClDpH,KAAKurB,gBAETvrB,KAAKgG,UAAUvK,KAAK2L,GACpBA,EAAStD,iBACT9D,KAAKsd,IAAIlW,IAGb+jB,EAAAxvB,UAAAwL,sBAAA,SAAsBxD,EAAgB6nB,EAA2C/f,YAA3C+f,mBAA2C/f,MAAA,WAAyC,WACtH,IAAIC,EAAW1L,KAAKgG,UACnBrE,OAAO,SAAAyF,GACJ,SAACokB,EAAejwB,OAAS,IACvBiwB,EAAenT,KAAK,SAAAoT,GAAM,OAAArkB,EAASjH,qBAAqBsrB,MAEtDhgB,EAAUrE,KAGlB,GAAIsE,GAAYA,EAASnQ,OAAS,EAE9B,OAAOmE,EAAAmL,MAAMa,EADU,SAACtE,GAAa,OAAAzD,EAAOiI,SAASxE,EAASlD,QAAQ,OAK9EinB,EAAAxvB,UAAAquB,YAAA,SAAYe,EAAgBW,GACnB1rB,KAAKqrB,SACNrrB,KAAKurB,eAET,IAAII,EAAU3rB,KAAKqrB,QAAQJ,YAAYF,GACnCC,EAAOU,EAAYxnB,QAAQ,GAC3B0nB,EAAW5rB,KAAKqrB,QAAQJ,YAAYD,GAExC,OADWhrB,KAAKqrB,QAAQP,SAASa,EAASC,IAI9CT,EAAAxvB,UAAAkwB,oBAAA,SAAoBloB,EAAgBmoB,EAAuCrgB,YAAvCqgB,mBAAuCrgB,MAAA,WAAuC,WAC9G,IAAIpK,EAAUrB,KAAKsjB,iBAMnB,IALAjiB,EAAUA,EAAQM,OAAO,SAAAxE,GACrB,SAAC2uB,EAAavwB,OAAS,IAAIuwB,EAAazT,KAAK,SAAAzP,GAAW,OAAAzL,EAAEyL,mBAAmBA,MACzE6C,EAAUtO,OAGHkE,EAAQ9F,OAAS,EAE5B,OAAOmE,EAAAmL,MAAMxJ,EADG,SAAClE,GAAM,OAAAwG,EAAOiI,SAASzO,MAKvCguB,EAAAxvB,UAAA4vB,aAAR,WACI,IAAIQ,EAAO/rB,KAAKgG,UAAUC,KAAK,SAAAmB,GAAY,OAAAA,EAASjH,qBAAqBuW,EAAAtB,iBACrE2W,IACA/rB,KAAKqrB,QAAU,IAAIH,EAAAL,eAAekB,KAI1CZ,EAAAxvB,UAAA2nB,eAAA,WACI,OAAO5jB,EAAAmM,WAAW7L,KAAKgG,UAAUkB,IAAI,SAAA+E,GAAK,OAAAA,EAAE5D,iBAEpD8iB,EAhGA,CAA4B3rB,EAAAwJ,OAAflM,EAAAquB,waCPb,IAAA3rB,EAAA9C,EAAA,GACAgD,EAAAhD,EAAA,GAQAsvB,EAAA,SAAA9rB,GAAA,SAAA8rB,IAAA,IAAA3rB,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YACIK,EAAA4rB,WAwDJ,OAzD+BvpB,EAAAspB,EAAA9rB,GAK3B8rB,EAAArwB,UAAAuwB,aAAA,WAQI,IAPA,IAKIC,EAAOnsB,KAAKmE,WAAa,EACzBioB,EAAepsB,KAAKmE,WANR,GAOEY,EAAA,EAAAC,EAAAtF,EAAAyL,MAAM,GAANpG,EAAAC,EAAAzJ,OAAAwJ,IAGd,IAHC,IAAIsnB,EAAKrnB,EAAAD,GACNunB,EAAc,IAAID,EAClBE,EAAQ,EAAIF,GAASD,EAAe,GAC1BhZ,EAAA,EAAAqG,EAAA/Z,EAAAyL,MAVF,IAUEiI,EAAAqG,EAAAle,OAAA6X,IAAkB,CAA3B,IAAI/X,EAACoe,EAAArG,GACNpT,KAAKisB,MAAMxwB,MACP6E,EAAWjF,EAAI+wB,EAAXD,GAA4B9nB,KAAK6G,SAAWqhB,EAAUA,EAAQ,GAClE9rB,OAAQ4D,KAAK2G,IAAI,GAAI,IAZhB,IAYwB3G,KAAK6G,UAAyB7G,KAAK6G,SAAWohB,EAAcA,EAAY,QAQrHN,EAAArwB,UAAAkH,KAAA,SAAKC,EAA+BC,GAChC,IAAIypB,EAAYxsB,KAAKU,MAAM+S,WAAW,KAElCgZ,EAAczsB,KAAKU,MAAMmkB,SAAS,IAAKze,QAAQ,IAEnDtD,EAAI+J,UAAY2f,EAAUhgB,SAG1B,IAAIkgB,EAAQ1sB,KAAKD,IAAIQ,EAAE,EAEvBP,KAAKisB,MAAM9oB,QAAQ,SAAAwpB,GACf,IAAI3O,EAAK0O,EAAQC,EAAKlsB,OAClBmsB,EAAyB,IAAdD,EAAKlsB,OACpBqC,EAAIsJ,YACJtJ,EAAIuJ,OAAOsgB,EAAKrsB,EAAG0d,GACnBlb,EAAIwJ,OAAOqgB,EAAKrsB,EAAIssB,EAAUF,GAC9B5pB,EAAIwJ,OAAOqgB,EAAKrsB,EAAIssB,EAAUF,GAE9B5pB,EAAI+J,UAAY2f,EAAUhgB,SAC1B1J,EAAIuI,OAEJvI,EAAIsJ,YACJtJ,EAAIuJ,OAAOsgB,EAAKrsB,EAAG0d,GACnBlb,EAAIwJ,OAAOqgB,EAAKrsB,EAAOssB,EAAS,EAAZ,EAAgBF,GACpC5pB,EAAIwJ,OAAOqgB,EAAKrsB,EAAIssB,EAAUF,GAC9B5pB,EAAI+J,UAAY4f,EAAYjgB,SAC5B1J,EAAIuI,UAIhB2gB,EAzDA,CANA,SAAA9rB,GACI,SAAA2sB,EAAYtsB,EAAWC,EAAeE,UAClCR,EAAArE,KAAAmE,KAAM,EAAGO,EAAGC,EAAO,IAAKE,IAAMV,KAEtC,OAJ+B0C,EAAAmqB,EAAA3sB,GAI/B2sB,EAJA,CAA+BrtB,EAAAwJ,QAMlBlM,EAAAkvB,2aCTb,IAAAxD,EAAA9rB,EAAA,GACA8C,EAAA9C,EAAA,GAEAgD,EAAAhD,EAAA,GACAowB,EAAApwB,EAAA,IAGAuQ,EAAAvQ,EAAA,GACAqwB,EAAArwB,EAAA,IACAswB,EAAAtwB,EAAA,IACAqX,EAAArX,EAAA,GAIAuwB,EAAA,SAAA/sB,GAII,SAAA+sB,EACWC,EACAxsB,EACAF,EACA2sB,YADA3sB,MAAA,cACA2sB,MAAA,KAJX,IAAA9sB,EAMIH,EAAArE,KAAAmE,KAAM,EAAGmtB,EAAM,EAAG3sB,EAAO2sB,EAAOzsB,IAAMV,KAL/BK,EAAA6sB,MACA7sB,EAAAK,QACAL,EAAAG,QACAH,EAAA8sB,QAGP9sB,EAAKqB,OAASrB,EAAKqB,OAAOC,OAAO,SAAAC,GAAS,QAAEA,aAAiB4mB,EAAG3mB,OAAOC,oBAEvE,IAAI4qB,GAASS,EAAM,EAGnB9sB,EAAK+sB,YAAYV,EADC,GACmBrsB,EAAKK,MAAM0F,QAAQ,MAKxD,IAFA,IACIinB,EAAcF,EADD,GAEHpoB,EAAA,EAAAC,EAAAtF,EAAAyL,MAFG,IAEHpG,EAAAC,EAAAzJ,OAAAwJ,IAAmB,CAA5B,IAAI1J,EAAC2J,EAAAD,GACN1E,EAAK+sB,YACDV,EARU,GAQaW,EAAY,EAAMA,GAAehyB,EAAE,GAC1DgyB,EACAhtB,EAAKK,MAAM+B,OAAO,IAAO,IAAOpH,WAIxCgF,EAAKid,IAAI,IAAIwP,EAAAd,WAAWmB,EAAM,EAAG9sB,EAAK8D,WAAY9D,EAAKK,MAAM0F,QAAQ,OAErE/F,EAAK0F,OAAS,IAAIgnB,EAAA5B,OAAO,GAAGgC,EAAM,GAClC9sB,EAAKid,IAAIjd,EAAK0F,QAEd1F,EAAKitB,WAAa,IAAIN,EAAAvC,WAAWpqB,GACjCA,EAAKid,IAAIjd,EAAKitB,cA6EtB,OAhH4B5qB,EAAAuqB,EAAA/sB,GAsChB+sB,EAAAtxB,UAAAyxB,YAAR,SAAoB7sB,EAAWpB,EAAcuB,GACzC,IAAI6sB,EAAW,IAAI/tB,EAAAwJ,MAAM,EAAGzI,EAAGP,KAAKmE,WAAYhF,EAAMuB,GACtDV,KAAKsd,IAAIiQ,IAGbN,EAAAtxB,UAAAkH,KAAA,SAAKC,EAA+BC,GAChC7C,EAAAvE,UAAMkH,KAAIhH,KAAAmE,KAAC8C,EAAKC,GAEZ/C,KAAKorB,uBACLprB,KAAKorB,sBAAsBvoB,KAAKC,EAAKC,IAI7CrH,OAAA6B,eAAI0vB,EAAAtxB,UAAA,WAAA+B,IAAJ,WACI,IAEI8vB,EAFUxtB,KAAK+F,OAAOud,iBACFpc,IAAI,SAAC/J,GAAc,OAAAA,EAAEyL,QAAQuG,UAC1B3E,OAAOyC,EAAA6F,WAAY7F,EAAAmC,eAE1Cqe,EAAgBztB,KAAKstB,WAAW5C,SAASnvB,OAI7C,OAHAiyB,EAAoB1c,QAAEnB,OAAS8d,EAC/BD,EAAmB5d,OAAED,QAAU8d,EAC/BD,EAAkBvd,MAAEN,QAAU8d,EACvBD,mCAGXP,EAAAtxB,UAAA4H,OAAA,SAAOC,EAAQT,GACX7C,EAAAvE,UAAM4H,OAAM1H,KAAAmE,KAACwD,EAAQT,GAErB/C,KAAK+F,OAAOC,UAAU7C,QAAQ,SAAAiE,GAAY,OAAAA,EAAS7D,OAAOC,EAAQT,KAClE/C,KAAKstB,WAAW5C,SAASvnB,QAAQ,SAAAqU,GAAW,OAAAA,EAAQjU,OAAOC,EAAQT,MAGvErH,OAAA6B,eAAI0vB,EAAAtxB,UAAA,yBAAA+B,IAAJ,WACI,OAAOsC,KAAK+F,OAAOqlB,uDAGvB6B,EAAAtxB,UAAA6J,OAAA,SAAOuS,GACH/X,KAAKktB,IAAI7K,iBAAiBtK,IAG9BkV,EAAAtxB,UAAA2vB,cAAA,SAAclkB,GACVpH,KAAK+F,OAAOulB,cAAclkB,IAG9B6lB,EAAAtxB,UAAA8J,SAAA,SAAS1F,GACL,GAAIC,KAAKstB,WAAW5C,SAASnvB,OAASyE,KAAK2iB,OAAQ,CAC/C,IAAIiI,EAAO5qB,KAAKqqB,cAActqB,GAAMgU,EAAAzC,aACpCtR,KAAKstB,WAAW3C,SAASC,KAIjClvB,OAAA6B,eAAI0vB,EAAAtxB,UAAA,UAAA+B,IAAJ,WAEI,IAEIgwB,EAFU1tB,KAAK+F,OAAOud,iBACFpc,IAAI,SAAC/J,GAAc,OAAAA,EAAEyL,QAAQuG,UACb3E,OAAOyC,EAAA6F,WAAY7F,EAAAmC,eAEvDue,GAAW1gB,EAAAwF,UAAU3B,QAAS7D,EAAAwF,UAAUxC,MAAOhD,EAAAwF,UAAU7C,QAC7D,OAAOvL,KAAKyG,IAAG5O,MAARmI,KACAspB,EAAOzmB,IAAI,SAAA0mB,GAAO,OAAA3gB,EAAA2F,kBAAkB8a,EAAyBE,uCAIxEX,EAAAtxB,UAAAwL,sBAAA,SAAsBxD,EAAgB6nB,EAAsC/f,GACxE,gBADwEA,MAAA,WAAuC,WACxGzL,KAAK+F,OAAOoB,sBAAsBxD,EAAQ6nB,EAAgB/f,IAGrEwhB,EAAAtxB,UAAA0uB,cAAA,SAAc1mB,EAAgBmoB,EAAuCrgB,GACjE,gBAD0BqgB,mBAAuCrgB,MAAA,WAAuC,WACjGzL,KAAK+F,OAAO8lB,oBAAoBloB,EAAQmoB,EAAcrgB,IAGjEwhB,EAAAtxB,UAAAquB,YAAA,SAAYe,EAAgBW,GACxB,OAAO1rB,KAAK+F,OAAOikB,YAAYe,EAAQW,IAE/CuB,EAhHA,CAA4BztB,EAAAwJ,OAAflM,EAAAmwB,waCdb,IAAAztB,EAAA9C,EAAA,GAEAmxB,EAAAnxB,EAAA,IACAoxB,EAAApxB,EAAA,IACAga,EAAAha,EAAA,GACAuM,EAAAvM,EAAA,GACAqxB,EAAArxB,EAAA,IACAwN,EAAAxN,EAAA,IACAypB,EAAAzpB,EAAA,IACAqX,EAAArX,EAAA,GACAsxB,EAAAtxB,EAAA,IACAuxB,EAAAvxB,EAAA,IACAwxB,EAAAxxB,EAAA,IACAyxB,EAAAzxB,EAAA,IACA0xB,EAAA1xB,EAAA,IACA2xB,EAAA3xB,EAAA,IACA4xB,EAAA5xB,EAAA,IAGA6xB,EAAA,SAAAruB,GAAA,SAAAquB,IAAA,IAAAluB,EAAA,OAAAH,KAAAhE,MAAA8D,KAAAuP,YAAAvP,YAMIK,EAAAmuB,YAGAnuB,EAAAouB,eAAyB,oCAAA1iB,EA6N7B,OAtO+BrJ,EAAA6rB,EAAAruB,GA4C3BquB,EAAA5yB,UAAA4H,OAAA,SAAOC,EAAQT,GACX7C,EAAAvE,UAAM4H,OAAM1H,KAAAmE,KAACwD,EAAQT,GAErB/C,KAAKktB,IAAI5K,cAActiB,KAAKI,YAGzBmuB,EAAA5yB,UAAAuwB,aAAP,SAAoBtL,GAApB,IAAAvgB,EAAAL,KACIA,KAAK4gB,KAAOA,EAGZ5gB,KAAKktB,IAAM,IAAIa,EAAApN,IAAIC,EAAM,SAACzgB,GAEtBE,EAAKquB,kBAAkBvuB,IACxB,SAACiD,GACA/C,EAAKquB,kBAAkBtrB,KAE3BpD,KAAKsd,IAAItd,KAAKktB,KAEdltB,KAAKI,OAAS,IAAIytB,EAAAZ,OAAOjtB,KAAKktB,IAAKtM,EAAKjF,MAAMjb,OAC9CV,KAAKsd,IAAItd,KAAKI,QAEdJ,KAAK2uB,OAAS,IAAIb,EAAArF,OAClBzoB,KAAKsd,IAAItd,KAAK2uB,QAEd3uB,KAAK4uB,sBACL5uB,KAAK6uB,OAAO/Z,KAAK,MACjB9U,KAAK6uB,OAAO/Z,KAAK,EAAG,MAGjByZ,EAAA5yB,UAAAmzB,WAAP,eAAAzuB,EAAAL,KACIA,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQltB,GAAG,OAAQ,SAACgK,GACzC,GAAI1L,EAAKmuB,SACLnuB,EAAKwuB,OAAO9uB,IAAMM,EAAKwuB,OAAO9uB,IAAIud,IAC9Bjd,EAAK6uB,WAAWtnB,IAAImE,EAAEhM,UAEvB,CACHM,EAAKsuB,OAAO5uB,IAAMgM,EAAEhM,IAEpB,IAAIovB,EAAoB9uB,EAAKD,OAAOgrB,sBACpC,GAAI+D,aAA6BlmB,EAAAhJ,SAAU,CAEvC,IAAImvB,EAAcD,EAAkBzrB,gBAAgBrD,EAAKsuB,OAAO5uB,KAChEM,EAAKsuB,OAAO5uB,IAAMqvB,EAElBD,EAAkBtrB,QAAQxD,EAAKsuB,OAAO5uB,UAC/BovB,aAA6BhJ,EAAAxP,QAEpCwY,EAAkB/W,KAAK/X,EAAKD,OAAQC,EAAKsuB,OAAO5uB,QAK5DC,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQltB,GAAG,KAAM,WAClC1B,EAAKmuB,WAAYnuB,EAAKmuB,eAG9BxuB,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQltB,GAAG,OAAQ,SAACgK,GACzC,GAAIA,EAAEsjB,QAAU7vB,EAAA8vB,MAAMC,cAAcnd,KAAM,CACtC,IAAM+c,EAAoB9uB,EAAKD,OAAOgrB,sBACtC,GAAI+D,EACA,GAAIA,aAA6BlmB,EAAAhJ,SAAU,CACvC,IAAIuvB,EAA4BL,EAC5BM,GAAkBD,EAA0B1pB,cAC5C0pB,GAA6BC,GAAkBD,EAA0BzrB,YAAYgI,EAAEhM,OACvFM,EAAKD,OAAOkrB,cAAckE,GAC1BnvB,EAAK6sB,IAAI7M,WAAWhgB,EAAKouB,gBACzBpuB,EAAKD,OAAO2F,OAAOqlB,sBAAwB,KAC3C/qB,EAAKuuB,oBAAoB7iB,EAAEhM,KAC3BM,EAAK6sB,IAAI5K,cAAcjiB,EAAKD,aAE7B,CACH,IAAIsvB,EAA0BP,EAC1BO,EAAwBtX,KAAK/X,EAAKD,UACvBsvB,EAAwBtoB,SAC9BY,UAAU0nB,GACfrvB,EAAKD,OAAO2F,OAAOqlB,sBAAwB,KAC3C/qB,EAAK6sB,IAAI7M,WAAWhgB,EAAKouB,gBACzBpuB,EAAK6sB,IAAI5K,cAAcjiB,EAAKD,eAIjC2L,EAAEsjB,SAAW7vB,EAAA8vB,MAAMC,cAAcI,SACxCtvB,EAAKmuB,YACLnuB,EAAK6uB,WAAanjB,EAAEhM,OAI5BC,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQltB,GAAG,QAAS,SAACgK,GAC1C,IAAI6jB,EAAIvvB,EAAKwuB,OAAOgB,UAGhB9jB,EAAE+jB,OAAS,EACXzvB,EAAKwuB,OAAO/Z,KAAKzQ,KAAKyG,IAAI8kB,EAHnB,IACW,IAGX7jB,EAAE+jB,OAAS,GAClBzvB,EAAKwuB,OAAO/Z,KAAKzQ,KAAK2G,IAAI4kB,EALnB,IACD,QAQd5vB,KAAK4gB,KAAKmO,MAAMgB,SAAShuB,GAAG,QAAS,SAACgK,GAC9BA,EAAEqQ,MAAQ5c,EAAA8vB,MAAMU,KAAKC,EACjB5vB,EAAK2F,WAAa3F,EAAK2F,UAAU,KACjC3F,EAAKwuB,OAAOqB,KAAK7vB,EAAK2F,UAAU,GAAGjG,IAAK,KACxCM,EAAKwuB,OAAO/Z,KAAK,GAAK,MAEnB/I,EAAEqQ,MAAQ5c,EAAA8vB,MAAMU,KAAKG,MAE5B9vB,EAAKD,OAAO2F,OAAOqlB,sBAAwB,SAKhDmD,EAAA5yB,UAAAy0B,aAAP,WACIpwB,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQoB,IAAI,QACrCrwB,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQoB,IAAI,QACrCrwB,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQoB,IAAI,MACrCrwB,KAAK4gB,KAAKmO,MAAMC,SAASC,QAAQoB,IAAI,UAIzC30B,OAAA6B,eAAIgxB,EAAA5yB,UAAA,aAAA+B,IAAJ,WAAkB,OAAOsC,KAAKI,OAAO2F,OAAOC,2CAGpCuoB,EAAA5yB,UAAA20B,6BAAR,WACI,IAAIC,EAAkChC,EAAUiC,sBAAsBtpB,IAAI,SAAAvK,GAAK,WAAIA,IAC/E8zB,EAAiCzwB,KAAKgG,UAAUkB,IAAI,SAAAE,GAAY,OAAAA,EAASjH,UAAU/C,OAEvF,OAAOmzB,EAAmBtqB,KAAK,SAAA9F,GAAa,OAACswB,EAAqB1X,SAAS5Y,EAAU/C,SAG/EmxB,EAAA5yB,UAAAizB,oBAAV,SAA8B7uB,kBAAA,IAAkBP,EAAAgC,OAAO,EAAE,IACrD,IAAIrB,EAAY,KACZuwB,EAAc1wB,KAAKswB,+BACnBI,IAAevwB,EAAYuwB,GAC3BvwB,GACAH,KAAK0uB,kBAAkBvuB,EAAWJ,IAM1CwuB,EAAA5yB,UAAA+yB,kBAAA,SAAkBiC,EAAyC5wB,kBAAA,IAAkBP,EAAAgC,OAAO,EAAG,IACnFxB,KAAKktB,IAAItK,SAAS+N,GAGlB,IAAIC,EAAa,KACjB,GAAID,aAA8Bja,EAAA9B,UAAW,CACzC,IAAIzU,EAAYwwB,EAEhB3wB,KAAKktB,IAAI7M,WAAW,SAASlgB,EAAU/C,KAAI,KAAK+C,EAAUsO,YAAW,KACrEmiB,EAAa5wB,KAAK6wB,cAAc1wB,EAAWJ,GAC3CC,KAAK6uB,OAAO/Z,KAAK3U,EAAU2U,KAAM,UAC9B,GAAI6b,aAA8B5c,EAAAvF,QAAS,CAE9C,IAAI5F,EAAU+nB,EAEd3wB,KAAKktB,IAAI7M,WAAW,WAAWzX,EAAQxL,KAAI,KAAKwL,EAAQ6F,YAAW,KAEnEmiB,EAAa5wB,KAAK8wB,YAAYloB,EAAS7I,GACvCC,KAAK6uB,OAAO/Z,KAAK,IAAK,KAG1B9U,KAAKI,OAAO2F,OAAOqlB,sBAAwB,KACvCwF,IACA5wB,KAAKI,OAAO2F,OAAOqlB,sBAAwBwF,EAE3C5wB,KAAK6uB,OAAO9uB,IAAM6wB,EAAW7wB,MAI3BwuB,EAAA5yB,UAAAm1B,YAAV,SAAsBloB,EAAkB7I,GACpC,IAAIqD,EAAS,IAAI+iB,EAAAxP,OAAO/N,EAAS7I,GAEjC,OADAqD,EAAOgV,KAAKpY,KAAKI,QACVgD,GAGDmrB,EAAA5yB,UAAAk1B,cAAV,SAAwB1wB,EAAsBJ,GAC1C,IAAIgxB,EAAkB/wB,KAAKgxB,8BAA8B7wB,EAAWJ,GAEpE,OADAgxB,EAAgBltB,QAAQktB,EAAgBrtB,gBAAgBqtB,EAAgBhxB,MACjEgxB,GAGHxC,EAAA5yB,UAAAq1B,8BAAR,SAAsC7wB,EAAsBJ,GAGxD,OADe,MADJwuB,EAAU0C,eAAe9wB,EAAU0U,OACtB9U,EAAKI,EAAWH,KAAKI,SAxN1CmuB,EAAA0C,gBACH9nB,aAAYF,EAAAE,aACZY,WAAUd,EAAAc,WACVJ,WAAUV,EAAAU,WACVQ,gBAAeD,EAAAC,gBAEfZ,SAAQN,EAAAM,SACRmT,mBAAkB4R,EAAA5R,mBAClBO,YAAWgR,EAAAhR,YACXL,YAAWyR,EAAAzR,YAEXnT,mBAAkBR,EAAAQ,mBAElByT,mBAAkB8Q,EAAA9Q,mBAElB7T,eAAcJ,EAAAI,eACd2T,eAAckR,EAAAlR,eACdD,cAAaoR,EAAApR,cACbF,aAAYuR,EAAAvR,aAEZhT,aAAYZ,EAAAY,cAGT0kB,EAAAiC,uBACH9Z,EAAAtB,eACAsB,EAAArB,YAEAqB,EAAAV,eACAU,EAAAxB,WACAwB,EAAA1B,SACA0B,EAAAf,cA6LR4Y,EAtOA,CAA+B/uB,EAAA0xB,OAAlBp0B,EAAAyxB,2FCnBb,IAAA/uB,EAAA9C,EAAA,GAEAgD,EAAAhD,EAAA,GAIAy0B,EAAA,oBAAAA,IAGEnxB,KAAAU,MAAehB,EAAAuL,OAAOkmB,EAAMC,QACxB3uB,OAAO,IACPgR,WAAW,IACfzT,KAAAgc,SAAkBtc,EAAAuL,QAASzL,EAAA6C,MAAMgvB,KAAM7xB,EAAA6C,MAAMivB,aACvClrB,QAAQ,KACRqN,WAAW,KAInB,OAXS0d,EAAAC,QAAU5xB,EAAA6C,MAAMmE,IAAKhH,EAAA6C,MAAM0L,KAAMvO,EAAA6C,MAAMyL,OAWhDqjB,EAZA,GAAar0B,EAAAq0B,yBCNbp0B,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAAwV,EAAA3H,EAAAlO,GAAA,aAAAnC,OAAA6B,eAAAwO,EAAA,cAAAnO,OAAA,ICAxC,IAAA4qB,EAAA9rB,EAAA,GACM60B,EAAQ70B,EAAQ,IAChByQ,EAAYzQ,EAAQ,IAGtB2f,GACAmV,MAAO,IAAIhJ,EAAGiJ,QAAQF,GAEtB/gB,UAAW,IAAIgY,EAAGiJ,QAAQtkB,IAKrBrQ,EAAAuf,2FCbT,IAAAqM,EAAAhsB,EAAA,IACAg1B,EAAAh1B,EAAA,IACAi1B,EAAAj1B,EAAA,IAEMk1B,EAAW,IAAIF,EAAAP,MACfvQ,EAAO,IAAI8H,EAAAhN,KAAKkW,GAGhBC,EAAY,IAAIF,EAAApD,UAAU3N,GAChCA,EAAKtD,IAAI,YAAauU,GAEtBjR,EAAK3E,QAAQ6V,KAAK,WAChBlR,EAAKmR,UAAU","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([61,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import { Scale } from \"./Scale\";\r\nlet { major, minor } = Scale\r\n\r\nexport enum DeviceSize {\r\n    Small,\r\n    Medium,\r\n    Large,\r\n    Huge\r\n}\r\n\r\n\r\nexport function getVisibleDeviceSize(size: DeviceSize): number {\r\n    let sz = 10;\r\n    switch (size) {\r\n        case DeviceSize.Small: sz = major.third; break;\r\n        case DeviceSize.Medium: sz = major.sixth; break;\r\n        case DeviceSize.Large: sz = 2 * major.eighth; break;\r\n        case DeviceSize.Huge: sz = 6 * major.eighth; break;\r\n    }\r\n    return sz;\r\n}","import { Actor, Vector, CollisionType, Color, Label, Traits } from \"excalibur\";\r\nimport { Planet } from \"../Planet/Planet\";\r\nimport { Structure, } from \"../../models/Structure\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip, compass } from \"../../values/Orientation\";\r\nimport { Game } from \"../../Game\";\r\nimport { Rectangle } from \"../../values/Rectangle\";\r\nimport { closest, measureDistance, drawRect, deleteByValue } from \"../../Util\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\nimport { Device } from \"../Device\";\r\nimport { allSpaceFunctions } from \"../../models/SpaceFunction\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class DevicePlace {\r\n    constructor(private pos: Vector, private size: DeviceSize) {}\r\n    get position() { return this.pos }\r\n    get visibleSize() { return getVisibleDeviceSize(this.size) }\r\n\r\n}\r\n\r\nexport class Building extends Actor {\r\n    edgeWidth: number = 0 //.1\r\n\r\n    nameLabel: Label\r\n    levelLabel: Label\r\n\r\n    built: boolean = false\r\n    hover: boolean = false\r\n    showLabel: boolean = false\r\n    facing: Orientation = Orientation.Right\r\n    hideBox: boolean = false\r\n    parentSlot: Slot\r\n    childrenBuildings: Building[] = []\r\n\r\n    level: number = 1\r\n\r\n    private devices: Device[] = []\r\n\r\n    constructor(pos: Vector, public structure: Structure, protected planet: Planet) {\r\n        super(\r\n          pos.x,\r\n          pos.y,\r\n          structure.width,\r\n          structure.height,\r\n          planet.color\r\n        )\r\n        this.anchor = new Vector(0,0)\r\n\r\n        this.setup();\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling))\r\n\r\n        this.on('pointerenter', () => {\r\n            this.hover = true\r\n            // console.log(\"HOVER ON\", { building: this })\r\n        })\r\n\r\n        // this.on('pointerdown', () => {\r\n        //     console.log(\"CLICKED BUILDING\", { building: this })\r\n        //     this.levelUp();\r\n        // })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.hover = false\r\n        })\r\n\r\n        this.collisionType = CollisionType.PreventCollision\r\n\r\n        this.nameLabel = new Label(this.structure.name, 0, 0, 'Helvetica')\r\n        // this.nameLabel.fontSize = 11\r\n        this.nameLabel.color = Color.White\r\n\r\n        this.levelLabel = new Label(`Lvl. ${this.level}`, 0, 0, 'Helvetica')\r\n        this.levelLabel.fontSize = 6\r\n        this.levelLabel.color = Color.White.darken(0.2)\r\n    }\r\n\r\n    levelUp() {\r\n        this.level += 1\r\n        this.levelLabel.text = `Lvl. ${this.level}`\r\n    }\r\n\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        if (!this.hideBox) {\r\n            drawRect(ctx, this.aabb(), this.edgeWidth, this.processedColor())\r\n        }\r\n        this.devices.forEach(device => device.draw(ctx, delta))\r\n\r\n        if (this.showLabel) {\r\n            this.nameLabel.pos = this.getCenter()\r\n            this.nameLabel.pos.x -= ctx.measureText(this.structure.name).width / 2\r\n            this.nameLabel.draw(ctx, delta)\r\n\r\n            // this.levelLabel.text = `Lvl. ${this.level}`\r\n            // this.levelLabel.pos = this.getCenter()\r\n            // this.levelLabel.pos.y += 10\r\n            // this.levelLabel.pos.x -= ctx.measureText(this.structure.name).width / 4\r\n            // this.levelLabel.draw(ctx, delta)\r\n        }\r\n\r\n        let debug = false;\r\n        if (debug) {\r\n            if (this.slots().length > 0) {\r\n                // draw slots\r\n                this.slots().forEach((slot: Slot) => {\r\n                    let rect: Rectangle = { x: slot.pos.x, y: slot.pos.y, width: 3, height: 3 }\r\n                    drawRect(ctx, rect, 1, Color.Gray.lighten(0.5))\r\n                })\r\n            }\r\n         if (this.nodes().length > 0) {\r\n                // draw nodes\r\n                this.nodes().forEach((node: Vector) => {\r\n                    let rect: Rectangle = { x: node.x, y: node.y, width: 4, height: 4 }\r\n                    drawRect(ctx, rect, 1, Color.Yellow.lighten(0.5))\r\n                })\r\n            }\r\n\r\n        }\r\n\r\n        let showDevicePlaces = false\r\n        if (showDevicePlaces && this.devicePlaces().length > 0) {\r\n            this.devicePlaces().forEach(p => {\r\n                let place = p.position\r\n                let sz = p.visibleSize\r\n                drawRect(ctx,\r\n                    { x: place.x - sz/2, y: place.y - sz/2, width: sz, height: sz },\r\n                    1,\r\n                    Color.White,\r\n                    false\r\n                )\r\n            })\r\n        }\r\n    }\r\n\r\n    step: number = 0\r\n    update(engine: Game, delta: number) {\r\n        super.update(engine, delta)\r\n        let tryProduce = this.built;\r\n        if (tryProduce) {\r\n            this.devices.forEach(device => device.produce(this.step));\r\n        }\r\n        this.step += 1\r\n    }\r\n\r\n    setup(): void { }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        return cursor.clone();\r\n    }\r\n    reshape(cursor: Vector): void {\r\n        this.pos = cursor.clone()\r\n    }\r\n\r\n    afterConstruct(): void {}\r\n\r\n    handleClick(_pos): boolean { return true; }\r\n\r\n    slots(): Slot[] {\r\n        return []\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y)-4)\r\n        ];\r\n    }\r\n\r\n    devicePlaces(): DevicePlace[] {\r\n        return []; //this.nodes();\r\n    }\r\n    \r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph\r\n        // assemble subgraph\r\n        let nodes = this.nodes()\r\n        let rootNode = g.findOrCreate(nodes[0], measureDistance)\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            g.edge(rootNode, slot)\r\n\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(slot, childNode)\r\n\r\n            child.graph(g)\r\n        }\r\n        return g\r\n    }\r\n\r\n    // just a patch through to planet -- but could animate something here?\r\n    public redeem(res: ResourceBlock) {\r\n        this.planet.gather(res)\r\n    }\r\n\r\n    public populate(pos: Vector) {\r\n        this.planet.populate(pos) //this.pos)\r\n    }\r\n\r\n\r\n    protected aabb(): Rectangle {\r\n        return {\r\n            x: this.pos.x,\r\n            y: this.pos.y,\r\n            width: this.getWidth(),\r\n            height: this.getHeight()\r\n        }\r\n    }\r\n\r\n    protected overlaps(other: Building): boolean {\r\n        let rect1 = this.aabb(), rect2 = other.aabb();\r\n        let doesOverlap = (\r\n            rect1.x < rect2.x + rect2.width &&\r\n            rect1.x + rect1.width > rect2.x &&\r\n            rect1.y < rect2.y + rect2.height &&\r\n            rect1.y + rect1.height > rect2.y\r\n        )\r\n        return(!!doesOverlap);\r\n    }\r\n\r\n    public overlapsAny(): boolean {\r\n        return !!this.planet.colony.buildings.find(bldg => bldg !== this && this.overlaps(bldg))\r\n    }\r\n\r\n    protected edgeColor(): Color {\r\n        let edge = this.processedColor().lighten(0.85);\r\n        return edge;\r\n    }\r\n\r\n    protected mainColor(): Color {\r\n        let main = this.processedColor().darken(0.08);\r\n        return main;\r\n    }\r\n\r\n    protected colorBase(): Color {\r\n        return this.color;\r\n    }\r\n\r\n    protected processedColor(): Color {\r\n        let clr = this.colorBase().clone();\r\n        if (!this.built)  { \r\n            if (this.overlapsAny()) { clr = Color.Red }\r\n            clr.a = 0.8\r\n        }\r\n        if (this.hover) { clr.a = 0.5 }\r\n        return clr;\r\n    }\r\n\r\n    get connections() {\r\n        return this.structure.connections;\r\n    }\r\n\r\n\r\n    protected findSlot(\r\n        pos: Vector,\r\n        validConnections: { [key in Orientation]: (typeof Structure)[] } = this.connections\r\n    ): Slot {\r\n        let slotList = []\r\n            for (let dir of compass) {\r\n                const validStructures = validConnections[dir];\r\n                let flipped = flip(dir)\r\n                const buildings = validStructures.map(structure =>\r\n                    this.planet.closestBuildingByType(pos, [structure])\r\n                )\r\n                buildings.forEach(building => {\r\n                    if (building) {\r\n                        let neighborSlots = building.slots()\r\n                        neighborSlots.filter(slot => slot.facing === flipped)\r\n                        .forEach(matchingSlot => {\r\n                            slotList.push(matchingSlot)\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n\r\n        if (slotList.length > 0) {\r\n            return closest(pos, slotList, (slot) => slot.pos)\r\n        } else {\r\n            // console.warn('no conecting structures found')\r\n        }\r\n    }\r\n\r\n    protected alignToSlot(\r\n        cursor: Vector,\r\n        validConnections: { [key in Orientation]: (typeof Structure)[] } = this.connections\r\n    ) {\r\n        let theSlot = this.findSlot(cursor, validConnections)\r\n        if (theSlot) {\r\n            let matchingSlot = this.slots()\r\n                .find(s => s.facing == flip(theSlot.facing))\r\n            if (matchingSlot) {\r\n                let offset = theSlot.pos.sub(matchingSlot.pos)\r\n                this.pos.addEqual(offset)\r\n\r\n                this.parentSlot = theSlot;\r\n                return theSlot;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected buildSlot(x: number, y: number, facing: Orientation = Orientation.Right): Slot {\r\n        return {\r\n            pos: new Vector(x,y),\r\n            facing,\r\n            parent: this\r\n        }\r\n    }\r\n\r\n    public addDevice(device: Device) {\r\n        device.finalize()\r\n        if (device.building !== this) {\r\n            device.building = this\r\n        }\r\n        this.devices.push(device)\r\n        this.updateName()\r\n    }\r\n\r\n    public hasPlaceForDevice() {\r\n        return this.devices.length < this.devicePlaces().length\r\n    }\r\n\r\n    public nextDevicePlace(): DevicePlace {\r\n        // could throw an err if we have no place\r\n        return this.devicePlaces()[\r\n            this.devices.length\r\n        ]\r\n    }\r\n\r\n    public getDevices() {\r\n        return this.devices\r\n    }\r\n\r\n    private updateName() {\r\n        let fn = allSpaceFunctions.find(spaceFn => {\r\n            let matched = true;\r\n            let unseenDevices = this.devices.slice() // clone?\r\n            spaceFn.machines.forEach(machine => {\r\n                let matchingDevice = unseenDevices.find(d => d.machine instanceof machine)\r\n                if (!matchingDevice) { matched = false; }\r\n                unseenDevices = deleteByValue(unseenDevices, matchingDevice)\r\n            })\r\n            return matched;\r\n        })\r\n        if (fn) {\r\n            this.nameLabel.text = fn.label\r\n        }\r\n    }\r\n}","import { Building } from './Building';\r\n\r\nimport { CorridorView } from './CorridorView';\r\nimport { CommonAreaView } from './CommonAreaView';\r\nimport { DomeView } from './DomeView';\r\nimport { MissionControlView } from './MissionControlView';\r\nimport { TunnelView } from './TunnelView';\r\nimport { ArcologyView } from './ArcologyView';\r\nimport { LadderView } from './LadderView';\r\nimport { MineView } from './MineView';\r\nimport { SurfaceRoadView } from './SurfaceRoadView';\r\n\r\n\r\n// import { LivingQuartersView } from './LivingQuartersView';\r\n\r\nexport {\r\n    Building,\r\n\r\n    CorridorView, // as AccessTunnelView,\r\n    CommonAreaView,\r\n    DomeView,\r\n    MissionControlView,\r\n    TunnelView,\r\n    ArcologyView,\r\n    LadderView,\r\n    MineView,\r\n    SurfaceRoadView,\r\n\r\n}","import { Vector, Color } from \"excalibur\";\r\nimport { Rectangle } from \"./values/Rectangle\";\r\n\r\nconst extremumBy = (arr, pluck, extremum) => {\r\n  return arr.reduce(function(best, next) {\r\n    var pair = [ pluck(next), next ];\r\n    if (!best) {\r\n       return pair;\r\n    } else if (extremum.apply(null, [ best[0], pair[0] ]) == best[0]) {\r\n       return best;\r\n    } else {\r\n       return pair;\r\n    }\r\n  },null)[1];\r\n}\r\n\r\nexport const minBy = (arr, fn) => extremumBy(arr, fn, Math.min)\r\nexport const maxBy = (arr, fn) => extremumBy(arr, fn, Math.max)\r\n\r\n\r\nexport const sample = (arr) => arr[Math.floor(Math.random() * arr.length)]\r\n\r\nexport const range = (n) => Array(n).fill(0).map((_val,idx) => idx)\r\n\r\nexport function closest<T>(cursor: Vector, arr: Array<T>, getVector: (T) => Vector, predicate?: (T) => boolean) {\r\n   let matching: Array<T> = arr;\r\n   if (predicate) { arr = arr.filter(predicate) }\r\n   if (matching) {\r\n      let distanceToCursor = (elem: T) => cursor.distance(getVector(elem))\r\n      return minBy(matching, distanceToCursor)\r\n   }\r\n}\r\n\r\nexport const flatSingle = arr => [].concat(...arr);\r\n\r\nexport const deleteByValue = (arr, elem) => arr.filter(e => e !== elem)\r\n\r\nexport function eachCons(a, n) {\r\n  var r = []\r\n  for (var i = 0; i < a.length - n + 1; i++) {\r\n    r.push(_ecRange(a, i, n))\r\n  }\r\n  return r\r\n}\r\n\r\nfunction _ecRange (a, i, n) {\r\n  var r = []\r\n  for (var j = 0; j < n; j++) {\r\n    r.push(a[i + j])\r\n  }\r\n  return r\r\n}\r\n\r\nexport const measureDistance = (a: Vector, b: Vector) => a.distance(b)\r\n\r\n\r\n// tiny rendering lib\r\nexport function drawLine(ctx: CanvasRenderingContext2D, a: Vector, b: Vector, c: Color = Color.White, lineWidth: number = 1) {\r\n  c.a = 0.5\r\n  ctx.beginPath()\r\n  ctx.moveTo(a.x, a.y)\r\n  ctx.lineTo(b.x, b.y)\r\n  ctx.strokeStyle = c.toRGBA()\r\n  ctx.lineWidth = lineWidth\r\n  ctx.stroke()\r\n}\r\n\r\nexport function drawRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  rectangle: Rectangle,\r\n  edgeWidth: number = 0,\r\n  color: Color = Color.White,\r\n  filled: boolean = true\r\n) {\r\n  let { x, y, width, height } = rectangle;\r\n\r\n  // if (edgeWidth > 0) {\r\n  //   let edge = Color.White;\r\n  //   ctx.fillStyle = edge.toRGBA();\r\n  //   ctx.fillRect(x, y, width, height)\r\n  // }\r\n\r\n  if (filled) {\r\n    let main = color;\r\n    ctx.fillStyle = main.toRGBA();\r\n    ctx.fillRect(\r\n      x, //+ edgeWidth,\r\n      y, //+ edgeWidth,\r\n      width, // - edgeWidth * 2,\r\n      height // - edgeWidth * 2\r\n    )\r\n  }\r\n\r\n  if (edgeWidth > 0) {\r\n    let edge = Color.White;\r\n    ctx.strokeStyle = edge.toRGBA();\r\n    ctx.lineWidth=edgeWidth\r\n    // ctx.strokeStyle = Stroke.So\r\n    ctx.strokeRect(\r\n      x, y, width, height\r\n    )\r\n  }\r\n}","import { ResourceBlock, Economy, emptyMarket } from \"./Economy\";\r\nimport { Scale } from \"../values/Scale\";\r\nimport { Color, Resource } from \"excalibur\";\r\nimport { DeviceSize } from \"../values/DeviceSize\";\r\n\r\n\r\nconst bookshelfSvg = require('../images/bookshelf-plain.svg');\r\nconst vatSvg = require('../images/vat-plain.svg');\r\nconst benchSimple = require('../images/bench-simple-plain.svg');\r\nconst stove = require('../images/stove-plain.svg');\r\nconst cabin = require('../images/cabin-plain.svg');\r\nconst fire = require('../images/cooking-fire-plain.svg')\r\nconst bed = require('../images/bed-plain.svg')\r\nconst fridge = require('../images/fridge-plain.svg')\r\nconst server = require('../images/research-server-plain.svg')\r\nconst plant = require('../images/houseplant-plain.svg')\r\nconst workstation = require('../images/workstation-plain.svg')\r\n\r\nconst images = {\r\n    bookshelf: bookshelfSvg,\r\n    vat: vatSvg,\r\n    bench: benchSimple,\r\n    stove,\r\n    cabin,\r\n    fire,\r\n    bed,\r\n    fridge,\r\n    server,\r\n    plant,\r\n    workstation,\r\n}\r\n\r\n\r\nconst { Red, Green, Blue, Orange, Violet, Yellow } = Color;\r\n\r\nexport enum MachineOperation {\r\n    // generic functioning: consuming a block to produce a new block\r\n    Work,\r\n    // more interesting functions\r\n    SpawnCitizen,\r\n    CollectResource,\r\n    CollectMeals,\r\n    CollectData\r\n}\r\n\r\nexport class Machine {\r\n    name: string = '(machine name)'\r\n    description: string = '(machine description)'\r\n    color: Color = Color.LightGray\r\n\r\n    size: DeviceSize = DeviceSize.Small\r\n\r\n    consumes: ResourceBlock = null\r\n    produces: ResourceBlock = null\r\n\r\n    // need to stop using this both for work time and 'generation' time\r\n    // productionTime: number = 500\r\n    generationTime: number = 3000\r\n    workTime: number = 10000\r\n    capacity: number = 2\r\n\r\n    behavior: MachineOperation = MachineOperation.Work\r\n\r\n    image = images.vat\r\n\r\n    prereqs: (typeof Machine)[] = []\r\n\r\n    economy: Economy = emptyMarket()\r\n\r\n    forDome: boolean = false\r\n}\r\n\r\nexport class CommandCenter extends Machine {\r\n    name = 'Command'\r\n    description = 'gather resources...'\r\n    behavior = MachineOperation.CollectResource\r\n    image = images.bench\r\n\r\n    size = DeviceSize.Medium\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 1, demand: 0 },\r\n        Oxygen: { supply: 1, demand: 0 },\r\n        // Shelter: { supply: 1, demand: 0 },\r\n        Hope: { supply: 1, demand: 0 }\r\n    }\r\n}\r\n\r\n// small\r\n/// small surface\r\n\r\nexport class OxygenExtractor extends Machine {\r\n    name = 'O2 Extractor'\r\n    description = 'breathe deep'\r\n    image = images.vat\r\n    prereqs = [ WaterCondensingMachine, SolarCell ]\r\n\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 1, demand: 0 },\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class SolarCell extends Machine {\r\n    name = 'Solar Cell'\r\n    description = 'feel the warmth'\r\n\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 2, demand: 0 },\r\n    }\r\n}\r\n\r\n\r\nexport class WaterCondensingMachine extends Machine {\r\n    name = 'H20 Condenser'\r\n    description = 'have a drink'\r\n    prereqs = [ SolarCell ]\r\n\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 1, demand: 0 },\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\n/// small subsurface\r\nexport class StudyMachine extends Machine {\r\n    consumes = ResourceBlock.Hypothesis\r\n    produces = ResourceBlock.Data\r\n}\r\n\r\nexport class Desk extends StudyMachine {\r\n    name = 'Desk'\r\n    description = 'get to work'\r\n    image = images.bench\r\n    prereqs = [ OxygenExtractor ]\r\n\r\n    // color = Blue\r\n}\r\n\r\nexport class Workstation extends StudyMachine {\r\n    name = 'Workstation'\r\n    description = 'hackety hack'\r\n    prereqs = [ Bookshelf ]\r\n    color = Blue\r\n    image = images.workstation\r\n}\r\n\r\n\r\n\r\nexport class Bookshelf extends Machine {\r\n    name = 'Shelf'\r\n    description = 'brainstorm'\r\n    produces = ResourceBlock.Hypothesis\r\n    image = images.bookshelf\r\n    prereqs = [ OxygenExtractor, Desk ]\r\n    color = Blue\r\n}\r\n\r\n\r\nexport class Fridge extends Machine {\r\n    name = 'Fridge'\r\n    description = 'store meals'\r\n    behavior = MachineOperation.CollectMeals\r\n    image = images.fridge\r\n    prereqs = [Bookshelf]\r\n    color = Yellow\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Stove extends Machine {\r\n    name = 'Stove'\r\n    description = 'make a meal'\r\n    consumes = ResourceBlock.Food\r\n    produces = ResourceBlock.Meal\r\n    image = images.stove\r\n\r\n    prereqs = [Bookshelf, Fridge]\r\n    color = Yellow\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Bed extends Machine {\r\n    name = 'Bed'\r\n    description = 'sweet dreams'\r\n    image = images.bed\r\n    prereqs = [ OxygenExtractor ]\r\n    color = Orange\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Shelter: { supply: 2, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Houseplant extends Machine {\r\n    name = 'House Plant'\r\n    description = 'so nice'\r\n    prereqs = [ Bed ]\r\n    produces = ResourceBlock.Food\r\n    capacity = 1\r\n    color = Green\r\n    image = images.plant\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\n// medium\r\n\r\n\r\nexport class ResearchServer extends Machine {\r\n    name = 'Research Server'\r\n    description = 'hold data'\r\n    produces = ResourceBlock.Hypothesis\r\n    behavior = MachineOperation.CollectData\r\n    image = images.server\r\n    prereqs = [Bookshelf]\r\n    size = DeviceSize.Medium\r\n    color = Blue\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 4 },\r\n    }\r\n}\r\n\r\nexport class Orchard extends Machine {\r\n   name = 'Orchard'\r\n   description = 'grow some food'\r\n   produces = ResourceBlock.Food\r\n   size = DeviceSize.Medium\r\n   prereqs = [AlgaeVat]\r\n   color = Green\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 2, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Cabin extends Machine {\r\n   name = 'Cabin'\r\n   description = 'home on the plains'\r\n   consumes = ResourceBlock.Food\r\n   produces = ResourceBlock.Meal\r\n   image = images.cabin\r\n   prereqs = [Orchard]\r\n   size = DeviceSize.Medium\r\n   color = Orange\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n        Water: { supply: 0, demand: 1 },\r\n        Shelter: { supply: 4, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Arbor extends Machine {\r\n    name = 'Arbor'\r\n    description = 'arbor around the clock'\r\n    produces = ResourceBlock.Food\r\n    prereqs = [Orchard]\r\n    size = DeviceSize.Medium\r\n    color = Green\r\n    forDome = true\r\n}\r\n\r\nexport class AlgaeVat extends Machine {\r\n    name = 'Algae Vat'\r\n    description = 'where there is a will'\r\n    produces = ResourceBlock.Food\r\n    prereqs = [ OxygenExtractor, Bookshelf, Fridge ]\r\n    size = DeviceSize.Medium\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\nexport class Botany extends Machine {\r\n    name = 'Botany'\r\n    description = 'plant lab'\r\n    produces = ResourceBlock.Food\r\n    prereqs = [ OxygenExtractor, Bookshelf ]\r\n    size = DeviceSize.Medium\r\n    color = Green\r\n}\r\n\r\nexport class CloningVat extends Machine {\r\n    name = 'Cloning Vat'\r\n    description = 'we all grow'\r\n    behavior = MachineOperation.SpawnCitizen \r\n    productionTime = 1500\r\n    image = images.vat\r\n    prereqs = [AlgaeVat]\r\n    size = DeviceSize.Medium\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\n    \r\nexport class Fabricator extends Machine {\r\n    name = 'Fabricator'\r\n    description = 'you made that'\r\n    consumes = ResourceBlock.Ore\r\n    produces = ResourceBlock.Mineral\r\n    size = DeviceSize.Medium\r\n    color = Red\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 3 },\r\n    }\r\n    // ...\r\n}\r\n\r\n//export class HoloProjector extends Machine {\r\n//    name = 'Holo Projector'\r\n//    size = DeviceSize.Medium\r\n//    color = Violet\r\n//}\r\n\r\n// large devices!\r\n\r\nexport class MiningDrill extends Machine {\r\n    name = 'Mining Drill'\r\n    description = 'ore away'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Fabricator ]\r\n    produces = ResourceBlock.Ore\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 5 },\r\n    }\r\n//\r\n}    \r\n\r\nexport class Megafabricator extends Machine {\r\n    name = 'Mega-Fabricator'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Fabricator ]\r\n    color = Red\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 8 },\r\n    }\r\n}\r\n\r\nexport class Preserve extends Machine {\r\n    name = 'Preserve'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Arbor ]\r\n    color = Green\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 0, demand: 4 },\r\n    }\r\n}\r\n\r\n/// huge devices\r\n\r\nexport class Microcity extends Machine {\r\n    name = 'Microcity'\r\n    size = DeviceSize.Huge\r\n    prereqs = [ Megafabricator ]\r\n    color = Orange\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 0, demand: 2 },\r\n        Power: { supply: 0, demand: 2 },\r\n        Joy: { supply: 5, demand: 0 },\r\n        Hope: { supply: 5, demand: 0 },\r\n        Beauty: { supply: 1, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class LogicCrystal extends Machine {\r\n    name = 'Logic Crystal'\r\n    size = DeviceSize.Huge\r\n    prereqs = [ Megafabricator ]\r\n    color = Blue\r\n}\r\n\r\n// export class MiniSun extends Machine {}\r\n\r\nexport const allMachines = [\r\n    AlgaeVat,\r\n    Arbor,\r\n    Bed,\r\n    Bookshelf,\r\n    Cabin,\r\n    CloningVat,\r\n    Desk,\r\n    Fabricator,\r\n    Fridge,\r\n    Houseplant,\r\n    Megafabricator,\r\n    MiningDrill,\r\n    Orchard,\r\n    OxygenExtractor,\r\n    Preserve,\r\n    ResearchServer,\r\n    SolarCell,\r\n    Stove,\r\n    WaterCondensingMachine,\r\n    Workstation,\r\n    Microcity,\r\n    LogicCrystal,\r\n    Botany,\r\n]","\r\nexport enum Orientation { Left, Up, Right, Down } //, Angle }\r\n\r\nexport const compass = [\r\n    Orientation.Left,\r\n    Orientation.Right,\r\n    Orientation.Up,\r\n    Orientation.Down,\r\n]\r\n\r\n\r\nexport function flip(orientation: Orientation): Orientation {\r\n    switch (orientation) {\r\n        case Orientation.Left: return Orientation.Right\r\n        case Orientation.Right: return Orientation.Left\r\n        case Orientation.Up: return Orientation.Down\r\n        case Orientation.Down: return Orientation.Up\r\n    }\r\n    throw new Error(`Don't know orientation ${ orientation }`)\r\n}","import { Color } from \"excalibur\";\r\n\r\n// an abstract/intangible thing (or at least something we don't represent)\r\nexport enum PureValue {\r\n    Power = 'Power',\r\n    Oxygen = 'Oxygen',\r\n    Water = 'Water',\r\n    Shelter = 'Shelter',\r\n    Hope = 'Hope',\r\n    Joy = 'Joy',\r\n    Wisdom = 'Wisdom',\r\n    Wealth = 'Wealth',\r\n    Beauty = 'Beauty',\r\n    Wonder = 'Wonder'\r\n}\r\n\r\nexport type Economy = { [key in PureValue]: {\r\n    supply: number,\r\n    demand: number\r\n} }\r\n\r\nexport function emptyMarket() : Economy {\r\n    return {\r\n        Power: { supply: 0, demand: 0 },\r\n        Oxygen: { supply: 0, demand: 0 },\r\n        Water: { supply: 0, demand: 0 },\r\n        Shelter: { supply: 0, demand: 0 },\r\n        Hope: { supply: 0, demand: 0 },\r\n        Joy: { supply: 0, demand: 0 },\r\n        Wealth: { supply: 0, demand: 0 },\r\n        Wisdom: { supply: 0, demand: 0 },\r\n        Beauty: { supply: 0, demand: 0 },\r\n        Wonder: { supply: 0, demand: 0 },\r\n    }\r\n}\r\n\r\nexport function availableCapacity(market: Economy, value: PureValue) {\r\n    return market[value].supply - market[value].demand\r\n}\r\n\r\nexport const sumMarkets: (ea: Economy, eb: Economy) => Economy = (ea, eb) => {\r\n    let newMarket = emptyMarket();\r\n    for (let value in PureValue) {\r\n        let { supply: sa, demand: da } = ea[value]\r\n        let { supply: sb, demand: db } = eb[value]\r\n        let supply = sa + sb\r\n        let demand = da + db\r\n        newMarket[value] = {\r\n            supply, //: ea[value].supply + eb[value].supply,\r\n            demand, //: ea[value].demand + eb[value].demand\r\n        }\r\n    }\r\n    return newMarket\r\n}\r\n\r\nexport enum ResourceBlock {\r\n    // base\r\n    Food = 'Food',\r\n    Ore = 'Ore',\r\n    Data = 'Data',\r\n    // derived\r\n    Meal = 'Meal',\r\n    Hypothesis = 'Hypothesis',\r\n    Mineral = 'Mineral',\r\n    Alloy = \"Alloy\"\r\n}\r\n\r\nconst blockColors: { [key in ResourceBlock]: Color } = {\r\n    Food: Color.Green,\r\n    Data: Color.Blue,\r\n    Mineral: Color.Red,\r\n\r\n    Meal: Color.Yellow.darken(0.2),\r\n    Hypothesis: Color.Violet.darken(0.4),\r\n    Ore: Color.Red.darken(0.5),\r\n\r\n    Alloy: Color.LightGray.darken(0.2),\r\n}\r\n\r\nexport function blockColor(block: ResourceBlock) {\r\n    let baseColor = blockColors[block]\r\n    //Color.Violet\r\n    //switch(block) {\r\n    //    case ResourceBlock.Food: baseColor = Color.Green; break\r\n    //    case ResourceBlock.Ore:  baseColor = Color.Red; break\r\n    //    case ResourceBlock.Data: baseColor = Color.Blue; break\r\n    //    case ResourceBlock.Meal: baseColor = Color.Yellow; break\r\n    //}\r\n    return baseColor.desaturate(0.25).lighten(0.125)\r\n}\r\n\r\n","import { Color } from 'excalibur';\r\nimport { ResourceBlock } from './Economy';\r\nimport { Scale } from '../values/Scale';\r\nimport { Orientation } from '../values/Orientation';\r\nimport { Machine, Bookshelf, CommandCenter, CloningVat, OxygenExtractor, WaterCondensingMachine, Desk, AlgaeVat, Stove, Bed, Fridge, ResearchServer, Orchard, Cabin, SolarCell, Arbor, Megafabricator, MiningDrill, Preserve, Workstation, Houseplant, Fabricator, LogicCrystal, Microcity, allMachines } from './Machine';\r\nimport { SpaceFunction } from './SpaceFunction';\r\nimport { DeviceSize } from '../values/DeviceSize';\r\n\r\nconst { major, minor } = Scale\r\n\r\nconst smallMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Small)\r\nconst mediumMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Medium)\r\nconst largeMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Large)\r\nconst hugeMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Huge)\r\n\r\nconst smallDome = smallMachines.filter(machine => (new machine()).forDome)\r\nconst smallBelow = smallMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst midDome = mediumMachines.filter(machine => (new machine()).forDome)\r\nconst midBelow = mediumMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst largeDome = largeMachines.filter(machine => (new machine()).forDome)\r\nconst largeBelow = largeMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst hugeDome = hugeMachines.filter(machine => (new machine()).forDome)\r\nconst hugeBelow = hugeMachines.filter(machine => !(new machine()).forDome)\r\n\r\nexport class Structure {\r\n    name: string = '(structure name)';\r\n    description: string = '(structure description)';\r\n    view: string = '<structure (room) view>';\r\n    width: number = 10\r\n    height: number = 10\r\n    zoom: number = 1\r\n    color: Color = Color.Gray\r\n\r\n    consumes: ResourceBlock = null\r\n    produces: ResourceBlock = null\r\n    productionTime: number = 500\r\n\r\n    // constructor(public origin: Vector = new Vector(0, 0)) { }\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Corridor ],\r\n        [Orientation.Right]: [ Corridor ],\r\n        [Orientation.Up]: [ Ladder ],\r\n        [Orientation.Down]: [ Ladder ],\r\n    }\r\n\r\n    machines: (typeof Machine)[] = []\r\n\r\n    prereqs: (typeof Structure)[] = []\r\n\r\n    // slotSize\r\n}\r\n\r\n\r\nexport class MainTunnel extends Structure {\r\n    name: string = 'Main Tunnel';\r\n    description: string = 'Elevating';\r\n    view: string = 'TunnelView';\r\n    width: number = major.second\r\n    height: number = major.eighth\r\n    zoom = 0.25\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Corridor ],\r\n        [Orientation.Right]: [ Corridor ],\r\n        [Orientation.Up]: [ MissionControl ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n}\r\n\r\n\r\nexport class SurfaceRoad extends Structure {\r\n    name: string = 'Road'\r\n    description: string = 'go for a walk'\r\n    view: string = 'SurfaceRoadView'\r\n    width: number = minor.fifth\r\n    height: number = minor.first\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Dome, MissionControl ],\r\n        [Orientation.Right]: [  Dome, MissionControl ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n}\r\n\r\nexport class Corridor extends Structure {\r\n    name: string = 'Corridor'\r\n    description: string = 'in the hallway'\r\n    view: string = 'CorridorView'\r\n    width: number = minor.fifth\r\n    height: number = minor.third\r\n    zoom = 0.5\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [\r\n            MainTunnel,\r\n            CommonArea\r\n        ],\r\n        [Orientation.Right]: [\r\n            MainTunnel,\r\n            CommonArea\r\n        ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n    prereqs = [SurfaceRoad] //MainTunnel]\r\n}\r\n\r\nexport class Ladder extends Structure {\r\n    name = 'Ladder'\r\n    description = 'connect vertically'\r\n    view = 'LadderView'\r\n    width = minor.third\r\n    height = 100 + major.third\r\n    zoom = 0.5\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Up]: [ CommonArea ],\r\n        [Orientation.Down]: [ CommonArea ],\r\n        [Orientation.Left]: [ ],\r\n        [Orientation.Right]: [ ],\r\n    }\r\n    prereqs = [Corridor, SmallRoomThree]\r\n}\r\n\r\n// 'abstract' structure...\r\n\r\nclass Dome extends Structure {\r\n    // name: string = 'Biodome';\r\n    description: string = 'Biome sweet biome';\r\n    // dominantColor = Color.Green\r\n\r\n    view: string = 'DomeView';\r\n    width: number  = 2 * major.eighth\r\n    height: number = major.eighth\r\n    zoom = 0.2\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ SurfaceRoad ],\r\n        [Orientation.Right]: [ SurfaceRoad ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n\r\n    machines = [\r\n        SolarCell,\r\n        OxygenExtractor, WaterCondensingMachine,\r\n        // Cabin, CookingFire\r\n    ]\r\n}\r\n\r\n// common subsurface room...\r\nclass CommonArea extends Structure {\r\n    name: string = 'Commons'\r\n    description: string = 'hallway cap'\r\n    view: string = 'CommonAreaView'\r\n    width: number = major.eighth\r\n    height: number = major.fifth\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [\r\n            Corridor, CommonArea\r\n            ],\r\n        [Orientation.Right]: [\r\n            Corridor,\r\n            CommonArea,\r\n        ],\r\n        [Orientation.Up]: [ Ladder ],\r\n        [Orientation.Down]: [ Ladder ],\r\n    }\r\n\r\n    machines = []\r\n    //    Stove,\r\n    //    Bed,\r\n    //    Desk,\r\n    //    Bookshelf,\r\n    //    Fridge,\r\n    //    Workstation,\r\n    //    Houseplant,\r\n    //]\r\n\r\n    prereqs = [\r\n        // Dome \r\n    ]\r\n}\r\n\r\nexport class SmallRoomTwo extends CommonArea {\r\n    name = 'Sm. Room (2)'\r\n    width = major.eighth\r\n    prereqs = [ SmallDome ]\r\n    machines = smallBelow\r\n    // two small slots\r\n}\r\n\r\nexport class SmallRoomThree extends CommonArea {\r\n    name = 'Sm. Room (3)'\r\n    prereqs = [SmallRoomTwo]\r\n    view = 'SmallRoomThreeView'\r\n    width = 2 * major.eighth\r\n    machines = smallBelow\r\n}\r\n\r\nexport class MediumRoom extends CommonArea {\r\n    name = 'Mid Room'\r\n    prereqs = [ SmallRoomThree ]\r\n    view = 'MediumRoomView'\r\n    width = 3 * major.eighth\r\n    height = 2 * major.third\r\n    // two medium slots...\r\n    \r\n    machines = midBelow\r\n}\r\n\r\nexport class LargeRoom extends CommonArea {\r\n    name = 'Lg. Room'\r\n    view = 'LargeRoomView'\r\n    prereqs = [ MediumRoom ]\r\n    width = 6 * major.eighth\r\n    height = 4 * major.fifth\r\n\r\n    // two big slots?\r\n    machines = largeBelow\r\n    //machines = [\r\n    //    MiningDrill,\r\n    //    Megafabricator,\r\n    //    // Preserve,\r\n    //]\r\n}\r\n\r\nexport class HugeRoom extends CommonArea {\r\n    name = 'Huge Room'\r\n    view = 'HugeRoomView'\r\n    width = 10 * major.eighth\r\n    height = 8 * major.eighth\r\n\r\n    prereqs = [LargeRoom]\r\n    machines = hugeBelow\r\n    // machines = [ LogicCrystal ] // ultrafab...\r\n}\r\n\r\n/// surface bldgs\r\n\r\nexport class SmallDome extends Dome {\r\n    name = 'Sm. Dome'\r\n    width = 3 * major.eighth\r\n    height = 2 * major.eighth\r\n    machines = smallDome\r\n}\r\n\r\nexport class SmallDomeThree extends Dome {\r\n    name = 'Sm. Dome (3)'\r\n    view = 'SmallDomeThreeView'\r\n    width = 4 * major.seventh\r\n    height = 3 * major.seventh\r\n    machines = smallDome\r\n}\r\n\r\nexport class MidDome extends Dome {\r\n    name = 'Mid Dome'\r\n    view = 'MidDomeView'\r\n    width = 6 * major.eighth\r\n    height = 5 * major.eighth\r\n    prereqs = [ SmallDome, MediumRoom ]\r\n    //machines = [\r\n    //    Cabin,\r\n    //    Orchard,\r\n    //    Arbor,\r\n    //    // Campfir\r\n    //]\r\n    machines = midDome\r\n}\r\n\r\nexport class LargeDome extends Dome {\r\n    name = 'Lg. Dome'\r\n    view = 'BigDomeView'\r\n    width = 8 * major.eighth\r\n    height = 6 * major.eighth\r\n    prereqs = [MidDome, LargeRoom]\r\n    machines = largeDome\r\n}\r\n\r\nexport class Arcology extends Dome {\r\n    name = 'Arcology'\r\n    view = 'ArcologyView'\r\n    width = 12 * major.eighth\r\n    height = 36 * major.eighth\r\n    prereqs = [LargeDome, HugeRoom]\r\n    machines = hugeDome\r\n    //machines = [\r\n    //    Microcity\r\n    //]\r\n}\r\n\r\n//////\r\n\r\nexport class MissionControl extends Structure {\r\n    name: string = 'Mission Control';\r\n    description: string = 'Keeping everything on track';\r\n    view: string = 'MissionControlView';\r\n    width: number = 6 * major.eighth\r\n    height: number = 1 * major.sixth\r\n    zoom = 0.1\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ SurfaceRoad ],\r\n        [Orientation.Right]: [ SurfaceRoad ],\r\n        [Orientation.Up]: [ MainTunnel ],\r\n        [Orientation.Down]: [ MainTunnel ],\r\n    }\r\n\r\n    machines = [ CommandCenter ]\r\n}\r\n\r\nexport const allStructures =\r\n    [\r\n        SmallDome,\r\n        SmallDomeThree,\r\n        MidDome,\r\n        LargeDome,\r\n        Arcology,\r\n\r\n        SmallRoomTwo,\r\n        SmallRoomThree,\r\n        MediumRoom,\r\n        LargeRoom,\r\n        HugeRoom,\r\n    ]\r\n\r\n\r\n","const majorUnit = 16\r\nconst minorUnit = 4\r\n\r\nconst majorScale = {\r\n    first: majorUnit,\r\n    second: majorUnit * 2,\r\n    third: majorUnit * 3,\r\n    fourth: majorUnit * 4,\r\n    fifth: majorUnit * 5,\r\n    sixth: majorUnit * 6,\r\n    seventh: majorUnit * 7,\r\n    eighth: majorUnit * 8,\r\n}\r\n\r\nconst minorScale = {\r\n    first:   minorUnit,\r\n    second:  minorUnit * 2,\r\n    third:   minorUnit * 3,\r\n    fourth:  minorUnit * 4,\r\n    fifth:   minorUnit * 5,\r\n    sixth:   minorUnit * 6,\r\n    seventh: minorUnit * 7,\r\n    eighth:  minorUnit * 8,\r\n}\r\n\r\nexport const Scale = {\r\n    major: majorScale,\r\n    minor: minorScale\r\n}","import { CorridorView } from \".\";\r\n\r\nexport class SurfaceRoadView extends CorridorView {\r\n    edgeWidth: 0 //.5\r\n    colorBase() { return this.color.lighten(0.1); }\r\n\r\n}","import { Actor, Label, Color, Vector } from \"excalibur\";\r\nimport { Machine, MachineOperation } from \"../models/Machine\";\r\nimport { Building, CommonAreaView } from \"./Building\";\r\nimport { ResourceBlock, blockColor } from \"../models/Economy\";\r\nimport { Citizen } from \"./Citizen\";\r\nimport { Planet } from \"./Planet/Planet\";\r\nimport { SmallRoomThree, SmallRoomTwo, MediumRoom, SmallDome, MidDome, LargeRoom, allStructures } from \"../models/Structure\";\r\nimport { getVisibleDeviceSize } from \"../values/DeviceSize\";\r\n\r\nexport class Device extends Actor {\r\n    product: ResourceBlock[] = []\r\n    // capacity: number = 4\r\n\r\n    nameLabel: Label\r\n\r\n    image: any\r\n    // imageLoaded: boolean = false\r\n\r\n    building: Building // set once built?\r\n\r\n    inUse: boolean = false\r\n\r\n    constructor(\r\n        // public building: Building,\r\n        public machine: Machine,\r\n        private initialPos: Vector\r\n    ) {\r\n        super(\r\n            initialPos.x,\r\n            initialPos.y,\r\n            getVisibleDeviceSize(machine.size),\r\n            getVisibleDeviceSize(machine.size),\r\n            // machine.height,\r\n            machine.color\r\n        )\r\n\r\n        this.nameLabel = new Label(this.machine.name, 0, 0, 'Helvetica')\r\n        this.nameLabel.fontSize = 6\r\n        this.nameLabel.color = Color.White\r\n\r\n        this.image = new Image();\r\n        // this.image.onload = function () {\r\n            //  this.imageLoaded = true\r\n        // }\r\n        this.image.src = machine.image\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        // super.draw(ctx, delta)\r\n        ctx.drawImage(\r\n            this.image,\r\n            this.pos.x - this.getWidth() / 2,\r\n            this.pos.y - this.getHeight() / 2 - 10,\r\n            this.getWidth(), this.getHeight()\r\n        )\r\n\r\n        let showLabel = true\r\n        if (showLabel) {\r\n            this.nameLabel.pos = this.getCenter()\r\n            this.nameLabel.pos.x -= 10 //ctx.measureText(this.machine.name).width / 2\r\n            this.nameLabel.pos.y += 8 + this.getHeight()/2\r\n            this.nameLabel.draw(ctx, delta)\r\n        }\r\n\r\n        let bx = this.x - this.getWidth()/2 + 5, by = this.y - 23\r\n        let blockSize = 5\r\n        this.product.forEach((produced, index) => {\r\n            ctx.fillStyle = blockColor(produced).desaturate(0.3).lighten(0.2).toRGBA();\r\n            ctx.fillRect(bx + blockSize * index, by - blockSize, blockSize-1, blockSize-1)\r\n        })\r\n    }\r\n\r\n    get produces()       { return this.machine.produces }\r\n    get consumes()       { return this.machine.consumes }\r\n    get workTime()       { return this.machine.workTime }\r\n    get generationTime() { return this.machine.generationTime }\r\n    // get productionTime() { return this.machine.productionTime }\r\n    get capacity()       { return this.machine.capacity }\r\n\r\n    async interact(citizen: Citizen) {\r\n        if (this.inUse) {\r\n            citizen.waitToUse(this)\r\n            return\r\n        }\r\n\r\n        if (this.product.length > 0) {\r\n            this.product.pop()\r\n            this.inUse = true\r\n            await citizen.progressBar(500) //this.productionTime)\r\n            this.inUse = false\r\n            citizen.carry(this.produces)\r\n        } else {\r\n            if (this.consumes && citizen.carrying === this.consumes) {\r\n                this.inUse = true\r\n                await citizen.progressBar(this.workTime)\r\n                citizen.carry(this.produces)\r\n                this.inUse = false\r\n            }\r\n        }\r\n\r\n        if (this.machine.behavior === MachineOperation.Work) {\r\n            // ...\r\n\r\n        } else if (this.machine.behavior === MachineOperation.CollectResource) {\r\n            // generic redeem..\r\n            let resource = citizen.drop()\r\n            if (resource) {\r\n                this.building.redeem(resource)\r\n            }\r\n        } else if (this.machine.behavior === MachineOperation.CollectMeals) {\r\n            // store a meal...\r\n            if (citizen.carrying === ResourceBlock.Meal) {\r\n                let resource = citizen.drop()\r\n                if (resource) {\r\n                    this.building.redeem(resource)\r\n                }\r\n            }\r\n        } else if (this.machine.behavior === MachineOperation.CollectData) {\r\n            // store research\r\n            if (citizen.carrying === ResourceBlock.Data) {\r\n                let resource = citizen.drop()\r\n                if (resource) {\r\n                    this.building.redeem(resource)\r\n                }\r\n            }\r\n        } else {\r\n            console.warn(\"no handler for this interaction\", { device: this })\r\n        }\r\n    }\r\n\r\n    public produce(step: number) {\r\n        if (step % this.generationTime === 0) {\r\n            if (this.machine.behavior === MachineOperation.Work) {\r\n\r\n                if (this.produces && !this.consumes && this.product.length < this.capacity) {\r\n                    this.product.push(this.produces)\r\n                }\r\n            } else if (this.machine.behavior === MachineOperation.SpawnCitizen) {\r\n                setTimeout(() => this.building.populate(this.pos), 100)\r\n            }\r\n        }\r\n    }\r\n\r\n    // todo only snap when close enough? try to prevent some mis-clicks?\r\n    snap(planet: Planet, pos: Vector = this.pos) {\r\n        let bldg = planet.colony.closestBuildingByType(pos,\r\n            // hmmm\r\n            allStructures,\r\n            // machines count < device slots count\r\n            (bldg: Building) => {\r\n                let hasSpace = bldg.hasPlaceForDevice()\r\n                return hasSpace && bldg.structure.machines.some(Machine => this.machine instanceof Machine)\r\n\r\n            }\r\n        )\r\n\r\n        if (bldg) {\r\n            this.building = bldg;\r\n            this.pos = this.building.nextDevicePlace().position\r\n            //devicePlaces()[\r\n            //    this.building.devices.length\r\n            //]\r\n        }\r\n\r\n        return !!bldg;\r\n    }\r\n\r\n    finalize() {\r\n        // this.building.devices.push(this)\r\n    }\r\n}","import { minBy } from \"../Util\";\r\n\r\nexport class Graph<T> {\r\n    private empty: boolean = true\r\n    public nodes: T[] = []\r\n    private edges: { [key: number]: number[] } = {}\r\n    private edgesInverse: { [key: number]: number[] } = {}\r\n\r\n    public isEmpty(): boolean {\r\n        return this.empty;\r\n    }\r\n\r\n    public get size() { return this.nodes.length }\r\n\r\n    public node(newNode: T) {\r\n        this.empty = false;\r\n        if (!this.contains(newNode)) {\r\n            this.nodes.push(newNode)\r\n        }\r\n    }\r\n\r\n    public contains(testNode: T) {\r\n        return this.nodes.includes(testNode)\r\n    }\r\n\r\n    public findOrCreate(testNode: T, measure: (a: T, b: T) => number, tolerance: number = 5): T {\r\n        let nodes = this.dfs();\r\n        let closest = minBy(nodes, (node: T) => measure(testNode, node))\r\n        if (closest && measure(closest, testNode) < tolerance) {\r\n            return closest;\r\n        }\r\n        return testNode;\r\n    }\r\n\r\n    public edge(src: T, dst: T) {\r\n        this.node(src)\r\n        this.node(dst)\r\n\r\n        let s = this.indexOf(src), d = this.indexOf(dst)\r\n        this.edges[s] = this.edges[s] || []\r\n        this.edges[s].push(d)\r\n\r\n        this.edgesInverse[d] = this.edgesInverse[d] || []\r\n        this.edgesInverse[d].push(s)\r\n    }\r\n\r\n    public union(otherGraph: Graph<T>) {\r\n       otherGraph.edgeList().forEach(([a,b]) => this.edge(a,b))\r\n    }\r\n\r\n    public edgeList(): [T,T][] {\r\n        let theEdges = []\r\n        for (let node of this.nodes) {\r\n            let index = this.indexOf(node)\r\n            if (this.edges[index]) {\r\n                for (let otherIndex of this.edges[index]) {\r\n                    let otherNode = this.nodes[otherIndex]\r\n                    if (!theEdges.includes([otherNode, node])) {\r\n                        theEdges.push([node, otherNode])\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return theEdges\r\n    }\r\n\r\n    public adjacent(testNode: T): T[] {\r\n        let index = this.indexOf(testNode)\r\n        let vertex = this.adjacentIndices(index)\r\n        return vertex.map((n) => this.nodes[n])\r\n    }\r\n\r\n    private adjacentIndices(testNodeIndex: number): number[] {\r\n        let es = this.edges[testNodeIndex] || []\r\n        let esInv = this.edgesInverse[testNodeIndex] || []\r\n        let vertex = [...es, ...esInv ]\r\n        return vertex\r\n    }\r\n\r\n    public dfs(root:T=null, visited=[]): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.dfsIndex(rIndex).map(n => this.nodes[n])\r\n    }\r\n\r\n    private dfsIndex(rootIndex:number=0, visited:number[]=[]) {\r\n        visited.push(rootIndex)\r\n        let children = this.adjacentIndices(rootIndex)\r\n        children.forEach((childIndex: number) => {\r\n            if (!visited.includes(childIndex)) {\r\n                this.dfsIndex(childIndex, visited)\r\n            }\r\n        })\r\n\r\n        return visited\r\n    }\r\n\r\n    public bfs(root:T=null, cb: (x: number,y: number)=>boolean = ()=>true): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.bfsIndex(rIndex, cb).map(n => this.nodes[n])\r\n    }\r\n\r\n    private bfsIndex(rootIndex:number=null, cb: (x: number, y: number) => boolean = () => true): number[] {\r\n        let halt = false;\r\n        let visited: number[] = []\r\n        visited.push(rootIndex)\r\n        while (visited.length < this.nodes.length) {\r\n            for (let visitedNode of visited) {\r\n                let adj: number[] = this.adjacentIndices(visitedNode)\r\n                for (let adjacentNode of adj) {\r\n                    if (!visited.includes(adjacentNode)) {\r\n                        if (!cb(visitedNode, adjacentNode)) {\r\n                            halt = true;\r\n                            break;\r\n                        }\r\n                        visited.push(adjacentNode)\r\n                    }\r\n                }\r\n                if (halt) break;\r\n            }\r\n            if (halt) break;\r\n        }\r\n        return visited\r\n    }\r\n\r\n    public shortestPath(src: T, dst: T, maxStep: number = 256): T[] {\r\n        let prevStep = {}\r\n        let dstIndex = this.indexOf(dst)\r\n        this.bfs(src, (prev, curr) => {\r\n            prevStep[curr] = prev;\r\n            return curr !== dstIndex\r\n        })\r\n        let path = []\r\n        let curr = dstIndex\r\n        let steps = 0\r\n        let srcIndex = this.indexOf(src)\r\n        while (!path.includes(srcIndex) && steps < maxStep) {\r\n            path.push(curr)\r\n            curr = prevStep[curr]\r\n            steps += 1\r\n        }\r\n        let pathNodes = path.map(n => this.nodes[n])\r\n        return pathNodes.reverse()\r\n    }\r\n\r\n    private indexOf(node: T) {\r\n        return this.nodes.indexOf(node)\r\n    }\r\n\r\n}","import { Engine, DisplayMode, Loader } from 'excalibur';\r\nimport { World } from './models/World';\r\nimport { Resources } from './Resources';\r\n\r\nexport class Game extends Engine {\r\n\r\n  static citizenSpeed: number = 100\r\n\r\n  constructor(public world: World) {\r\n    super({\r\n      width: 800,\r\n      height: 600,\r\n      displayMode: DisplayMode.FullScreen,\r\n      backgroundColor: world.skyColor\r\n    });\r\n  }\r\n  public start() { //loader: ex.Loader) {\r\n    let loader = new Loader();\r\n    for (let key in Resources) {\r\n      loader.addResource(Resources[key]);\r\n    }\r\n    return super.start(loader);\r\n  }\r\n}","import { DomeView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class SmallDomeThreeView extends DomeView {\r\n\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - 6\r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    }\r\n}","import { DeviceSize } from \"../../values/DeviceSize\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DomeView } from \".\";\r\n\r\nexport class BigDomeView extends DomeView {\r\n\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - 20\r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            // new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Large))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class HugeRoomView extends CommonAreaView {\r\n    // device nodes are huge sized...\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - getVisibleDeviceSize(DeviceSize.Huge)/2 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            // new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Huge))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class LargeRoomView extends CommonAreaView {\r\n    // device nodes are large sized...\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - getVisibleDeviceSize(DeviceSize.Large)/2 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            // new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Large))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\n\r\nexport class MediumRoomView extends CommonAreaView {\r\n    // device nodes are medium sized...\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - 20 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            // new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    }\r\n}","import { DomeView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class MidDomeView extends DomeView {\r\n\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - 20\r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            // new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class SmallRoomThreeView extends CommonAreaView {\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - 10\r\n        let ds = [\r\n            new Vector(x - w / 2, y),\r\n            new Vector(x, y),\r\n            new Vector(x + w / 2, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    }\r\n}","import { Label, Color, Actor, FontStyle } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nexport class CardTitle extends Actor {\r\n    \r\n    name: Label;\r\n    type: Label;\r\n    constructor(private entity: Machine | Structure, x: number, y: number) {\r\n        super(x, y, 14, 32, entity && entity.color || Color.Gray);\r\n        // console.log(\"TITLE FOR\", { entity })\r\n        this.name = new Label(entity && entity.name || '..', 20, 16)\r\n        this.name.fontSize = 28\r\n        this.name.color = Color.Black\r\n        this.add(this.name)\r\n\r\n        this.type = new Label('..', 240, 16)\r\n        this.type.fontSize = 10\r\n        this.type.color = Color.Gray\r\n        this.type.fontStyle = FontStyle.Italic\r\n        this.add(this.type)\r\n    }\r\n\r\n    announce(entity: Machine | Structure): any {\r\n        this.name.text = entity.name\r\n        this.color = entity.color.desaturate(0.5).darken(0.2)\r\n        if (entity instanceof Machine) { this.type.text = 'Machine' }\r\n        if (entity instanceof Structure) { this.type.text = 'Structure' }\r\n    }\r\n}\r\n","import { Label, Color, Actor, FontStyle } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nimport { CardTitle } from \"./CardTitle\";\r\nimport { drawRect } from \"../../Util\";\r\n\r\nexport class Card extends Actor {\r\n    title: CardTitle\r\n    description: Label\r\n    image: any\r\n    constructor(private entity: Machine | Structure, x: number, y: number) {\r\n        super(x + 150, y, 320, 180, Color.White);\r\n        let x0 = -150, y0 = -50;\r\n        this.title = new CardTitle(entity, x0 - 3, y0); //x, y)\r\n        this.add(this.title);\r\n        this.description = new Label(entity && entity.description || 'okay', x0 + 14, y0 + 40);\r\n        this.description.fontSize = 10;\r\n        this.description.fontStyle = FontStyle.Italic;\r\n        this.add(this.description);\r\n        \r\n\r\n        this.image = new Image();\r\n        // this.image.onload = function () {\r\n            //  this.imageLoaded = true\r\n        // }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta) {\r\n        super.draw(ctx, delta)\r\n        if (this.entity) { //}.image)\r\n            // console.log(\"DRAW IMAGE\")\r\n            if (this.entity instanceof Machine && this.image) {\r\n                let ix = this.pos.x + 48, iy = this.pos.y - 16\r\n                let isz = 92\r\n                drawRect(ctx, { x: ix, y: iy, width: isz, height: isz }, 1, Color.LightGray.lighten(0.1))\r\n                ctx.drawImage(this.image, ix, iy, isz, isz)\r\n            }\r\n        }\r\n    }\r\n\r\n    present(entity: Machine | Structure): any {\r\n        this.title.announce(entity)\r\n        this.description.text = entity.description;\r\n\r\n        this.entity = entity\r\n        if (this.entity instanceof Machine) {\r\n            this.image.src = this.entity.image\r\n        }\r\n    }\r\n\r\n}\r\n","import { Label, Color, Actor } from \"excalibur\";\r\nexport class EconomicValue extends Actor {\r\n    private nameLabel: Label;\r\n    private valueLabel: Label;\r\n    constructor(name: string, x: number, y: number) {\r\n        super(x, y, 0, 0);\r\n        this.nameLabel = new Label(name, x, y);\r\n        this.nameLabel.fontSize = 10;\r\n        this.nameLabel.color = Color.White.darken(0.2);\r\n        this.add(this.nameLabel);\r\n        this.valueLabel = new Label('0', x + 40, y);\r\n        this.valueLabel.fontSize = 10;\r\n        this.valueLabel.color = Color.White.darken(0.2);\r\n        this.add(this.valueLabel);\r\n    }\r\n    setCount(count: number) {\r\n        this.valueLabel.text = `${count}`;\r\n        let c = Color.Gray;\r\n        if (count > 0) {\r\n            c = Color.Green;\r\n        }\r\n        else if (count < 0) {\r\n            c = Color.Red;\r\n        }\r\n        this.valueLabel.color = c;\r\n    }\r\n}\r\n","import { Actor } from \"excalibur\";\r\nimport { Economy, PureValue } from \"../../models/Economy\";\r\nimport { EconomicValue } from \"./EconomicValue\";\r\n\r\nexport class EconomyView extends Actor {\r\n    private valueLabels: { [key in PureValue]: EconomicValue } = {\r\n        Power: null,\r\n        Oxygen: null,\r\n        Water: null,\r\n        Shelter: null,\r\n        Hope: null,\r\n        Joy: null,\r\n        Wisdom: null,\r\n        Wealth: null,\r\n        Beauty: null,\r\n        Wonder: null\r\n    }\r\n\r\n    constructor(market: Economy, x: number, y: number) {\r\n        super(x, y, 0, 0);\r\n\r\n        let index = 0\r\n        for (let value in PureValue) {\r\n            let valueLabel: EconomicValue =  new EconomicValue(value, (index++ * 34), 0)\r\n            this.valueLabels[value] = valueLabel\r\n            this.add(valueLabel)\r\n        }\r\n\r\n        this.updateView(market);\r\n    }\r\n\r\n    updateView(updatedEconomy: Economy): void {\r\n        let market = updatedEconomy;\r\n\r\n        for (let value in PureValue) {\r\n            let { demand, supply } = market[value];\r\n            this.valueLabels[value].setCount(supply-demand)\r\n        }\r\n\r\n    }\r\n}\r\n","import { Label, Color, Actor } from \"excalibur\";\r\nimport { ResourceBlock, blockColor } from \"../../models/Economy\";\r\nexport class ResourceListEntry extends Actor {\r\n    icon: Actor;\r\n    count: Label;\r\n    constructor(x: number, y: number, resourceBlock: ResourceBlock, protected value: number) {\r\n        super(x, y, 10, 10); // 10,10,blockColor(resourceBlock))\r\n        let icon = new Actor(x, y, 10, 10, blockColor(resourceBlock)); //ResourceBlock.Meal))\r\n        this.add(icon);\r\n        this.count = new Label(`x${value}`, x + 10, y + 6, 'Helvetica');\r\n        this.count.fontSize = 10;\r\n        this.count.color = Color.White;\r\n        this.add(this.count);\r\n    }\r\n    credit(amt: number) {\r\n        this.value += amt;\r\n        this.count.text = `x${this.value}`;\r\n    }\r\n}\r\n","import { Color, Actor } from \"excalibur\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\nimport { ResourceListEntry } from \"./ResourceListEntry\";\r\nexport class ResourcesList extends Actor {\r\n    entries: {\r\n        [block in ResourceBlock]: ResourceListEntry;\r\n    } = {\r\n            // non-accruable\r\n            [ResourceBlock.Food]: null,\r\n            [ResourceBlock.Hypothesis]: null,\r\n            [ResourceBlock.Ore]: null,\r\n\r\n            // displayed/accruable\r\n            [ResourceBlock.Meal]: null,\r\n            [ResourceBlock.Mineral]: null,\r\n            [ResourceBlock.Data]: null,\r\n\r\n            // derived/accurable\r\n            [ResourceBlock.Alloy]: null,\r\n        };\r\n\r\n    constructor(x: number, y: number) {\r\n        super(x, y, 0, 0, Color.DarkGray.darken(0.8));\r\n        let rx0 = 0, ry0 = -2.5;\r\n        let resources = [ResourceBlock.Meal, ResourceBlock.Data, ResourceBlock.Mineral];\r\n        resources.forEach((resource, index) => {\r\n            let rx = rx0 + index * 16, ry = ry0 + index * 0;\r\n            let entry = new ResourceListEntry(rx, ry, resource, 0);\r\n            this.add(entry);\r\n            this.entries[resource] = entry;\r\n        });\r\n    }\r\n\r\n    increment(resource: ResourceBlock) {\r\n        // console.log(\"INCREMENT\", { resource })\r\n        let res = this.entries[resource]\r\n        if (res) {\r\n            res.credit(1);\r\n        }\r\n    }\r\n}\r\n","import { Label, Color, Actor, FontStyle, FontUnit } from \"excalibur\";\r\nimport { Economy, ResourceBlock, PureValue } from \"../../models/Economy\";\r\nimport { ResourcesList } from \"./ResourcesList\";\r\nimport { EconomyView } from \"./EconomyView\";\r\n\r\nexport class StatusAnalysisView extends Actor {\r\n    private messageLabel: Label\r\n    private popLabel: Label\r\n\r\n    private resources: ResourcesList\r\n    private economy: EconomyView\r\n\r\n\r\n    constructor(market: Economy, w: number = 10000, h: number = 28) {\r\n        super(0,0, w, h, Color.DarkGray.darken(0.8));\r\n\r\n        let ty = 12\r\n\r\n        let brand = new Label(\"OSIRIS\", 5, ty+2)\r\n        brand.fontSize = 12\r\n        brand.color = Color.Gray\r\n        brand.fontStyle = FontStyle.Italic\r\n        this.add(brand)\r\n\r\n        let version = new Label(\"v0.0.1\", 48, ty + 2)\r\n        version.fontSize = 7\r\n        version.color = Color.Gray.darken(0.4)\r\n        this.add(version)\r\n\r\n\r\n        this.resources = new ResourcesList(80, ty)\r\n        this.add(this.resources)\r\n\r\n        this.economy = new EconomyView(market, 200, ty)\r\n        this.add(this.economy)\r\n\r\n        this.popLabel = new Label(\"\", 900, ty, 'Helvetica')\r\n        this.popLabel.fontSize = 10\r\n        this.popLabel.color = Color.White\r\n        this.add(this.popLabel)\r\n\r\n        this.messageLabel = new Label('hi', 1000, ty, 'Helvetica')\r\n        this.messageLabel.fontSize = 10\r\n        this.messageLabel.color = Color.White\r\n        this.add(this.messageLabel)\r\n    }\r\n\r\n    incrementResource(res: ResourceBlock) {\r\n        this.resources.increment(res)\r\n    }\r\n\r\n    setMessage(text: string) { this.messageLabel.text = text }\r\n\r\n    showEconomy(updatedEconomy: Economy): any {\r\n        this.economy.updateView(updatedEconomy)\r\n    }\r\n\r\n    showPopCap(curr: any, cap: any): any {\r\n        this.popLabel.text = `Pop: ${curr}/${cap}`\r\n    }\r\n    \r\n}\r\n","import { UIActor, Color } from \"excalibur\";\r\nimport { Structure, Corridor, SurfaceRoad, Ladder, SmallRoomThree, SmallRoomTwo, MediumRoom, MidDome, SmallDome, LargeRoom, allStructures } from \"../../models/Structure\";\r\nimport { Game } from \"../../Game\";\r\nimport { ResourceBlock, emptyMarket, sumMarkets, PureValue } from \"../../models/Economy\";\r\nimport { ResourcesList } from \"./ResourcesList\";\r\nimport { Desk, Bookshelf, Machine, CloningVat, WaterCondensingMachine, OxygenExtractor, AlgaeVat, Stove, Bed, Fridge, ResearchServer, Cabin, Orchard, SolarCell, Megafabricator, Arbor, Fabricator, MiningDrill, Preserve, Workstation, Houseplant, allMachines } from \"../../models/Machine\";\r\nimport { flatSingle } from \"../../Util\";\r\nimport { Colony } from \"../Planet/Colony\";\r\nimport { StatusAnalysisView } from \"./StatusAnalysisView\";\r\nimport { Device } from \"../Device\";\r\nimport { Planet } from \"../Planet/Planet\";\r\nimport { Card } from \"./Card\";\r\n\r\nexport class Hud extends UIActor {\r\n    private restrictConstruction: boolean = false\r\n    private status: StatusAnalysisView\r\n    private _structurePaletteElement: HTMLDivElement\r\n    private _machinePaletteElement: HTMLDivElement\r\n\r\n    static structuresForPalette = [\r\n        SurfaceRoad,\r\n        Corridor,\r\n        Ladder,\r\n        ...allStructures\r\n    ];\r\n\r\n    comprehendedStructures: (typeof Structure)[] = []\r\n    builtStructures: (typeof Structure)[] = []\r\n\r\n    static machinesForPalette = allMachines\r\n\r\n    comprehendedMachines: (typeof Machine)[] = []\r\n    builtMachines: (typeof Machine)[] = []\r\n\r\n    card: Card = new Card(null, 20, 800)\r\n\r\n    constructor(private game: Game, protected onBuildingSelect = null, protected onMachineSelect = null) {\r\n        super(0, 0, game.canvasWidth, game.canvasHeight);\r\n        this._makeStructurePalette(onBuildingSelect)\r\n        this._makeMachinePalette(onMachineSelect)\r\n        this.status = new StatusAnalysisView(emptyMarket());\r\n        this.add(this.status)\r\n\r\n        this.card.visible = false\r\n        this.add(this.card)\r\n    }\r\n\r\n    setMessage(text: string) { this.status.setMessage(text) }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta)\r\n        if (this._structurePaletteElement) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._structurePaletteElement.style.left = `${left + 20}px`;\r\n            this._structurePaletteElement.style.top = `${top + 35}px`;\r\n        }\r\n        if (this._machinePaletteElement) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._machinePaletteElement.style.left = `${left + 20}px`;\r\n            this._machinePaletteElement.style.top = `${top + 350}px`;\r\n        }\r\n\r\n    }\r\n\r\n    resourceGathered(resource: ResourceBlock) {\r\n        this.status.incrementResource(resource)\r\n    }\r\n\r\n    updateDetails(planet: Planet, rebuildPalettes: boolean = true) {\r\n        if (rebuildPalettes) {\r\n            this.updatePalettes(planet.colony)\r\n        }\r\n        this.updateEconomy(planet)\r\n        this.updateMaxPop(planet.economy[PureValue.Shelter].demand, planet.maxPop)\r\n    }\r\n\r\n    showCard(entity: Machine | Structure) {\r\n        this.card.present(entity)\r\n        this.card.visible = true\r\n    }\r\n\r\n\r\n    private updateMaxPop(curr, cap) {\r\n        this.status.showPopCap(curr, cap)\r\n    }\r\n\r\n    private updateEconomy(planet: Planet) {\r\n        this.status.showEconomy(planet.economy)\r\n    }\r\n\r\n    private updatePalettes(colony: Colony) {\r\n        this.updateBuildingPalette(colony)\r\n        this.updateMachinePalette(colony)\r\n    }\r\n\r\n    private updateBuildingPalette(colony: Colony) {\r\n        this.comprehendedStructures = Hud.structuresForPalette\r\n        if (this.restrictConstruction) {\r\n            this.builtStructures =\r\n                Hud.structuresForPalette.filter((structure) => colony.buildings.some(b => b.structure instanceof structure))\r\n            this.comprehendedStructures = this.comprehendedStructures.filter((structure: typeof Structure) => {\r\n                let s = new structure()\r\n                let prereqs: (typeof Structure)[] = s.prereqs\r\n                return prereqs.every((prereq: (typeof Structure)) => {\r\n                    let built = this.builtStructures.some((s: (typeof Structure)) => s === prereq)\r\n                    return built\r\n                })\r\n            })\r\n        }\r\n        this._structurePaletteElement.parentElement.removeChild(this._structurePaletteElement)\r\n        this._makeStructurePalette(this.onBuildingSelect)\r\n    }\r\n\r\n    private updateMachinePalette(colony: Colony) {\r\n        let bldgs = colony.buildings\r\n        let availableMachines = flatSingle(bldgs.map(b => b.structure.machines))\r\n        let devices = colony.findAllDevices()\r\n        this.builtMachines = Hud.machinesForPalette.filter((machine) => devices.some(d => d.machine instanceof machine))\r\n        this.comprehendedMachines = Hud.machinesForPalette.filter((machine: typeof Machine) => {\r\n            let canBuild = availableMachines.includes(machine);\r\n            return canBuild && (new machine()).prereqs.every((prereq: (typeof Machine)) => {\r\n                return this.builtMachines.some((m: (typeof Machine)) => m === prereq)\r\n            })\r\n\r\n        })\r\n        this._machinePaletteElement.parentElement.removeChild(this._machinePaletteElement)\r\n        this._makeMachinePalette(this.onMachineSelect)\r\n    }\r\n\r\n\r\n    protected _makeStructurePalette(fn: (Structure) => any) {\r\n        this._structurePaletteElement = document.createElement('div') \r\n        this._structurePaletteElement.style.position = 'absolute'\r\n        this._structurePaletteElement.style.border = '1px solid white'\r\n        document.body.appendChild(this._structurePaletteElement)\r\n        this.comprehendedStructures\r\n        .map(structure => new structure())\r\n        .forEach((structure: Structure) => {\r\n            let label = structure.name\r\n            if (!this.builtStructures.map(s => new s().name).includes(structure.name)) {\r\n                label += ' *';\r\n            }\r\n            let clr = structure.color\r\n            let btn = this.buttonFactory(label, clr);\r\n            this._structurePaletteElement.appendChild(\r\n                btn\r\n            )\r\n\r\n            btn.onmouseenter = () => { this.showCard(structure) }\r\n            // btn.onmouseleave = () => { this.hideCard() }\r\n            if (fn) {\r\n                btn.onclick = () => {\r\n                    fn(structure) \r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    protected _makeMachinePalette(fn: (Machine) => any) {\r\n        this._machinePaletteElement = document.createElement('div')\r\n        this._machinePaletteElement.style.position = 'absolute'\r\n        this._machinePaletteElement.style.border = '1px solid white'\r\n        document.body.appendChild(this._machinePaletteElement)\r\n\r\n        this.comprehendedMachines\r\n            .map(Machine => new Machine())\r\n            .sort((a,b) => a.color > b.color ? -1 : 1)\r\n            .forEach(machine => {\r\n                let label = machine.name\r\n                if (!this.builtMachines.map(m => new m().name).includes(machine.name)) {\r\n                    label += ' *'\r\n                }\r\n                let clr = machine.color\r\n                let btn = this.buttonFactory(label, clr)\r\n                this._machinePaletteElement.appendChild(btn)\r\n                btn.onmouseenter = () => { this.showCard(machine) }\r\n                // btn.onmouseleave = () => { this.hideCard() }\r\n                if (fn) {\r\n                    btn.onclick = () => { fn(machine) }\r\n                }\r\n            })\r\n    }\r\n\r\n    private buttonFactory(label: string, color: Color) {\r\n        let bg = color.darken(0.6).desaturate(0.5).clone()\r\n        bg.a = 0.8\r\n        let fg = color.lighten(0.8).desaturate(0.4).clone()\r\n        let paletteButton = document.createElement('button');\r\n\r\n        paletteButton.textContent = label;\r\n\r\n        paletteButton.style.display = 'block';\r\n        paletteButton.style.fontSize = '9pt';\r\n\r\n        paletteButton.style.fontFamily = 'Helvetica';\r\n        paletteButton.style.fontWeight = '600';\r\n        paletteButton.style.padding = '1px';\r\n        paletteButton.style.width = '160px';\r\n        paletteButton.style.textTransform = 'uppercase'\r\n        paletteButton.style.border = '1px solid rgba(255,255,255,0.08)'\r\n\r\n        paletteButton.style.background = bg.toRGBA();\r\n        paletteButton.style.color = fg.toRGBA()\r\n        paletteButton.onmouseover = () => {\r\n            paletteButton.style.background = bg.saturate(0.5).lighten(0.95).toRGBA()\r\n            paletteButton.style.color = fg.lighten(0.9).toRGBA()\r\n        }\r\n        paletteButton.onmouseleave = () => {\r\n            paletteButton.style.background = bg.toRGBA()\r\n            paletteButton.style.color = fg.toRGBA()\r\n        }\r\n\r\n        return paletteButton;\r\n    }\r\n}","import { CommonAreaView } from '.'\r\nimport { Vector } from 'excalibur';\r\n// import { Corridor, Refinery, Mine } from '../../models/Structure';\r\n\r\nexport class MineView extends CommonAreaView {\r\n    floorHeight = 150\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y)-4)\r\n        ];\r\n    }\r\n\r\n    // validConnectingStructures() { return [ Corridor, Mine, Refinery ]}\r\n}","import { TunnelView } from \".\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Vector } from \"excalibur\";\r\n\r\nexport class LadderView extends TunnelView {\r\n    // edgeWidth = 1\r\n    originSlot: Slot = null\r\n    constrainCursor(cursor: Vector): Vector {\r\n       if (this.pickingOrigin) {\r\n\r\n       } else {\r\n           cursor.x = this.pos.x\r\n       }\r\n       return cursor;\r\n    }\r\n\r\n    reshape(cursor: Vector) {\r\n        if (this.pickingOrigin) { \r\n            let theSlot = this.alignToSlot(cursor)\r\n            if (theSlot) {\r\n                this.facing = theSlot.facing\r\n\r\n                if (theSlot) {\r\n                    this.originSlot = theSlot\r\n                }\r\n            }\r\n        } else {\r\n            if (this.facing === Orientation.Up) {\r\n                let maxHeight = this.originSlot.pos.y - this.planet.getTop() - 25\r\n\r\n                let h = Math.min(maxHeight, Math.max(100, this.originSlot.pos.y - cursor.y))\r\n                this.setHeight((h/50)*50)\r\n                this.pos.y = this.originSlot.pos.y - this.getHeight()\r\n            } else {\r\n                let h = Math.max(100, cursor.y - this.originSlot.pos.y)\r\n                this.setHeight((h/50)*50) // - cursor.y))\r\n            }\r\n        }\r\n    }\r\n}","import { DomeView } from \".\";\r\nimport { Color, Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class ArcologyView extends DomeView {\r\n\r\n    devicePlaces() {\r\n        let w = 3*this.getWidth()/5\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight()/2 // - 20\r\n        let ds = [\r\n            new Vector(x, y-800),\r\n            new Vector(x, y),\r\n            new Vector(x, y+800),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Huge))\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        // super.draw(ctx, delta)\r\n\r\n        this.drawShape(ctx, this.pos.x, this.pos.y)\r\n        this.getDevices().forEach(device => device.draw(ctx, delta))\r\n\r\n    }\r\n\r\n    private drawShape(ctx, xoff, yoff) {\r\n        let h = this.getHeight()\r\n        let w = this.getWidth()\r\n        ctx.beginPath();\r\n        ctx.moveTo(0 + xoff, h + yoff);\r\n        // ctx.bezierCurveTo(-3 + xoff, 514 + yoff, 1 + xoff, 406 + yoff, 1 + xoff, 391 + yoff);\r\n        ctx.bezierCurveTo(1 + xoff, h - 150 + yoff, 121 + xoff, 70 + yoff, w - 80 + xoff, 8 + yoff);\r\n        ctx.bezierCurveTo(w - 40 + xoff, 2 + yoff, w - 5 + xoff, 11 + yoff, w - 10 + xoff, 25 + yoff);\r\n        ctx.bezierCurveTo(w - 5 + xoff, 10 + yoff, w + xoff, (h-10) + yoff, w + xoff, h + yoff);\r\n        ctx.lineTo(0 + xoff, h + yoff);\r\n        ctx.fillStyle = this.mainColor().toRGBA()\r\n        ctx.fill();\r\n    }\r\n}","import { Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { MissionControl } from \"../../models/Structure\";\r\nimport { range, eachCons, measureDistance, drawRect } from \"../../Util\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip } from \"../../values/Orientation\";\r\nimport { Graph } from \"../../values/Graph\";\r\n\r\nexport class TunnelView extends Building {\r\n    pickingOrigin: boolean = true\r\n    hideBox = true\r\n    // edgeWidth = 0.2\r\n\r\n    colorBase() { return this.color.darken(0.2); }\r\n\r\n    draw(ctx, delta) {\r\n        let rect = this.aabb()\r\n        drawRect(ctx, rect, 0, this.color.darken(0.1)) \r\n\r\n        let n = 5\r\n        rect.x = rect.x + this.getWidth() / n\r\n        rect.width -= (2) * (this.getWidth() / n)\r\n        drawRect(ctx, rect, 0, this.color.darken(0.2)) \r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y\r\n        return [\r\n            new Vector(Math.floor(x), y) //, Math.floor(y)-4)\r\n        ];\r\n    }\r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph;\r\n\r\n        let halfWidth = this.getWidth()/2\r\n        let x = this.pos.x + halfWidth\r\n\r\n        // connect node to first slot...\r\n        let root = g.findOrCreate(this.nodes()[0], measureDistance)\r\n        let first = g.findOrCreate(new Vector(x,this.slotHeights()[0]), measureDistance)\r\n        g.edge(root,first)\r\n\r\n        let heights = this.slotHeights()\r\n\r\n        eachCons(heights, 2).forEach(([y0,y1]: [number,number]) => {\r\n            let top = g.findOrCreate(new Vector(x,y0), measureDistance)\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n            g.edge(top, btm)\r\n        })\r\n\r\n        let btm = g.findOrCreate(new Vector(x, this.pos.y + this.getHeight()), measureDistance)\r\n        let lst = g.findOrCreate(new Vector(x, heights[heights.length-1]), measureDistance)\r\n        g.edge(btm,lst)\r\n\r\n        heights.forEach(y1 => {\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n\r\n            let left = g.findOrCreate(new Vector(x-halfWidth,y1), measureDistance)\r\n            g.edge(left,btm)\r\n\r\n            let right = g.findOrCreate(new Vector(x+halfWidth,y1), measureDistance)\r\n            g.edge(btm,right)\r\n        });\r\n\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(childNode, slot)\r\n            g.edge(slot, childNode)\r\n\r\n            child.graph(g)\r\n        }\r\n\r\n        return g;\r\n    }\r\n\r\n    private slotHeights() {\r\n        let slotSize = 50\r\n        let slotCount = Math.floor((this.getHeight()) / slotSize)\r\n        let heights = []\r\n        for (let i of range(slotCount)) {\r\n            heights.push(\r\n                50 + this.pos.y + i * slotSize,\r\n            )\r\n        }\r\n        return heights\r\n    }\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y,\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n        for (let y of this.slotHeights()) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x, y,\r\n                    Orientation.Left\r\n                )\r\n            )\r\n\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x + this.getWidth(),\r\n                    y,\r\n                    Orientation.Right,\r\n                )\r\n            )\r\n        }\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n        return theSlots;\r\n    } \r\n\r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        if (this.pickingOrigin) {\r\n            this.alignToSlot(cursor)\r\n        } else {\r\n            // we're determining depth of tunnel\r\n            cursor.y = Math.max(this.planet.getTop() + 100, cursor.y)\r\n        }\r\n        return cursor;\r\n    }\r\n\r\n    // expand\r\n    reshape(cursor: Vector) {\r\n        this.pos.y = this.planet.getTop() + 2\r\n        if (!this.pickingOrigin) {\r\n          this.setHeight(cursor.y - this.planet.getTop())\r\n        }\r\n    }\r\n\r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Device } from \"../Device\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class MissionControlView extends Building {\r\n    hideBox = true\r\n\r\n    devicePlaces() {\r\n        return this.nodes().map(n => {\r\n            n.y -= 20\r\n            return new DevicePlace(n, DeviceSize.Medium)\r\n        }) \r\n    }\r\n\r\n    afterConstruct() {\r\n        // build devices?\r\n        let { machines } = this.structure;\r\n        if (machines && machines.length > 0) {\r\n            let machine = new machines[0]();\r\n            this.devicePlaces().forEach(place => {\r\n                let theDevice = new Device(machine, place.position)\r\n                this.addDevice(theDevice)\r\n                // this.devices.push(theDevice)\r\n                // theDevice.building = this;\r\n                // this.add(theDevice)\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() / 2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n\r\n        let slotY = this.getHeight();\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n\r\n        return theSlots;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        cursor.y = this.planet.getTop();\r\n        return cursor;\r\n    }\r\n\r\n    reshape(cursor: Vector) {\r\n        this.pos = cursor\r\n        this.pos.y -= this.getHeight() - 2 // + 1\r\n    }\r\n\r\n    //async interact(citizen: Citizen) {\r\n    //}\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color = this.mainColor();\r\n\r\n        ctx.fillStyle = color.toRGBA()\r\n        // y is going to be surface height\r\n        ctx.fillRect(this.pos.x, this.pos.y, this.getWidth(), this.getHeight())\r\n\r\n        // could draw a little flag :)\r\n        let flagpoleHeight = 18\r\n        let flagX = this.pos.x + 3 * (this.getWidth() / 4)\r\n        let flagY = this.pos.y - flagpoleHeight\r\n        ctx.fillRect(flagX, flagY, 2, flagpoleHeight)\r\n        ctx.fillRect(flagX, flagY, 10, 5)\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White; }\r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class DomeView extends Building {\r\n    hideBox = true\r\n    showLabel = true\r\n\r\n    slots() {\r\n        let theSlots = [];\r\n        let slotY = this.getHeight();\r\n\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n    reshape(cursor: Vector) {\r\n        this.alignToSlot(cursor)\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color: Color = this.mainColor()\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(\r\n            this.pos.x + this.getWidth()/2,\r\n            this.pos.y + this.getHeight(),\r\n            this.getHeight()/1.5,\r\n            0,\r\n            Math.PI,\r\n            true\r\n        )\r\n        ctx.closePath()\r\n        ctx.fillStyle = color.toRGBA()\r\n        ctx.fill()\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White.darken(0.05); } \r\n\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - 6\r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            // new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    }\r\n}","import { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\nimport { drawRect } from \"../../Util\";\r\n\r\nexport class CommonAreaView extends Building {\r\n    floorHeight: number = 12\r\n    edgeWidth: number = 0.5 //.1\r\n    showLabel = true\r\n    hideBox = true\r\n\r\n    colorBase() { return this.color.darken(0.3); }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n\r\n        let wallColor = this.processedColor() //.darken(0.4)\r\n        let floorColor = this.processedColor().darken(0.4)\r\n\r\n        drawRect(ctx, this.aabb(), 0.5, wallColor)\r\n\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight,\r\n              width: this.getWidth(), height: this.floorHeight },\r\n              0.2,\r\n              floorColor\r\n        )\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    slots() {\r\n        let theSlots = []\r\n        let slotY = this.getHeight() - this.floorHeight\r\n        let leftSlot: Slot = this.buildSlot(\r\n            this.pos.x,\r\n            this.pos.y + slotY,\r\n            Orientation.Left,\r\n        )\r\n        theSlots.push(leftSlot)\r\n\r\n        let rightSlot: Slot = this.buildSlot(\r\n            this.pos.x + this.getWidth(),\r\n            this.pos.y + slotY,\r\n            Orientation.Right,\r\n        )\r\n        theSlots.push(rightSlot)\r\n\r\n        // top slot\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y,\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n        // bottom slot\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n        return theSlots;\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()-this.floorHeight\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y)) //-16)\r\n        ];\r\n    }\r\n  \r\n    reshape(cursor) {\r\n        this.alignToSlot(cursor);\r\n    }\r\n\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - 10 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            // new Vector(x, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    }\r\n}","import { Building } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\n\r\nexport class CorridorView extends Building {\r\n    edgeWidth: number = 0\r\n\r\n    pickingOrigin: boolean = true\r\n    facing: Orientation = Orientation.Left\r\n\r\n    colorBase() { return this.color.darken(0.2); }\r\n\r\n    slots() {\r\n        // left slot -- right slot\r\n        let theSlots: Slot[] = [];\r\n        let slotY = this.getHeight() / 2;\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n    \r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            this.reshape(this.constrainCursor(cursor))\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        let newCursor = cursor.clone();\r\n        if (this.pickingOrigin) {\r\n        } else {\r\n            newCursor.y = this.pos.y\r\n        }\r\n\r\n        return newCursor;\r\n    }\r\n\r\n    originX: number = 0\r\n    reshape(cursor: Vector) {\r\n\r\n        if (this.pickingOrigin) {\r\n            let theSlot = this.alignToSlot(cursor)\r\n            if (theSlot) {\r\n                this.facing = theSlot.facing\r\n\r\n                if (theSlot && this.facing === Orientation.Left) {\r\n                    this.originX = theSlot.pos.x\r\n                }\r\n            }\r\n\r\n        } else {\r\n            if (this.facing === Orientation.Left) {\r\n                this.setWidth(Math.abs(this.originX - cursor.x))\r\n                this.pos.x = this.originX - this.getWidth()\r\n            } else {\r\n                this.setWidth(Math.abs(this.pos.x - cursor.x))\r\n            }\r\n        }\r\n    }\r\n}","import { Machine, OxygenExtractor, WaterCondensingMachine, CloningVat, Bookshelf, Desk, Bed, Stove, AlgaeVat, ResearchServer, Fridge, SolarCell, Arbor, Cabin, Workstation, Fabricator, Houseplant, Orchard, Megafabricator, StudyMachine } from './Machine';\r\n\r\nexport class SpaceFunction {\r\n    static label: string = '(generic)';\r\n    static machines: (typeof Machine)[] = [];\r\n}\r\n\r\nclass LivingQuarters extends SpaceFunction {\r\n    static label = 'Living Quarters'\r\n    static machines = [ Bed ]\r\n}\r\n\r\nclass Barracks extends SpaceFunction {\r\n    static label = 'Barracks'\r\n    static machines = [ Bed, Bed, Bed ]\r\n}\r\n\r\nclass Kitchen extends SpaceFunction {\r\n    static label = 'Kitchen'\r\n    static machines = [ Stove, Fridge ]\r\n}\r\n\r\nclass LifeSupportPod extends SpaceFunction {\r\n    static label = 'Life Support Module'\r\n    static machines = [ OxygenExtractor, WaterCondensingMachine ]\r\n}\r\n\r\nclass Retreat extends SpaceFunction {\r\n    static label = 'Retreat'\r\n    static machines = [ Cabin, Cabin ]\r\n}\r\n\r\nclass CloneMatrix extends SpaceFunction {\r\n    static label = 'Clone Matrix'\r\n    static machines = [ CloningVat, CloningVat ] //\r\n}\r\n\r\nclass ReadingRoom extends SpaceFunction {\r\n    static label = 'Reading Room'\r\n    static machines = [ Bookshelf, Bookshelf ]\r\n}\r\n\r\nclass Library extends SpaceFunction {\r\n    static label = 'Library'\r\n    static machines = [ Bookshelf, Bookshelf, Bookshelf ]\r\n}\r\n\r\nclass Study extends SpaceFunction {\r\n    static label = 'Study'\r\n    static machines = [ StudyMachine, Bookshelf ]\r\n}\r\n\r\nclass Lab extends SpaceFunction {\r\n    static label = 'Lab'\r\n    static machines = [ Workstation, Workstation, Workstation ]\r\n}\r\n\r\nclass Archive extends SpaceFunction {\r\n    static label = 'Archive'\r\n    static machines = [ ResearchServer, ResearchServer ]\r\n}\r\n\r\nclass Arboretum extends SpaceFunction {\r\n    static label = 'Arboretum'\r\n    static machines = [ Arbor, Arbor ]\r\n}\r\n\r\nclass AlgaeFarm extends SpaceFunction {\r\n    static label = 'Algae Farm'\r\n    static machines = [ AlgaeVat, AlgaeVat ]\r\n}\r\n\r\nclass SolarArray extends SpaceFunction {\r\n    static label = 'Solar Array'\r\n    static machines = [ SolarCell, SolarCell ]\r\n}\r\n\r\nclass Workshop extends SpaceFunction {\r\n    static label = 'Workshop'\r\n    static machines = [ Fabricator, Fabricator ]\r\n}\r\n\r\n// 3 house plants => nursery?\r\nclass Nursery extends SpaceFunction {\r\n    static label = 'Nursery'\r\n    static machines = [ Houseplant, Houseplant, Houseplant ]\r\n}\r\n\r\nclass Farm extends SpaceFunction {\r\n    static label = 'Farm'\r\n    static machines = [ Orchard, Orchard ]\r\n}\r\n\r\nclass Factory extends SpaceFunction {\r\n    static label = 'Factory'\r\n    static machines = [ Megafabricator, Megafabricator ]\r\n}\r\n\r\nexport const allSpaceFunctions = [\r\n    Library,\r\n    Barracks,\r\n    LifeSupportPod,\r\n    CloneMatrix,\r\n    LivingQuarters,\r\n    Kitchen,\r\n    AlgaeFarm,\r\n    Archive,\r\n    Arboretum,\r\n    SolarArray,\r\n    Retreat,\r\n    Study,\r\n    Workshop,\r\n    ReadingRoom,\r\n    Nursery,\r\n    Farm,\r\n    Factory,\r\n    Lab,\r\n]","import * as ex from 'excalibur';\r\n\r\nexport class Player extends ex.Actor {\r\n  constructor() {\r\n    super();\r\n    this.setWidth(5);\r\n    this.setHeight(5);\r\n    this.x = 5;\r\n    this.y = 5;\r\n    this.color = new ex.Color(255, 255, 255);\r\n  }\r\n}\r\n","import { Actor, Color, Traits, Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { Planet } from \"./Planet/Planet\";\r\nimport { ResourceBlock, blockColor } from \"../models/Economy\";\r\nimport { Game } from \"../Game\";\r\nimport { eachCons } from \"../Util\";\r\n// import { Machine, Stove, ExperimentBench, MineralProcessor, CommandCenter, Orchard, MiningDrill, Bookshelf, CookingFire, Cabin } from \"../models/Machine\";\r\nimport { Device } from \"./Device\";\r\nimport { Scale } from \"../values/Scale\";\r\nimport { MachineOperation } from \"../models/Machine\";\r\nimport { worker } from \"cluster\";\r\n// import { Machine, Stove, CommandCenter } from \"../models/Machine\";\r\n\r\nexport class Citizen extends Actor {\r\n\r\n    walkSpeed: number = Game.citizenSpeed\r\n    carrying: ResourceBlock = null\r\n    path: Vector[] = []\r\n\r\n    workInProgress: boolean = false\r\n    workStarted: number\r\n    workDuration: number\r\n    progress: number\r\n\r\n    constructor(private device: Device, protected planet: Planet) {\r\n        super(device.x, device.y, Scale.minor.first, Scale.minor.third, Color.White)\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling))\r\n    }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n        // check wip\r\n        if (this.workInProgress) {\r\n            let now = (new Date()).getTime()\r\n            this.progress = (now - this.workStarted) / this.workDuration\r\n            this.vel.x += ((Math.random())-0.5) * 0.1\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta)\r\n        if (this.carrying) {\r\n            ctx.fillStyle = blockColor(this.carrying).toRGBA()\r\n            ctx.fillRect(this.x+4, this.y-3, 5, 5)\r\n        }\r\n\r\n        if (this.workInProgress) {\r\n            ctx.lineWidth = 1\r\n            let pw = 10, ph = 3\r\n            let px = this.x - pw/2, py = this.y - 10;\r\n            ctx.strokeStyle = Color.White.toRGBA()\r\n            ctx.strokeRect(px, py, pw, ph)\r\n            ctx.fillStyle = Color.Violet.darken(0.9).toRGBA()\r\n            ctx.fillRect(px, py, pw, ph)\r\n            ctx.fillStyle = Color.Violet.toRGBA()\r\n            ctx.fillRect(px, py, this.progress * pw, ph)\r\n        }\r\n\r\n        let debugPath = false\r\n        if (this.path && debugPath) {\r\n            let c = Color.White.lighten(0.5)\r\n            c.a = 0.5\r\n            eachCons(this.path, 2).forEach(([a,b]) => {\r\n                ctx.beginPath()\r\n                ctx.moveTo(a.x,a.y)\r\n                ctx.lineTo(b.x,b.y)\r\n                ctx.strokeStyle = c.toRGBA()\r\n                ctx.lineWidth = 10\r\n                ctx.stroke()\r\n            })\r\n        }\r\n    }\r\n\r\n    carry(c: ResourceBlock) { //c: Color) {\r\n        this.carrying = c;\r\n    }\r\n\r\n    drop(): ResourceBlock {\r\n        if (this.carrying) {\r\n            let c = this.carrying; //.clone();\r\n            this.carrying = null;\r\n            return c\r\n        }\r\n        return null\r\n    }\r\n\r\n    glideTo(pos: Vector) {\r\n        return this.actions.moveTo(pos.x, pos.y, this.walkSpeed).asPromise()\r\n    }\r\n\r\n    async progressBar(duration: number) {\r\n        // console.log(\"PROGRESS BAR\")\r\n        this.workInProgress = true\r\n        this.workStarted = (new Date()).getTime()\r\n        this.workDuration = duration\r\n        await new Promise((resolve, reject) => setTimeout(resolve, duration));\r\n        // console.log(\"PROGRESS BAR DONE!\")\r\n        this.workInProgress = false\r\n    }\r\n\r\n    async pathTo(building: Building) { //}, onArrival: (Building) => any) {\r\n        // let building = this.planet.closestBuildingByType(this.pos, structure)\r\n\r\n        let path = this.planet.pathBetween(this.pos.clone(), building)\r\n\r\n        if (path.length > 0) {\r\n            this.path = path\r\n            path.pop()\r\n            path.shift()\r\n            await Promise.all(\r\n                path.map(step => this.glideTo(step))\r\n            )\r\n            this.path = null\r\n            // onArrival(building);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    waitToUse(device) {\r\n        setTimeout(() => device.interact(this), 250)\r\n    }\r\n\r\n    async work() {\r\n        if (this.carrying) {\r\n            let item: ResourceBlock = this.carrying;\r\n            let sink: Device = this.planet.closestDevice(this.pos,\r\n                [],\r\n                (device) =>\r\n                    device.machine.consumes === item ||\r\n                    ((\r\n                        item === ResourceBlock.Meal ||\r\n                        item === ResourceBlock.Data ||\r\n                        item === ResourceBlock.Mineral\r\n                    ) && device.machine.behavior === MachineOperation.CollectResource) ||\r\n                    item === ResourceBlock.Meal && device.machine.behavior === MachineOperation.CollectMeals ||\r\n                    item === ResourceBlock.Data && device.machine.behavior === MachineOperation.CollectData\r\n            )\r\n\r\n            if (sink) {\r\n                await this.pathTo(sink.building)\r\n                await this.glideTo(sink.pos)\r\n                await sink.interact(this)\r\n            } else {\r\n                console.log(\"nowhere to deliver it\", this.carrying)\r\n            }\r\n        } else {\r\n            let source: Device = this.planet.closestDevice(this.pos,\r\n                [],\r\n                // [ Cabin, Orchard, MiningDrill, Bookshelf ],\r\n                (d) => d.product.length > 0\r\n            )\r\n\r\n            if (source) {\r\n                await this.pathTo(source.building)\r\n                await this.glideTo(source.pos)\r\n                await source.interact(this)\r\n            } else {\r\n                console.log(\"i guess i can try again? (sleep for a bit first)\")\r\n                await new Promise((resolve, reject) => setTimeout(resolve, 150));\r\n            }\r\n        }\r\n\r\n        setTimeout(() => this.work(), 100)\r\n    }\r\n}","import { Actor, Traits } from 'excalibur';\r\nimport { Citizen } from '../Citizen';\r\nimport { Planet } from './Planet';\r\nimport { Device } from '../Device';\r\n\r\nexport class Population extends Actor {\r\n    citizens: Citizen[] = [];\r\n    constructor(private planet: Planet) {\r\n        super(0, -planet.getHeight() / 2, 0, 0);\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling));\r\n    }\r\n\r\n    increase(home: Device) {\r\n        let citizen = new Citizen(home, this.planet);\r\n        citizen.work();\r\n        this.citizens.push(citizen);\r\n        this.add(citizen);\r\n    }\r\n}\r\n","import { Graph } from \"../../values/Graph\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Building } from \"../Building\";\r\nimport { minBy } from \"../../Util\";\r\n\r\nexport class NavigationTree {\r\n   graph: Graph<Vector>\r\n\r\n   constructor(root: Building) {\r\n       this.graph = root.graph()\r\n   }\r\n\r\n   seekPath(origin: Vector, dest: Vector): Vector[] {\r\n      return this.graph.shortestPath(origin, dest)\r\n   }\r\n\r\n   closestNode(testNode: Vector) {\r\n       let nodes = this.graph.dfs()\r\n       let closest = minBy(nodes,\r\n           (node: Vector) => Math.abs(testNode.distance(node))\r\n       )\r\n       if (closest) {\r\n           return closest\r\n       }\r\n       return false\r\n   }\r\n}","module.exports = __webpack_public_path__ + \"9ed5e1137b47b9fc3d2bbf4534777307.svg\";","module.exports = __webpack_public_path__ + \"3aeb9dd24809ba3fbd4eeb31a28c3b19.svg\";","module.exports = __webpack_public_path__ + \"cffe40698a3b47b52ca0ff90a2c86ddf.svg\";","module.exports = __webpack_public_path__ + \"43062e54318df93f49e2be9a4281eb4a.svg\";","module.exports = __webpack_public_path__ + \"86e09b7a9e4997af44c45206eb8694ad.svg\";","module.exports = __webpack_public_path__ + \"c4ab2ceb2f61e18493fc776770c65654.svg\";","module.exports = __webpack_public_path__ + \"bbd50a175546bd70d21c5eadbc30d479.svg\";","module.exports = __webpack_public_path__ + \"7441c2ab240d0f733451d75204ac0792.svg\";","module.exports = __webpack_public_path__ + \"91a8cce06c3c05ce6e4b176afafd7b0a.svg\";","module.exports = __webpack_public_path__ + \"0ce4f9c3384680565b6bb16495b64233.svg\";","module.exports = __webpack_public_path__ + \"1db542acabeb82ec8da785e77afd4dca.svg\";","import { Actor, Vector, Traits, Color } from 'excalibur';\r\nimport { Building } from '../Building';\r\nimport { minBy, flatSingle } from '../../Util';\r\nimport { Structure, MissionControl } from '../../models/Structure';\r\nimport { NavigationTree } from './NavigationTree';\r\nimport { Machine } from '../../models/Machine';\r\nimport { Device } from '../Device';\r\nexport class Colony extends Actor {\r\n    navTree: NavigationTree;\r\n    buildings: Building[] = [];\r\n    currentlyConstructing: Building | Device = null;\r\n\r\n    constructor(x: number, y: number) {\r\n        super(x, y, 0, 0); // 1000, 1000);\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling));\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta);\r\n\r\n        let debugTree = false\r\n        if (this.navTree && debugTree) {\r\n            let edges = this.navTree.graph.edgeList();\r\n            edges.forEach((edge) => {\r\n                let [a,b] = edge;\r\n                var gradient = ctx.createLinearGradient(a.x,a.y+this.pos.y,b.x,b.y+this.pos.y);\r\n\r\n                gradient.addColorStop(0, 'green');\r\n                gradient.addColorStop(1, 'blue');\r\n\r\n                ctx.beginPath()\r\n                ctx.moveTo(a.x, a.y + this.pos.y)\r\n                ctx.lineTo(b.x, b.y + this.pos.y)\r\n                ctx.closePath()\r\n                ctx.strokeStyle = gradient\r\n                ctx.lineWidth = 0.5\r\n                ctx.stroke()\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n\r\n    placeBuilding(building: Building) {\r\n        building.built = true;\r\n        if (building.parentSlot) {\r\n            building.parentSlot.parent.childrenBuildings.push(building);\r\n            this.buildNavTree();\r\n        }\r\n        this.buildings.push(building);\r\n        building.afterConstruct();\r\n        this.add(building);\r\n    }\r\n\r\n    closestBuildingByType(cursor: Vector, structureTypes: (typeof Structure)[] = [], predicate: (Building) => boolean = () => true): Building {\r\n        let matching = this.buildings\r\n        .filter(building => //predicate(building) &&\r\n            (structureTypes.length > 0\r\n            ? structureTypes.some(st => building.structure instanceof st)\r\n            : true)\r\n             && predicate(building)\r\n        )\r\n\r\n        if (matching && matching.length > 0) {\r\n            let distanceToCursor = (building) => cursor.distance(building.nodes()[0]);\r\n            return minBy(matching, distanceToCursor);\r\n        }\r\n    }\r\n\r\n    pathBetween(origin: Vector, destination: Building): Vector[] {\r\n        if (!this.navTree) {\r\n            this.buildNavTree();\r\n        }\r\n        let srcNode = this.navTree.closestNode(origin);\r\n        let dest = destination.nodes()[0];\r\n        let destNode = this.navTree.closestNode(dest);\r\n        let path = this.navTree.seekPath(srcNode, destNode);\r\n        return path;\r\n    }\r\n\r\n    closestDeviceByType(cursor: Vector, machineTypes: (typeof Machine)[] = [], predicate: (Device) => boolean = () => true) {\r\n        let devices = this.findAllDevices()\r\n        devices = devices.filter(d => \r\n            (machineTypes.length > 0 ? machineTypes.some(machine => d.machine instanceof machine) : true)\r\n             && predicate(d)\r\n        )\r\n\r\n        if (devices && devices.length > 0) {\r\n            let proximity = (d) => cursor.distance(d)\r\n            return minBy(devices, proximity)\r\n        }\r\n    }\r\n\r\n    private buildNavTree() {\r\n        let ctrl = this.buildings.find(building => building.structure instanceof MissionControl);\r\n        if (ctrl) {\r\n            this.navTree = new NavigationTree(ctrl);\r\n        }\r\n    }\r\n\r\n    findAllDevices() {\r\n        return flatSingle(this.buildings.map(b => b.getDevices()))\r\n    }\r\n}\r\n","import { Actor, Color } from 'excalibur';\r\nimport { range } from '../../Util';\r\n\r\nclass PlanetBackground extends Actor {\r\n    constructor(y: number, width: number, color: Color) {\r\n        super(0, y, width, 500, color); // y + size, size, layerSize, color.darken(0.2))\r\n    }\r\n}\r\n\r\nexport class Mountains extends PlanetBackground {\r\n    peaks: {\r\n        x: number;\r\n        height: number;\r\n    }[] = [];\r\n    onInitialize() {\r\n        let peakCount = 20; // Math.floor(this.getWidth() / 2000)\r\n        let peakHeight = 3000;\r\n        // let mtnWidth = 180\r\n        // figure out mountain peaks?\r\n        // let yBase = this.pos.y //-1000 //this.pos.y //this.getHeight()\r\n        let xOff = this.getWidth() / 2;\r\n        let peakDistance = this.getWidth() / peakCount;\r\n        for (let times of range(5)) {\r\n            let heightRange = 100*times;\r\n            let drift = 3 * times * (peakDistance / 2);\r\n            for (let i of range(peakCount)) { //} / 2)) {\r\n                this.peaks.push({\r\n                    x: -xOff + i * peakDistance + ((Math.random() * drift) - (drift / 2)),\r\n                    height: Math.max(10, 1000 + (Math.random()*peakHeight) + ((Math.random() * heightRange)-(heightRange/2))) //(Util.randomIntInRange(-160,160))\r\n                    // y = yBase - peakHeight\r\n                });\r\n            }\r\n        }\r\n        // console.log({ peaks: this.peaks });\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let baseColor = this.color.desaturate(0.25); //.toRGB\r\n        // baseColor.a = 0.6\r\n        let brightColor = this.color.saturate(0.2).lighten(0.5)\r\n        // super.draw(ctx, delta)\r\n        ctx.fillStyle = baseColor.toRGBA() // this.color.desaturate(0.45).lighten(0.15).toRGBA();\r\n        //let peakHeight = 250\r\n        // let mtnWidth = 180\r\n        let yBase = this.pos.y-3; //-1000 //this.pos.y //this.getHeight()\r\n        // let xOff = this.getWidth() / 2\r\n        this.peaks.forEach(peak => {\r\n            let y0 = yBase - peak.height;\r\n            let mtnWidth = peak.height * 3.4;\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x - mtnWidth, yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n\r\n            ctx.fillStyle = baseColor.toRGBA() // this.color.desaturate(0.45).lighten(0.15).toRGBA();\r\n            ctx.fill();\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x + 3*(mtnWidth/4), yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n            ctx.fillStyle = brightColor.toRGBA() // this.color.desaturate(0.45).lighten(0.15).toRGBA();\r\n            ctx.fill();\r\n\r\n        });\r\n    }\r\n}","import * as ex from 'excalibur';\r\nimport { Actor, Color, Vector, Util, EdgeArea } from 'excalibur';\r\nimport { Building } from '../Building';\r\nimport { range } from '../../Util';\r\nimport { Mountains } from './PlanetBackground';\r\nimport { Structure } from '../../models/Structure';\r\nimport { Hud } from '../Hud/Hud';\r\nimport { ResourceBlock, Economy, sumMarkets, emptyMarket, availableCapacity, PureValue } from '../../models/Economy';\r\nimport { Colony } from './Colony';\r\nimport { Population } from './Population';\r\nimport { Machine, CloningVat } from '../../models/Machine';\r\nimport { Device } from '../Device';\r\n\r\n\r\nexport class Planet extends Actor {\r\n    colony: Colony\r\n    population: Population\r\n\r\n    constructor(\r\n        public hud: Hud,\r\n        public color: Color,\r\n        public width: number = 2000000,\r\n        public depth: number = 10000000,\r\n        ) {\r\n        super(0, depth/2, width, depth, color)\r\n        this.traits = this.traits.filter(trait => !(trait instanceof ex.Traits.OffscreenCulling))\r\n\r\n        let yBase = -depth/2\r\n        // crust\r\n        let crustHeight = 20\r\n        this.createLayer(yBase, crustHeight, this.color.lighten(0.25))\r\n\r\n\r\n        let layerCount = 10\r\n        let layerHeight = depth / layerCount \r\n        for (let i of range(layerCount)) {\r\n            this.createLayer(\r\n                yBase + crustHeight + (layerHeight/2) + (layerHeight * (i+1)),\r\n                layerHeight,\r\n                this.color.darken(0.05 + 0.01 * i)\r\n            )\r\n        }\r\n\r\n        this.add(new Mountains(-depth/2, this.getWidth(), this.color.lighten(0.15)))\r\n\r\n        this.colony = new Colony(0,-depth/2) //yBase)\r\n        this.add(this.colony)\r\n\r\n        this.population = new Population(this)\r\n        this.add(this.population)\r\n    }\r\n\r\n    private createLayer(y: number, size: number, color: Color) {\r\n        let theLayer = new Actor(0, y, this.getWidth(), size, color);\r\n        this.add(theLayer);\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta) {\r\n        super.draw(ctx, delta)\r\n\r\n        if (this.currentlyConstructing) {\r\n            this.currentlyConstructing.draw(ctx, delta)\r\n        }\r\n    }\r\n\r\n    get economy(): Economy {\r\n        let devices = this.colony.findAllDevices()\r\n        let economies = devices.map((d: Device) => d.machine.economy)\r\n        let theEconomy = economies.reduce(sumMarkets, emptyMarket())\r\n\r\n        let popularDemand = this.population.citizens.length\r\n        theEconomy['Shelter'].demand = popularDemand\r\n        theEconomy['Oxygen'].demand += popularDemand\r\n        theEconomy['Water'].demand += popularDemand\r\n        return theEconomy\r\n    }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n        this.colony.buildings.forEach(building => building.update(engine, delta))\r\n        this.population.citizens.forEach(citizen => citizen.update(engine, delta))\r\n    }\r\n\r\n    get currentlyConstructing() {\r\n        return this.colony.currentlyConstructing\r\n    }\r\n\r\n    gather(resource: ResourceBlock): any {\r\n        this.hud.resourceGathered(resource)\r\n    }\r\n\r\n    placeBuilding(building: Building) {\r\n        this.colony.placeBuilding(building)\r\n    }\r\n\r\n    populate(pos: Vector) {\r\n        if (this.population.citizens.length < this.maxPop) {\r\n            let home = this.closestDevice(pos, [CloningVat])\r\n            this.population.increase(home)\r\n        }\r\n    }\r\n\r\n    get maxPop() {\r\n        // let econ = this.economy\r\n        let devices = this.colony.findAllDevices()\r\n        let economies = devices.map((d: Device) => d.machine.economy)\r\n        let theEconomyWithoutPeople = economies.reduce(sumMarkets, emptyMarket())\r\n\r\n        let values = [ PureValue.Shelter, PureValue.Water, PureValue.Oxygen ]\r\n        return Math.min(\r\n            ...values.map(val => availableCapacity(theEconomyWithoutPeople, val))\r\n        )\r\n    }\r\n\r\n    closestBuildingByType(cursor: Vector, structureTypes: (typeof Structure)[], predicate: (Building) => boolean = ()=>true): Building {\r\n        return this.colony.closestBuildingByType(cursor, structureTypes, predicate)\r\n    }\r\n\r\n    closestDevice(cursor: Vector, machineTypes: (typeof Machine)[] = [], predicate: (Device) => boolean = () => true) {\r\n        return this.colony.closestDeviceByType(cursor, machineTypes, predicate);\r\n    }\r\n\r\n    pathBetween(origin: Vector, destination: Building): Vector[] {\r\n        return this.colony.pathBetween(origin, destination)\r\n    }\r\n}","import { Scene, Input, Vector } from \"excalibur\";\r\nimport { Game } from \"../Game\";\r\nimport { Planet } from \"../actors/Planet/Planet\";\r\nimport { Player } from \"../actors/player\";\r\nimport { Structure, MissionControl, MainTunnel, Corridor, SurfaceRoad, SmallDome, SmallRoomTwo, SmallDomeThree } from \"../models/Structure\";\r\nimport { Building, DomeView, CorridorView, CommonAreaView, TunnelView, MissionControlView, LadderView, ArcologyView, } from \"../actors/Building\";\r\nimport { Hud } from \"../actors/Hud/Hud\";\r\nimport { SurfaceRoadView } from \"../actors/Building/SurfaceRoadView\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { Machine } from \"../models/Machine\";\r\nimport { SmallRoomThreeView } from \"../actors/Building/SmallRoomThreeView\";\r\nimport { MidDomeView } from \"../actors/Building/MidDomeView\";\r\nimport { MediumRoomView } from \"../actors/Building/MediumRoomView\";\r\nimport { LargeRoomView } from \"../actors/Building/LargeRoomView\";\r\nimport { HugeRoomView } from \"../actors/Building/HugeRoomView\";\r\nimport { BigDomeView } from \"../actors/Building/BigDomeView\";\r\nimport { SmallDomeThreeView } from \"../actors/Building/SmallDomeThreeView\";\r\n\r\n\r\nexport class Construct extends Scene {\r\n    game: Game\r\n    planet: Planet\r\n    hud: Hud\r\n    player: Player\r\n\r\n    dragging: boolean = false\r\n    dragOrigin: Vector\r\n\r\n    defaultMessage: string = 'Welcome to the Colony, Commander.'\r\n\r\n    static structureViews: { [key: string]: typeof Building } = {\r\n        CorridorView,\r\n        LadderView,\r\n        TunnelView,\r\n        SurfaceRoadView,\r\n\r\n        DomeView, // small dome 2\r\n        SmallDomeThreeView,\r\n        MidDomeView,\r\n        BigDomeView,\r\n\r\n        MissionControlView,\r\n        // SmallRoomTwoView, [ none, same as common area? ]\r\n        SmallRoomThreeView,\r\n\r\n        CommonAreaView,\r\n        MediumRoomView,\r\n        LargeRoomView,\r\n        HugeRoomView,\r\n\r\n        ArcologyView,\r\n    }\r\n    ////\r\n    static requiredStructureList: Array<typeof Structure> = [\r\n        MissionControl,\r\n        SurfaceRoad,\r\n        // SmallDome,\r\n        SmallDomeThree,\r\n        MainTunnel,\r\n        Corridor,\r\n        SmallRoomTwo,\r\n    ]\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n        this.hud.updateDetails(this.planet, false)\r\n    }\r\n\r\n    public onInitialize(game: Game) {\r\n        this.game = game\r\n\r\n\r\n        this.hud = new Hud(game, (structure) => {\r\n            // console.log('would build', { structure })\r\n            this.startConstructing(structure)\r\n        }, (device) => {\r\n            this.startConstructing(device)\r\n        });\r\n        this.add(this.hud)\r\n\r\n        this.planet = new Planet(this.hud, game.world.color);\r\n        this.add(this.planet)\r\n  \r\n        this.player = new Player()\r\n        this.add(this.player)\r\n\r\n        this.prepareNextBuilding()\r\n        this.camera.zoom(0.001)\r\n        this.camera.zoom(2, 10000)\r\n    }\r\n\r\n    public onActivate() {\r\n        this.game.input.pointers.primary.on('move', (e: Input.PointerMoveEvent) => {\r\n            if (this.dragging) {\r\n                this.camera.pos = this.camera.pos.add(\r\n                    this.dragOrigin.sub(e.pos)\r\n                )\r\n            } else {\r\n                this.player.pos = e.pos\r\n\r\n                let currentlyBuilding = this.planet.currentlyConstructing\r\n                if (currentlyBuilding instanceof Building) {\r\n\r\n                    let constrained = currentlyBuilding.constrainCursor(this.player.pos)\r\n                    this.player.pos = constrained\r\n\r\n                    currentlyBuilding.reshape(this.player.pos)\r\n                } else if (currentlyBuilding instanceof Device) {\r\n                    // console.warn(\"would snap device in place!\")\r\n                    currentlyBuilding.snap(this.planet, this.player.pos)\r\n                }\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('up', () => {\r\n            if (this.dragging) { this.dragging = false; }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('down', (e: Input.PointerDownEvent) => {\r\n            if (e.button == Input.PointerButton.Left) {\r\n                const currentlyBuilding = this.planet.currentlyConstructing\r\n                if (currentlyBuilding) {\r\n                    if (currentlyBuilding instanceof Building) {\r\n                        let buildingUnderConstruction = currentlyBuilding\r\n                        let placementValid = !buildingUnderConstruction.overlapsAny()\r\n                        if (buildingUnderConstruction && placementValid && buildingUnderConstruction.handleClick(e.pos)) {\r\n                            this.planet.placeBuilding(buildingUnderConstruction)\r\n                            this.hud.setMessage(this.defaultMessage)\r\n                            this.planet.colony.currentlyConstructing = null\r\n                            this.prepareNextBuilding(e.pos)\r\n                            this.hud.updateDetails(this.planet)\r\n                        }\r\n                    } else {\r\n                        let deviceUnderConstruction = currentlyBuilding\r\n                        if (deviceUnderConstruction.snap(this.planet)) {\r\n                            let bldg = deviceUnderConstruction.building\r\n                            bldg.addDevice(deviceUnderConstruction)\r\n                            this.planet.colony.currentlyConstructing = null\r\n                            this.hud.setMessage(this.defaultMessage)\r\n                            this.hud.updateDetails(this.planet)\r\n                        }\r\n                    }\r\n                }\r\n            } else if (e.button === Input.PointerButton.Middle) {\r\n                this.dragging = true;\r\n                this.dragOrigin = e.pos\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('wheel', (e: Input.WheelEvent) => {\r\n            let z = this.camera.getZoom()\r\n            let step = 0.05\r\n            let min = 0.05, max = 8\r\n            if (e.deltaY < 0) {\r\n                this.camera.zoom(Math.min(z + step, max))\r\n            } else if (e.deltaY > 0) {\r\n                this.camera.zoom(Math.max(z - step, min))\r\n            }\r\n        })\r\n\r\n        this.game.input.keyboard.on('press', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.H) {\r\n                if (this.buildings && this.buildings[0]) {\r\n                    this.camera.move(this.buildings[0].pos, 500)\r\n                    this.camera.zoom(0.5, 1000)\r\n                }\r\n            } else if (e.key === Input.Keys.Esc) {\r\n                // cancel building in progress?\r\n                this.planet.colony.currentlyConstructing = null\r\n            }\r\n        })\r\n    }\r\n\r\n    public onDeactivate() {\r\n        this.game.input.pointers.primary.off('move')\r\n        this.game.input.pointers.primary.off('down')\r\n        this.game.input.pointers.primary.off('up')\r\n        this.game.input.pointers.primary.off('wheel')\r\n    }\r\n\r\n\r\n    get buildings() { return this.planet.colony.buildings }\r\n\r\n\r\n    private nextMissingRequiredStructure(): Structure {\r\n        let requiredStructures: Structure[] = Construct.requiredStructureList.map(s => new s())\r\n        let actualStructureNames: string[] = this.buildings.map(building => building.structure.name)\r\n\r\n        return requiredStructures.find(structure => !actualStructureNames.includes(structure.name))\r\n    }\r\n\r\n    protected prepareNextBuilding(pos: Vector = new Vector(0,0)) {\r\n        let structure = null;\r\n        let nextMissing = this.nextMissingRequiredStructure();\r\n        if (nextMissing) { structure = nextMissing; }\r\n        if (structure) {\r\n            this.startConstructing(structure, pos)\r\n        } //else {\r\n            // this.hud.setMessage(`Welcome to OSIRIS!`)\r\n        // }\r\n    }\r\n\r\n    startConstructing(structureOrMachine: Structure | Machine, pos: Vector = new Vector(0, 0)) {\r\n        this.hud.showCard(structureOrMachine)\r\n        \r\n        // console.log(\"START CONSTRUCTING\", { structureOrMachine })\r\n        let theNextOne = null\r\n        if (structureOrMachine instanceof Structure) {\r\n            let structure = structureOrMachine\r\n            // structure.origin = pos // thread this out somehow??\r\n            this.hud.setMessage(`Place ${structure.name} (${structure.description})`)\r\n            theNextOne = this.spawnBuilding(structure, pos)\r\n            this.camera.zoom(structure.zoom, 250)\r\n        } else if (structureOrMachine instanceof Machine) {\r\n            // setup machine?\r\n            let machine = structureOrMachine\r\n            // machine.origin = pos\r\n            this.hud.setMessage(`Install ${machine.name} (${machine.description})`)\r\n\r\n            theNextOne = this.spawnDevice(machine, pos)\r\n            this.camera.zoom(1.5, 250)\r\n        }\r\n\r\n        this.planet.colony.currentlyConstructing = null\r\n        if (theNextOne) {\r\n            this.planet.colony.currentlyConstructing = theNextOne\r\n            // console.warn(\"would start constructing\", { theNextOne })\r\n            this.camera.pos = theNextOne.pos\r\n        }\r\n    }\r\n\r\n    protected spawnDevice(machine: Machine, pos: Vector): Device {\r\n        let device = new Device(machine, pos)\r\n        device.snap(this.planet)\r\n        return device\r\n    }\r\n\r\n    protected spawnBuilding(structure: Structure, pos: Vector): Building {\r\n        let anotherBuilding = this.assembleBuildingFromStructure(structure, pos)\r\n        anotherBuilding.reshape(anotherBuilding.constrainCursor(anotherBuilding.pos))\r\n        return anotherBuilding\r\n    }\r\n    \r\n    private assembleBuildingFromStructure(structure: Structure, pos: Vector): Building {\r\n        let View = Construct.structureViews[structure.view]\r\n        let building = new View(pos, structure, this.planet)\r\n        return building;\r\n    }\r\n} \r\n","import { Color } from 'excalibur';\r\nimport { Structure } from './Structure';\r\nimport { sample } from '../Util';\r\nimport { Planet } from '../actors/Planet/Planet';\r\n\r\n\r\nexport class World {\r\n  static colors = [Color.Red, Color.Blue, Color.Green] // Color.Viridian, Color.Magenta, Color.Chartreuse];\r\n\r\n  color: Color = sample(World.colors).\r\n      darken(0.1).\r\n      desaturate(0.8);\r\n  skyColor: Color = sample([ Color.Cyan, Color.Vermillion ] ). // Color.Rose //World.colors).\r\n        lighten(0.15).\r\n        desaturate(0.65) // sample([Color.Blue, Color.Rose,Color.Blue]).lighten(0.1).desaturate(0.8)\r\n//   colony: Colony = new Colony()\r\n\r\n  \r\n}","module.exports = __webpack_public_path__ + \"0f6ac78b40c6bc151aee01b517f49ca1.png\";","module.exports = __webpack_public_path__ + \"94754f62e0ae4d23d386e246f5e0cb6e.png\";","import * as ex from 'excalibur';\r\nconst sword = require('./images/sword.png');\r\nconst bookshelf = require('./images/bookshelf.png');\r\n// const bookshelfSvg = require('./images/bookshelf-plain.svg');\r\n\r\nlet Resources = {\r\n    Sword: new ex.Texture(sword),\r\n\r\n    Bookshelf: new ex.Texture(bookshelf),\r\n\r\n    // BookshelfSVG: new ex.Texture(bookshelfSvg)\r\n}\r\n\r\nexport { Resources }\r\n","import { Game } from './Game';\r\nimport { World } from './models/World';\r\nimport { Construct } from './scenes/Construct';\r\n\r\nconst theWorld = new World();\r\nconst game = new Game(theWorld);\r\n\r\n// scenes\r\nconst construct = new Construct(game);\r\ngame.add('construct', construct);\r\n\r\ngame.start().then(() => {\r\n  game.goToScene('construct');\r\n});\r\n"],"sourceRoot":""}