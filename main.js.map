{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Util.ts","webpack:///./src/values/DeviceSize.ts","webpack:///./src/actors/Building/index.ts","webpack:///./src/models/Machine.ts","webpack:///./src/models/Economy.ts","webpack:///./src/values/Orientation.ts","webpack:///./src/actors/Building/Building.ts","webpack:///./src/Painting.ts","webpack:///./src/Game.ts","webpack:///./src/actors/Device.ts","webpack:///./src/models/Structure.ts","webpack:///./src/values/Scale.ts","webpack:///./src/models/SpaceFunction.ts","webpack:///./src/strategies/Strategy.ts","webpack:///./src/actors/Building/BackgroundPatterns.ts","webpack:///./src/actors/Hud/Pane.ts","webpack:///./src/values/Graph.ts","webpack:///./src/models/World.ts","webpack:///./src/Resources.ts","webpack:///./src/models/TechnologyRank.ts","webpack:///./src/models/TechTree.ts","webpack:///./src/actors/player.ts","webpack:///./src/actors/Planet/PlanetBackground.ts","webpack:///./src/actors/Planet/SkyLayer.ts","webpack:///./src/actors/Planet/SkyLayers.ts","webpack:///./src/strategies/EatingStrategy.ts","webpack:///./src/strategies/WhenHungryEatingStrategy.ts","webpack:///./src/strategies/SleepingStrategy.ts","webpack:///./src/strategies/AnyBedSleepingStrategy.ts","webpack:///./src/strategies/ConstructionStrategy.ts","webpack:///./src/strategies/ProximityBasedConstruction.ts","webpack:///./src/values/InteractionRequest.ts","webpack:///./src/strategies/ProductionStrategy.ts","webpack:///./src/strategies/CapacityBasedProduction.ts","webpack:///./src/actors/Citizen.ts","webpack:///./src/actors/Planet/Population.ts","webpack:///./src/actors/Planet/NavigationTree.ts","webpack:///./src/actors/Planet/Colony.ts","webpack:///./src/actors/Planet/Planet.ts","webpack:///./src/actors/Hud/Modal.ts","webpack:///./src/actors/Hud/Palette.ts","webpack:///./src/actors/Hud/CardBody.ts","webpack:///./src/actors/Hud/CardTitle.ts","webpack:///./src/actors/Hud/Card.ts","webpack:///./src/actors/Hud/MusicPlayer.ts","webpack:///./src/actors/Hud/EconomicValue.ts","webpack:///./src/actors/Hud/EconomyView.ts","webpack:///./src/actors/Hud/ResourceListEntry.ts","webpack:///./src/actors/Hud/ResourcesList.ts","webpack:///./src/actors/Hud/StatusAnalysisView.ts","webpack:///./src/actors/Hud/Hud.ts","webpack:///./src/actors/Building/MediumSurfaceRoomView.ts","webpack:///./src/actors/Building/MediumRoomThreeView.ts","webpack:///./src/actors/Building/HugeRoomView.ts","webpack:///./src/actors/Building/LargeRoomView.ts","webpack:///./src/actors/Building/MediumRoomView.ts","webpack:///./src/actors/Building/SmallRoomThreeView.ts","webpack:///./src/actors/Building/BigDomeView.ts","webpack:///./src/actors/Building/MidDomeView.ts","webpack:///./src/actors/Building/SmallDomeThreeView.ts","webpack:///./src/actors/Building/SurfaceRoadView.ts","webpack:///./src/actors/Building/LadderView.ts","webpack:///./src/actors/Building/ArcologyView.ts","webpack:///./src/actors/Building/TunnelView.ts","webpack:///./src/actors/Building/DomeView.ts","webpack:///./src/actors/Building/CommonAreaView.ts","webpack:///./src/actors/Building/CorridorView.ts","webpack:///./src/images/wood-panel-bg.png","webpack:///./src/images/ussf.png","webpack:///./src/images/window-bg.png","webpack:///./src/images/beige-bg.png","webpack:///./src/images/checker-bg.png","webpack:///./src/images/tech-bg.png","webpack:///./src/images/poster-wall-bg.png","webpack:///./src/images/books-bg.png","webpack:///./src/images/leafy-bg.png","webpack:///./src/images/raised-square-bg.png","webpack:///./src/images/books-plain.svg","webpack:///./src/images/telescope-plain.svg","webpack:///./src/images/orrery-plain.svg","webpack:///./src/images/lava-lamp-plain.svg","webpack:///./src/images/codex-plain.svg","webpack:///./src/images/statue-plain.svg","webpack:///./src/images/miner-plain.svg","webpack:///./src/images/solar-collector-plain.svg","webpack:///./src/images/couch-plain.svg","webpack:///./src/images/fabricator-plain.svg","webpack:///./src/images/mega-console-plain.svg","webpack:///./src/images/console-red-plain.svg","webpack:///./src/images/console-green-plain.svg","webpack:///./src/images/console-purple-plain.svg","webpack:///./src/images/console-plain.svg","webpack:///./src/images/workstation-plain.svg","webpack:///./src/images/houseplant-plain.svg","webpack:///./src/images/research-server-plain.svg","webpack:///./src/images/fridge-plain.svg","webpack:///./src/images/bed-plain.svg","webpack:///./src/images/cooking-fire-plain.svg","webpack:///./src/images/cabin-plain.svg","webpack:///./src/images/stove-plain.svg","webpack:///./src/images/bench-simple-plain.svg","webpack:///./src/images/vat-plain.svg","webpack:///./src/images/bookshelf-plain.svg","webpack:///./src/models/MechanicalOperation.ts","webpack:///./src/scenes/Construct.ts","webpack:///./src/sounds/future tense.mp3","webpack:///./src/sounds/understanding.mp3","webpack:///./src/sounds/indivision.mp3","webpack:///./src/sounds/assembler.mp3","webpack:///./src/sounds/crater-rock.mp3","webpack:///./src/images/sword.png","webpack:///./src/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","p","jsonpArray","window","webpackJsonp","oldJsonpFunction","bind","slice","excalibur_1","extremumBy","arr","pluck","extremum","reduce","best","next","pair","_ecRange","a","minBy","fn","Math","min","maxBy","max","sample","floor","random","range","Array","fill","map","_val","idx","closest","cursor","getVector","predicate","matching","filter","elem","distance","flatSingle","concat","deleteByValue","e","deleteByValueOnce","index","indexOf","eachCons","eachChunk","array","measureDistance","b","sleep","ms","Promise","resolve","setTimeout","shuffle","sort","zip","countOccurrences","counts","forEach","containsUniq","testElems","doesContain","arrCopy","missingItem_1","testElem","find","mixColors","factor","aFactor","bFactor","Color","g","onlyUnique","self","DeviceSize","Scale_1","major","Scale","minor","Tiny","Small","Medium","Large","Huge","getVisibleDeviceSize","size","sz","third","fourth","eighth","second","Building_1","Building","CorridorView_1","CorridorView","CommonAreaView_1","CommonAreaView","DomeView_1","DomeView","TunnelView_1","TunnelView","ArcologyView_1","ArcologyView","LadderView_1","LadderView","SurfaceRoadView_1","SurfaceRoadView","SmallDomeThreeView_1","SmallDomeThreeView","MidDomeView_1","MidDomeView","BigDomeView_1","BigDomeView","SmallRoomThreeView_1","SmallRoomThreeView","MediumRoomView_1","MediumRoomView","LargeRoomView_1","LargeRoomView","HugeRoomView_1","HugeRoomView","MediumRoomThreeView_1","MediumRoomThreeView","MediumSurfaceRoomView_1","MediumSurfaceRoomView","structureViews","Economy_1","DeviceSize_1","MechanicalOperation_1","Util_1","images","bookshelf","vat","bench","stove","cabin","fire","bed","fridge","server","plant","workstation","console","consolePurple","consoleGreen","consoleRed","megaconsole","fabricator","couch","solar","miner","statue","codex","lavaLamp","orrery","telescope","books","Red","Green","Blue","Orange","Violet","Yellow","store","mechanicalOperations","generate","recipe","spawn","accelerateTime","explore","Machine","this","description","color","LightGray","cost","ResourceBlock","Mineral","operation","type","image","prereqs","economy","emptyMarket","forDome","hide","isVehicle","tinySlots","concretize","onPlacement","device","CommandCenter","_super","_this","arguments","Ore","__assign","Power","supply","demand","Oxygen","Water","Hope","Shelter","t","__extends","built","produceResource","building","populate","pos","add","MissionLog","Data","LavaLamp","Table","Joy","Figurine","Beauty","Orrery","Wonder","Books","Wisdom","OxygenExtractor","WaterCondensingMachine","SolarCell","Bed","Telescope","Statue","StudyMachine","Idea","Workstation","Desk","Codex","Bookshelf","Couch","Fridge","Meal","Stove","Biomass","Houseplant","PersonnelRegistry","CloningVat","OrientationConsole","productionTime","AlgaeVat","DissolutionVat","Bioplasma","PlasmaBank","Fabricator","Alloy","LifeSciencesConsole","Botany","Miner","MetalStorage","ResearchServer","Algorithm","Orchard","Cabin","Arbor","MineralProcessor","ThinkingFountain","Mainframe","Megafabricator","MolecularEngine","fromHex","Aurum","SilverForest","Argent","TimeCrystal","Omnium","HoloProjector","SacredGrove","AtomicCompiler","MiningDrill","Preserve","LogicPool","Cathedral","Microcity","LogicCrystal","allMachines","PureValue","availableCapacity","market","Wealth","allValues","sumMarkets","ea","eb","newMarket","_a","sa","da","_b","equilibrium","every","blockColors","lighten","darken","cStep","Viridian","DarkGray","Gray","White","blockColor","block","desaturate","Orientation","Left","Up","Right","Down","compass","flip","orientation","Error","Orientation_1","Game_1","Graph_1","SpaceFunction_1","Machine_1","BackgroundPatterns_1","Painting_1","DevicePlace","structure","planet","x","y","width","height","infra","Transparent","edgeWidth","placed","hover","showLabel","facing","hideBox","childrenBuildings","devices","active","step","anchor","Vector","setup","traits","trait","Traits","OffscreenCulling","on","some","currentlyViewing","toggleActive","collisionType","CollisionType","PreventCollision","nameLabel","Label","fontSize","poly","aabbPoly","draw","ctx","delta","drawRect","aabb","processedColor","spaceFunction","Game","debugPath","slots","slot","rect","nodes","node","update","engine","tryProduce","emptyUnlessActive","isActive","machineEconomies","buildingEconomy","inUse","wasEquil","_i","allValues_1","localCap","globalCap","agg","constrainCursor","clone","reshape","afterConstruct","handleClick","_pos","getWidth","getHeight","devicePlaces","deviceInteractionPlaces","place","position","visibleSize","graph","supergraph","Graph","rootNode","findOrCreate","child","parentSlot","edge","childNode","redeem","res","gather","debit","spend","elite","pathFromRect","angledRoofPoly","angleStartY","overlaps","other","rect1","rect2","overlapsAny","colony","buildings","bldg","edgeColor","mainColor","colorBase","clr","connections","findSlot","validConnections","slotList","dir","validStructures","flipped","closestBuildingByType","matchingSlot","compass_1","alignToSlot","theSlot","offset","sub","addEqual","buildSlot","parent","addDevice","subEqual","updateFunction","machine","hasPlaceForDevice","nextDevicePlace","getDevices","tinyDevices","allTheMachines","machines","allSpaceFunctions","spaceFn","sf","text","background","BackgroundPattern","Grid","Actor","drawPatternedPoly","path","pattern","Black","gridPattern","getBackgroundPattern","save","translate","beginPath","moveTo","pt","lineTo","closePath","fillStyle","strokeStyle","stroke","restore","drawLine","lineWidth","toRGBA","drawPatternedRect","rectangle","filled","dashed","main","fillRect","setLineDash","strokeRect","drawPoly","drawStar","cx","cy","outerRadius","innerRadius","spikes","rot","PI","cos","sin","Resources_1","world","displayMode","DisplayMode","FullScreen","backgroundColor","start","loader","Loader","key","Resources","addResource","logo","logoWidth","logoHeight","startButtonFactory","myButton","document","createElement","textContent","style","border","display","padding","fontFamily","fontWeight","then","log","citizenSpeed","startHour","minuteTickMillis","Engine","Structure_1","Device","initialPos","product","imageLoaded","reserved","parentDevice","Image","onload","src","computeEconomy","globalAlpha","imageX","imageY","vel","scale","drawImage","iv","bx","by","yOff","produced","blockSize","assemble","citizen","isCarryingUnique","drop","progressBar","sent","label","interact","request","worked","op","recipe_1","carrying","it","consumes","includes","consumed","workTime","getEffectiveWorkTime","carry","produces","warn","requires","has","storeOrExplore","dispense","store_1","stores","getEffectiveOperationalCapacity","res_1","stored","origX","groundSpeed","driving","xOff","actions","asPromise","gathers","bonus","bonuses","capacity","workSpeed","round","resource","generationTime","generates","snap","snapTiny","allStructures","snapped","spot","getCenter","abs","findAllDevices","hasTinyPlace","nextTinyPlace","tx0","ndx","addTinyDevice","smallMachines","mediumMachines","largeMachines","hugeMachines","smallDome","smallBelow","midDome","midBelow","largeDome","largeBelow","hugeDome","hugeBelow","medGroundVehicles","Structure","view","zoom","Corridor","Ladder","MainTunnel","fifth","MediumSurfaceRoom","SurfaceRoad","first","Dome","seventh","CommonArea","SmallRoomThree","sixth","SmallRoomTwo","SmallDome","MediumRoom","MediumRoomThree","LargeRoom","HugeRoom","SmallDomeThree","MidDome","LargeDome","Arcology","GroundVehiclePool","majorUnit","minorUnit","minorScale","SpaceFunction","Beige","MissionControl","Window","LivingQuarters","Barracks","Kitchen","Checker","LifeSupportPod","Retreat","CloneMatrix","CloneReception","ReadingRoom","Library","Study","Wood","ComputerLab","Archive","Arboretum","AlgaeFarm","SolarArray","Workshop","Nursery","Leafy","Farm","Factory","ComputerCore","Tech","LifeSciencesLab","Refinery","Mine","HoloMatrix","TimeChamber","LivingRoom","Statuary","InteractionRequest_1","Strategy","pawn","sleepInterval","currentPlanet","findPoweredDevices","recipes","operations","explores","attempt","pause","gatherBlock","gathered","generatesDesiredBlock","gen","closestDeviceByType","storesDesiredBlock","visitDevice","waitTimes","retrieveResource","visit","workExploration","exploring","knowsHow","vehicle","explored","drive","driven","workRecipe","debug","knowsRecipe","maker","made","gatherIngredients","performRecipeTask","blocks","blocks_1","ingredient","tries","timesToAttempt","raisedSquare","leafy","bookish","posters","tech","checker","beige","ussf","wood","loadBg","loading","Poster","USSF","backgroundPatterns","bg","matrix","DOMMatrix","createPattern","setTransform","Pane","dragging","dragStart","target","title","initialX","clientX","initialY","clientY","drag","preventDefault","currentX","currentY","dragEnd","makeRootElement","_element","parentElement","removeChild","flexWrap","body","appendChild","container","margin","addEventListener","left","canvas","offsetLeft","top_1","offsetTop","top","buttonFactory","fg","theButton","textTransform","onmouseover","saturate","onmouseleave","empty","edges","edgesInverse","isEmpty","newNode","contains","testNode","measure","tolerance","dfs","dst","union","otherGraph","edgeList","theEdges","_c","otherIndex","otherNode","adjacent","adjacentIndices","testNodeIndex","es","esInv","root","visited","rIndex","dfsIndex","rootIndex","childIndex","bfs","cb","bfsIndex","halt","visited_1","visitedNode","adj_1","adjacentNode","shortestPath","maxStep","prevStep","dstIndex","prev","curr","steps","srcIndex","reverse","World","colors","skyColor","Cyan","Vermillion","Chartreuse","Rose","nameCitizen","sword","craterRock","assembler","indivision","understanding","futureTense","Sword","Texture","CraterRock","Sound","Assembler","Indivision","Understanding","FutureTense","Discipline","Survival","LibraryScience","disciplineTree","level","unlocks","TechnologyRank_1","TechTree","currentLevels","findDisciplineToRankUp","keys","disciplineName","discipline","canRankUp","rankUp","currentRank","nextLevel","allUnlockedMachines","unlocked","unlockedMachinesFor","tree","ex","Player","setWidth","setHeight","PlanetBackground","MountainLayers","layers","layerHeight","layerCount","peakCount","onInitialize","layerIndex","unshift","baseY","deltas","genPeaks","wc","sc","ls_1","layer","drawLayer","ox","oy","peakWidth","dMax","last","times","pick","Mountains","peaks","peakDistance","drift","baseColor","brightColor","yBase","peak","y0","mtnWidth","PlanetBackground_1","SkyLayer","lo","hi","mid","backMountainLayers","mountains","mountainLayers","setLoHi","SkyLayer_1","SkyLayers","c0","c1","setHi","EatingStrategy","EatingStrategy_1","WhenHungryEatingStrategy","canApply","isHungry","storedResources","desk","eat","SleepingStrategy","SleepingStrategy_1","AnyBedSleepingStrategy","isTired","hour","takeRest","Strategy_1","ConstructionStrategy","unbuiltDevice","ProxmityBasedConstruction","constructDevice","resources","setPrototypeOf","__proto__","constructor","create","__awaiter","throw","done","__generator","trys","ops","return","Symbol","iterator","TypeError","pop","ProductionStrategy","storeBlock","tryStoreBlock","openStore","CapacityBasedProduction","findStore","findRecipe","explorer","findExplorer","storage_1","storage_2","explorers","CapacityBasedProduction_1","ProximityBasedConstruction_1","AnyBedSleepingStrategy_1","WhenHungryEatingStrategy_1","Citizen","home","isPlanning","workInProgress","sleeping","hunger","energy","currentBuilding","productionStrategy","constructionStrategy","sleepingStrategy","eatingStrategy","speedMultiplier","timeFactor","now","Date","getTime","progress","workStarted","workDuration","work","rotate","carried","pw","px","py","c_1","duration","reject","targetForDevice","pathBetweenPoints","followPath","glideTo","walkSpeed","all","choice","strategies","strat","thirtyMinuteTimer","Citizen_1","World_1","Population","citizens","increase","NavigationTree","seekPath","origin","dest","closestNode","NavigationTree_1","Colony","currentlyConstructing","debugTree","navTree","gradient","createLinearGradient","addColorStop","placeBuilding","buildNavTree","structureTypes","st","pathBetween","destination","srcNode","destNode","machineTypes","ctrl","activeBuildings","Colony_1","Population_1","Device_1","SkyLayers_1","Planet","hud","onBuildingHover","onDeviceHover","w","depth","sky","createLayer","skyLayers","population","currentHour","setTime","time","nextHour","inc","oldC","skyColorForHour","newC","mixC","assignColors","colorMap","night","dawn","morning","afternoon","evening","set","buildingOrDevice","theLayer","theEconomy","popularDemand","resourceGathered","resourceExpended","maxPop","theEconomyWithoutPeople","values","val","closestDevice","acc","Modal","message","makeDialog","addButtons","buttonMap","entries","intent","btn","onclick","teardown","modalButton","Palette","onButtonClick","onButtonEnter","comprehend","comprehended","makePalette","updateBuilt","nowComprehended","prereq","onmouseenter","CardBody","entity","describeResources","freqs","join","notes","fontStyle","FontStyle","Italic","footer","show","describeEconomy","resourceDescription","domeStatus","bonusMessages","econ","CardTitle","announce","CardTitle_1","CardBody_1","Card","x0","cardBody","ix","iy","present","MusicPlayer","playlist","paused","makePlayer","startMusic","_titleElem","currentTrack","play","advancePlaylist","_wrapper","maxHeight","textAlign","overflow","inlineBlock","iconFactory","handleAction","action","song","stop","trackNames","append","iconContent","icon","innerHTML","EconomicValue","valueLabel","setCount","count","EconomicValue_1","EconomyView","valueLabels","val1","val2","addValue","updateView","updatedEconomy","Tooltip","messageLabel","ResourceListEntry","resourceBlock","hovering","tooltip","visible","credit","amt","UIActor","ResourceListEntry_1","ResourcesList","res1","res2","rx","ry","addEntry","entry","increment","decrement","ResourcesList_1","EconomyView_1","MusicPlayer_1","StatusAnalysisView","h","brand","ty","version","clock","popLabel","musicPlayer","Crater Rock","Future Tense","incrementResource","decrementResource","setMessage","showEconomy","showPopCap","cap","setClock","days","toString","hh","hours","minutes","ampm","padStart","StatusAnalysisView_1","Card_1","Palette_1","Modal_1","CitizenList","onCitizenSelect","updateRoster","makeRoster","Hud","game","onBuildingSelect","onMachineSelect","onFunctionSelect","canvasWidth","canvasHeight","hidePalettes","modal","devicePixelRatio","status","displayInfo","showCard","machinePalette","structurePalette","structuresForPalette","functionPalette","functionsForPalette","citizenList","card","systemMessage","buttons","closeSystemMessage","showPalettes","setStatus","updateDetails","techTree","rebuildPalettes","updatePalettes","updateEconomy","updateMaxPop","updateBuildingPalette","updateMachinePalette","updateFunctionPalette","builtStructures","builtMachines","machinesForPalette","builtReifiedFunctions","builtFunctions","rf","devicePlaceSize","devicePlaceCount","floorHeight","sg","right","isGroundFloor","leftSlot","rightSlot","topSlot","theSlots","slotY","getTop","backgroundPattern","floorColor","floorEdgeHeight","flagX","flagY","flagpoleHeight","_1","originSlot","slotSize","pickingOrigin","drawShape","xoff","yoff","bezierCurveTo","halfWidth","slotHeights","heights","y1","btm","lst","slotCount","deviceSize","buffer","arc","originX","newCursor","input","output","Hud_1","Planet_1","player_1","TechTree_1","Construct","defaultMessage","placingFunction","hasActiveModal","firstBuilding","showTutorial","timeStepIntervalMillis","rank","buildIt","startConstructing","startFollowing","player","prepareNextBuilding","camera","addTimer","Timer","stepTime","continue","tutorialMessage","i got this","rankUpMessage","yay","onActivate","pointers","primary","dragOrigin","currentlyBuilding","constrained","button","Input","PointerButton","buildingUnderConstruction_1","placementValid","deviceUnderConstruction","Middle","z","getZoom","deltaY","moveCam","direction","camMoveSpeed","dv","move","keyboard","Keys","H","Esc","stopFollowing","W","A","S","D","onDeactivate","off","nextMissingStructureOrFunction","reqs","requiredStructuresAndFunctions","req","actualStructureNames","actualFunctionNames","actualNames","nextMissing","cameraStrategy","LockCameraToActorStrategy","addStrategy","removeStrategy","structureOrMachine","theNextOne","spawnBuilding","spawnDevice","spawnFunction","anotherBuilding","assembleBuildingFromStructure","theStructure","Scene","Construct_1","theWorld","construct","goToScene"],"mappings":"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AwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAqK,EAAAtN,GCAxCd,EAAAD,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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([112,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import { Vector, Color } from \"excalibur\";\r\nimport { Rectangle } from \"./values/Rectangle\";\r\nimport { getBackgroundPattern, BackgroundPattern } from \"./actors/Building/BackgroundPatterns\";\r\n\r\nconst extremumBy = (arr, pluck, extremum) => {\r\n  return arr.reduce(function(best, next) {\r\n    var pair = [ pluck(next), next ];\r\n    if (!best) {\r\n       return pair;\r\n    } else if (extremum.apply(null, [ best[0], pair[0] ]) == best[0]) {\r\n       return best;\r\n    } else {\r\n       return pair;\r\n    }\r\n  },null)[1];\r\n}\r\n\r\nexport const minBy = (arr, fn) => extremumBy(arr, fn, Math.min)\r\nexport const maxBy = (arr, fn) => extremumBy(arr, fn, Math.max)\r\n\r\n\r\nexport const sample = (arr) => arr[Math.floor(Math.random() * arr.length)]\r\n\r\nexport const range = (n) => Array(n).fill(0).map((_val,idx) => idx)\r\n\r\nexport function closest<T>(cursor: Vector, arr: Array<T>, getVector: (elem: T) => Vector, predicate?: (elem: T) => boolean) {\r\n   let matching: Array<T> = arr;\r\n   if (predicate) { arr = arr.filter(predicate) }\r\n   if (matching) {\r\n      let distanceToCursor = (elem: T) => cursor.distance(getVector(elem))\r\n      return minBy(matching, distanceToCursor)\r\n   }\r\n}\r\n\r\nexport const flatSingle = arr => [].concat(...arr);\r\n\r\nexport const deleteByValue = (arr, elem) => arr.filter(e => e !== elem)\r\n\r\nexport const deleteByValueOnce = (arr, elem) => {\r\n  let index = arr.indexOf(elem);\r\n  if (index !== -1) arr.splice(index, 1);\r\n}\r\n\r\nexport function eachCons(a, n) {\r\n  var r = []\r\n  for (var i = 0; i < a.length - n + 1; i++) {\r\n    r.push(_ecRange(a, i, n))\r\n  }\r\n  return r\r\n}\r\n\r\nfunction _ecRange (a, i, n) {\r\n  var r = []\r\n  for (var j = 0; j < n; j++) {\r\n    r.push(a[i + j])\r\n  }\r\n  return r\r\n}\r\n\r\nexport function eachChunk(a, n) {\r\n  return a.reduce(function (result, value, index, array) {\r\n    if (index % n === 0)\r\n      result.push(array.slice(index, index + n));\r\n    return result;\r\n  }, []);\r\n}\r\n\r\nexport const measureDistance = (a: Vector, b: Vector) => a.distance(b)\r\n\r\n\r\nexport function sleep(ms) {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\nexport function shuffle(arr) {\r\n  return arr.sort(() => Math.random() > 0.5 ? 1 : -1)\r\n}\r\n\r\nexport const zip = (a, b) => a.map((e, i) => [e, b[i]])\r\n\r\nexport const countOccurrences = (arr) => {\r\n  let counts = {}\r\n  arr.forEach((elem) => {\r\n    counts[elem] = counts[elem] || 0\r\n    counts[elem] += 1\r\n  })\r\n  return counts\r\n}\r\n\r\nexport function containsUniq<T>(arr: T[], testElems: T[]) {\r\n  let doesContain = false\r\n  let arrCopy = arr.slice()\r\n  if (arr.length > 0) {\r\n    let missingItem = false\r\n    testElems.forEach(testElem => {\r\n      if (arrCopy.find(e => e === testElem)) {\r\n        deleteByValueOnce(arrCopy, testElem)\r\n      } else {\r\n        missingItem = true\r\n      }\r\n    })\r\n    doesContain = !missingItem\r\n  }\r\n  return doesContain\r\n}\r\n\r\n\r\nexport function mixColors(a: Color, b: Color, factor: number = 0.5): Color {\r\n  let aFactor = factor, bFactor = (1-factor)\r\n  return new Color(\r\n    (a.r * aFactor) + (b.r * bFactor),\r\n    (a.g * aFactor) + (b.g * bFactor),\r\n    (a.b * aFactor) + (b.b * bFactor),\r\n    1\r\n  )\r\n}\r\n\r\nexport function onlyUnique(value, index, self) { \r\n    return self.indexOf(value) === index;\r\n}","import { Scale } from \"./Scale\";\r\nlet { major, minor } = Scale\r\n\r\nexport enum DeviceSize {\r\n    Tiny,\r\n    Small,\r\n    Medium,\r\n    Large,\r\n    Huge,\r\n}\r\n\r\n\r\nexport function getVisibleDeviceSize(size: DeviceSize): number {\r\n    let sz = 10;\r\n    switch (size) {\r\n        case DeviceSize.Tiny: sz = minor.third; break;\r\n        case DeviceSize.Small: sz = major.third; break;\r\n        case DeviceSize.Medium: sz = major.fourth; break;\r\n        case DeviceSize.Large: sz = major.eighth + major.second; break;\r\n        case DeviceSize.Huge: sz = 6 * major.eighth; break;\r\n    }\r\n    return sz;\r\n}","import { Building } from './Building';\r\n\r\nimport { CorridorView } from './CorridorView';\r\nimport { CommonAreaView } from './CommonAreaView';\r\nimport { DomeView } from './DomeView';\r\nimport { TunnelView } from './TunnelView';\r\nimport { ArcologyView } from './ArcologyView';\r\nimport { LadderView } from './LadderView';\r\nimport { SurfaceRoadView } from './SurfaceRoadView';\r\nimport { SmallDomeThreeView } from './SmallDomeThreeView';\r\nimport { MidDomeView } from './MidDomeView';\r\nimport { BigDomeView } from './BigDomeView';\r\nimport { SmallRoomThreeView } from './SmallRoomThreeView';\r\nimport { MediumRoomView } from './MediumRoomView';\r\nimport { LargeRoomView } from './LargeRoomView';\r\nimport { HugeRoomView } from './HugeRoomView';\r\nimport { MediumRoomThreeView } from './MediumRoomThreeView';\r\nimport { MediumSurfaceRoomView } from './MediumSurfaceRoomView';\r\n\r\n\r\nconst structureViews: { [key: string]: typeof Building } = {\r\n    CorridorView,\r\n    LadderView,\r\n    TunnelView,\r\n    SurfaceRoadView,\r\n\r\n    DomeView, // small dome 2\r\n    SmallDomeThreeView,\r\n    MidDomeView,\r\n    BigDomeView,\r\n\r\n    SmallRoomThreeView,\r\n\r\n    CommonAreaView,\r\n    MediumRoomView,\r\n    MediumRoomThreeView,\r\n    LargeRoomView,\r\n    HugeRoomView,\r\n\r\n    ArcologyView,\r\n    MediumSurfaceRoomView,\r\n}\r\n\r\nexport {\r\n    Building,\r\n\r\n    CorridorView,\r\n    LadderView,\r\n    TunnelView,\r\n    SurfaceRoadView,\r\n\r\n    DomeView, // small dome 2\r\n    SmallDomeThreeView,\r\n    MidDomeView,\r\n    BigDomeView,\r\n\r\n    SmallRoomThreeView,\r\n\r\n    CommonAreaView,\r\n    MediumRoomView,\r\n    MediumRoomThreeView,\r\n\r\n    LargeRoomView,\r\n    HugeRoomView,\r\n\r\n    ArcologyView,\r\n\r\n    MediumSurfaceRoomView,\r\n\r\n\r\n    structureViews\r\n\r\n}","import { ResourceBlock, Economy, emptyMarket } from \"./Economy\";\r\nimport { Color, FontStyle, Resource } from \"excalibur\";\r\nimport { DeviceSize } from \"../values/DeviceSize\";\r\nimport { MechanicalOperation, mechanicalOperations } from \"./MechanicalOperation\";\r\nimport { shuffle, range, sample } from \"../Util\";\r\nimport { Device } from \"../actors/Device\";\r\n\r\nconst bookshelfSvg = require('../images/bookshelf-plain.svg');\r\nconst vatSvg = require('../images/vat-plain.svg');\r\nconst benchSimple = require('../images/bench-simple-plain.svg');\r\nconst stove = require('../images/stove-plain.svg');\r\nconst cabin = require('../images/cabin-plain.svg');\r\nconst fire = require('../images/cooking-fire-plain.svg')\r\nconst bed = require('../images/bed-plain.svg')\r\nconst fridge = require('../images/fridge-plain.svg')\r\nconst server = require('../images/research-server-plain.svg')\r\nconst plant = require('../images/houseplant-plain.svg')\r\nconst workstation = require('../images/workstation-plain.svg')\r\n\r\nconst console = require('../images/console-plain.svg')\r\nconst consolePurple = require('../images/console-purple-plain.svg')\r\nconst consoleGreen = require('../images/console-green-plain.svg')\r\nconst consoleRed = require('../images/console-red-plain.svg')\r\nconst megaconsole = require('../images/mega-console-plain.svg')\r\n\r\nconst fabricator = require('../images/fabricator-plain.svg')\r\n\r\nconst couch = require('../images/couch-plain.svg')\r\nconst solar = require('../images/solar-collector-plain.svg')\r\nconst miner = require('../images/miner-plain.svg')\r\n\r\nconst statue = require('../images/statue-plain.svg')\r\nconst codex = require('../images/codex-plain.svg')\r\n\r\nconst lavaLamp = require('../images/lava-lamp-plain.svg')\r\nconst orrery = require('../images/orrery-plain.svg')\r\nconst telescope = require('../images/telescope-plain.svg')\r\nconst books = require('../images/books-plain.svg')\r\n\r\nconst images = {\r\n    bookshelf: bookshelfSvg,\r\n    vat: vatSvg,\r\n    bench: benchSimple,\r\n    stove,\r\n    cabin,\r\n    fire,\r\n    bed,\r\n    fridge,\r\n    server,\r\n    plant,\r\n    workstation,\r\n\r\n    console,\r\n    consolePurple,\r\n    consoleGreen,\r\n    consoleRed,\r\n    megaconsole,\r\n\r\n    fabricator,\r\n\r\n    couch,\r\n    solar,\r\n    miner,\r\n    statue,\r\n\r\n    codex,\r\n    lavaLamp,\r\n    orrery,\r\n    telescope,\r\n    books,\r\n}\r\n\r\n\r\nconst { Red, Green, Blue, Orange, Violet, Yellow } = Color;\r\n\r\nlet { store, generate, recipe, spawn, accelerateTime, explore } = mechanicalOperations\r\n\r\nexport class Machine {\r\n    name: string = '(machine name)'\r\n    description: string = '(machine description)'\r\n    color: Color = Color.LightGray\r\n\r\n    cost: ResourceBlock[] = [ResourceBlock.Mineral]\r\n\r\n    size: DeviceSize = DeviceSize.Small\r\n    operation: MechanicalOperation = { type: 'noop' }\r\n    image = images.vat\r\n    prereqs: (typeof Machine)[] = []\r\n    economy: Economy = emptyMarket()\r\n    forDome: boolean = false\r\n    hide: boolean = false\r\n\r\n    capacity: boolean\r\n\r\n    isVehicle: boolean = false\r\n\r\n    tinySlots: boolean = false\r\n\r\n    concretize(): Machine { return this; } \r\n\r\n    onPlacement(device: Device) {\r\n        // ...whatever we need to script here?\r\n    }\r\n}\r\n\r\nexport class CommandCenter extends Machine {\r\n    name = 'Command Console'\r\n    description = 'commander, we need your help'\r\n    operation = store(\r\n        [ResourceBlock.Mineral, ResourceBlock.Ore], //,ResourceBlock.Biomass],\r\n        24\r\n    )\r\n    image = images.megaconsole\r\n    size = DeviceSize.Medium\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 6, demand: 0 },\r\n        Oxygen: { supply: 16, demand: 0 },\r\n        Water: { supply: 1, demand: 0 },\r\n        Hope: { supply: 1, demand: 0 },\r\n        Shelter: { supply: 1, demand: 0}\r\n    }\r\n\r\n    onPlacement(device: Device) {\r\n        device.built = true\r\n        for (let i in range(20)) {\r\n            device.produceResource(ResourceBlock.Mineral)\r\n        }\r\n        let { building } = device\r\n        building.populate(device.pos.add(building.pos), true)\r\n    }\r\n}\r\n\r\nexport class MissionLog extends Machine {\r\n    name = 'Mission Log'\r\n    description = 'gather data'\r\n    operation = store(\r\n        [ResourceBlock.Data],\r\n        8\r\n    )\r\n    image = images.consolePurple\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.1 },\r\n        Hope: { supply: 1, demand: 0 }\r\n    }\r\n}\r\n\r\n//export class Energon extends Machine {\r\n//    name = 'Energon'\r\n//    description = 'food paste'\r\n//}\r\n\r\n// tiny\r\nexport class LavaLamp extends Machine {\r\n    name = 'Lava Lamp'\r\n    description = 'mesmerizing'\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image  = images.lavaLamp\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Joy: { supply: 1, demand: 0 },\r\n        Power: { supply: 0, demand: 0.1 },\r\n    }\r\n}\r\n\r\nexport class Figurine extends Machine {\r\n    name = 'Figurine'\r\n    description = 'not an action figure'\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image = images.statue   \r\n    economy = {\r\n        ...emptyMarket(),\r\n        Beauty: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Orrery extends Machine {\r\n    name = 'Orrery'\r\n    description = 'to the stars'\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image = images.orrery\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wonder: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Books extends Machine {\r\n    name = 'Books'\r\n    description = 'black and white'\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image = images.books\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\n// small\r\n/// small surface\r\n\r\nexport class OxygenExtractor extends Machine {\r\n    name = 'O2 Extractor'\r\n    description = 'breathe deep'\r\n    image = images.vat\r\n    prereqs = [ WaterCondensingMachine, SolarCell ]\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 6, demand: 0 },\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class SolarCell extends Machine {\r\n    name = 'Solar Cell'\r\n    description = 'feel the warmth'\r\n    image = images.solar\r\n    prereqs = [ Bed ] \r\n\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 10, demand: 0 },\r\n    }\r\n}\r\n\r\n\r\nexport class WaterCondensingMachine extends Machine {\r\n    name = 'H2O Condenser'\r\n    description = 'have a drink'\r\n// setup a loop here so we have to get survival I?\r\n    prereqs = [ SolarCell, OxygenExtractor ]\r\n\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 5, demand: 0 },\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Telescope extends Machine {\r\n    name = 'Telescope'\r\n    description = 'look to the stars'\r\n    prereqs = [ Orrery ]\r\n    forDome = true\r\n    image = images.telescope\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 1, demand: 0 },\r\n    } \r\n}\r\n\r\n\r\n// /// small subsurface\r\n\r\nexport class Table extends Machine {\r\n    name = 'Table'\r\n    description = 'a simple table'\r\n    image = images.bench\r\n    // this device provides slots for tiny-sized deviecs\r\n    tinySlots = true\r\n}\r\n\r\nexport class Statue extends Machine {\r\n    name = 'Statue'\r\n    description = 'for honor'\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Hope: { supply: 0.1, demand: 0 },\r\n        Beauty: { supply: 1, demand: 0 },\r\n    }\r\n    image = images.statue\r\n    prereqs = [ Figurine ]\r\n}\r\n\r\nexport class StudyMachine extends Machine {\r\n    operation = recipe(\r\n        [ ResourceBlock.Idea, ResourceBlock.Idea, ResourceBlock.Idea ],\r\n        ResourceBlock.Data\r\n    )\r\n    color = Blue\r\n    concretize(): Machine { return new (sample([Workstation, Desk]))() }\r\n}\r\n\r\nexport class Desk extends StudyMachine {\r\n    name = 'Desk'\r\n    description = 'get to work'\r\n    image = images.bench\r\n    prereqs = [ OxygenExtractor ]\r\n    concretize() { return this }\r\n}\r\n\r\nexport class Codex extends Machine {\r\n    name = 'Codex'\r\n    description = 'read it closely'\r\n    image = images.codex\r\n    prereqs = [ Bookshelf ]\r\n    operation = store([ResourceBlock.Data], 3)\r\n    color = Blue\r\n    // concretize() { return this }\r\n}\r\n\r\nexport class Workstation extends StudyMachine {\r\n    name = 'Workstation'\r\n    description = 'hackety hack'\r\n    prereqs = [ Bookshelf ]\r\n    image = images.workstation\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n    concretize() { return this }\r\n}\r\n\r\nexport class Couch extends Machine {\r\n    name = 'Couch'\r\n    description = 'take it easy'\r\n    prereqs = []\r\n    image = images.couch\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Joy: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class Bookshelf extends Machine {\r\n    name = 'Shelf'\r\n    description = 'brainstorm'\r\n    operation = generate(ResourceBlock.Idea)\r\n    image = images.bookshelf\r\n    prereqs = [ ]\r\n    color = Blue\r\n}\r\n\r\n\r\nexport class Fridge extends Machine {\r\n    name = 'Fridge'\r\n    description = 'store meals'\r\n    operation = store([ResourceBlock.Meal], 6)\r\n    image = images.fridge\r\n    prereqs = [Bookshelf]\r\n    color = Yellow\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Stove extends Machine {\r\n    name = 'Stove'\r\n    description = 'make a meal'\r\n    operation = recipe(\r\n        [ResourceBlock.Biomass, ResourceBlock.Biomass],\r\n        ResourceBlock.Meal\r\n    )\r\n    image = images.stove\r\n\r\n    prereqs = [Bookshelf, Fridge]\r\n    color = Yellow\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Bed extends Machine {\r\n    name = 'Bed'\r\n    description = 'sweet dreams'\r\n    image = images.bed\r\n    prereqs = [ OxygenExtractor ]\r\n    color = Orange\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Shelter: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Houseplant extends Machine {\r\n    name = 'House Plant'\r\n    description = 'so nice'\r\n    prereqs = [ Bed ]\r\n    // produces = ResourceBlock.Food\r\n    cost = [ ResourceBlock.Biomass ]\r\n    operation = generate(ResourceBlock.Biomass, 1)\r\n    color = Green\r\n    image = images.plant\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 1, demand: 0 },\r\n        Water: { supply: 0, demand: 0.1 },\r\n    }\r\n}\r\n\r\nexport class PersonnelRegistry extends Machine {\r\n    name = 'Personnel Registry'\r\n    description = 'track everybody'\r\n    prereqs = [ CloningVat ]\r\n    operation = store([ResourceBlock.Data], 4)\r\n    color = Yellow\r\n    image = images.console\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.1 },\r\n        Wisdom: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class OrientationConsole extends Machine {\r\n    name = 'Orientation Console'\r\n    description = 'welcome to the colony'\r\n    prereqs = [CloningVat]\r\n    operation = generate(ResourceBlock.Data, 1)\r\n    image = images.consoleRed\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.1 },\r\n        Hope: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class CloningVat extends Machine {\r\n    name = 'Cloning Vat'\r\n    description = 'we all grow'\r\n    // behavior = MachineOperation.SpawnCitizen \r\n    operation = spawn()\r\n    productionTime = 1500\r\n    image = images.vat\r\n    prereqs = [AlgaeVat]\r\n    size = DeviceSize.Small\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\nexport class DissolutionVat extends Machine {\r\n    name = 'Dissolution Vat'\r\n    description = 'back to basics'\r\n    // behavior = MachineOperation.SpawnCitizen \r\n    operation = recipe(\r\n        [ ResourceBlock.Biomass, ResourceBlock.Biomass ],\r\n        ResourceBlock.Bioplasma\r\n    )\r\n    productionTime = 1500\r\n    image = images.vat\r\n    prereqs = [PlasmaBank]\r\n    size = DeviceSize.Small\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class PlasmaBank extends Machine {\r\n    name = 'Bioplasm Bank'\r\n    description = 'hold on'\r\n    operation = store([ ResourceBlock.Bioplasma ])\r\n    prereqs = [AlgaeVat]\r\n    color = Green\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\n    \r\nexport class Fabricator extends Machine {\r\n    name = 'Fabricator'\r\n    description = 'you made that'\r\n    operation = recipe(\r\n        [ResourceBlock.Mineral, ResourceBlock.Mineral],\r\n         ResourceBlock.Alloy\r\n    )\r\n    size = DeviceSize.Small\r\n    color = Red\r\n    prereqs = [Workstation]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 3 },\r\n    }\r\n    image = images.fabricator\r\n}\r\n\r\nexport class AlgaeVat extends Machine {\r\n    name = 'Algae Vat'\r\n    description = 'where there is a will'\r\n    operation = generate(ResourceBlock.Biomass)\r\n    prereqs = [ OxygenExtractor, Bookshelf, Fridge ]\r\n    size = DeviceSize.Small\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\nexport class LifeSciencesConsole extends Machine {\r\n    name = 'Life Sciences Console'\r\n    description = 'mind and body together'\r\n    operation = store([ResourceBlock.Biomass, ResourceBlock.Data], 5)\r\n    prereqs = [Houseplant, Botany]\r\n    color = Green\r\n    image = images.consoleGreen\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.2 },\r\n    }\r\n}\r\n\r\n// medium\r\n\r\nexport class Miner extends Machine {\r\n    name = 'Miner (Rover)'\r\n    description = 'mobile drill unit'\r\n\r\n    // gather actually takes the machine/citizen around?\r\n    operation = explore(ResourceBlock.Ore, 2)\r\n\r\n    color = Red\r\n    size = DeviceSize.Medium\r\n    isVehicle = true\r\n    image = images.miner\r\n}\r\n\r\nexport class MetalStorage extends Machine {\r\n    name = 'Metal Storage'\r\n    description = 'contain minerals and alloys?'\r\n    operation = store([ResourceBlock.Mineral, ResourceBlock.Alloy], 8)\r\n    prereqs = [Bookshelf]\r\n    color = Red\r\n    size = DeviceSize.Medium\r\n}\r\n\r\nexport class ResearchServer extends Machine {\r\n    name = 'Research Server'\r\n    description = 'hold data'\r\n    operation = store([ResourceBlock.Data, ResourceBlock.Algorithm], 10)\r\n    image = images.server\r\n    prereqs = [Bookshelf, Workstation]\r\n    size = DeviceSize.Medium\r\n    color = Blue\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 4 },\r\n    }\r\n}\r\n\r\nexport class Orchard extends Machine {\r\n   name = 'Orchard'\r\n   description = 'grow some food'\r\n   operation = generate(ResourceBlock.Biomass)\r\n   size = DeviceSize.Medium\r\n   prereqs = [AlgaeVat]\r\n   color = Green\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n        Water: { supply: 0, demand: 1 },\r\n        Oxygen: { supply: 2, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Cabin extends Machine {\r\n   name = 'Cabin'\r\n   description = 'home on the plains'\r\n   operation = recipe(\r\n       [ ResourceBlock.Biomass, ResourceBlock.Biomass ],\r\n       ResourceBlock.Meal\r\n   )\r\n   image = images.cabin\r\n   prereqs = [Orchard]\r\n   size = DeviceSize.Medium\r\n   color = Orange\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n        Water: { supply: 0, demand: 1 },\r\n        Shelter: { supply: 4, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Arbor extends Machine {\r\n    name = 'Arbor'\r\n    description = 'arbor around the clock'\r\n    operation = generate(ResourceBlock.Biomass)\r\n    prereqs = [Orchard]\r\n    size = DeviceSize.Medium\r\n    color = Green\r\n    forDome = true\r\n}\r\n\r\n\r\nexport class Botany extends Machine {\r\n    name = 'Botany'\r\n    description = 'plant lab'\r\n    operation = generate(ResourceBlock.Biomass)\r\n    prereqs = [ OxygenExtractor, Bookshelf ]\r\n    size = DeviceSize.Medium\r\n    color = Green\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\n\r\nexport class MineralProcessor extends Machine {\r\n    name = 'Mineral Processor'\r\n    description = 'wheat from the chaff'\r\n    operation = recipe(\r\n        [ResourceBlock.Ore, ResourceBlock.Ore, ResourceBlock.Ore],\r\n         ResourceBlock.Mineral\r\n    )\r\n    size = DeviceSize.Medium\r\n    color = Red\r\n    prereqs = [Workstation, Fabricator]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\nexport class ThinkingFountain extends Machine {\r\n    name = 'Thinking Fountain'\r\n    description = 'slowly growing'\r\n    size = DeviceSize.Medium\r\n    prereqs = [ Mainframe, Megafabricator, MolecularEngine ]\r\n    color = Color.fromHex('daa520')\r\n    operation = generate(ResourceBlock.Aurum, 8)\r\n    cost = [ResourceBlock.Aurum]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 2, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 }\r\n    }\r\n}\r\n\r\nexport class SilverForest extends Machine {\r\n    name = 'Silver Forest'\r\n    description = 'immense serenity'\r\n    size = DeviceSize.Medium\r\n    prereqs = [ Megafabricator, Mainframe ]\r\n    color = Color.fromHex('c0c0c0')\r\n    operation = store([ResourceBlock.Argent], 12)\r\n    cost = [ResourceBlock.Alloy, ResourceBlock.Algorithm]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Beauty: { supply: 2, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 }\r\n    }\r\n    forDome = true\r\n}\r\n\r\nexport class TimeCrystal extends Machine {\r\n    name = 'Time Crystal'\r\n    description = 'xlr8'\r\n    size = DeviceSize.Medium\r\n    color = Color.fromHex('e5e4e2')\r\n    operation = accelerateTime()\r\n    cost = [ResourceBlock.Omnium]\r\n    prereqs = [ Megafabricator, SilverForest ]\r\n}\r\n\r\nexport class HoloProjector extends Machine {\r\n    name = 'Holo Projector'\r\n    description = 'whatever your heart desires'\r\n    size = DeviceSize.Medium\r\n    color = Blue\r\n    operation = generate(ResourceBlock.Data, 3)\r\n    cost = [ResourceBlock.Algorithm, ResourceBlock.Mineral]\r\n    prereqs = [ Mainframe ]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n        Joy: { supply: 3, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class SacredGrove extends Machine {\r\n    name = 'Sacred Grove'\r\n    description = 'where the furies play'\r\n    size = DeviceSize.Medium\r\n    forDome = true\r\n    cost = [ ResourceBlock.Omnium ]\r\n    prereqs = [ AtomicCompiler ]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 4, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class AtomicCompiler extends Machine {\r\n    name = 'Atomic Compiler'\r\n    description = 'super position'\r\n    operation = recipe(\r\n        [ ResourceBlock.Aurum, ResourceBlock.Argent ],\r\n        ResourceBlock.Omnium\r\n    )\r\n    cost = [ ResourceBlock.Argent, ResourceBlock.Algorithm ]\r\n    prereqs = [ ThinkingFountain, SilverForest ]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 3 },\r\n    }\r\n}\r\n\r\n\r\n// large devices!\r\n\r\nexport class MiningDrill extends Machine {\r\n    name = 'Mining Drill'\r\n    description = 'ore away'\r\n    operation = generate(ResourceBlock.Ore)\r\n    size = DeviceSize.Large\r\n    prereqs = [ Fabricator ]\r\n    image = images.miner\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 5 },\r\n    }\r\n}    \r\n\r\nexport class Megafabricator extends Machine {\r\n    name = 'Mega-Fabricator'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Fabricator ]\r\n    color = Red\r\n    operation = recipe(\r\n        [ResourceBlock.Alloy, ResourceBlock.Algorithm],\r\n        ResourceBlock.Argent\r\n    )\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 8 },\r\n    }\r\n}\r\n\r\nexport class MolecularEngine extends Machine {\r\n    name = 'Molecular Engine'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Megafabricator ]\r\n    color = Violet\r\n    operation = recipe(\r\n        [ResourceBlock.Bioplasma, ResourceBlock.Algorithm],\r\n        ResourceBlock.Aurum\r\n    )\r\n    image = images.megaconsole\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 3 },\r\n        Water: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Mainframe extends Machine {\r\n    name = 'Mainframe'\r\n    size = DeviceSize.Large\r\n    color = Blue\r\n    prereqs = [ResearchServer]\r\n    cost = [ ResourceBlock.Mineral, ResourceBlock.Mineral ]\r\n    operation = recipe(\r\n        [ ResourceBlock.Data, ResourceBlock.Data ],\r\n        ResourceBlock.Algorithm\r\n    )\r\n    image = images.server\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 6 },\r\n    }\r\n}\r\n\r\nexport class Preserve extends Machine {\r\n    name = 'Nature Preserve'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Arbor ]\r\n    color = Green\r\n    forDome = true\r\n    operation = generate(ResourceBlock.Biomass, 12)\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 0, demand: 4 },\r\n        Oxygen: { supply: 12, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class LogicPool extends Machine {\r\n    name = 'Logic Pool'\r\n    size = DeviceSize.Large\r\n    prereqs = [ MolecularEngine ]\r\n    color = Color.fromHex('daa520')\r\n    operation = store([ResourceBlock.Aurum], 12)\r\n    cost = [ResourceBlock.Algorithm, ResourceBlock.Bioplasma]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 2, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 }\r\n    }\r\n}\r\n\r\nexport class Cathedral extends Machine {\r\n    name = 'Cathedral'\r\n    description = 'first ultrahumanist'\r\n    size = DeviceSize.Large\r\n    prereqs = [ SacredGrove ]\r\n}\r\n\r\n\r\n/// huge devices\r\n\r\nexport class Microcity extends Machine {\r\n    name = 'Microcity'\r\n    size = DeviceSize.Huge\r\n    prereqs = [ Megafabricator ]\r\n    color = Orange\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 0, demand: 2 },\r\n        Power: { supply: 0, demand: 2 },\r\n        Joy: { supply: 5, demand: 0 },\r\n        Hope: { supply: 5, demand: 0 },\r\n        Beauty: { supply: 1, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class LogicCrystal extends Machine {\r\n    name = 'Logic Crystal'\r\n    size = DeviceSize.Huge\r\n    prereqs = [ Megafabricator ]\r\n    color = Blue\r\n}\r\n\r\n// export class MiniSun extends Machine {}\r\n\r\nexport const allMachines: (typeof Machine)[] = [\r\n    AlgaeVat,\r\n    Arbor,\r\n    Bed,\r\n    Bookshelf,\r\n    Cabin,\r\n    CloningVat,\r\n    Desk,\r\n    Fabricator,\r\n    Fridge,\r\n    Houseplant,\r\n    Megafabricator,\r\n    MiningDrill,\r\n    Orchard,\r\n    OxygenExtractor,\r\n    Preserve,\r\n    ResearchServer,\r\n    SolarCell,\r\n    Stove,\r\n    WaterCondensingMachine,\r\n    Workstation,\r\n    Microcity,\r\n    LogicCrystal,\r\n    Botany,\r\n\r\n    MineralProcessor,\r\n    PlasmaBank,\r\n    DissolutionVat,\r\n    MetalStorage,\r\n    Mainframe,\r\n\r\n    PersonnelRegistry,\r\n    MolecularEngine,\r\n    ThinkingFountain,\r\n    SilverForest,\r\n\r\n    OrientationConsole,\r\n    LifeSciencesConsole,\r\n\r\n    TimeCrystal,\r\n    LogicPool,\r\n    HoloProjector,\r\n    Cathedral,\r\n    SacredGrove,\r\n    AtomicCompiler,\r\n\r\n    Couch,\r\n    Statue,\r\n    Codex,\r\n\r\n    Table,\r\n    LavaLamp,\r\n\r\n    Figurine,\r\n\r\n    Miner,\r\n    Orrery,\r\n    Telescope,\r\n    Books,\r\n]","import { Color } from \"excalibur\";\r\n\r\n// an abstract/intangible thing (or at least something we don't represent)\r\nexport enum PureValue {\r\n    Power = 'Power',\r\n    Oxygen = 'Oxygen',\r\n    Water = 'Water',\r\n    Shelter = 'Shelter',\r\n    Hope = 'Hope',\r\n    Joy = 'Joy',\r\n    Wisdom = 'Wisdom',\r\n    Wealth = 'Wealth',\r\n    Beauty = 'Beauty',\r\n    Wonder = 'Wonder'\r\n}\r\n\r\nexport const allValues: PureValue[] = [\r\n    PureValue.Power,\r\n    PureValue.Oxygen,\r\n    PureValue.Water,\r\n    PureValue.Shelter,\r\n    PureValue.Hope,\r\n    PureValue.Joy,\r\n    PureValue.Wisdom,\r\n    PureValue.Wealth,\r\n    PureValue.Beauty,\r\n    PureValue.Wonder\r\n]\r\n\r\nexport type Economy = { [key in PureValue]: {\r\n    supply: number,\r\n    demand: number\r\n} }\r\n\r\nexport function emptyMarket() : Economy {\r\n    return {\r\n        Power: { supply: 0, demand: 0 },\r\n        Oxygen: { supply: 0, demand: 0 },\r\n        Water: { supply: 0, demand: 0 },\r\n        Shelter: { supply: 0, demand: 0 },\r\n        Hope: { supply: 0, demand: 0 },\r\n        Joy: { supply: 0, demand: 0 },\r\n        Wealth: { supply: 0, demand: 0 },\r\n        Wisdom: { supply: 0, demand: 0 },\r\n        Beauty: { supply: 0, demand: 0 },\r\n        Wonder: { supply: 0, demand: 0 },\r\n    }\r\n}\r\n\r\nexport function availableCapacity(market: Economy, value: PureValue) {\r\n    return Math.floor(market[value].supply - market[value].demand)\r\n}\r\n\r\nexport const sumMarkets: (ea: Economy, eb: Economy) => Economy = (ea, eb) => {\r\n    let newMarket = emptyMarket();\r\n    for (let value in PureValue) {\r\n        let { supply: sa, demand: da } = ea[value]\r\n        let { supply: sb, demand: db } = eb[value]\r\n        let supply = sa + sb\r\n        let demand = da + db\r\n        newMarket[value] = {\r\n            supply,\r\n            demand,\r\n        }\r\n    }\r\n    return newMarket\r\n}\r\n\r\nexport const equilibrium: (e: Economy) => boolean = (e) => {\r\n    return allValues.every(value => availableCapacity(e, value) >= 0)\r\n}\r\n\r\nexport enum ResourceBlock {\r\n    // base\r\n    Biomass = 'Biomass',\r\n    Ore = 'Ore',\r\n    Idea = 'Idea',\r\n\r\n    // derived\r\n    Meal = 'Meal',\r\n    Data = 'Data',\r\n    Mineral = 'Mineral',\r\n    Bioplasma = 'Bioplasma',\r\n\r\n    // higher-order\r\n    Alloy = \"Alloy\",\r\n    Algorithm = \"Algorithm\",\r\n\r\n    // superb\r\n    Argent = \"Argent\",\r\n    Aurum = \"Aurum\",\r\n\r\n    // hyperbolic\r\n    Omnium = \"Omnium\",\r\n}\r\n\r\nlet cStep = 0.3\r\nconst blockColors: { [key in ResourceBlock]: Color } = {\r\n    Biomass: Color.Green,\r\n    Data: Color.Blue.lighten(cStep),\r\n    Mineral: Color.Red,\r\n\r\n    Meal: Color.Yellow.darken(cStep),\r\n    Idea: Color.Blue.lighten(cStep*2), //.desaturate(cStep),\r\n    Ore: Color.Red.darken(cStep),\r\n\r\n    Bioplasma: Color.Viridian,\r\n\r\n    Alloy: Color.DarkGray.darken(cStep), //(cStep),\r\n    Algorithm: Color.Blue.darken(cStep), //.desaturate(cStep),\r\n\r\n    Argent: Color.Gray.lighten(cStep),\r\n    Aurum: Color.Orange.lighten(cStep),\r\n\r\n    Omnium: Color.White,\r\n}\r\n\r\nexport function blockColor(block: ResourceBlock) {\r\n    let baseColor = blockColors[block]\r\n    return baseColor.desaturate(0.1) //.lighten(0.1) //.desaturate(0.25).lighten(0.125)\r\n}\r\n\r\n","\r\nexport enum Orientation { Left, Up, Right, Down } //, Angle }\r\n\r\nexport const compass = [\r\n    Orientation.Left,\r\n    Orientation.Right,\r\n    Orientation.Up,\r\n    Orientation.Down,\r\n]\r\n\r\n\r\nexport function flip(orientation: Orientation): Orientation {\r\n    switch (orientation) {\r\n        case Orientation.Left: return Orientation.Right\r\n        case Orientation.Right: return Orientation.Left\r\n        case Orientation.Up: return Orientation.Down\r\n        case Orientation.Down: return Orientation.Up\r\n    }\r\n    throw new Error(`Don't know orientation ${ orientation }`)\r\n}","import { Actor, Vector, CollisionType, Color, Label, Traits, FontStyle } from \"excalibur\";\r\nimport { Planet } from \"../Planet/Planet\";\r\nimport { Structure, } from \"../../models/Structure\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip, compass } from \"../../values/Orientation\";\r\nimport { Game } from \"../../Game\";\r\nimport { Rectangle } from \"../../values/Rectangle\";\r\nimport { closest, measureDistance, deleteByValue, containsUniq, flatSingle } from \"../../Util\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { ResourceBlock, emptyMarket, Economy, sumMarkets, equilibrium, allValues, availableCapacity } from \"../../models/Economy\";\r\nimport { Device } from \"../Device\";\r\nimport { allSpaceFunctions, SpaceFunction } from \"../../models/SpaceFunction\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { World } from \"../../models/World\";\r\nimport { Machine, allMachines, CommandCenter, MissionLog, StudyMachine } from \"../../models/Machine\";\r\nimport { BackgroundPattern } from \"./BackgroundPatterns\";\r\nimport { EconomicValue } from \"../Hud/EconomicValue\";\r\nimport { drawRect, pathFromRect } from \"../../Painting\";\r\n\r\nexport class DevicePlace {\r\n    constructor(private pos: Vector, private size: DeviceSize) {}\r\n    get position() { return this.pos }\r\n    get visibleSize() { return getVisibleDeviceSize(this.size) }\r\n\r\n}\r\n\r\nexport class Building extends Actor {\r\n    edgeWidth: number = 0\r\n\r\n    nameLabel: Label\r\n\r\n    placed: boolean = false\r\n    hover: boolean = false\r\n    showLabel: boolean = false\r\n    facing: Orientation = Orientation.Right\r\n    hideBox: boolean = false\r\n    parentSlot: Slot\r\n    childrenBuildings: Building[] = []\r\n\r\n    spaceFunction: SpaceFunction\r\n\r\n    private devices: Device[] = []\r\n    givenName: string\r\n\r\n    private active: boolean = true\r\n    // private built: boolean = false\r\n\r\n    constructor(pos: Vector, public structure: Structure, public planet: Planet) {\r\n        super(\r\n          pos.x,\r\n          pos.y,\r\n          structure.width,\r\n          structure.height,\r\n          structure.infra ? planet.color.darken(0.3) : Color.Transparent\r\n        )\r\n        this.anchor = new Vector(0,0)\r\n\r\n        this.setup();\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling))\r\n\r\n        this.on('pointerenter', () => {\r\n            this.hover = true\r\n            if (!this.devices.some(d => d.hover)) {\r\n                this.planet.currentlyViewing = this\r\n            }\r\n        })\r\n\r\n\r\n        this.on('pointerdown', () => {\r\n            // console.log(\"CLICKED BUILDING\", { building: this })\r\n            this.toggleActive();\r\n        })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.hover = false\r\n        })\r\n\r\n        this.collisionType = CollisionType.PreventCollision\r\n\r\n        this.nameLabel = new Label(this.structure.name, 0, 0, 'Helvetica')\r\n        this.nameLabel.fontSize = 9\r\n        // this.nameLabel.fontStyle = FontStyle.Italic\r\n        this.nameLabel.color = Color.White\r\n\r\n        if (this.structure.infra) { this.active = true }\r\n    }\r\n\r\n    poly() { return this.aabbPoly() }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        if (!this.hideBox) {\r\n            drawRect(ctx, this.aabb(), this.edgeWidth, this.processedColor())\r\n        }\r\n        // this.devices.forEach(device => device.draw(ctx, delta))\r\n        super.draw(ctx, delta)\r\n\r\n        if (this.showLabel && this.spaceFunction) {\r\n            this.nameLabel.pos = this.pos.add(new Vector(28, 24)) //get getCenter().\r\n            // this.nameLabel.color = Color.White\r\n            // this.nameLabel.pos.x = this.getCenter().x //ctx.measureText(this.structure.name).width / 2\r\n            // this.nameLabel.pos.x -= ctx.measureText(this.structure.name).width / 2\r\n            this.nameLabel.draw(ctx, delta)\r\n\r\n        }\r\n\r\n        // let debug = true;\r\n        if (Game.debugPath) {\r\n            if (this.slots().length > 0) {\r\n                // draw slots\r\n                this.slots().forEach((slot: Slot) => {\r\n                    let rect: Rectangle = { x: slot.pos.x, y: slot.pos.y, width: 3, height: 3 }\r\n                    drawRect(ctx, rect, 1, Color.Gray.lighten(0.5))\r\n                })\r\n            }\r\n         if (this.nodes().length > 0) {\r\n                // draw nodes\r\n                this.nodes().forEach((node: Vector) => {\r\n                    let rect: Rectangle = { x: node.x, y: node.y, width: 4, height: 4 }\r\n                    drawRect(ctx, rect, 1, Color.Yellow.lighten(0.5))\r\n                })\r\n            }\r\n\r\n        }\r\n\r\n        let showDevicePlaces = false\r\n        if (showDevicePlaces && this.devicePlaces().length > 0 && this.devices.length < this.devicePlaces().length) {\r\n            this.devicePlaces().forEach(p => {\r\n                let place = p.position\r\n                let sz = p.visibleSize\r\n                drawRect(ctx,\r\n                    { x: place.x - sz/2, y: place.y - sz/2, width: sz, height: sz },\r\n                    0.1,\r\n                    Color.White,\r\n                    false,\r\n                    true\r\n                )\r\n            })\r\n        }\r\n    }\r\n\r\n\r\n    step: number = 0\r\n    update(engine: Game, delta: number) {\r\n        super.update(engine, delta)\r\n\r\n        let tryProduce = this.placed;\r\n        if (tryProduce) {\r\n            this.devices.forEach(device => device.tryProduce(this.step));\r\n        }\r\n\r\n        // this.devices.forEach(d => d.update(engine, delta))\r\n\r\n        this.step += 1\r\n    }\r\n\r\n    get name() {\r\n        if (this.spaceFunction) {\r\n            return this.spaceFunction.name\r\n        } else {\r\n            return this.structure.name\r\n        }\r\n    }\r\n\r\n    get description() {\r\n        if (this.spaceFunction) {\r\n            return this.spaceFunction.description\r\n        } else {\r\n            return this.structure.description\r\n        }\r\n    }\r\n\r\n    economy(emptyUnlessActive: boolean = true): Economy {\r\n        if (emptyUnlessActive && !this.isActive) {\r\n            return emptyMarket()\r\n        } else {\r\n            let machineEconomies = this.devices.map(d => d.economy)\r\n            //machine.economy)\r\n\r\n            let buildingEconomy = {\r\n                ...emptyMarket(),\r\n                Oxygen: { demand: 1, supply: 0 }, // structural demand\r\n                // Water: { demand: 0.1, supply: 0 },\r\n            }\r\n\r\n            let aggregate = [...machineEconomies, buildingEconomy]\r\n                .reduce(sumMarkets, emptyMarket())\r\n\r\n            return aggregate\r\n        }\r\n    }\r\n\r\n    private toggleActive() {\r\n        if (!this.structure.infra) {\r\n            if (this.active) {\r\n                if (this.devices.some(d => d.inUse)) { return }\r\n                let wasEquil = equilibrium(this.planet.economy)\r\n                this.active = false\r\n                if (wasEquil) {\r\n                    if (!equilibrium(this.planet.economy)) {\r\n                        this.active = true\r\n                        // return\r\n                    }\r\n                    // this.active = true\r\n                } else {\r\n                    // we weren't at equilibrium previously\r\n                    // permit it, if we don't have any supply that would go negative without us?\r\n                    // console.log(\"can we toggle?\")\r\n                    for (let value of allValues) {\r\n                        let localCap = availableCapacity(this.economy(false), value)\r\n                        let globalCap = availableCapacity(this.planet.economy, value)\r\n                        // console.log(\"value\", { value, localCap, globalCap})\r\n                        if (localCap > 0 && globalCap < 0) {\r\n                            // don't permit it to be turned off\r\n                            this.active = true\r\n                        }\r\n                    }\r\n                }\r\n            } else { // this.active is false now\r\n                let agg = [\r\n                    this.planet.economy,\r\n                    this.economy(false)\r\n                ].reduce(sumMarkets, emptyMarket())\r\n\r\n                if (equilibrium(agg)) {\r\n                    this.active = true\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    get isActive() { return !!this.active }\r\n\r\n\r\n    setup(): void { }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        return cursor.clone();\r\n    }\r\n    reshape(cursor: Vector): void {\r\n        this.pos = cursor.clone()\r\n    }\r\n\r\n    afterConstruct(): void {}\r\n\r\n    handleClick(_pos): boolean { return true; }\r\n\r\n    slots(): Slot[] {\r\n        return []\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n\r\n    devicePlaces(): DevicePlace[] {\r\n        return []; //this.nodes();\r\n    }\r\n\r\n    deviceInteractionPlaces(): Vector[] {\r\n        return this.devicePlaces().map(place => {\r\n            place.position.y += (place.visibleSize/2)\r\n            return place.position\r\n        })\r\n    }\r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph\r\n        // assemble subgraph\r\n        let nodes = this.nodes()\r\n        let rootNode = g.findOrCreate(nodes[0], measureDistance)\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            g.edge(rootNode, slot)\r\n\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(slot, childNode)\r\n\r\n            child.graph(g)\r\n        }\r\n        return g\r\n    }\r\n\r\n    // just a patch through to planet -- but could animate something here?\r\n    public redeem(res: ResourceBlock) {\r\n        this.planet.gather(res)\r\n    }\r\n\r\n    public debit(res: ResourceBlock) {\r\n        this.planet.spend(res)\r\n    }\r\n\r\n    public populate(pos: Vector, elite: boolean = false) {\r\n        this.planet.populate(pos, elite) //this.pos)\r\n    }\r\n\r\n    protected aabb(): Rectangle {\r\n        return {\r\n            x: this.pos.x,\r\n            y: this.pos.y,\r\n            width: this.getWidth(),\r\n            height: this.getHeight()\r\n        }\r\n    }\r\n\r\n    protected aabbPoly(): {x:number,y:number}[] {\r\n        return pathFromRect(this.aabb());\r\n\r\n    }\r\n\r\n    protected angledRoofPoly(): {x: number, y: number}[] {\r\n        let angleStartY = 1 * (this.getHeight() / 3) - 3\r\n        let angleStartX = 20 // 1 * (this.getWidth() / 10)\r\n        return [\r\n            // bottom-left\r\n            { x: this.pos.x, y: this.pos.y + this.getHeight() },\r\n\r\n            // upper-left\r\n            { x: this.pos.x, y: this.pos.y + angleStartY },\r\n            { x: this.pos.x + angleStartX, y: this.pos.y },\r\n\r\n            // upper-right\r\n            { x: this.pos.x + this.getWidth() - angleStartX, y: this.pos.y },\r\n            { x: this.pos.x + this.getWidth(), y: this.pos.y + angleStartY },\r\n\r\n            // bottom-right\r\n            { x: this.pos.x + this.getWidth(), y: this.pos.y + this.getHeight() },\r\n        ]\r\n            \r\n    }\r\n\r\n    protected overlaps(other: Building): boolean {\r\n        let rect1 = this.aabb(), rect2 = other.aabb();\r\n        let doesOverlap = (\r\n            rect1.x < rect2.x + rect2.width &&\r\n            rect1.x + rect1.width > rect2.x &&\r\n            rect1.y < rect2.y + rect2.height &&\r\n            rect1.y + rect1.height > rect2.y\r\n        )\r\n        return(!!doesOverlap);\r\n    }\r\n\r\n    public overlapsAny(): boolean {\r\n        return !!this.planet.colony.buildings.find(bldg => bldg !== this && this.overlaps(bldg))\r\n    }\r\n\r\n    protected edgeColor(): Color {\r\n        let edge = this.processedColor().lighten(0.85);\r\n        return edge;\r\n    }\r\n\r\n    protected mainColor(): Color {\r\n        let main = this.processedColor().darken(0.08);\r\n        return main;\r\n    }\r\n\r\n    protected colorBase(): Color {\r\n        return this.color;\r\n    }\r\n\r\n    protected processedColor(): Color {\r\n        let clr = this.colorBase().clone();\r\n        if (!this.placed)  { \r\n            if (this.overlapsAny()) { clr = Color.Red }\r\n            clr.a = 0.8\r\n        }\r\n        if (!this.active) {\r\n            clr = clr.darken(0.8)\r\n        }\r\n\r\n        if (this.hover) { clr.a = 0.5 }\r\n        return clr;\r\n    }\r\n\r\n    get connections() {\r\n        return this.structure.connections;\r\n    }\r\n\r\n\r\n    protected findSlot(\r\n        pos: Vector,\r\n        validConnections: { [key in Orientation]: (typeof Structure)[] } = this.connections\r\n    ): Slot {\r\n        let slotList = []\r\n            for (let dir of compass) {\r\n                const validStructures = validConnections[dir];\r\n                let flipped = flip(dir)\r\n                const buildings = validStructures.map(structure =>\r\n                    this.planet.closestBuildingByType(pos, [structure])\r\n                )\r\n                buildings.forEach(building => {\r\n                    if (building) {\r\n                        let neighborSlots = building.slots()\r\n                        neighborSlots.filter(slot => slot.facing === flipped)\r\n                        .forEach(matchingSlot => {\r\n                            slotList.push(matchingSlot)\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n\r\n        if (slotList.length > 0) {\r\n            return closest(pos, slotList, (slot) => slot.pos)\r\n        } else {\r\n            // console.warn('no conecting structures found')\r\n        }\r\n    }\r\n\r\n    protected alignToSlot(\r\n        cursor: Vector,\r\n        validConnections: { [key in Orientation]: (typeof Structure)[] } = this.connections\r\n    ) {\r\n        let theSlot = this.findSlot(cursor, validConnections)\r\n        if (theSlot) {\r\n            let matchingSlot = this.slots()\r\n                .find(s => s.facing == flip(theSlot.facing))\r\n            if (matchingSlot) {\r\n                let offset = theSlot.pos.sub(matchingSlot.pos)\r\n                this.pos.addEqual(offset)\r\n\r\n                this.parentSlot = theSlot;\r\n                return theSlot;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected buildSlot(x: number, y: number, facing: Orientation = Orientation.Right): Slot {\r\n        return {\r\n            pos: new Vector(x,y),\r\n            facing,\r\n            parent: this\r\n        }\r\n    }\r\n\r\n    public addDevice(device: Device) {\r\n        // device.finalize()\r\n        if (device.building !== this) {\r\n            device.building = this\r\n        }\r\n        this.devices.push(device)\r\n        device.pos.subEqual(this.pos) // = this.devicePlaces()[0].position\r\n        // console.log(\"DEVICE IS AT\", { pos: device.pos })\r\n        this.add(device)\r\n        this.updateFunction()\r\n        device.machine.onPlacement(device)\r\n        this.toggleActive()\r\n\r\n        device.placed = true\r\n    }\r\n\r\n    public hasPlaceForDevice() {\r\n        return this.devices.length < this.devicePlaces().length\r\n    }\r\n\r\n    public nextDevicePlace(): DevicePlace {\r\n        // could throw an err if we have no place\r\n        return this.devicePlaces()[\r\n            this.devices.length\r\n        ]\r\n    }\r\n\r\n    public getDevices() {\r\n        return [ ...this.devices, ...flatSingle(this.devices.map(d => d.tinyDevices)) ]\r\n    }\r\n\r\n    public updateFunction() {\r\n        let allTheMachines = [ StudyMachine, ...allMachines, CommandCenter, MissionLog ]\r\n        let machines = this.devices.map(\r\n            d => allTheMachines.find((m: typeof Machine) => d.machine instanceof m)\r\n        )\r\n        let fn = allSpaceFunctions.find(spaceFn => {\r\n            let sf = new spaceFn()\r\n\r\n            return containsUniq(\r\n              machines,\r\n              sf.machines\r\n            );\r\n        })\r\n        if (fn) {\r\n            // console.log(\"Determined building function\", { fn })\r\n            let sf = new fn()\r\n            this.spaceFunction = sf\r\n            this.nameLabel.text = sf.name\r\n        } else {\r\n            // console.warn(\"Could not identify function!\")\r\n        }\r\n    }\r\n\r\n    get backgroundPattern() {\r\n        if (this.spaceFunction) {\r\n            return this.spaceFunction.background\r\n        } else {\r\n            return BackgroundPattern.Grid\r\n        }\r\n    }\r\n}","import { Vector, Color } from \"excalibur\";\r\nimport { Rectangle } from \"./values/Rectangle\";\r\nimport { BackgroundPattern, getBackgroundPattern } from \"./actors/Building/BackgroundPatterns\";\r\n\r\ntype PaintingPath = { x: number, y: number }[]\r\n\r\nexport function pathFromRect(rect: Rectangle): PaintingPath {\r\n  let pos = { x: rect.x, y: rect.y }\r\n  let path = [\r\n            // bottom-left\r\n            { x: pos.x, y: pos.y + rect.height }, // this.getHeight() },\r\n\r\n            // upper-left\r\n            { x: pos.x, y: pos.y },\r\n\r\n            // upper-right\r\n            { x: pos.x + rect.width, y: pos.y },\r\n\r\n            // bottom-right\r\n            { x: pos.x + rect.width, y: pos.y + rect.height },\r\n        ];\r\n\r\n  return path\r\n}\r\n\r\n// tiny rendering lib\r\nexport function drawLine(ctx: CanvasRenderingContext2D, a: Vector, b: Vector, clr: Color = Color.White, lineWidth: number = 1) {\r\n  let c = clr.clone()\r\n  // c.a = 0.5\r\n  ctx.beginPath()\r\n  ctx.moveTo(a.x, a.y)\r\n  ctx.lineTo(b.x, b.y)\r\n  ctx.strokeStyle = c.toRGBA()\r\n  ctx.lineWidth = lineWidth\r\n  ctx.stroke()\r\n}\r\n\r\nexport function drawPatternedRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  rect: Rectangle,\r\n  pattern: BackgroundPattern = BackgroundPattern.Grid\r\n) {\r\n  const gridPattern = getBackgroundPattern(ctx, pattern)\r\n  if (gridPattern) {\r\n    drawPatternedPoly(ctx, pathFromRect(rect), pattern)\r\n    // let { x, y, width, height } = rect;\r\n    // ctx.fillStyle = gridPattern\r\n    // ctx.fillRect(x,y,width,height)\r\n\r\n    //ctx.lineWidth = 0\r\n    //ctx.setLineDash([])\r\n    //ctx.strokeStyle = Color.White.toRGBA()\r\n    //ctx.strokeRect(x,y,width,height)\r\n  }\r\n}\r\n\r\nexport function drawPatternedPoly(\r\n  ctx: CanvasRenderingContext2D,\r\n  path: {x:number, y:number}[],\r\n  // rect: Rectangle,\r\n  pattern: BackgroundPattern = BackgroundPattern.Grid,\r\n  edgeColor: Color = Color.Black\r\n) {\r\n  const gridPattern = getBackgroundPattern(ctx, pattern)\r\n  if (gridPattern) {\r\n    ctx.save()\r\n    ctx.translate(path[0].x, path[0].y)\r\n    // ctx.moveTo(0, 0)\r\n    ctx.beginPath()\r\n    ctx.moveTo(0,0) //path[0].x, path[0].y)\r\n    path.forEach(pt => ctx.lineTo(pt.x - path[0].x, pt.y-path[0].y))\r\n    ctx.lineTo(0,0) // path[0].x, path[0].y)\r\n    ctx.closePath()\r\n    // let { x, y, width, height } = rect;\r\n    ctx.fillStyle = gridPattern\r\n    ctx.fill()\r\n\r\n\r\n    ctx.strokeStyle = edgeColor.fillStyle()\r\n    ctx.stroke()\r\n    ctx.restore()\r\n    // ctx.fillRect(x,y,width,height)\r\n\r\n    // ctx.lineWidth = 2\r\n    // ctx.setLineDash([])\r\n    // ctx.strokeStyle = Color.White.toRGBA()\r\n    // ctx.strokeRect(x,y,width,height)\r\n  }\r\n}\r\n\r\nexport function drawRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  rectangle: Rectangle,\r\n  edgeWidth: number = 0,\r\n  color: Color = Color.White,\r\n  filled: boolean = true,\r\n  dashed: boolean = false\r\n) {\r\n  let { x, y, width, height } = rectangle;\r\n\r\n  if (filled) {\r\n    let main = color.clone();\r\n    // main.a = 1\r\n    ctx.fillStyle = main.toRGBA();\r\n    ctx.fillRect(\r\n      x,\r\n      y,\r\n      width,\r\n      height\r\n    )\r\n  }\r\n\r\n  if (edgeWidth > 0) {\r\n    let edge = Color.White.clone();\r\n    ctx.strokeStyle = edge.toRGBA();\r\n    ctx.lineWidth=edgeWidth\r\n    if (dashed) { ctx.setLineDash([5, 10]) }\r\n    else { ctx.setLineDash([]) }\r\n    ctx.strokeRect(\r\n      x, y, width, height\r\n    )\r\n  }\r\n}\r\n\r\nexport function drawPoly(\r\n  ctx: CanvasRenderingContext2D,\r\n  path: {x:number, y:number}[],\r\n  color: Color\r\n  // rect: Rectangle,\r\n  // pattern: BackgroundPattern = BackgroundPattern.Grid\r\n) {\r\n  // const gridPattern = getBackgroundPattern(ctx, pattern)\r\n  // if (gridPattern) {\r\n    ctx.beginPath()\r\n    ctx.moveTo(path[0].x, path[0].y)\r\n    path.forEach(pt => ctx.lineTo(pt.x, pt.y))\r\n    ctx.lineTo(path[0].x, path[0].y)\r\n    ctx.closePath()\r\n    // let { x, y, width, height } = rect;\r\n    ctx.fillStyle = color.fillStyle()\r\n    ctx.fill()\r\n    // ctx.fillRect(x,y,width,height)\r\n\r\n    // ctx.lineWidth = 2\r\n    // ctx.setLineDash([])\r\n    // ctx.strokeStyle = Color.White.toRGBA()\r\n    // ctx.strokeRect(x,y,width,height)\r\n  // }\r\n}\r\n\r\nexport function drawStar(ctx, cx, cy, outerRadius=3.6, innerRadius=1.4, spikes=5, ) {\r\n    var rot = Math.PI / 2 * 3;\r\n    var x = cx;\r\n    var y = cy;\r\n    var step = Math.PI / spikes;\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(cx, cy - outerRadius)\r\n    for (let i = 0; i < spikes; i++) {\r\n        x = cx + Math.cos(rot) * outerRadius;\r\n        y = cy + Math.sin(rot) * outerRadius;\r\n        ctx.lineTo(x, y)\r\n        rot += step\r\n\r\n        x = cx + Math.cos(rot) * innerRadius;\r\n        y = cy + Math.sin(rot) * innerRadius;\r\n        ctx.lineTo(x, y)\r\n        rot += step\r\n    }\r\n    ctx.lineTo(cx, cy - outerRadius);\r\n    ctx.closePath();\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeStyle = 'yellow';\r\n    ctx.stroke();\r\n    ctx.fillStyle = 'yellow';\r\n    ctx.fill();\r\n}","import { Engine, DisplayMode, Loader, Timer, Color } from 'excalibur';\r\nimport { World } from './models/World';\r\nimport { Resources } from './Resources';\r\n\r\nexport class Game extends Engine {\r\n  // static showTutorial: boolean = true\r\n  static citizenSpeed: number = 130\r\n  static debugPath: boolean = false\r\n  static startHour: number = 9\r\n\r\n  static minuteTickMillis: number = 800\r\n\r\n  constructor(public world: World) {\r\n    super({\r\n      width: 800,\r\n      height: 600,\r\n      displayMode: DisplayMode.FullScreen,\r\n      backgroundColor: Color.Black //world.skyColor\r\n    });\r\n  }\r\n\r\n  public start() {\r\n    let loader = new Loader();\r\n    for (let key in Resources) {\r\n      loader.addResource(Resources[key]);\r\n    }\r\n    loader.backgroundColor = '#0a0e0c'\r\n    // loader.logo = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAACwklEQVR4nO3dQXKbMBQAULvTbXYe1u30fln0IF3kfp1mzXjnA7grMoRxDBISSOi9VSYBPsrw/xdg8OkEAAAAAAAAAAAAAAAAAAAAABTjvPcOHEXfX+/P/t51l6z/61zx+/56n647Fys27qNYIeum2o+WfN97B2o2Puj+/Pq5eNlUB2PINlPHX7qNIW6OBNxz/EehAETq++t9LunHxsuu6XSx2xgvmyJ+aNzUMWsZf+kUgEBDJwlJ/qnX7hLdGVN01K67nHN25mcxUxS+YXtr92Xtdo5AAQgQ2vWfee0uH9sMmU6nOmBzdea5mGvP82sef4m+7b0DtUiZ/D9eXj5+Hs8G5uLnOFDH3bBkrY8/FwWATbWecKVRABZI2f0fmZsF5J6mlp6UrY8/JwVgRu7kH3xVBLY6Ry01CVoff24KADRMAYCGKQBP5Jr+v99uD38/PQ3Y+hbVFtPgvW57LtHiaYACAA1TAPgkZ8et4UM3pe9fagrAxr6a/h9dDcnfIh8F3lBM8u9xTpr6oZ0126x9/KVTADYSk/x7HIhLE27pcmsf2oldN1ZrFwEVgA0ccdq/5Pn7ljpprVwDyGxN8tfcjVLcUqt5/LVQAJ7ousv5999/Ueu+327Byf/WXz911q3vS5fWtVsf/xYUgAyOOOWP0eIHa2rjGkAikv6xVG8CIg8FYMZwAA9v8MllOv2fxt/ircIlJmnr48/NKcACXXc5v/XXbNv/KvnH8XNOpUt/3r728ZdMAWATrgeUSQFYKNcsYK77j+PnSKBaul/r48/FNYAA44Nw7TWBoZiEvts+1eus93gt9trz+drHXyIFIND4ddKxRWBp15+LX8LrtUOlKAKnU73jL40CEGk6JZ0rBuPTh1RfzdXyV2O1Pv5UFIAVpl83tXTZo8SPlerWXq3jBwAAAAAAAAAAAAAAAAAAAAB46D+AUA+q0Ax9RQAAAABJRU5ErkJggg=='\r\n    loader.logo = 'data:image/png;base64,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'\r\n    // loader.logo = 'data:image/png;base64,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'\r\n    // loader.logo = 'data:image/png;base64,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'\r\n    loader.logoWidth = 3 * 256\r\n    loader.logoHeight = 3 * 64\r\n\r\n    // loader.playButtonText = 'make planetfall'\r\n    loader.startButtonFactory = () => {\r\n      let myButton = document.createElement('button');\r\n      myButton.textContent = 'Make Planetfall';\r\n      myButton.style.border = 'none'\r\n      myButton.style.display = 'block'\r\n      myButton.style.padding = '14px'\r\n      myButton.style.fontFamily = 'Helvetica'\r\n      myButton.style.color = 'white'\r\n      myButton.style.fontSize = '20pt'\r\n      myButton.style.fontWeight = '300'\r\n\r\n      myButton.style.backgroundColor = '#9a5e5c'\r\n      return myButton;\r\n    };\r\n\r\n    return super.start(loader).then(() => {\r\n      console.log(\"Osiris running.\")\r\n    });\r\n  }\r\n}","import { Actor, Label, Color, Vector } from \"excalibur\";\r\nimport { Machine } from \"../models/Machine\";\r\nimport { Building } from \"./Building\";\r\nimport { ResourceBlock, blockColor, emptyMarket, sumMarkets } from \"../models/Economy\";\r\nimport { Citizen } from \"./Citizen\";\r\nimport { Planet } from \"./Planet/Planet\";\r\nimport { allStructures } from \"../models/Structure\";\r\nimport { getVisibleDeviceSize, DeviceSize } from \"../values/DeviceSize\";\r\nimport { Recipe, ResourceStorage, MechanicalOperation, ResourceGenerator, ExploreForResource } from \"../models/MechanicalOperation\";\r\nimport { range, deleteByValueOnce, closest } from \"../Util\";\r\nimport { drawRect } from \"../Painting\";\r\nimport { InteractionRequest, retrieveResource } from \"../values/InteractionRequest\";\r\nimport { Game } from \"../Game\";\r\nimport { Rectangle } from \"../values/Rectangle\";\r\n\r\nexport class Device extends Actor {\r\n    // constructionMaterials: ResourceBlock[] = []\r\n\r\n    // could also use for storage?\r\n    product: ResourceBlock[] = []\r\n    nameLabel: Label\r\n    image: HTMLImageElement\r\n    building: Building\r\n    inUse: boolean = false\r\n    hover: boolean = false\r\n\r\n    imageLoaded: boolean = false\r\n\r\n    built: boolean = false\r\n    reserved: boolean = false\r\n\r\n    constructor(\r\n        public machine: Machine,\r\n        initialPos: Vector\r\n    ) {\r\n        super(\r\n            initialPos.x,\r\n            initialPos.y,\r\n            getVisibleDeviceSize(machine.size),\r\n            getVisibleDeviceSize(machine.size),\r\n            Color.Transparent\r\n            // machine.color\r\n        )\r\n\r\n        this.nameLabel = new Label(this.machine.name, 0, 0, 'Helvetica')\r\n        this.nameLabel.fontSize = this.machine.size === DeviceSize.Tiny ? 2 : 6\r\n        this.nameLabel.color = Color.White\r\n\r\n        this.image = new Image();\r\n        this.image.onload = () => { this.imageLoaded = true }\r\n        this.image.src = machine.image\r\n\r\n        this.on('pointerenter', () => {\r\n            // console.log(\"HOVER OVER\", { machine: this.machine })\r\n            this.hover = true\r\n            let tinyDevices = this.tinyDevices.length > 0 &&\r\n              this.tinyDevices.some(d => d.hover)\r\n            if (this.building && !tinyDevices) {\r\n                this.building.planet.currentlyViewing = this\r\n            }\r\n        })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.hover = false\r\n            if (this.building && this.building.planet.currentlyViewing === this) {\r\n                this.building.planet.currentlyViewing = null\r\n            }\r\n        })\r\n    }\r\n\r\n    get imageX() { return this.pos.x - this.getWidth() / 2 }\r\n    get imageY() { return this.pos.y - this.getHeight() / 2 } //- 10 }\r\n\r\n    get economy() { return this.built ? this.computeEconomy() : emptyMarket() }\r\n\r\n    private computeEconomy() {\r\n        let econs = [ this.machine.economy, ...this.tinyDevices.map(d => d.economy) ]\r\n        return econs.reduce(sumMarkets, emptyMarket())\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        if (this.imageLoaded) {\r\n            ctx.save()\r\n            if (!this.built) { ctx.globalAlpha = 0.5 }\r\n            ctx.translate(this.imageX, this.imageY)\r\n            if (this.vel.x > 0) {\r\n                // flip? (assume we're drawn facing left)\r\n                ctx.translate(this.getWidth(), 0)\r\n                ctx.scale(-1,1)\r\n            }\r\n            ctx.drawImage(\r\n                this.image,\r\n                0,\r\n                0, //this.imageY,\r\n\r\n                this.getWidth(),\r\n                this.getHeight()\r\n            )\r\n            // if (!this.built) { ctx.globalAlpha = 1.0 }\r\n\r\n            let c = Color.Transparent.clone()\r\n            if (this.hover) {\r\n                c = Color.White.clone()\r\n                c.a = 0.5\r\n            }\r\n            if (!(this.size === DeviceSize.Tiny) && this.overlapsAny()) {\r\n                c = Color.Red.clone()\r\n                c.a = 0.3\r\n            }\r\n\r\n            // if (this.hover || this.overlapsAny()) {\r\n                // let c = Color.White.clone()\r\n                // c.a = 0.6\r\n                drawRect(\r\n                    ctx,\r\n                    { x: 0, y: 0, width: this.getWidth(), height: this.getHeight() },\r\n                    0,\r\n                    c\r\n                )\r\n            // }\r\n            ctx.restore()\r\n        }\r\n\r\n        let iv = new Vector(this.imageX, this.imageY + this.getHeight() / 8)\r\n\r\n        let showLabel = true\r\n        if (showLabel) {\r\n            this.nameLabel.pos = iv\r\n            this.nameLabel.draw(ctx, delta)\r\n        }\r\n\r\n        let { x: bx, y: by } = iv\r\n        let blockSize = 5\r\n        let yOff = this.nameLabel.fontSize\r\n        this.product.forEach((produced, index) => {\r\n            ctx.fillStyle = blockColor(produced).toRGBA()\r\n            ctx.fillRect(bx + blockSize * index, by - blockSize + yOff, blockSize-1, blockSize-1)\r\n        })\r\n\r\n        super.draw(ctx ,delta)\r\n        // this.tinyDevices.forEach(d => d.draw(ctx, delta))\r\n    }\r\n\r\n    get name() { return this.machine.name }\r\n    get description() { return this.machine.description }\r\n    get size() { return this.machine.size }\r\n    get operation() { return this.machine.operation }\r\n\r\n    async assemble(citizen: Citizen) {\r\n        if (citizen.isCarryingUnique(this.machine.cost)) {\r\n            for (let res of this.machine.cost) {\r\n                citizen.drop(res)\r\n                await citizen.progressBar(3000)\r\n            }\r\n            this.built = true\r\n        }\r\n    }\r\n\r\n    async interact(citizen: Citizen, request: InteractionRequest): Promise<boolean> {\r\n        if (this.inUse || !this.built) {\r\n            return false\r\n        }\r\n\r\n        let worked = false\r\n        let op = this.operation\r\n        if (op.type === 'recipe' && request.type === 'work') {\r\n            let recipe: Recipe = op\r\n            // do we have all the things?\r\n            if (citizen.carrying.some(it => recipe.consumes.includes(it))) {\r\n                this.inUse = true\r\n                if (citizen.isCarryingUnique(recipe.consumes)) {\r\n                    recipe.consumes.forEach(consumed => citizen.drop(consumed))\r\n                    let workTime = this.getEffectiveWorkTime(recipe)\r\n                    await citizen.progressBar(workTime) // recipe.workTime)\r\n                    citizen.carry(recipe.produces)\r\n\r\n                    worked = true\r\n                } else {\r\n                    console.warn(\"not carrying all requirements?\", { requires: recipe.consumes, has: citizen.carrying })\r\n                }\r\n                this.inUse = false\r\n            }\r\n        } else if ((op.type === 'store' || op.type === 'explore') && (request.type === 'retrieve' || request.type === 'store')) {\r\n            // accept it! (whatever you have that matches...?)\r\n            let storeOrExplore: ResourceStorage | ExploreForResource = op\r\n            if (request && request.type === 'retrieve') { // assume dispense request for now?\r\n                this.inUse = true\r\n                await citizen.progressBar(1000)\r\n                worked = this.dispense(citizen, request)\r\n                //if (worked) {\r\n                //    await citizen.progressBar(500)\r\n                //}\r\n                this.inUse = false\r\n            } else {\r\n                if (storeOrExplore.type === 'store') {\r\n                    let store: ResourceStorage = storeOrExplore\r\n                    if (request.type === 'store' &&\r\n                        citizen.carrying.some(it => store.stores.includes(it))) { // maybe trying to store?\r\n                        if (this.product.length < this.getEffectiveOperationalCapacity(store)) { // store.capacity) {\r\n                            let res = null\r\n                            if (store.stores.some(stored => { res = citizen.drop(stored); return res })) {\r\n                                if (res) {\r\n                                    this.produceResource(res)\r\n                                    // this.product.push(res)\r\n                                    // this.building.redeem(res)\r\n                                    worked = true\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    console.warn(\"no capacity in this store!!\")\r\n                    worked = false\r\n                }\r\n            }\r\n        } else if (op.type === 'generator') {\r\n            this.inUse = true\r\n            worked = this.dispense(citizen, request)\r\n            if (worked) {\r\n                await citizen.progressBar(500)\r\n            }\r\n            this.inUse = false\r\n        } else if (op.type === 'explore') {\r\n            this.inUse = true\r\n            // this.add(citizen)\r\n            // if (this.product.length < this.getEffectiveOperationalCapacity(op)) {\r\n            let origX = this.pos.x\r\n            let groundSpeed = Game.citizenSpeed * 3\r\n            citizen.driving = this\r\n            // let oldAnchor = citizen.anchor\r\n            // citizen.anchor = this.anchor\r\n            let xOff = 5000 * (Math.random() > 0.5 ? -1 : 1)\r\n            await this.actions.moveTo(this.pos.x + xOff, this.pos.y, groundSpeed).asPromise()\r\n            // for (let times in range(op.capacity)) {\r\n            this.produceResource(op.gathers)\r\n            // }\r\n            await this.actions.moveTo(origX, this.pos.y, groundSpeed).asPromise()\r\n            worked = true\r\n            citizen.driving = null\r\n            // citizen.anchor = oldAnchor\r\n\r\n            this.inUse = false\r\n\r\n            //await this.interact(citizen, retrieveResource(op.gathers))\r\n            // }\r\n            // this.remove(citizen)\r\n        }\r\n\r\n        return worked\r\n    }\r\n\r\n\r\n\r\n    getEffectiveOperationalCapacity(op: ResourceGenerator | ResourceStorage | ExploreForResource) {\r\n        let bonus = this.building.spaceFunction\r\n            ? this.building.spaceFunction.bonuses.capacity \r\n        : 0\r\n        return op.capacity + bonus\r\n    }\r\n\r\n    getEffectiveWorkTime(op: Recipe) {\r\n        let bonus = this.building.spaceFunction \r\n         ? this.building.spaceFunction.bonuses.workSpeed\r\n         : 1\r\n\r\n        return Math.round(op.workTime * (1/bonus))\r\n    } \r\n\r\n\r\n    private dispense(citizen: Citizen, request: InteractionRequest) {\r\n        if (request && request.type === 'retrieve') {\r\n            let canFulfill = this.product.find(p => p === request.resource)\r\n            if (canFulfill) {\r\n                deleteByValueOnce(this.product, request.resource)\r\n                citizen.carry(request.resource)\r\n                this.building.debit(request.resource)\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    }\r\n\r\n    public tryProduce(step: number) {\r\n        if (this.building.isActive && this.built) {\r\n            if (this.machine.operation.type === 'generator') {\r\n                if (step % this.machine.operation.generationTime === 0) {\r\n                    if (this.product.length < this.machine.operation.capacity) {\r\n                        this.produceResource(this.machine.operation.generates)\r\n                    }\r\n                }\r\n\r\n            } else if (this.machine.operation.type === 'spawn') {\r\n                if (step % 1000 == 0) {\r\n                    // console.log(\"WOULD SPAWN\")\r\n                    setTimeout(() => this.building.populate(this.pos.add(this.building.pos)), 100)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public produceResource(res: ResourceBlock) {\r\n        this.product.push(res)\r\n        this.building.redeem(res)\r\n    }\r\n\r\n    snap(planet: Planet, pos: Vector = this.pos) {\r\n        if (this.size === DeviceSize.Tiny) {\r\n            return this.snapTiny(planet, pos)\r\n        } else {\r\n            let bldg = planet.colony.closestBuildingByType(pos,\r\n                allStructures,\r\n                (bldg: Building) => {\r\n                    // let hasSpace = bldg.hasPlaceForDevice()\r\n                    let compatible = bldg.structure.machines.some(Machine => this.machine instanceof Machine)\r\n                    return compatible\r\n\r\n                }\r\n            )\r\n\r\n            let snapped = false\r\n            if (bldg) {\r\n                let spot = bldg.getCenter() //.y //+ bldg.flo //nextDevicePlace().position\r\n                let d = spot.distance(pos) //Math.abs(spotY - pos.y) //.distance(pos)\r\n                snapped = d < (bldg.getWidth()/2 - getVisibleDeviceSize(this.size)/2) && (Math.abs(spot.y - pos.y) < 50)\r\n            }\r\n\r\n            if (snapped) {\r\n                this.building = bldg;\r\n                this.pos = pos //.x //this.building.nextDevicePlace().position\r\n                this.pos.y = bldg.getCenter().y + (bldg.getHeight()/8)\r\n            } else {\r\n                this.pos = pos\r\n            }\r\n\r\n            // let overlapping = !this.overlapsAny()\r\n\r\n            return snapped // && !overlapping\r\n        }\r\n    }\r\n\r\n    public overlapsAny(): boolean {\r\n        if (this.building) {\r\n            return !!this.building.planet.colony.findAllDevices().find(device => device !== this && this.overlaps(device))\r\n        } else {\r\n            return true\r\n        }\r\n    }\r\n\r\n    private overlaps(other: Device): boolean {\r\n        let rect1 = this.aabb(), rect2 = other.aabb();\r\n        let doesOverlap = (\r\n            rect1.x < rect2.x + rect2.width &&\r\n            rect1.x + rect1.width > rect2.x &&\r\n            rect1.y < rect2.y + rect2.height &&\r\n            rect1.y + rect1.height > rect2.y\r\n        )\r\n        return(!!doesOverlap);\r\n    }\r\n\r\n    placed: boolean = false\r\n    private aabb(): Rectangle {\r\n        let pos = this.pos.clone()\r\n        if (this.placed) {\r\n            pos.addEqual(this.building.pos)\r\n        }\r\n        return {\r\n            x: pos.x,\r\n            y: pos.y,\r\n            width: this.getWidth(),\r\n            height: this.getHeight()\r\n        }\r\n    }\r\n    // private overlapsAny()\r\n\r\n    private snapTiny(planet: Planet, pos: Vector) {\r\n        // okay, we need the closest building with any built machine that HAS a tiny slot\r\n        let bldg = planet.colony.closestBuildingByType(pos,\r\n            allStructures,\r\n            (bldg: Building) => bldg.getDevices().some(\r\n                (device: Device) => device.built && device.hasTinyPlace()\r\n            )\r\n        )\r\n\r\n        // todo look at all devices? (closest bldg may not house closest device!!)\r\n        let device: Device = closest(\r\n            pos,\r\n            bldg.getDevices().filter((d: Device) => d.built && d.hasTinyPlace()),\r\n            (d: Device) => d.pos,\r\n        )\r\n\r\n        this.pos = pos\r\n        let snapped = false\r\n        if (device) {\r\n            let spot = device.nextTinyPlace().add(device.pos).add(device.building.pos)\r\n            let d = spot.distance(pos)\r\n            snapped = d < 50\r\n\r\n            if (snapped) {\r\n                this.building = device.building\r\n                this.parentDevice = device\r\n                this.pos = spot\r\n            }\r\n        }\r\n\r\n        return snapped\r\n    }\r\n\r\n    public parentDevice: Device = null\r\n    tinyDevices: Device[] = []\r\n    private hasTinyPlace() {\r\n        if (!this.machine.tinySlots) {\r\n            return false\r\n        } else {\r\n            return this.tinyDevices.length < 3\r\n        }\r\n    }\r\n\r\n    private nextTinyPlace() {\r\n        let tx0 = -this.getWidth()/3, ty0 = -3\r\n        let ndx = this.tinyDevices.length\r\n        return new Vector(tx0 + (ndx * 14), ty0)\r\n    }\r\n\r\n    public addTinyDevice(device: Device) {\r\n        // console.log(\"ADD TINY DEVICE\", { device: device.machine })\r\n        device.pos = this.nextTinyPlace() //.add(this.pos)\r\n        // device.pos.addEqual(this.pos.add(this.nextTinyPlace()))\r\n        this.tinyDevices.push(device)\r\n        this.add(device)\r\n    }\r\n}","import { Color } from 'excalibur';\r\nimport { ResourceBlock } from './Economy';\r\nimport { Scale } from '../values/Scale';\r\nimport { Orientation } from '../values/Orientation';\r\nimport { Machine, Bookshelf, CommandCenter, CloningVat, OxygenExtractor, WaterCondensingMachine, Desk, AlgaeVat, Stove, Bed, Fridge, ResearchServer, Orchard, Cabin, SolarCell, Arbor, Megafabricator, MiningDrill, Preserve, Workstation, Houseplant, Fabricator, LogicCrystal, Microcity, allMachines } from './Machine';\r\nimport { SpaceFunction } from './SpaceFunction';\r\nimport { DeviceSize } from '../values/DeviceSize';\r\n\r\nconst { major, minor } = Scale\r\n\r\nconst smallMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Small)\r\nconst mediumMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Medium)\r\nconst largeMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Large)\r\nconst hugeMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Huge)\r\n\r\nconst smallDome = smallMachines.filter(machine => (new machine()).forDome)\r\nconst smallBelow = smallMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst midDome = mediumMachines.filter(machine => (new machine()).forDome)\r\nconst midBelow = mediumMachines.filter(machine => !(new machine()).forDome && !(new machine()).isVehicle)\r\n\r\nconst largeDome = largeMachines.filter(machine => (new machine()).forDome)\r\nconst largeBelow = largeMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst hugeDome = hugeMachines.filter(machine => (new machine()).forDome)\r\nconst hugeBelow = hugeMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst medGroundVehicles = mediumMachines.filter(machine => (new machine()).isVehicle)\r\n\r\nexport class Structure {\r\n    name: string = '(structure name)';\r\n    description: string = '(structure description)';\r\n    view: string = '<structure (room) view>';\r\n    width: number = 10\r\n    height: number = 10\r\n    zoom: number = 1\r\n    color: Color = Color.Gray\r\n    infra: boolean = false\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Corridor ],\r\n        [Orientation.Right]: [ Corridor ],\r\n        [Orientation.Up]: [ Ladder ],\r\n        [Orientation.Down]: [ Ladder ],\r\n    }\r\n\r\n    machines: (typeof Machine)[] = []\r\n    prereqs: (typeof Structure)[] = []\r\n\r\n\r\n    hide: boolean = false\r\n}\r\n\r\n\r\nexport class MainTunnel extends Structure {\r\n    name: string = 'Main Tunnel';\r\n    description: string = 'Elevating';\r\n    view: string = 'TunnelView';\r\n    width: number = major.fifth\r\n    height: number = major.eighth\r\n    zoom = 0.25\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Corridor ],\r\n        [Orientation.Right]: [ Corridor ],\r\n        [Orientation.Up]: [ MediumSurfaceRoom ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n    infra = true\r\n}\r\n\r\n\r\nexport class SurfaceRoad extends Structure {\r\n    name: string = 'Road'\r\n    description: string = 'go for a walk'\r\n    view: string = 'SurfaceRoadView'\r\n    width: number = minor.fifth\r\n    height: number = minor.first\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Dome, MediumSurfaceRoom ],\r\n        [Orientation.Right]: [  Dome, MediumSurfaceRoom ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n    infra = true\r\n}\r\n\r\nexport class Corridor extends Structure {\r\n    name: string = 'Corridor'\r\n    description: string = 'in the hallway'\r\n    view: string = 'CorridorView'\r\n    width: number = minor.fifth\r\n    height: number = minor.seventh\r\n    zoom = 0.5\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [\r\n            MainTunnel,\r\n            CommonArea,\r\n            Ladder,\r\n        ],\r\n        [Orientation.Right]: [\r\n            MainTunnel,\r\n            CommonArea,\r\n            Ladder,\r\n        ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n    prereqs = [SurfaceRoad] //MainTunnel]\r\n    infra = true\r\n}\r\n\r\nexport class Ladder extends Structure {\r\n    name = 'Ladder'\r\n    description = 'connect vertically'\r\n    view = 'LadderView'\r\n    width = major.second\r\n    height = major.third\r\n    zoom = 0.5\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Up]: [ CommonArea ],\r\n        [Orientation.Down]: [ CommonArea ],\r\n        [Orientation.Left]: [ ],\r\n        [Orientation.Right]: [ ],\r\n    }\r\n    prereqs = [Corridor, SmallRoomThree]\r\n    infra = true\r\n}\r\n\r\n// 'abstract' structure...\r\n\r\nclass Dome extends Structure {\r\n    description: string = 'Biome sweet biome';\r\n\r\n    view: string = 'DomeView';\r\n    width: number  = 2 * major.sixth\r\n    height: number = major.fifth\r\n    zoom = 0.2\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ SurfaceRoad ],\r\n        [Orientation.Right]: [ SurfaceRoad ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n\r\n    machines = [\r\n        SolarCell,\r\n        OxygenExtractor, WaterCondensingMachine,\r\n    ]\r\n}\r\n\r\n// common subsurface room...\r\nclass CommonArea extends Structure {\r\n    name: string = 'Commons'\r\n    description: string = 'hallway cap'\r\n    view: string = 'CommonAreaView'\r\n    width: number = major.eighth\r\n    height: number = major.fifth\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [\r\n            Corridor, CommonArea\r\n            ],\r\n        [Orientation.Right]: [\r\n            Corridor,\r\n            CommonArea,\r\n        ],\r\n        [Orientation.Up]: [ Ladder ],\r\n        [Orientation.Down]: [ Ladder ],\r\n    }\r\n\r\n    machines = []\r\n\r\n    prereqs = [\r\n    ]\r\n}\r\n\r\nexport class SmallRoomTwo extends CommonArea {\r\n    name = 'Sm. Room (2)'\r\n    width = major.eighth\r\n    height = major.fifth\r\n    prereqs = [ SmallDome ]\r\n    machines = smallBelow\r\n}\r\n\r\nexport class SmallRoomThree extends CommonArea {\r\n    name = 'Sm. Room (3)'\r\n    prereqs = [SmallRoomTwo]\r\n    view = 'SmallRoomThreeView'\r\n    width = 2 * major.eighth\r\n    height = major.eighth\r\n    machines = smallBelow\r\n}\r\n\r\nexport class MediumRoom extends CommonArea {\r\n    name = 'Mid Room'\r\n    prereqs = [ SmallRoomThree ]\r\n    view = 'MediumRoomView'\r\n    width = 2 * major.eighth\r\n    machines = [ ...midBelow, ...smallBelow ]\r\n}\r\n\r\nexport class MediumRoomThree extends CommonArea {\r\n    name = 'Mid Room (3)'\r\n    prereqs = [ MediumRoom ]\r\n    view = 'MediumRoomThreeView'\r\n    width = 3 * major.eighth\r\n    height = major.eighth\r\n\r\n    machines = [ ...midBelow, ...smallBelow ]\r\n}\r\n\r\nexport class LargeRoom extends CommonArea {\r\n    name = 'Lg. Room'\r\n    view = 'LargeRoomView'\r\n    prereqs = [ MediumRoom ]\r\n    width = 4 * major.eighth\r\n    height = 2*major.eighth\r\n    machines = [ ...largeBelow, ...midBelow, ...smallBelow ]\r\n}\r\n\r\nexport class HugeRoom extends CommonArea {\r\n    name = 'Huge Room'\r\n    view = 'HugeRoomView'\r\n    width = 10 * major.eighth\r\n    height = 8 * major.eighth\r\n\r\n    prereqs = [LargeRoom]\r\n    machines = hugeBelow\r\n}\r\n\r\n/// surface bldgs\r\n\r\nexport class MediumSurfaceRoom extends Dome {\r\n    name = 'Mid Surf Bldg'\r\n    description = 'home away from home';\r\n\r\n    view: string = 'MediumSurfaceRoomView';\r\n\r\n    width: number = 4 * major.eighth\r\n    height: number = major.seventh\r\n\r\n    zoom = 0.1\r\n\r\n    prereqs = [ SmallDome ]\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ SurfaceRoad ],\r\n        [Orientation.Right]: [ SurfaceRoad ],\r\n        [Orientation.Up]: [ MainTunnel, MediumSurfaceRoom ],\r\n        [Orientation.Down]: [ MainTunnel, MediumSurfaceRoom ],\r\n    }\r\n\r\n    machines = [ ...midBelow, ...smallBelow ]\r\n\r\n    // hide = false // need another one which cares about connecting to roads...\r\n}\r\n\r\nexport class SmallDome extends Dome {\r\n    name = 'Sm. Dome'\r\n    width = 2 * major.fifth\r\n    // height = major.seventh\r\n    machines = smallDome\r\n}\r\n\r\nexport class SmallDomeThree extends Dome {\r\n    name = 'Sm. Dome (3)'\r\n    view = 'SmallDomeThreeView'\r\n    width = 3 * major.fifth\r\n    // height = 2*major.fifth\r\n    machines = smallDome\r\n}\r\n\r\nexport class MidDome extends Dome {\r\n    name = 'Mid Dome'\r\n    view = 'MidDomeView'\r\n    width = 3 * major.seventh\r\n    // height = 2 * major.seventh\r\n    prereqs = [ SmallDome, MediumRoom ]\r\n    machines = [ ...midDome, ...smallDome ]\r\n}\r\n\r\nexport class LargeDome extends Dome {\r\n    name = 'Lg. Dome'\r\n    view = 'BigDomeView'\r\n    width = 4 * major.eighth\r\n    // height = 3 * major.eighth\r\n    prereqs = [MidDome, LargeRoom]\r\n    machines = [ ...largeDome, ...midDome, ...smallDome ]\r\n}\r\n\r\nexport class Arcology extends Dome {\r\n    name = 'Arcology'\r\n    view = 'ArcologyView'\r\n    width = 12 * major.eighth\r\n    height = 36 * major.eighth\r\n    prereqs = [LargeDome, HugeRoom]\r\n    machines = hugeDome\r\n\r\n}\r\n\r\n/// vehicles...!\r\n\r\nexport class GroundVehiclePool extends Dome {\r\n    name = 'Veh. Pool'\r\n    // view = 'G'\r\n    width = 2 * major.eighth\r\n    height = minor.second\r\n    machines = medGroundVehicles\r\n}\r\n\r\n\r\nexport const allStructures =\r\n    [\r\n        SmallDome,\r\n        SmallDomeThree,\r\n        MidDome,\r\n        LargeDome,\r\n        Arcology,\r\n        MediumSurfaceRoom,\r\n\r\n        SmallRoomTwo,\r\n        SmallRoomThree,\r\n        MediumRoom,\r\n        MediumRoomThree,\r\n        LargeRoom,\r\n        HugeRoom,\r\n\r\n        GroundVehiclePool,\r\n    ]\r\n\r\n\r\n","const majorUnit = 16\r\nconst minorUnit = 4\r\n\r\nconst majorScale = {\r\n    first: majorUnit,\r\n    second: majorUnit * 2,\r\n    third: majorUnit * 3,\r\n    fourth: majorUnit * 4,\r\n    fifth: majorUnit * 5,\r\n    sixth: majorUnit * 6,\r\n    seventh: majorUnit * 7,\r\n    eighth: majorUnit * 8,\r\n}\r\n\r\nconst minorScale = {\r\n    first:   minorUnit,\r\n    second:  minorUnit * 2,\r\n    third:   minorUnit * 3,\r\n    fourth:  minorUnit * 4,\r\n    fifth:   minorUnit * 5,\r\n    sixth:   minorUnit * 6,\r\n    seventh: minorUnit * 7,\r\n    eighth:  minorUnit * 8,\r\n}\r\n\r\nexport const Scale = {\r\n    major: majorScale,\r\n    minor: minorScale\r\n}","import { Machine, OxygenExtractor, WaterCondensingMachine, CloningVat, Bookshelf, Desk, Bed, Stove, AlgaeVat, ResearchServer, Fridge, SolarCell, Arbor, Cabin, Workstation, Fabricator, Houseplant, Orchard, Megafabricator, StudyMachine, Mainframe, CommandCenter, MissionLog, Botany, OrientationConsole, PersonnelRegistry, MineralProcessor, MiningDrill, HoloProjector, TimeCrystal, Couch, Statue } from './Machine';\r\nimport { Color } from 'excalibur';\r\nimport { Structure, MediumSurfaceRoom } from './Structure';\r\nimport { BackgroundPattern } from '../actors/Building/BackgroundPatterns';\r\n\r\nexport class SpaceFunction {\r\n     name: string = '(generic)'\r\n     description: string = '(generic description)'\r\n     machines: (typeof Machine)[] = []\r\n     color: Color = Color.Gray\r\n\r\n     prereqs: (typeof SpaceFunction)[] =  [] \r\n\r\n     structure: typeof Structure = null\r\n     hide: boolean = false\r\n     background: BackgroundPattern = BackgroundPattern.Beige\r\n\r\n     bonuses: {\r\n          capacity: number, // every store/generator gets this??\r\n          workSpeed: number, // 2 should double work speed (dur *= 1/multiplier)\r\n     } = {\r\n          capacity: 0, // boost cap by one\r\n          workSpeed: 1.00 // 20% bonus to work speed\r\n     }\r\n}\r\n\r\nexport class MissionControl extends SpaceFunction {\r\n     hide = true\r\n     name = 'Mission Control'\r\n     description = 'keeping everything on track'\r\n     structure = MediumSurfaceRoom\r\n     prereqs = [] //ComputerCore, Factory, Farm ]\r\n     machines = [ CommandCenter, MissionLog ]\r\n     background = BackgroundPattern.Window\r\n}\r\n\r\nexport class LivingQuarters extends SpaceFunction {\r\n     name = 'Living Quarters'\r\n     description = 'good night'\r\n     machines = [ Bed ]\r\n}\r\n\r\nclass Barracks extends SpaceFunction {\r\n     name = 'Barracks'\r\n     description = 'sleep tight'\r\n     machines = [ Bed, Bed, Bed ]\r\n}\r\n\r\nexport class Kitchen extends SpaceFunction {\r\n     name = 'Kitchen'\r\n     description = 'stay together'\r\n     machines = [ Stove, Fridge ]\r\n     bonuses = {\r\n          capacity: 2,\r\n          workSpeed: 1.1\r\n     }\r\n     background = BackgroundPattern.Checker\r\n}\r\n\r\nexport class LifeSupportPod extends SpaceFunction {\r\n     name = 'Life Support'\r\n     description = 'keep it going'\r\n     machines = [ OxygenExtractor, WaterCondensingMachine ]\r\n}\r\n\r\nclass Retreat extends SpaceFunction {\r\n     name = 'Retreat'\r\n     description = 'take it easy'\r\n     machines = [ Cabin, Cabin ]\r\n}\r\n\r\nexport class CloneMatrix extends SpaceFunction {\r\n     name = 'Clone Matrix'\r\n     description = 'clone home'\r\n     machines = [ CloningVat, CloningVat ]\r\n}\r\n\r\nexport class CloneReception extends SpaceFunction {\r\n     name = 'Clone Reception'\r\n     description = 'welcome clone'\r\n     machines = [ CloningVat, OrientationConsole, PersonnelRegistry ]\r\n}\r\n\r\nclass ReadingRoom extends SpaceFunction {\r\n     name = 'Reading Room'\r\n     description = 'butterflies in the sky'\r\n     machines = [ Bookshelf, Bookshelf ]\r\n}\r\n\r\nexport class Library extends SpaceFunction {\r\n     name = 'Library'\r\n     description = 'take a look'\r\n     machines = [ Bookshelf, Bookshelf, Bookshelf ]\r\n     background = BackgroundPattern.Books\r\n}\r\n\r\nexport class Study extends SpaceFunction {\r\n     name = 'Study'\r\n     description = 'plan it out'\r\n     machines = [ StudyMachine, Bookshelf ]\r\n     background = BackgroundPattern.Wood\r\n}\r\n\r\nclass ComputerLab extends SpaceFunction {\r\n     name = 'Computer Lab'\r\n     description = 'make it happen'\r\n     machines = [ Workstation, Workstation, Workstation ]\r\n}\r\n\r\nexport class Archive extends SpaceFunction {\r\n     name = 'Archive'\r\n     description = 'write it down'\r\n     machines = [ ResearchServer, ResearchServer ]\r\n}\r\n\r\nclass Arboretum extends SpaceFunction {\r\n     name = 'Arboretum'\r\n     description = 'walk it out'\r\n     machines = [ Arbor, Arbor ]\r\n}\r\n\r\nclass AlgaeFarm extends SpaceFunction {\r\n     name = 'Algae Farm'\r\n     description = 'make do'\r\n     machines = [ AlgaeVat, AlgaeVat ]\r\n}\r\n\r\nexport class SolarArray extends SpaceFunction {\r\n     name = 'Solar Array'\r\n     description = 'warm up'\r\n     machines = [ SolarCell, SolarCell ]\r\n}\r\n\r\nexport class Workshop extends SpaceFunction {\r\n     name = 'Workshop'\r\n     description = 'take form'\r\n     machines = [ Fabricator, Fabricator ]\r\n}\r\n\r\nclass Nursery extends SpaceFunction {\r\n     name = 'Nursery'\r\n     description = 'quiet please'\r\n     machines = [ Houseplant, Houseplant, Houseplant ]\r\n     background = BackgroundPattern.Leafy\r\n}\r\n\r\nclass Farm extends SpaceFunction {\r\n     name = 'Farm'\r\n     description = 'food for the masses'\r\n     machines = [ Orchard, Orchard ]\r\n}\r\n\r\nclass Factory extends SpaceFunction {\r\n     name = 'Factory'\r\n     description = 'production lines'\r\n     machines = [ Megafabricator, Megafabricator ]\r\n}\r\n\r\n\r\nexport class ComputerCore extends SpaceFunction {\r\n     name = 'Computer Core'\r\n     description = 'let us calculate'\r\n     machines = [ Mainframe, Mainframe ]\r\n     background = BackgroundPattern.Tech\r\n}\r\n\r\nexport class LifeSciencesLab extends SpaceFunction {\r\n     name = 'Life Sciences Lab'\r\n     description = 'where do i come from'\r\n     machines = [ Botany, Botany ]\r\n}\r\n\r\nexport class Refinery extends SpaceFunction {\r\n     name = 'Refinery'\r\n     description = 'separation'\r\n     machines = [ MineralProcessor ]\r\n}\r\n\r\nexport class Mine extends SpaceFunction {\r\n     name = 'Mine'\r\n     description = 'ore from the stone'\r\n     machines = [ MiningDrill ]\r\n}\r\n\r\nexport class HoloMatrix extends SpaceFunction {\r\n     name = 'Hologram Matrix'\r\n     description = 'dream it'\r\n     machines = [ HoloProjector, HoloProjector ]\r\n}\r\n\r\nexport class TimeChamber extends SpaceFunction {\r\n     name = 'Time Chamber'\r\n     description = 'believe it'\r\n     machines = [ TimeCrystal, TimeCrystal ]\r\n}\r\n\r\n// export class DreamMatrix extends \r\n\r\nexport class LivingRoom extends SpaceFunction {\r\n     name = 'Living Room'\r\n     description = 'just relax'\r\n     machines = [ Couch, Couch ]\r\n}\r\n\r\nexport class Statuary extends SpaceFunction {\r\n     name = 'Statuary'\r\n     description = 'to remember'\r\n     machines = [ Statue, Statue, Statue ]\r\n}\r\n\r\nexport const allSpaceFunctions = [\r\n    Library,\r\n    Barracks,\r\n    LifeSupportPod,\r\n    CloneMatrix,\r\n    LivingQuarters,\r\n    Kitchen,\r\n    AlgaeFarm,\r\n    Archive,\r\n    Arboretum,\r\n    SolarArray,\r\n    Retreat,\r\n    Study,\r\n    Workshop,\r\n    ReadingRoom,\r\n    Nursery,\r\n    Farm,\r\n    Factory,\r\n    ComputerLab,\r\n\r\n    ComputerCore,\r\n\r\n    MissionControl,\r\n    LifeSciencesLab,\r\n\r\n    CloneReception,\r\n    \r\n    Refinery,\r\n    Mine,\r\n    HoloMatrix,\r\n    TimeChamber,\r\n\r\n    LivingRoom,\r\n    Statuary,\r\n]","import { Citizen } from \"../actors/Citizen\";\r\nimport { Planet } from \"../actors/Planet/Planet\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { sleep } from \"../Util\";\r\nimport { ResourceBlock } from \"../models/Economy\";\r\nimport { retrieveResource, drive } from \"../values/InteractionRequest\";\r\nimport { Recipe, MechanicalOperation, ExploreForResource } from \"../models/MechanicalOperation\";\r\n\r\nexport abstract class Strategy {\r\n    private sleepInterval: number = 150\r\n    protected isActive: boolean = false;\r\n    constructor(protected pawn: Citizen) { }\r\n\r\n    protected abstract async apply();\r\n    abstract canApply(): boolean;\r\n\r\n    protected get planet(): Planet { return this.pawn.currentPlanet; }\r\n    protected get devices(): Device[] { return this.planet.colony.findPoweredDevices(); }\r\n    protected get operations(): MechanicalOperation[] { return this.devices.map(d => d.operation); }\r\n    protected get recipes(): Recipe[] {\r\n        let recipes: Recipe[] = [];\r\n        this.operations.forEach(op => {\r\n            if (op.type === 'recipe') {\r\n                recipes.push(op);\r\n            }\r\n        });\r\n        return recipes;\r\n    }\r\n\r\n    protected get explorers(): ExploreForResource[] {\r\n        let explores: ExploreForResource[] = []\r\n        this.operations.forEach(op => {\r\n            if (op.type === 'explore') {\r\n                explores.push(op)\r\n            }\r\n        })\r\n        return explores;\r\n    }\r\n\r\n\r\n    async attempt(): Promise<void> {\r\n        if (this.isActive) {\r\n            return;\r\n        }\r\n        if (!this.isActive) {\r\n            this.isActive = true\r\n            // note apply will need to set this.isActive around its critical section\r\n            await this.apply();\r\n            this.isActive = false\r\n        }\r\n\r\n        // await this.pause()\r\n        // setInterval(() => { this.attempt() }, this.sleepInterval)\r\n    }\r\n\r\n    protected async pause() {\r\n        await sleep(this.sleepInterval)\r\n    }\r\n\r\n    protected async gatherBlock(res: ResourceBlock): Promise<boolean> {\r\n        let gathered = false\r\n        let generatesDesiredBlock = (d: Device) => (d.operation.type === 'generator') &&\r\n            d.product.some(stored => res === stored) //&& !d.inUse\r\n        let gen: Device = this.planet.colony.closestDeviceByType(this.pawn.pos, [], generatesDesiredBlock)\r\n\r\n        let storesDesiredBlock = (d: Device) => (d.operation.type === 'store') &&\r\n              d.product.some(stored => res === stored) //&& !d.inUse\r\n        let store: Device = this.planet.colony.closestDeviceByType(this.pawn.pos, [], storesDesiredBlock)\r\n\r\n        let device: Device = gen || store\r\n\r\n        if (device) {\r\n            // device.inUse = true\r\n            await this.visitDevice(device)\r\n\r\n            if (device.inUse) {\r\n                // at least wait a bit and try again?\r\n                let waitTimes = 0\r\n                while (device.inUse) {\r\n                    await this.pause() //sleep(5000) //this.pause()\r\n                    if (waitTimes++ > 10) {\r\n                        return false \r\n                    }\r\n                }\r\n            }\r\n\r\n            if (await device.interact(this.pawn, retrieveResource(res))) {\r\n                gathered = true\r\n            }\r\n        } else {\r\n            console.warn(\"Didn't gather...\")\r\n            // don't work sub-recipes??\r\n            // let recipe = this.recipes.find(recipe => recipe.produces === res);\r\n            // if (recipe) {\r\n                // gathered = await this.workRecipe(recipe);\r\n                // gathered = true\r\n            // }\r\n        }\r\n\r\n        return gathered\r\n    }\r\n\r\n    protected async visitDevice(device: Device) {\r\n        await this.pawn.visit(device)\r\n    }\r\n\r\n    protected async workExploration(exploring: ExploreForResource): Promise<boolean> {\r\n        let knowsHow = (d: Device) => d.operation === exploring && !d.reserved\r\n        let vehicle = this.planet.colony.closestDeviceByType(this.pawn.pos, [], knowsHow)\r\n        let explored = false\r\n        if (vehicle) {\r\n            vehicle.reserved = true\r\n            if (await this.drive(vehicle, exploring)) {\r\n                explored = true\r\n            }\r\n\r\n            vehicle.reserved = false\r\n        }\r\n        return explored\r\n    }\r\n\r\n    private async drive(vehicle: Device, exploring: ExploreForResource) {\r\n        let driven = false\r\n        if (!vehicle.machine.isVehicle) {\r\n            throw new Error(\"Tried to drive a device that wasn't a vehicle!\")\r\n        } else {\r\n            await this.visitDevice(vehicle)\r\n            if (await vehicle.interact(this.pawn, drive())) {\r\n                if (await vehicle.interact(this.pawn, retrieveResource(exploring.gathers))) {\r\n                    driven = true\r\n                }\r\n            }\r\n        }\r\n        return driven\r\n    }\r\n\r\n    protected async workRecipe(recipe: Recipe): Promise<boolean> {\r\n        console.debug(\"Working recipe\", { product: recipe.produces })\r\n        let knowsRecipe = (d: Device) => d.operation === recipe && !d.reserved\r\n        let maker = this.planet.colony.closestDeviceByType(this.pawn.pos, [], knowsRecipe)\r\n        let made = false\r\n        if (maker) {\r\n            maker.reserved = true\r\n            // maker.inUse = true\r\n            if (await this.gatherIngredients(recipe.consumes)) {\r\n                await this.visitDevice(maker)\r\n                if (await this.performRecipeTask(maker, recipe)) {\r\n                    made = true\r\n                }\r\n            }\r\n            maker.reserved = false\r\n            // maker.inUse = false\r\n        }\r\n        // await this.pause()\r\n        // await this.workRecipe(recipe);\r\n        return made\r\n    }\r\n\r\n    protected async gatherIngredients(blocks: ResourceBlock[]): Promise<boolean> {\r\n        if (!this.pawn.isCarryingUnique(blocks)) {\r\n            console.debug(\"Gathering blocks...\")\r\n            for (let ingredient of blocks) {\r\n                let tries = 0\r\n                let gathered = false\r\n                while (!gathered && tries < 20) {\r\n                    tries += 1\r\n                    if (await this.gatherBlock(ingredient)) {\r\n                        gathered = true\r\n                    } else {\r\n                        await this.pause()\r\n                    }\r\n                }\r\n\r\n                if (!gathered) {\r\n                    console.warn(\"couldn't gather one of the ingredients!!\")\r\n                    return false\r\n                }\r\n                //else {\r\n                //    console.warn(\"didn't gather it!\")\r\n                //    return false\r\n                //}\r\n            }\r\n        }\r\n        return true\r\n    }\r\n\r\n    protected async performRecipeTask(maker: Device, recipe: Recipe, timesToAttempt: number = 5) {\r\n        console.debug(\"Try to perform recipe task...\", { produces: recipe.produces })\r\n        let worked = await maker.interact(this.pawn, { type: 'work', recipe })\r\n        if (!worked) {\r\n            // await this.pause()\r\n            console.warn(\"waiting for machine to become available...\")\r\n            for (let i = 0; i < timesToAttempt; i ++) {\r\n                await this.pause()\r\n                if (await this.performRecipeTask(maker, recipe)) {\r\n                    worked = true\r\n                    break\r\n                }\r\n            }\r\n        }\r\n        return worked\r\n    }\r\n}","const raisedSquare = require('../../images/raised-square-bg.png')\r\nconst leafy = require('../../images/leafy-bg.png')\r\nconst bookish = require('../../images/books-bg.png')\r\nconst posters = require('../../images/poster-wall-bg.png')\r\nconst tech = require('../../images/tech-bg.png')\r\nconst checker = require('../../images/checker-bg.png')\r\nconst beige = require('../../images/beige-bg.png')\r\nconst window = require('../../images/window-bg.png')\r\nconst ussf = require('../../images/ussf.png')\r\nconst wood = require('../../images/wood-panel-bg.png')\r\n\r\ninterface Background {\r\n    image: HTMLImageElement\r\n    pattern: CanvasPattern\r\n    loading: boolean\r\n}\r\n\r\nconst loadBg = (path, scale = 1) => {\r\n    let background: Background = { image: null, pattern: null, loading: true }\r\n    background.image = new Image();\r\n    background.image.src = path\r\n    background.image.onload = function () {\r\n      background.loading = false\r\n    }\r\n    return { background, scale }\r\n}\r\n\r\nexport enum BackgroundPattern {\r\n    Leafy = 'Leafy',\r\n    Grid = 'Grid',\r\n    Books = 'Books',\r\n    Poster = 'Poster',\r\n    Tech = 'Tech',\r\n    Checker = 'Checker',\r\n    Beige = 'Beige',\r\n    Window = 'Window',\r\n    USSF = 'USSF',\r\n    Wood = 'Wood',\r\n}\r\n\r\nconst backgroundPatterns: { [ key in BackgroundPattern ]: { background: Background, scale: number } } = {\r\n    Leafy: loadBg(leafy),\r\n    Grid: loadBg(raisedSquare),\r\n    Books: loadBg(bookish),\r\n    Poster: loadBg(posters),\r\n    Tech: loadBg(tech),\r\n    Checker: loadBg(checker),\r\n    Beige: loadBg(beige),\r\n    Window: loadBg(window),\r\n    USSF: loadBg(ussf, 0.5),\r\n    Wood: loadBg(wood),\r\n}\r\n\r\nexport const getBackgroundPattern = (ctx: CanvasRenderingContext2D, p: BackgroundPattern) => {\r\n    let pattern = backgroundPatterns[p]\r\n    let bg = pattern.background\r\n    if (!bg.loading) {\r\n        if (!bg.pattern) {\r\n            let matrix = new DOMMatrix() //bg.pattern.cre //ctx. // new SVGMatrix()\r\n\r\n            // bg.image.scal\r\n            // bg.image.scale\r\n            bg.pattern = ctx.createPattern(bg.image, 'repeat');\r\n            bg.pattern.setTransform(matrix.scale(pattern.scale)) //0.5))\r\n\r\n        }\r\n        return bg.pattern\r\n    }\r\n}","import { Color } from \"excalibur\";\r\n\r\nexport class Pane {\r\n    protected _element: HTMLDivElement;\r\n    title: HTMLDivElement\r\n    dragging: boolean = false\r\n    xOff: number = 0\r\n    yOff: number = 0\r\n    initialX: number\r\n    initialY: number\r\n\r\n\r\n    constructor(protected name: string, private x: number, private y: number) {\r\n        this.makeRootElement()\r\n\r\n    }\r\n\r\n    protected makeRootElement() {\r\n        if (this._element) {\r\n            this._element.parentElement.removeChild(this._element);\r\n        }\r\n        // if (!(this.comprehended.length > 0)) { return }\r\n\r\n        this._element = document.createElement('div');\r\n        this._element.style.position = 'absolute';\r\n        this._element.style.display = 'flex';\r\n        this._element.style.flexWrap = 'wrap';\r\n        this._element.style.width = '200px';\r\n        this._element.style.border = 'none'; //1px solid black'; //0.5px solid white';\r\n        // this._element.style.zIndex = '1'; //1px solid black'; //0.5px solid white';\r\n\r\n\r\n        document.body.appendChild(this._element);\r\n\r\n        // make title...\r\n        if (this.name) {\r\n            let container = document.createElement('div')\r\n            container.style.width = '200px'\r\n            // container.draggable = true\r\n            // container.position = 'absolute'\r\n            container.style.backgroundColor = Color.Violet.darken(0.92).toRGBA()\r\n\r\n            this.title = document.createElement('div')\r\n            this.title.textContent = this.name\r\n            this.title.style.fontFamily = 'Verdana'\r\n            this.title.style.border = 'none'\r\n            this.title.style.fontSize = '7pt'\r\n            this.title.style.fontWeight = '400'\r\n            this.title.style.color = Color.White.toRGBA()\r\n            this.title.style.padding = '4px'\r\n            this.title.style.margin = '0px'\r\n\r\n            container.appendChild(this.title)\r\n            this._element.appendChild(\r\n                container\r\n            )\r\n\r\n            /// hmmmm\r\n            document.addEventListener(\"pointerdown\", (e) => { this.dragStart(e) }, false);\r\n            document.addEventListener(\"pointerup\", (e) => { this.dragEnd(e) }, false);\r\n            document.addEventListener(\"pointermove\", (e) => { this.drag(e) }, false);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): any {\r\n        if (this._element) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._element.style.left = `${left + this.x + this.xOff}px`;\r\n            this._element.style.top = `${top + this.y + this.yOff}px`;\r\n        }\r\n    }\r\n    private dragStart = (e) => {\r\n        if (e.target === this.title) {\r\n            // console.log(\"drag start\")\r\n            this.initialX = e.clientX - this.xOff;\r\n            this.initialY = e.clientY - this.yOff;\r\n            this.dragging = true\r\n        }\r\n    }\r\n\r\n    private drag = (e) => {\r\n        if (this.dragging) {\r\n            e.preventDefault()\r\n            // console.log(\"drag\")\r\n            let currentX = e.clientX - this.initialX;\r\n            let currentY = e.clientY - this.initialY;\r\n            this.xOff = currentX\r\n            this.yOff = currentY\r\n        }\r\n\r\n    }\r\n\r\n    private dragEnd = (e) => {\r\n        if (this.dragging) {\r\n            // console.log(\"drag end\")\r\n            this.dragging = false\r\n        }\r\n\r\n    }\r\n\r\n    protected buttonFactory(label: string, color: Color = Color.LightGray) {\r\n        let c = color.clone()\r\n        let bg = c.darken(0.5).desaturate(0.5).clone();\r\n        bg.a = 0.8;\r\n        let fg = c.lighten(0.8).desaturate(0.4).clone();\r\n        let theButton = document.createElement('button');\r\n        theButton.textContent = label;\r\n\r\n        theButton.style.display = 'block';\r\n        theButton.style.fontSize = '6pt';\r\n        theButton.style.fontFamily = 'Verdana';\r\n        theButton.style.fontWeight = '500';\r\n        theButton.style.padding = '2px';\r\n        theButton.style.width = '100px';\r\n        theButton.style.textTransform = 'uppercase';\r\n        theButton.style.border = 'none' //1px solid rgba(255,255,255,0.08)';\r\n        theButton.style.background = bg.toRGBA();\r\n        theButton.style.color = fg.toRGBA();\r\n        theButton.onmouseover = () => {\r\n            theButton.style.background = bg.saturate(0.5).lighten(0.95).toRGBA();\r\n            theButton.style.color = fg.lighten(0.9).toRGBA();\r\n        };\r\n        theButton.onmouseleave = () => {\r\n            theButton.style.background = bg.toRGBA();\r\n            theButton.style.color = fg.toRGBA();\r\n        };\r\n        return theButton;\r\n    }\r\n}","import { minBy } from \"../Util\";\r\n\r\nexport class Graph<T> {\r\n    private empty: boolean = true\r\n    public nodes: T[] = []\r\n    private edges: { [key: number]: number[] } = {}\r\n    private edgesInverse: { [key: number]: number[] } = {}\r\n\r\n    public isEmpty(): boolean {\r\n        return this.empty;\r\n    }\r\n\r\n    public get size() { return this.nodes.length }\r\n\r\n    public node(newNode: T) {\r\n        this.empty = false;\r\n        if (!this.contains(newNode)) {\r\n            this.nodes.push(newNode)\r\n        }\r\n    }\r\n\r\n    public contains(testNode: T) {\r\n        return this.nodes.includes(testNode)\r\n    }\r\n\r\n    public findOrCreate(testNode: T, measure: (a: T, b: T) => number, tolerance: number = 5): T {\r\n        let nodes = this.dfs();\r\n        let closest = minBy(nodes, (node: T) => measure(testNode, node))\r\n        if (closest && measure(closest, testNode) < tolerance) {\r\n            return closest;\r\n        }\r\n        return testNode;\r\n    }\r\n\r\n    public edge(src: T, dst: T) {\r\n        this.node(src)\r\n        this.node(dst)\r\n\r\n        let s = this.indexOf(src), d = this.indexOf(dst)\r\n        this.edges[s] = this.edges[s] || []\r\n        this.edges[s].push(d)\r\n\r\n        this.edgesInverse[d] = this.edgesInverse[d] || []\r\n        this.edgesInverse[d].push(s)\r\n    }\r\n\r\n    public union(otherGraph: Graph<T>) {\r\n       otherGraph.edgeList().forEach(([a,b]) => this.edge(a,b))\r\n    }\r\n\r\n    public edgeList(): [T,T][] {\r\n        let theEdges = []\r\n        for (let node of this.nodes) {\r\n            let index = this.indexOf(node)\r\n            if (this.edges[index]) {\r\n                for (let otherIndex of this.edges[index]) {\r\n                    let otherNode = this.nodes[otherIndex]\r\n                    if (!theEdges.includes([otherNode, node])) {\r\n                        theEdges.push([node, otherNode])\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return theEdges\r\n    }\r\n\r\n    public adjacent(testNode: T): T[] {\r\n        let index = this.indexOf(testNode)\r\n        let vertex = this.adjacentIndices(index)\r\n        return vertex.map((n) => this.nodes[n])\r\n    }\r\n\r\n    private adjacentIndices(testNodeIndex: number): number[] {\r\n        let es = this.edges[testNodeIndex] || []\r\n        let esInv = this.edgesInverse[testNodeIndex] || []\r\n        let vertex = [...es, ...esInv ]\r\n        return vertex\r\n    }\r\n\r\n    public dfs(root:T=null, visited=[]): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.dfsIndex(rIndex).map(n => this.nodes[n])\r\n    }\r\n\r\n    private dfsIndex(rootIndex:number=0, visited:number[]=[]) {\r\n        visited.push(rootIndex)\r\n        let children = this.adjacentIndices(rootIndex)\r\n        children.forEach((childIndex: number) => {\r\n            if (!visited.includes(childIndex)) {\r\n                this.dfsIndex(childIndex, visited)\r\n            }\r\n        })\r\n\r\n        return visited\r\n    }\r\n\r\n    public bfs(root:T=null, cb: (x: number,y: number)=>boolean = ()=>true): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.bfsIndex(rIndex, cb).map(n => this.nodes[n])\r\n    }\r\n\r\n    private bfsIndex(rootIndex:number=null, cb: (x: number, y: number) => boolean = () => true): number[] {\r\n        let halt = false;\r\n        let visited: number[] = []\r\n        visited.push(rootIndex)\r\n        let tries = 0\r\n        while (visited.length < this.nodes.length && tries++ < this.nodes.length * 20) {\r\n            for (let visitedNode of visited) {\r\n                let adj: number[] = this.adjacentIndices(visitedNode)\r\n                for (let adjacentNode of adj) {\r\n                    if (!visited.includes(adjacentNode)) {\r\n                        if (!cb(visitedNode, adjacentNode)) {\r\n                            halt = true;\r\n                            break;\r\n                        }\r\n                        visited.push(adjacentNode)\r\n                    }\r\n                }\r\n                if (halt) break;\r\n            }\r\n            if (halt) break;\r\n        }\r\n        return visited\r\n    }\r\n\r\n    public shortestPath(src: T, dst: T, maxStep: number = 256): T[] {\r\n        let prevStep = {}\r\n        let dstIndex = this.indexOf(dst)\r\n        this.bfs(src, (prev, curr) => {\r\n            prevStep[curr] = prev;\r\n            return curr !== dstIndex\r\n        })\r\n        let path = []\r\n        let curr = dstIndex\r\n        let steps = 0\r\n        let srcIndex = this.indexOf(src)\r\n        while (!path.includes(srcIndex) && steps < maxStep) {\r\n            path.push(curr)\r\n            curr = prevStep[curr]\r\n            steps += 1\r\n        }\r\n        let pathNodes = path.map(n => this.nodes[n])\r\n        return pathNodes.reverse()\r\n    }\r\n\r\n    private indexOf(node: T) {\r\n        return this.nodes.indexOf(node)\r\n    }\r\n\r\n}","import { Color } from 'excalibur';\r\nimport { Structure } from './Structure';\r\nimport { sample } from '../Util';\r\nimport { Planet } from '../actors/Planet/Planet';\r\n\r\n\r\nexport class World {\r\n    static nameCitizen(): string {\r\n      return sample([\r\n        'Parthas',\r\n        'Athos',\r\n        'Karzak',\r\n        'Echo',\r\n        'Jaen',\r\n        'Xavier',\r\n        'Mante',\r\n        'Ern',\r\n        'Leor',\r\n        'Exiel',\r\n        'Tomlien',\r\n        'Amriel',\r\n        'Sariel',\r\n        'Arthax',\r\n        'Avalon',\r\n        'Kor',\r\n        'Exelon',\r\n        'Dominel',\r\n        'Prinz',\r\n        'Etsa',\r\n        'Corinth',\r\n        'Coade',\r\n        'Exter',\r\n        'Domnek',\r\n        'Tahm',\r\n        'Esk',\r\n        'Ith',\r\n        'Torl',\r\n        'Klapaucius',\r\n        'Antonidus',\r\n        'Exeleron',\r\n        'Moab',\r\n        'Thim',\r\n        'Pol',\r\n        'Maigel',\r\n      ])\r\n    }\r\n  static colors = [Color.Orange, Color.Red, Color.Blue, Color.Green] //, Color.Violet] //, Color.White]\r\n\r\n  color: Color = sample(World.colors).\r\n      clone().\r\n      darken(0.1).\r\n      desaturate(0.8);\r\n  skyColor: Color = sample(\r\n    //   [ Color.Blue ]\r\n      [Color.Cyan, Color.Vermillion, Color.Violet, Color.Chartreuse, Color.Orange, Color.Rose]\r\n  ).\r\n        clone().\r\n        lighten(0.15).\r\n        desaturate(0.8) //65)\r\n\r\n}","import { Texture, Sound } from 'excalibur';\r\nconst sword = require('./images/sword.png');\r\nconst craterRock = require('./sounds/crater-rock.mp3')\r\nconst assembler = require('./sounds/assembler.mp3')\r\nconst indivision = require('./sounds/indivision.mp3')\r\nconst understanding = require('./sounds/understanding.mp3')\r\nconst futureTense = require('./sounds/future tense.mp3')\r\n// const isomer = require('./sounds/isomer.mp3')\r\n// const outbound = require('./sounds/outbound.mp3')\r\n\r\nlet Resources = {\r\n    Sword: new Texture(sword),\r\n\r\n    CraterRock: new Sound(craterRock),\r\n    Assembler: new Sound(assembler),\r\n    Indivision: new Sound(indivision),\r\n    Understanding: new Sound(understanding),\r\n    FutureTense: new Sound(futureTense),\r\n    // Isomer: new Sound(isomer),\r\n    // Outbound: new Sound(outbound),\r\n\r\n\r\n}\r\n\r\nexport { Resources }\r\n","import { Machine, Houseplant, Orchard, AlgaeVat, Statue, Figurine, Bed, OxygenExtractor, WaterCondensingMachine, ResearchServer, Desk, Codex, Botany, Bookshelf, SolarCell, TimeCrystal } from \"./Machine\";\r\nimport { SolarArray, TimeChamber } from \"./SpaceFunction\";\r\n\r\nexport enum Discipline {\r\n    Survival = 'Survival',\r\n    // Agriculture = 'Agriculture',\r\n    LibraryScience = 'Library Science',\r\n    // LifeScience = 'Life Sciences',\r\n    // PlasticArts = 'Plastic Arts',\r\n}\r\n\r\nexport interface TechnologyRank {\r\n    name: string\r\n    level: number\r\n    description: string\r\n    prereqs: (typeof Machine)[]\r\n    unlocks: (typeof Machine)[]\r\n}\r\n\r\nexport const disciplineTree: { [key in Discipline]: TechnologyRank[] } = {\r\n    [Discipline.Survival]: [\r\n        { \r\n            name: \"Survival I\",\r\n            level: 1,\r\n            description: \"Keep it going\",\r\n            prereqs: [ Bed, SolarCell ],\r\n            unlocks: [ OxygenExtractor, WaterCondensingMachine ]\r\n        },\r\n    ],\r\n\r\n    // [Discipline.Agriculture]: [\r\n    //     // small planter?\r\n    //     { prereqs: [ Houseplant ], unlocks: [ Orchard ] } // Greenhouse...? ] }\r\n    // ],\r\n\r\n    [Discipline.LibraryScience]: [\r\n        {\r\n            name: \"Library Science I\",\r\n            level: 1,\r\n            description: \"try to understand\",\r\n            prereqs: [ Bookshelf ],\r\n            unlocks: [ Desk, Codex ],\r\n        }\r\n    ],\r\n\r\n    // [Discipline.LifeScience]: [ \r\n    //     { prereqs: [], unlocks: [ Botany, AlgaeVat ]}\r\n    // ],\r\n\r\n    // [Discipline.PlasticArts]: [\r\n    //     { prereqs: [ Figurine ], unlocks: [ Statue ] }\r\n\r\n    // ],\r\n}\r\n\r\n","import { Machine } from \"./Machine\";\r\nimport { range } from \"../Util\";\r\nimport { Discipline, TechnologyRank, disciplineTree } from \"./TechnologyRank\";\r\n\r\nexport class TechTree {\r\n    currentLevels: {\r\n        [key in Discipline]: number;\r\n    } = {\r\n            [Discipline.Survival]: -1,\r\n            [Discipline.LibraryScience]: -1,\r\n        };\r\n\r\n    findDisciplineToRankUp(machines: (typeof Machine)[]): Discipline {\r\n        for (let disciplineName of Object.keys(Discipline)) {\r\n            let discipline: Discipline = Discipline[disciplineName];\r\n            if (this.canRankUp(discipline, machines)) {\r\n                return discipline;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    rankUp(discipline: Discipline): TechnologyRank {\r\n        this.currentLevels[discipline] += 1;\r\n        return this.currentRank(discipline);\r\n    }\r\n\r\n    private currentRank(discipline: Discipline): TechnologyRank {\r\n        return disciplineTree[discipline][this.currentLevels[discipline]];\r\n    }\r\n\r\n    private canRankUp(discipline: Discipline, machines: (typeof Machine)[]): boolean {\r\n        let level = this.currentLevels[discipline];\r\n        let nextLevel: TechnologyRank = disciplineTree[discipline][level + 1];\r\n        if (nextLevel) {\r\n            if (nextLevel.prereqs.every(machine => machines.includes(machine))) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    allUnlockedMachines(): (typeof Machine)[] {\r\n        let unlocked = [];\r\n        for (let disciplineName of Object.keys(Discipline)) {\r\n            unlocked.push(...this.unlockedMachinesFor(Discipline[disciplineName]));\r\n        }\r\n        return unlocked;\r\n    }\r\n\r\n    private unlockedMachinesFor(discipline: Discipline) {\r\n        let tree = disciplineTree[discipline];\r\n        let unlocked = [];\r\n        let level = this.currentLevels[discipline] + 1;\r\n        for (let i in range(level)) {\r\n            unlocked.push(...tree[i].unlocks);\r\n        }\r\n        return unlocked;\r\n    }\r\n}\r\n","import * as ex from 'excalibur';\r\n\r\nexport class Player extends ex.Actor {\r\n  constructor() {\r\n    super();\r\n    this.setWidth(5);\r\n    this.setHeight(5);\r\n    this.x = 5;\r\n    this.y = 5;\r\n    this.color = new ex.Color(255, 255, 255);\r\n  }\r\n}\r\n","import { Actor, Color } from 'excalibur';\r\nimport { range, mixColors } from '../../Util';\r\nimport { drawRect } from '../../Painting';\r\n\r\nclass PlanetBackground extends Actor {\r\n    constructor(y: number, width: number, color: Color) {\r\n        super(0, y, width, 1500, color)\r\n    }\r\n}\r\n\r\nexport class MountainLayers extends PlanetBackground {\r\n    layers: {\r\n        baseY: number,\r\n        // color: Color,\r\n        deltas: number[]\r\n    }[] = []\r\n\r\n    skyColor: Color = Color.Blue.clone()\r\n    layerHeight: number = 100\r\n    layerCount = 1\r\n    peakCount = 100\r\n\r\n    get peakWidth() {\r\n        return Math.floor(this.getWidth() / this.peakCount)\r\n    }\r\n\r\n    onInitialize() {\r\n        // let min = -this.layerHeight\r\n        for (let layerIndex of range(this.layerCount)) {\r\n            this.layers.unshift({\r\n                baseY: (layerIndex+1) * -this.layerHeight, // - (20 * layerIndex),\r\n                deltas: this.genPeaks(layerIndex)\r\n            })\r\n        }\r\n    }\r\n\r\n    draw(ctx, delta) {\r\n        let wc = this.color.clone() //.lighten(0.1)\r\n        let sc = this.skyColor.clone() //.lighten(0.1)\r\n\r\n        let ndx = 1\r\n        let ls = this.layers.slice()\r\n        for (let layer of ls) {\r\n            let c = mixColors(wc, sc, (ndx / (this.layers.length)))\r\n            this.drawLayer(ctx, layer, c) //.lighten(0.1))\r\n            ndx += 1\r\n        }\r\n    }\r\n\r\n    private drawLayer(ctx, layer, color) {\r\n        let ox = -this.getWidth()/2, oy = this.pos.y + layer.baseY \r\n        let c = color.clone()\r\n\r\n        ctx.beginPath()\r\n        ctx.moveTo(ox, oy)\r\n        let ndx = 0\r\n        for (let delta of layer.deltas) {\r\n            ctx.lineTo(ox + (ndx * this.peakWidth), oy + delta)\r\n            ndx += 1\r\n        }\r\n        ctx.lineTo(ox + (this.peakCount * this.peakWidth), oy)\r\n        ctx.lineTo(ox + (this.peakCount * this.peakWidth), oy + this.layerHeight)\r\n        ctx.lineTo(ox, oy+this.layerHeight)\r\n        ctx.closePath()\r\n        c.a = 1\r\n        ctx.fillStyle = c.toRGBA()\r\n        ctx.fill()\r\n    }\r\n\r\n    private genPeaks(n) {\r\n        let dMax = 2*(this.layerHeight/3)\r\n        let deltas = []\r\n        let randomDelta = () => (Math.random() * (dMax)) - (dMax/2)\r\n        let last = 0\r\n        let maxDiff = 15 // + (n*2)\r\n        for (let times in range(this.peakCount)) {\r\n            let curr = randomDelta()\r\n            let pick = Math.max(\r\n                   last - maxDiff,\r\n                   Math.min(curr, last + maxDiff),\r\n               )\r\n            deltas.push(\r\n               pick\r\n            )\r\n            last = pick\r\n        }\r\n        return deltas\r\n    }\r\n}\r\n\r\nexport class Mountains extends PlanetBackground {\r\n    peaks: {\r\n        x: number;\r\n        height: number;\r\n    }[] = [];\r\n    onInitialize() {\r\n        let peakCount = 3\r\n        let peakHeight = 480\r\n        let xOff = this.getWidth() / 2\r\n        let peakDistance = this.getWidth() / peakCount\r\n        for (let times of range(2)) {\r\n            let heightRange = 100\r\n            let drift = 3 * (peakDistance / 2)\r\n            for (let i of range(peakCount)) {\r\n                this.peaks.push({\r\n                    x: -xOff + i * peakDistance + ((Math.random() * drift) - (drift / 2)),\r\n                    height: Math.max(10, 200 + (Math.random() * peakHeight) + ((Math.random() * heightRange) - (heightRange / 2))) //(Util.randomIntInRange(-160,160))\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let baseColor = this.color.desaturate(0.35)\r\n        let brightColor = baseColor.lighten(0.1)\r\n        ctx.fillStyle = baseColor.toRGBA()\r\n        let yBase = this.pos.y-3\r\n        this.peaks.forEach(peak => {\r\n            let y0 = yBase - peak.height;\r\n            let mtnWidth = peak.height * 3.4;\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x - mtnWidth, yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n\r\n            ctx.fillStyle = baseColor.toRGBA()\r\n            ctx.fill();\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x + 3*(mtnWidth/4), yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n            ctx.fillStyle = brightColor.toRGBA()\r\n            ctx.fill();\r\n\r\n        });\r\n    }\r\n}","import { Actor, Color } from 'excalibur';\r\nimport { mixColors } from '../../Util';\r\nimport { Mountains, MountainLayers } from './PlanetBackground';\r\nexport class SkyLayer extends Actor {\r\n    mountains: Mountains;\r\n    mountainLayers: MountainLayers;\r\n    backMountainLayers: MountainLayers;\r\n    constructor(y: number, width: number, lo: Color, hi: Color) {\r\n        super(0, y, width, 1500); //width,1500) //height)\r\n        let mid = mixColors(lo, hi);\r\n        this.backMountainLayers = new MountainLayers(-80, width, mid);\r\n        this.backMountainLayers.skyColor = hi;\r\n        this.add(this.backMountainLayers);\r\n        this.mountains = new Mountains(0, width, mid);\r\n        this.add(this.mountains);\r\n        this.mountainLayers = new MountainLayers(0, this.getWidth(), lo);\r\n        this.mountainLayers.skyColor = mid;\r\n        this.add(this.mountainLayers);\r\n    }\r\n    setLoHi(lo: Color, hi: Color) {\r\n        let mid = mixColors(lo, hi);\r\n        this.backMountainLayers.color = mid;\r\n        this.backMountainLayers.skyColor = hi;\r\n        this.mountains.color = mid;\r\n        this.mountainLayers.color = lo;\r\n        this.mountainLayers.skyColor = mid;\r\n    }\r\n}\r\n","import { Actor, Color } from 'excalibur';\r\nimport { range, mixColors } from '../../Util';\r\nimport { SkyLayer } from \"./SkyLayer\";\r\nexport class SkyLayers extends Actor {\r\n    layers: SkyLayer[] = [];\r\n    constructor(y: number, width: number, private lo: Color, hi: Color, private layerCount: number = 5) {\r\n        super(0, y, width, 1500);\r\n        for (let i of range(layerCount)) {\r\n            let c0 = mixColors(lo, hi, (i / (layerCount + 1)));\r\n            let c1 = mixColors(lo, hi, ((i + 1) / (layerCount + 1)));\r\n            let layer = new SkyLayer(-20 - (50 * (layerCount - i - 1)), this.getWidth(), c1, c0);\r\n            this.layers.push(layer);\r\n            this.add(layer);\r\n        }\r\n    }\r\n    setHi(hi: Color) {\r\n        let lo = this.lo;\r\n        for (let i of range(this.layerCount)) {\r\n            let c0 = mixColors(lo, hi, (i / (this.layerCount + 1)));\r\n            let c1 = mixColors(lo, hi, ((i + 1) / (this.layerCount + 1)));\r\n            this.layers[i].setLoHi(c1, c0);\r\n            // let layer = new SkyLayer(-100 * (layerCount-i-1), this.getWidth(), c1, c0)\r\n        }\r\n    }\r\n}\r\n","import { Strategy } from \"./Strategy\";\r\n\r\nexport abstract class EatingStrategy extends Strategy {}","import { EatingStrategy } from \"./EatingStrategy\";\r\nimport { ResourceBlock } from \"../models/Economy\";\r\nimport { Fridge, Desk } from \"../models/Machine\";\r\n\r\nexport class WhenHungryEatingStrategy extends EatingStrategy {\r\n    canApply(): boolean {\r\n        return this.pawn.isHungry &&\r\n            this.planet.storedResources.includes(ResourceBlock.Meal)\r\n        // hunger > 0.6\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    protected async apply() {\r\n        // find the store with the food! reserve it maybe?\r\n        let fridge = this.devices.find(d => d.machine.operation.type === 'store' &&\r\n          d.machine.operation.stores.includes(ResourceBlock.Meal) &&\r\n          d.product.includes(ResourceBlock.Meal) &&\r\n          !d.reserved\r\n        )\r\n\r\n        if (fridge) {\r\n            fridge.reserved = true\r\n            // take the meal to a desk? (maybe need table here... or eatingSurface aspect?)\r\n            await this.visitDevice(fridge)\r\n            await fridge.interact(this.pawn, { type: 'retrieve', resource: ResourceBlock.Meal })\r\n            fridge.reserved = false\r\n\r\n            let desk = this.devices.find(d => d.machine instanceof Desk)\r\n            if (desk) {\r\n                await this.visitDevice(desk)\r\n            }\r\n            await this.pawn.eat()\r\n            // fridge.interac\r\n            // this.pawn.interact()\r\n        }\r\n    }\r\n    \r\n    \r\n}","import { Strategy } from \"./Strategy\";\r\n\r\nexport abstract class SleepingStrategy extends Strategy {\r\n\r\n}","import { SleepingStrategy } from \"./SleepingStrategy\";\r\nimport { Bed } from \"../models/Machine\";\r\nimport { shuffle } from \"../Util\";\r\n\r\nexport class AnyBedSleepingStrategy extends SleepingStrategy {\r\n    canApply(): boolean {\r\n        if (!this.pawn.isTired) {\r\n            return false\r\n        }\r\n\r\n        let bedtime = this.planet.hour > 21 || this.planet.hour < 4\r\n        return bedtime\r\n    }\r\n\r\n    protected async apply() {\r\n        // find a bed\r\n        let bed = shuffle(this.devices).find(d => d.machine instanceof Bed && !d.inUse)\r\n        if (bed) {\r\n            bed.inUse = true\r\n            await this.visitDevice(bed)\r\n        }\r\n        await this.pawn.takeRest() //1000 * 24)\r\n        if (bed) { \r\n            bed.inUse = false\r\n        }\r\n        return true\r\n    }\r\n\r\n}","import { Strategy } from \"./Strategy\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { containsUniq } from \"../Util\";\r\n\r\nexport abstract class ConstructionStrategy extends Strategy {\r\n    canApply(): boolean {\r\n        return !!this.unbuiltDevice\r\n    }\r\n\r\n    get unbuiltDevice() {\r\n        const isUnbuilt = (d: Device) => !d.built && !d.inUse && d.building.isActive &&\r\n          // the player can TRY to build it, we don't have to hang forever on it though\r\n          containsUniq(this.planet.storedResources, d.machine.cost)\r\n        return this.planet.colony.findAllDevices().find(isUnbuilt)\r\n    }\r\n}","import { ConstructionStrategy } from \"./ConstructionStrategy\";\r\nimport { Device } from \"../actors/Device\";\r\n\r\nexport class ProxmityBasedConstruction extends ConstructionStrategy {\r\n    async apply() {\r\n        if (this.unbuiltDevice && this.unbuiltDevice.building) {\r\n            await this.constructDevice(this.unbuiltDevice)\r\n        }\r\n        await this.pause()\r\n    }\r\n\r\n    private async constructDevice(device: Device) {\r\n        device.inUse = true\r\n        let resources = device.machine.cost\r\n        if (await this.gatherIngredients(resources)) {\r\n            await this.visitDevice(device)\r\n            await device.assemble(this.pawn)\r\n        } \r\n\r\n        device.inUse = false\r\n    }\r\n}","import { ResourceBlock } from \"../models/Economy\";\r\n\r\nimport { Recipe } from \"../models/MechanicalOperation\";\r\n\r\nexport interface RetrieveResource {\r\n    type: 'retrieve'\r\n    resource: ResourceBlock\r\n    // count: number\r\n}\r\n\r\nexport interface WorkRecipe {\r\n    type: 'work'\r\n    recipe: Recipe\r\n}\r\n\r\nexport interface StoreResource {\r\n    type: 'store'\r\n    resource: ResourceBlock\r\n}\r\n\r\nexport interface DriveAround {\r\n    type: 'drive'\r\n}\r\n\r\nexport function retrieveResource(res: ResourceBlock): RetrieveResource {\r\n    return {\r\n        type: 'retrieve',\r\n        resource: res,\r\n        // count: 1\r\n    }\r\n}\r\n\r\nexport function drive(): DriveAround {\r\n    return { type: 'drive' }\r\n}\r\n\r\nexport type InteractionRequest = StoreResource | RetrieveResource | WorkRecipe | DriveAround\r\n\r\n","import { Device } from \"../actors/Device\";\r\nimport { MechanicalOperation, Recipe } from \"../models/MechanicalOperation\";\r\nimport { ResourceBlock } from \"../models/Economy\";\r\nimport { retrieveResource } from \"../values/InteractionRequest\";\r\nimport { Strategy } from \"./Strategy\";\r\n\r\nexport abstract class ProductionStrategy extends Strategy {\r\n\r\n    protected async storeBlock(res: ResourceBlock) {\r\n        let stored = false\r\n        let tries = 0\r\n        while (!stored && tries < 30) {\r\n            tries++\r\n            if (await this.tryStoreBlock(res)) {\r\n                stored = true\r\n            } else {\r\n                await this.pause()\r\n            }\r\n        }\r\n    }\r\n\r\n    private async tryStoreBlock(res: ResourceBlock): Promise<boolean> {\r\n        let storesDesiredBlock = (d: Device) => d.operation.type === 'store' &&\r\n            d.product.length < d.getEffectiveOperationalCapacity(d.operation) && //operation.capacity &&\r\n            d.operation.stores.includes(res)\r\n        let openStore = this.planet.colony.closestDeviceByType(this.pawn.pos, [], storesDesiredBlock)\r\n        let stored = false\r\n        if (openStore) {\r\n            await this.visitDevice(openStore)\r\n            if (await openStore.interact(this.pawn, { type: 'store', resource: res })) {\r\n                stored = true\r\n            }\r\n        }\r\n\r\n        //if (!stored) {\r\n        //    await this.pause()\r\n        //    // should try agi\r\n        //    // await this.storeBlock(res)\r\n        //}\r\n\r\n        return stored\r\n    }\r\n\r\n}\r\n","import { shuffle, containsUniq } from \"../Util\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { Recipe, ResourceStorage, ExploreForResource } from \"../models/MechanicalOperation\";\r\nimport { ProductionStrategy } from \"./ProductionStrategy\";\r\nimport { Resource } from \"excalibur\";\r\n\r\nexport class CapacityBasedProduction extends ProductionStrategy {\r\n    canApply(): boolean {\r\n        let hasOpenStore = !!(this.findStore())\r\n        return hasOpenStore\r\n    }\r\n\r\n    async apply() {\r\n        let store = this.findStore()\r\n        let recipe = this.findRecipe(store)\r\n        let explorer = this.findExplorer(store)\r\n\r\n\r\n        if (recipe && containsUniq(this.planet.storedResources, recipe.consumes)) {\r\n            if (await this.workRecipe(recipe)) {\r\n                await this.storeBlock(recipe.produces)\r\n            }\r\n        } else if (explorer) {\r\n            if (await this.workExploration(explorer)) {\r\n                await this.storeBlock(explorer.gathers)\r\n            }\r\n        } else {\r\n            // console.warn(\"No recipe or explorer!\")\r\n        }\r\n    }\r\n\r\n    private findStore() {\r\n        const storeWithCapacity = (d: Device) => d.operation.type === 'store' &&\r\n            d.product.length < d.getEffectiveOperationalCapacity(d.operation) //&&\r\n        let store: Device = shuffle(this.devices).find(storeWithCapacity)\r\n        return store\r\n    }\r\n\r\n\r\n    private findRecipe(store: Device): Recipe {\r\n        if (store && store.operation.type === 'store') {\r\n            const storage: ResourceStorage = store.operation\r\n            const recipeForStoredResource = (r: Recipe) => storage.stores.some(stored => r.produces === stored)\r\n            let recipe: Recipe = shuffle(this.recipes).find(recipeForStoredResource)\r\n            return recipe\r\n        }\r\n    }\r\n\r\n    private findExplorer(store: Device): ExploreForResource {\r\n        if (store && store.operation.type === 'store') {\r\n            const storage: ResourceStorage = store.operation\r\n            // console.log(\"Looking for explorer for\", { stored: storage.stores })\r\n            const explorerForStored = (e: ExploreForResource) => storage.stores.some(stored => e.gathers === stored)\r\n            let explorer: ExploreForResource = shuffle(this.explorers).find(explorerForStored)\r\n            // console.log(\"Looked for explorer, found: \", { explorer })\r\n            return explorer\r\n        }\r\n    }\r\n}\r\n","import { Actor, Color, Traits, Vector, VisibleEvent } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { Planet } from \"./Planet/Planet\";\r\nimport { ResourceBlock, blockColor } from \"../models/Economy\";\r\nimport { Game } from \"../Game\";\r\nimport { eachCons, deleteByValueOnce, sleep, containsUniq, deleteByValue } from \"../Util\";\r\nimport { Device } from \"./Device\";\r\nimport { Scale } from \"../values/Scale\";\r\nimport { ProductionStrategy } from \"../strategies/ProductionStrategy\";\r\nimport { CapacityBasedProduction } from \"../strategies/CapacityBasedProduction\";\r\nimport { drawStar, drawRect } from \"../Painting\";\r\nimport { ConstructionStrategy } from \"../strategies/ConstructionStrategy\";\r\nimport { ProxmityBasedConstruction } from \"../strategies/ProximityBasedConstruction\";\r\nimport { SleepingStrategy } from \"../strategies/SleepingStrategy\";\r\nimport { AnyBedSleepingStrategy } from \"../strategies/AnyBedSleepingStrategy\";\r\nimport { EatingStrategy } from \"../strategies/EatingStrategy\";\r\nimport { WhenHungryEatingStrategy } from \"../strategies/WhenHungryEatingStrategy\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../values/DeviceSize\";\r\n\r\nexport class Citizen extends Actor {\r\n    isPlanning: boolean = false // \r\n\r\n    // walkSpeed: number = Game.citizenSpeed\r\n    carrying: ResourceBlock[] = [] // null\r\n    path: Vector[] = []\r\n\r\n    private workInProgress: boolean = false\r\n    private workStarted: number\r\n    private workDuration: number\r\n    private progress: number\r\n\r\n    private sleeping: boolean = false\r\n\r\n\r\n    private productionStrategy: ProductionStrategy\r\n    private constructionStrategy: ConstructionStrategy\r\n    private sleepingStrategy: SleepingStrategy\r\n    private eatingStrategy: EatingStrategy\r\n\r\n    private hunger: number = 0.0;\r\n    private energy: number = 100\r\n\r\n    driving: Device = null\r\n\r\n    constructor(public name: string, private home: Vector, protected planet: Planet, private elite: boolean = false) {\r\n        super(home.x, home.y, Scale.minor.first, Scale.minor.fourth, Color.White.clone())\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling))\r\n\r\n        this.productionStrategy = new CapacityBasedProduction(this)\r\n        this.constructionStrategy = new ProxmityBasedConstruction(this)\r\n        this.sleepingStrategy = new AnyBedSleepingStrategy(this)\r\n        this.eatingStrategy = new WhenHungryEatingStrategy(this)\r\n    }\r\n\r\n    get isHungry() { return this.hunger > 0.6 }\r\n    get isTired()  { return this.energy < 90 }\r\n\r\n    // get isWorking() { return this.isWorking }\r\n    get currentPlanet() { return this.planet }\r\n\r\n    get walkSpeed() {\r\n        let speedMultiplier = this.planet.timeFactor * (this.elite ? 1.6 : 1)\r\n        return Game.citizenSpeed * speedMultiplier\r\n    }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n\r\n        // check wip\r\n        if (this.workInProgress) {\r\n            let now = (new Date()).getTime()\r\n            this.progress = \r\n              Math.min(\r\n                  (now - this.workStarted) / this.workDuration,\r\n                  1\r\n              )\r\n\r\n            this.energy -= 0.1\r\n            this.hunger += 0.001\r\n        } else if (this.path.length > 0) {\r\n            // we have a non-empty path\r\n        } else {\r\n\r\n            // we aren't working or walking -- make sure we are busy!\r\n            this.work()\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let { x, y } = this\r\n        if (this.driving) {\r\n\r\n            x = this.driving.pos.add(this.driving.building.pos).x //- getVisibleDeviceSize(this.driving.size)/2\r\n            y = this.driving.pos.add(this.driving.building.pos).y // - 14\r\n        } \r\n\r\n        ctx.save()\r\n        // ctx.globalAlpha = 1.0\r\n        ctx.translate(x, y - this.getHeight()/2 - 5)\r\n        if (this.sleeping) {\r\n            ctx.rotate(-Math.PI / 2);\r\n            ctx.translate(5, -10)\r\n        }\r\n        // ctx.globalAlpha = 1.0 //?\r\n        drawRect(\r\n            ctx,\r\n            { x: 0, y: 0, width: this.getWidth(), height: this.getHeight() },\r\n            0,\r\n            Color.White\r\n        )\r\n\r\n        if (this.elite) {\r\n            // draw a little star?\r\n            drawStar(ctx, 8, -5)\r\n        }\r\n\r\n        // super.draw(ctx, delta)\r\n        if (this.carrying) {\r\n            let dx = 5\r\n            // if (this.vel.x < 0) { dx = -5 }\r\n            this.carrying.forEach((carried, idx) => {\r\n                ctx.fillStyle = blockColor(carried).clone().saturate(0.2).toRGBA()\r\n                ctx.fillRect(dx, 2 - 4 * idx, 5, 5)\r\n            })\r\n        }\r\n        ctx.restore()\r\n\r\n        if (this.workInProgress) {\r\n            ctx.lineWidth = 1\r\n            let pw = 10 + Math.floor(this.workDuration / 10000), ph = 3\r\n            let px = this.x - pw/2, py = this.y - 10;\r\n            ctx.strokeStyle = Color.White.toRGBA()\r\n            ctx.strokeRect(px, py, pw, ph)\r\n            ctx.fillStyle = Color.Violet.darken(0.9).toRGBA()\r\n            ctx.fillRect(px, py, pw, ph)\r\n            ctx.fillStyle = Color.Violet.toRGBA()\r\n            ctx.fillRect(px, py, this.progress * pw, ph)\r\n        }\r\n\r\n        // let debugPath = true\r\n        if (this.path && Game.debugPath) {\r\n            let c = Color.White.clone().lighten(0.5)\r\n            c.a = 0.5\r\n            eachCons(this.path, 2).forEach(([a,b]) => {\r\n                ctx.beginPath()\r\n                ctx.moveTo(a.x,a.y)\r\n                ctx.lineTo(b.x,b.y)\r\n                ctx.strokeStyle = c.toRGBA()\r\n                ctx.lineWidth = 4\r\n                ctx.stroke()\r\n            })\r\n        }\r\n    }\r\n\r\n    async progressBar(duration: number) {\r\n        this.workInProgress = true\r\n        this.workStarted = (new Date()).getTime()\r\n        this.workDuration = duration\r\n        await new Promise((resolve, reject) => setTimeout(resolve, duration));\r\n        this.workInProgress = false\r\n    }\r\n\r\n\r\n    carry(c: ResourceBlock) {\r\n        this.carrying.push(c);\r\n    }\r\n\r\n    isCarryingUnique(resources: ResourceBlock[]): boolean {\r\n        let isCarrying = containsUniq(this.carrying, resources)\r\n        return isCarrying\r\n    }\r\n\r\n    drop(res: ResourceBlock): ResourceBlock {\r\n        if (this.carrying.length > 0) {\r\n            if (this.carrying.find(r => r === res)) {\r\n                deleteByValueOnce(this.carrying, res)\r\n                return res\r\n            }\r\n        }\r\n        return null\r\n    }\r\n\r\n    currentBuilding: Building = null\r\n    async visit(device: Device) {\r\n        let target = this.targetForDevice(device)\r\n        if (this.currentBuilding != device.building) {\r\n            const path = this.planet.pathBetweenPoints(this.pos.clone(), target)\r\n            await this.followPath(path)\r\n        }\r\n        await this.glideTo(target)\r\n        this.currentBuilding = device.building\r\n    }\r\n\r\n    private targetForDevice(device: Device) {\r\n        let target = device.pos.add(device.building.pos)\r\n        if (device.parentDevice) {\r\n            target = (device.parentDevice.pos).add(device.building.pos)\r\n            target.x += device.pos.x\r\n            target.y += getVisibleDeviceSize(device.parentDevice.size) / 2\r\n        } else {\r\n            target.y += getVisibleDeviceSize(device.size) / 2\r\n        }\r\n        return target\r\n    }\r\n\r\n    glideTo(pos: Vector) {\r\n        if (pos) {\r\n            return this.actions.moveTo(pos.x, pos.y, this.walkSpeed).asPromise()\r\n        }\r\n    }\r\n\r\n    async followPath(path: Vector[]) {\r\n        if (path.length > 0) {\r\n            this.path = path\r\n            await Promise.all(\r\n                path.map(step => this.glideTo(step))\r\n            )\r\n            this.path = []\r\n        }\r\n    }\r\n    \r\n    protected get strategies() {\r\n        return [\r\n            this.sleepingStrategy,\r\n            this.eatingStrategy,\r\n            this.constructionStrategy,\r\n            this.productionStrategy\r\n        ]\r\n    }\r\n\r\n    async work() {\r\n        if (this.isPlanning || this.sleeping) { return }\r\n\r\n        this.isPlanning = true\r\n        // just get rid of it??\r\n        if (this.carrying.length > 0) { this.carrying = [] }\r\n        let choice = this.strategies.find(strat => strat.canApply())\r\n        if (choice) {\r\n            await choice.attempt()\r\n            this.energy -= 1\r\n            this.hunger += 0.01\r\n        }\r\n        this.isPlanning = false\r\n    }\r\n\r\n    async takeRest(duration: number = 8 * 60 * Game.minuteTickMillis) {\r\n        console.log(\"Citizen taking a well-deserved rest!!\")\r\n        this.sleeping = true\r\n        await this.progressBar(duration)\r\n        this.energy = 100\r\n        this.sleeping = false\r\n    }\r\n\r\n    async eat() {\r\n        console.log(\"Citizen eating a meal!\")\r\n        // this.eating = true\r\n        let thirtyMinuteTimer = 30 * Game.minuteTickMillis\r\n        await this.progressBar(thirtyMinuteTimer)\r\n        deleteByValueOnce(this.carrying, ResourceBlock.Meal)\r\n        this.hunger = 0\r\n    }\r\n}","import { Actor, Traits } from 'excalibur';\r\nimport { Citizen } from '../Citizen';\r\nimport { Planet } from './Planet';\r\nimport { Device } from '../Device';\r\nimport { World } from '../../models/World';\r\n\r\nexport class Population extends Actor {\r\n    citizens: Citizen[] = [];\r\n    constructor(private planet: Planet) {\r\n        super(0, -planet.getHeight() / 2, 0, 0);\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling));\r\n    }\r\n\r\n    increase(pos, elite: boolean = false) {\r\n        let citizen = new Citizen(World.nameCitizen(), pos, this.planet, elite);\r\n        citizen.work();\r\n        this.citizens.push(citizen);\r\n        this.add(citizen);\r\n    }\r\n}\r\n","import { Graph } from \"../../values/Graph\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Building } from \"../Building\";\r\nimport { minBy } from \"../../Util\";\r\n\r\nexport class NavigationTree {\r\n   graph: Graph<Vector>\r\n\r\n   constructor(root: Building) {\r\n       this.graph = root.graph()\r\n   }\r\n\r\n   seekPath(origin: Vector, dest: Vector): Vector[] {\r\n      return this.graph.shortestPath(origin, dest)\r\n   }\r\n\r\n   closestNode(testNode: Vector) {\r\n       let nodes = this.graph.dfs()\r\n       let closest = minBy(nodes,\r\n           (node: Vector) => Math.abs(testNode.distance(node))\r\n       )\r\n       if (closest) {\r\n           return closest\r\n       }\r\n       return false\r\n   }\r\n}","import { Actor, Vector, Traits, Color } from 'excalibur';\r\nimport { Building } from '../Building';\r\nimport { minBy, flatSingle } from '../../Util';\r\nimport { Structure } from '../../models/Structure';\r\nimport { NavigationTree } from './NavigationTree';\r\nimport { Machine } from '../../models/Machine';\r\nimport { Device } from '../Device';\r\nimport { Game } from '../../Game';\r\n\r\nexport class Colony extends Actor {\r\n    navTree: NavigationTree;\r\n    buildings: Building[] = [];\r\n    currentlyConstructing: Building | Device = null;\r\n\r\n    constructor(x: number, y: number) {\r\n        super(x, y, 0, 0); // 1000, 1000);\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling));\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta);\r\n\r\n        let debugTree = Game.debugPath\r\n        if (this.navTree && debugTree) {\r\n            let edges = this.navTree.graph.edgeList();\r\n            edges.forEach((edge) => {\r\n                let [a,b] = edge;\r\n                var gradient = ctx.createLinearGradient(a.x,a.y+this.pos.y,b.x,b.y+this.pos.y);\r\n\r\n                gradient.addColorStop(0, 'green');\r\n                gradient.addColorStop(1, 'blue');\r\n\r\n                ctx.beginPath()\r\n                ctx.moveTo(a.x, a.y + this.pos.y)\r\n                ctx.lineTo(b.x, b.y + this.pos.y)\r\n                ctx.closePath()\r\n                ctx.strokeStyle = gradient\r\n                ctx.lineWidth = 0.5\r\n                ctx.stroke()\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n\r\n    placeBuilding(building: Building) {\r\n        building.placed = true;\r\n        if (building.parentSlot) {\r\n            building.parentSlot.parent.childrenBuildings.push(building);\r\n            this.buildNavTree();\r\n        }\r\n        this.buildings.push(building);\r\n        building.afterConstruct();\r\n        this.add(building);\r\n    }\r\n\r\n    closestBuildingByType(cursor: Vector, structureTypes: (typeof Structure)[] = [], predicate: (Building) => boolean = () => true): Building {\r\n        let matching = this.buildings\r\n        .filter(building => //predicate(building) &&\r\n            (structureTypes.length > 0\r\n            ? structureTypes.some(st => building.structure instanceof st)\r\n            : true)\r\n             && predicate(building)\r\n        )\r\n\r\n        if (matching && matching.length > 0) {\r\n            let distanceToCursor = (building) => cursor.distance(building.nodes()[0]);\r\n            return minBy(matching, distanceToCursor);\r\n        }\r\n    }\r\n\r\n    pathBetween(origin: Vector, destination: Building): Vector[] {\r\n        if (!this.navTree) {\r\n            this.buildNavTree();\r\n        }\r\n        let srcNode = this.navTree.closestNode(origin);\r\n        let dest = destination.nodes()[0] //.length > 1 ? destination.nodes()[1] : destination.nodes()[0];\r\n        let destNode = this.navTree.closestNode(dest);\r\n        let path = this.navTree.seekPath(srcNode, destNode);\r\n        return path;\r\n    }\r\n\r\n    pathBetweenPoints(origin: Vector, destination: Vector): Vector[] {\r\n        if (!this.navTree) {\r\n            this.buildNavTree();\r\n        }\r\n        let srcNode = this.navTree.closestNode(origin);\r\n        let dest = destination; //.nodes()[0];\r\n        let destNode = this.navTree.closestNode(dest);\r\n        let path = this.navTree.seekPath(srcNode, destNode);\r\n        // console.log(\"PATH FOUND BTWN POINTS\", { srcNode, destNode, path })\r\n        return path;\r\n    }\r\n\r\n\r\n\r\n    closestDeviceByType(cursor: Vector, machineTypes: (typeof Machine)[] = [], predicate: (Device) => boolean = () => true) {\r\n        let devices = this.findPoweredDevices()\r\n        devices = devices.filter(d => \r\n            (machineTypes.length > 0 ? machineTypes.some(machine => d.machine instanceof machine) : true)\r\n             && predicate(d)\r\n        )\r\n\r\n        if (devices && devices.length > 0) {\r\n            let proximity = (d) => cursor.distance(d.pos.add(d.building.pos))\r\n            return minBy(devices, proximity)\r\n        }\r\n    }\r\n\r\n    private buildNavTree() {\r\n        let ctrl = this.buildings[0] //.find(building => building.structure instanceof MissionControl);\r\n        if (ctrl) {\r\n            this.navTree = new NavigationTree(ctrl);\r\n        }\r\n    }\r\n\r\n    findAllDevices(): Device[] {\r\n        return flatSingle(this.buildings.map(b => b.getDevices()))\r\n    }\r\n\r\n    findPoweredDevices(): Device[] {\r\n        return flatSingle(this.activeBuildings.map(b => b.getDevices()))\r\n            .filter(d => d.built) /// ....\r\n    }\r\n\r\n    protected get activeBuildings() {\r\n        return this.buildings.filter(b => b.isActive)\r\n    }\r\n}\r\n","import * as ex from 'excalibur';\r\nimport { Actor, Color, Vector } from 'excalibur';\r\nimport { Building } from '../Building';\r\nimport { range, flatSingle, mixColors } from '../../Util';\r\nimport { Structure } from '../../models/Structure';\r\nimport { Hud } from '../Hud/Hud';\r\nimport { ResourceBlock, Economy, sumMarkets, emptyMarket, availableCapacity, PureValue } from '../../models/Economy';\r\nimport { Colony } from './Colony';\r\nimport { Population } from './Population';\r\nimport { Machine } from '../../models/Machine';\r\nimport { Device } from '../Device';\r\nimport { MechanicalOperation } from '../../models/MechanicalOperation';\r\nimport { World } from '../../models/World';\r\nimport { Colorize } from 'excalibur/dist/Drawing/SpriteEffects';\r\nimport { SkyLayers } from './SkyLayers';\r\n\r\nexport class Planet extends Actor {\r\n    colony: Colony\r\n    population: Population\r\n    // baseColor: Color\r\n    sky: Actor\r\n    skyLayers: SkyLayers\r\n\r\n    constructor(\r\n        public world: World,\r\n        public hud: Hud,\r\n        // public color: Color,\r\n        private onBuildingHover: (b: Building) => any,\r\n        private onDeviceHover: (d: Device) => any,\r\n        private w: number = 200000,\r\n        private depth: number = 40000,\r\n    ) {\r\n        super(0, depth / 2, w, depth, world.color)\r\n        this.traits = this.traits.filter(trait => !(trait instanceof ex.Traits.OffscreenCulling))\r\n\r\n        this.sky = new Actor(0, -depth, w, depth, world.skyColor)\r\n        this.add(this.sky)\r\n\r\n        let yBase = -depth / 2\r\n        let crustHeight = 40\r\n        this.createLayer(yBase, crustHeight, this.color.lighten(0.45))\r\n\r\n\r\n        let layerCount = 10\r\n        let layerHeight = depth / layerCount\r\n        for (let i of range(layerCount)) {\r\n            this.createLayer(\r\n                yBase + crustHeight + (layerHeight / 2) + (layerHeight * (i + 1)),\r\n                layerHeight,\r\n                this.color.darken(0.05 + 0.01 * i)\r\n            )\r\n        }\r\n        let c = this.color.clone()\r\n\r\n        this.skyLayers =new SkyLayers(\r\n           -depth/2, // - 20,\r\n           this.getWidth(),\r\n           this.color.lighten(0.04),\r\n           world.skyColor,\r\n           15\r\n        )\r\n        this.add(this.skyLayers)\r\n\r\n        this.colony = new Colony(0, -depth / 2)\r\n        this.add(this.colony)\r\n\r\n        this.population = new Population(this)\r\n        this.add(this.population)\r\n\r\n    }\r\n\r\n\r\n    private currentHour: number\r\n    get hour() { return this.currentHour }\r\n\r\n    setTime(time: number) {\r\n        this.hour = (Math.floor(time / 60)) % 24\r\n\r\n        let nextHour = this.hour + 1\r\n\r\n        let minute = Math.floor(time % 60)\r\n        let inc = (minute / 60)\r\n        // console.log({ hour: this.hour, nextHour: nextHour, minute, inc })\r\n\r\n        let oldC = this.skyColorForHour(this.hour),\r\n            newC = this.skyColorForHour(nextHour)\r\n\r\n        let mixC = mixColors(newC, oldC, inc)\r\n\r\n        this.sky.color = mixC // skyColor\r\n        // this.assignColors(mixC)\r\n    }\r\n\r\n    private assignColors(skyColor: Color) {\r\n        this.sky.color = skyColor\r\n\r\n        let inc = 0.04\r\n\r\n        let c = mixColors(\r\n            this.sky.color.lighten(5 * inc), //.lighten(3*inc).saturate(5*inc),\r\n            this.color.darken(5 * inc), //.lighten(2*inc)\r\n            0.7\r\n        )\r\n\r\n        this.skyLayers.setHi(c)\r\n\r\n        // this.skyLayer.mountainLayers.color = this.color.lighten(inc) //0.1)\r\n        // this.skyLayer.mountainLayers.skyColor = c.lighten(inc)\r\n        // this.skyLayer.mountains.color = c.lighten(inc)\r\n        // this.skyLayer.backMountainLayers.color = c.lighten(inc)\r\n        // this.skyLayer.backMountainLayers.skyColor = c.lighten(inc * 3).desaturate(inc)\r\n    }\r\n\r\n    skyColorForHour(hour: number) {\r\n        let c = this.world.skyColor.clone().darken(0.2).desaturate(0.1)\r\n\r\n        let colorMap = {\r\n            night: c.darken(0.7),\r\n            dawn: c.darken(0.2),\r\n            morning: c.lighten(0.1),\r\n            afternoon: c.lighten(0.2).desaturate(0.1),\r\n            evening: c,\r\n        }\r\n\r\n        let result: Color = null\r\n        if (hour >= 5 && hour < 8) { // dawn\r\n            let inc = (hour - 6) / 5\r\n            result = colorMap.dawn.lighten(inc)\r\n        } else if (hour >= 8 && hour < 12) { // morning\r\n            let inc = (hour - 8) / 24\r\n            result = colorMap.morning.lighten(inc)\r\n        } else if (hour >= 12 && hour < 14) { // early afternoon\r\n            result = colorMap.afternoon //.darken(inc)\r\n        } else if (hour >= 14 && hour < 18) {  // late afternoon\r\n            let inc = (hour - 14) / 16\r\n            result = colorMap.afternoon.darken(inc)\r\n        } else if (hour >= 18 && hour < 23) { // evening\r\n            let inc = (hour - 18) / 10\r\n            result = colorMap.evening.darken(inc)\r\n        } else if (hour >= 23) { // late night\r\n            result = colorMap.night\r\n        } else if (hour < 5) { // early morning\r\n            result = colorMap.night\r\n        }\r\n        return result\r\n    }\r\n\r\n    set hour(hour: number) {\r\n        this.currentHour = hour\r\n    }\r\n\r\n    set currentlyViewing(buildingOrDevice: Building | Device) {\r\n        if (buildingOrDevice instanceof Building) {\r\n            let b: Building = buildingOrDevice\r\n            this.onBuildingHover(b)\r\n        } else if (buildingOrDevice instanceof Device) {\r\n            let d: Device = buildingOrDevice\r\n            this.onDeviceHover(d)\r\n        }\r\n    }\r\n\r\n    private createLayer(y: number, size: number, color: Color) {\r\n        let theLayer = new Actor(0, y, this.getWidth(), size, color);\r\n        this.add(theLayer);\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta) {\r\n        super.draw(ctx, delta)\r\n\r\n        if (this.currentlyConstructing) {\r\n            this.currentlyConstructing.draw(ctx, delta)\r\n        }\r\n    }\r\n\r\n    get economy(): Economy {\r\n        // let devices = this.colony.findPoweredDevices()\r\n        // let economies = devices.map((d: Device) => d.machine.economy)\r\n\r\n        let buildings = this.colony.buildings\r\n        let economies = buildings.map(b => b.economy())\r\n        let theEconomy = economies.reduce(sumMarkets, emptyMarket())\r\n\r\n        let popularDemand = this.population.citizens.length\r\n        theEconomy['Shelter'].demand = popularDemand\r\n        theEconomy['Oxygen'].demand += popularDemand\r\n        theEconomy['Water'].demand += popularDemand\r\n        return theEconomy\r\n    }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n        this.colony.buildings.forEach(building => building.update(engine, delta))\r\n        this.population.citizens.forEach(citizen => citizen.update(engine, delta))\r\n    }\r\n\r\n    get currentlyConstructing() {\r\n        return this.colony.currentlyConstructing\r\n    }\r\n\r\n    gather(resource: ResourceBlock): any {\r\n        this.hud.resourceGathered(resource)\r\n    }\r\n\r\n    spend(resource: ResourceBlock): any {\r\n        this.hud.resourceExpended(resource)\r\n    }\r\n\r\n    placeBuilding(building: Building) {\r\n        this.colony.placeBuilding(building)\r\n    }\r\n\r\n    populate(pos: Vector, elite: boolean = false) {\r\n        if (this.population.citizens.length < this.maxPop) {\r\n            // console.log(\"POPULATIN'!\")\r\n            // let home = this.closestDevice(pos, [CloningVat])\r\n            this.population.increase(pos, elite) //home)\r\n        } else {\r\n            console.warn(\"too many citizens already to populate more!\")\r\n        }\r\n    }\r\n\r\n    get maxPop() {\r\n        let devices = this.colony.findPoweredDevices()\r\n        let economies = devices.map((d: Device) => d.machine.economy)\r\n        let theEconomyWithoutPeople = economies.reduce(sumMarkets, emptyMarket())\r\n\r\n        let values = [PureValue.Shelter, PureValue.Water, PureValue.Oxygen]\r\n        return Math.max(0, Math.min(\r\n            ...values.map(val => availableCapacity(theEconomyWithoutPeople, val))\r\n        ))\r\n    }\r\n\r\n    closestBuildingByType(cursor: Vector, structureTypes: (typeof Structure)[], predicate: (Building) => boolean = () => true): Building {\r\n        return this.colony.closestBuildingByType(cursor, structureTypes, predicate)\r\n    }\r\n\r\n    closestDevice(cursor: Vector, machineTypes: (typeof Machine)[] = [], predicate: (Device) => boolean = () => true) {\r\n        return this.colony.closestDeviceByType(cursor, machineTypes, predicate);\r\n    }\r\n\r\n    pathBetween(origin: Vector, destination: Building): Vector[] {\r\n        return this.colony.pathBetween(origin, destination)\r\n    }\r\n\r\n    pathBetweenPoints(origin: Vector, destination: Vector): Vector[] {\r\n        return this.colony.pathBetweenPoints(origin, destination)\r\n    }\r\n\r\n    get timeFactor() {\r\n        let devices = this.colony.findPoweredDevices()\r\n        let ops: MechanicalOperation[] = devices.map(d => d.operation) //.filter(op => op.type === 'accelerate')\r\n        return ops\r\n            .map(op => op.type === 'accelerate' ? op.factor : 1)\r\n            .reduce((acc, val) => val * acc, 1.0)\r\n    }\r\n\r\n    get storedResources(): ResourceBlock[] {\r\n        let devices = this.colony.findAllDevices()\r\n        return flatSingle(devices.map(d => d.product))\r\n    }\r\n}","import { Color } from \"excalibur\";\r\nexport class Modal {\r\n    private _element: HTMLDivElement;\r\n    // private titleLabel: Label\r\n    // private messageLabel: Label\r\n    constructor(private title: string, private message: string, private x: number, private y: number) {\r\n        this.makeDialog();\r\n        // super(x,y,200,200, Color.DarkGray)\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): any {\r\n        // console.log(\"DRAW MODAL\")\r\n        if (this._element) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._element.style.left = `${left + this.x}px`;\r\n            this._element.style.top = `${top + this.y}px`;\r\n        }\r\n    }\r\n\r\n    addButtons(buttonMap: {\r\n        [intent: string]: () => any;\r\n    }) {\r\n        // throw new Error(\"Method not implemented.\");\r\n        Object.entries(buttonMap).forEach(([intent, cb]) => {\r\n            let btn = this.buttonFactory(intent)\r\n            btn.onclick = cb\r\n            this._element.appendChild(btn)\r\n        })\r\n    }\r\n\r\n    teardown() {\r\n        document.body.removeChild(this._element)\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    private makeDialog() {\r\n        this._element = document.createElement('div');\r\n        this._element.style.position = 'absolute';\r\n        this._element.style.display = 'flex';\r\n        this._element.style.flexWrap = 'wrap';\r\n        this._element.style.width = '200px';\r\n        this._element.style.border = 'none'; //1px solid black'; //0.5px solid white';\r\n        document.body.appendChild(this._element);\r\n\r\n        let title = document.createElement('div');\r\n        title.textContent = this.title;\r\n        title.style.fontFamily = 'Verdana';\r\n        title.style.fontSize = '8pt';\r\n        title.style.fontWeight = '700';\r\n        title.style.textTransform = 'uppercase';\r\n        title.style.width = '200px';\r\n        title.style.color = Color.White.toRGBA();\r\n        title.style.backgroundColor = Color.Violet.darken(0.92).toRGBA();\r\n        title.style.padding = '4px';\r\n        title.style.margin = '0px';\r\n        this._element.appendChild(title);\r\n\r\n        let body = document.createElement('div');\r\n        body.textContent = this.message;\r\n        body.style.fontFamily = 'Verdana';\r\n        body.style.fontSize = '7pt';\r\n        body.style.fontWeight = '400';\r\n        body.style.width = '200px';\r\n        body.style.color = Color.White.toRGBA();\r\n        body.style.backgroundColor = Color.Violet.darken(0.92).toRGBA();\r\n        body.style.padding = '4px';\r\n        body.style.margin = '0px';\r\n        this._element.appendChild(body);\r\n    }\r\n\r\n    private buttonFactory(label: string, color: Color = Color.DarkGray) {\r\n        let bg = color.darken(0.5).desaturate(0.5).clone();\r\n        bg.a = 0.8;\r\n        let fg = color.lighten(0.8).desaturate(0.4).clone();\r\n        let modalButton = document.createElement('button');\r\n        modalButton.textContent = label;\r\n        modalButton.style.display = 'block';\r\n        modalButton.style.fontSize = '6pt';\r\n        modalButton.style.fontFamily = 'Verdana';\r\n        modalButton.style.fontWeight = '500';\r\n        modalButton.style.padding = '2px';\r\n        modalButton.style.width = '100px';\r\n        modalButton.style.textTransform = 'uppercase';\r\n        modalButton.style.border = 'none'; //1px solid rgba(255,255,255,0.08)';\r\n        modalButton.style.background = bg.toRGBA();\r\n        modalButton.style.color = fg.toRGBA();\r\n        modalButton.onmouseover = () => {\r\n            modalButton.style.background = bg.saturate(0.5).lighten(0.95).toRGBA();\r\n            modalButton.style.color = fg.lighten(0.9).toRGBA();\r\n        };\r\n        modalButton.onmouseleave = () => {\r\n            modalButton.style.background = bg.toRGBA();\r\n            modalButton.style.color = fg.toRGBA();\r\n        };\r\n        return modalButton;\r\n    }\r\n}\r\n","import { Color } from \"excalibur\";\r\nimport { EntityKind } from \"../../values/Entity\";\r\nimport { onlyUnique } from \"../../Util\";\r\nimport { Pane } from \"./Pane\";\r\n\r\nexport class Palette extends Pane {\r\n    built: EntityKind[] = [];\r\n    comprehended: EntityKind[] = [];\r\n\r\n    constructor(\r\n        name: string,\r\n        x: number,\r\n        y: number,\r\n        private all: EntityKind[],\r\n        private onButtonClick: (EntityKind) => any = null,\r\n        private onButtonEnter: (EntityKind) => any = null,\r\n        private comprehend = true \r\n    ) {\r\n        super(name, x, y)\r\n        this.makePalette();\r\n    }\r\n\r\n\r\n    updateBuilt(built: (EntityKind)[], unlocked: (EntityKind)[] = []) {\r\n        this.built = built;\r\n        if (this.comprehend) {\r\n            let nowComprehended = this.all.filter((e: EntityKind) => {\r\n                let s = new e();\r\n                let prereqs: (EntityKind)[] = s.prereqs;\r\n                return prereqs.every((prereq: EntityKind) => {\r\n                    let built = this.built.some((s: EntityKind) => s === prereq);\r\n                    return built;\r\n                });\r\n            });\r\n            this.comprehended = [\r\n                ...nowComprehended,\r\n                ...unlocked\r\n            ].filter(onlyUnique)\r\n        } else {\r\n            this.comprehended = [ ...this.built, ...unlocked ].filter(onlyUnique)\r\n        }\r\n        this.makePalette();\r\n    }\r\n\r\n    private makePalette() {\r\n\r\n        this.makeRootElement()\r\n\r\n\r\n        this.comprehended\r\n            .map((elem: EntityKind) => new elem())\r\n            .sort((a, b) => a.color > b.color ? -1 : 1)\r\n            .forEach(elem => {\r\n                if (elem.hide) { return }\r\n                let label = elem.name;\r\n                if (!this.built.map(m => new m().name).includes(elem.name)) {\r\n                    label += ' *';\r\n                }\r\n                let clr = elem.color;\r\n                let btn = this.buttonFactory(label, clr);\r\n                this._element.appendChild(btn);\r\n                if (this.onButtonEnter) {\r\n                    btn.onmouseenter = () => { this.onButtonEnter(elem); };\r\n                }\r\n                if (this.onButtonClick) {\r\n                    btn.onclick = () => { this.onButtonClick(elem); };\r\n                }\r\n            });\r\n    }\r\n\r\n}\r\n","import { Label, Actor, FontStyle, Color } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nimport { PureValue, Economy, ResourceBlock } from \"../../models/Economy\";\r\nimport { SpaceFunction } from \"../../models/SpaceFunction\";\r\nimport { Building } from \"../Building\";\r\nimport { Device } from \"../Device\";\r\nimport { countOccurrences, flatSingle } from \"../../Util\";\r\n\r\nexport class CardBody extends Actor {\r\n    description: Label\r\n    values: Label\r\n    notes: Label\r\n    footer: Label\r\n\r\n    constructor(private entity: Machine | Structure | SpaceFunction | Building | Device, x: number, y: number) {\r\n        super(x, y, 0, 0)\r\n        // resources / recipes\r\n\r\n        this.values = new Label('')\r\n        this.values.fontSize = 10\r\n        this.add(this.values)\r\n\r\n        this.notes = new Label('behavioral notes', 0, 30)\r\n        this.notes.fontSize = 11\r\n        this.add(this.notes)\r\n\r\n        this.description = new Label('description', 0, 60)\r\n        this.description.fontSize = 12\r\n        this.description.fontStyle = FontStyle.Italic\r\n        this.description.color = Color.DarkGray\r\n        this.add(this.description)\r\n\r\n        this.footer = new Label('footer', 20, 80)\r\n        this.footer.fontSize = 10\r\n        this.footer.fontStyle = FontStyle.Italic\r\n        this.add(this.footer)\r\n\r\n        this.show(entity)\r\n    }\r\n\r\n    describeResources = (arr: ResourceBlock[]) => {\r\n        let freqs = countOccurrences(arr)\r\n        return Object.keys(freqs)\r\n            .map(elem => `${elem} x${freqs[elem]}`)\r\n            .join(' + ')\r\n    }\r\n\r\n    show(entity: Machine | Structure | SpaceFunction | Building | Device) {\r\n        if (entity) {\r\n            this.description.text = entity.description;\r\n\r\n            if (entity instanceof Machine || entity instanceof Device) {\r\n                this.values.text =  this.describeEconomy(entity.economy)\r\n                // let footerNotes = []\r\n                let resourceDescription = entity instanceof Machine\r\n                    ? `Cost: ${this.describeResources(entity.cost)}`\r\n                    : (entity.built ? this.describeResources(entity.product) : 'under construction')\r\n                let forDome = entity instanceof Machine ? entity.forDome : entity.machine.forDome\r\n                let domeStatus = `For Dome: ${forDome ? 'Yes' : 'No'}`\r\n                this.footer.text = resourceDescription === ''\r\n                    ? domeStatus\r\n                    : [resourceDescription, domeStatus].join(' | ') \r\n                this.notes.text = '' //\r\n                let op = entity.operation\r\n                if (op) {\r\n                    if (op.type === 'recipe') {\r\n                        this.notes.text = `Turns ${op.consumes.join(' + ')} -> ${op.produces}.`\r\n                    } else if (op.type === 'generator') {\r\n                        this.notes.text = `Generates ${op.generates}.`\r\n                    } else if (op.type === 'store') {\r\n                        this.notes.text = `Stores ${op.stores.join(' + ')}`\r\n                    } else if (op.type === 'spawn') {\r\n                        this.notes.text = 'Decants clones.'\r\n                    }\r\n                }\r\n            } else if (entity instanceof SpaceFunction) {\r\n                let { capacity, workSpeed } = entity.bonuses\r\n                let bonusMessages = [];\r\n                if (capacity > 0) {\r\n                    bonusMessages.push(`+${capacity} cap`)\r\n                }\r\n                if (workSpeed > 1.0) {\r\n                    bonusMessages.push(`+${Math.floor((workSpeed*100)-100)}% efficiency` )\r\n                }\r\n                this.values.text = bonusMessages.join('; ') \r\n                this.notes.text = entity.machines.map(m => (new m()).name).join(' + ')\r\n                this.footer.text = ''\r\n            } else if (entity instanceof Building) {\r\n                this.values.text =  this.describeEconomy(entity.economy(false))\r\n                this.notes.text = entity.getDevices().map(d => d.machine.name).join(' + ')\r\n\r\n                let product = entity.getDevices()\r\n                    .map(d => d.product)\r\n                    .reduce((a, b) => a.concat(b), [])\r\n                this.footer.text = product.length > 0\r\n                    ? \"Currently contains: \" + this.describeResources(product)\r\n                    : ''\r\n            } else {\r\n                this.values.text = ''\r\n                this.notes.text = ''\r\n                this.footer.text = ''\r\n            }\r\n\r\n        }\r\n        // other bonuses? behaviors?\r\n    }\r\n\r\n    private describeEconomy(e: Economy): string {\r\n        let values = []\r\n        let econ = e // entity.economy\r\n        for (let value in PureValue) {\r\n            let { supply, demand } = econ[value]\r\n            let delta = supply - demand\r\n            if (delta > 0) {\r\n                values.push(`+${delta} ${value}`)\r\n            } else if (delta < 0) {\r\n                values.push(`${delta} ${value}`)\r\n            }\r\n        }\r\n        return values.join(' | ')\r\n    }\r\n}\r\n","import { Label, Color, Actor, FontStyle } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\nimport { SpaceFunction } from \"../../models/SpaceFunction\";\r\nimport { Building } from \"../Building\";\r\nimport { Device } from \"../Device\";\r\nexport class CardTitle extends Actor {\r\n    \r\n    name: Label;\r\n    type: Label;\r\n    constructor(private entity: Machine | Structure | SpaceFunction | Building | Device, x: number, y: number) {\r\n        super(x, y, 14, 32, entity && entity.color || Color.Gray);\r\n        this.name = new Label(entity && entity.name || '..', 20, 16)\r\n        this.name.fontSize = 28\r\n        this.name.color = Color.Black\r\n        this.add(this.name)\r\n\r\n        this.type = new Label('..', 220, 18)\r\n        this.type.fontSize = 10\r\n        this.type.color = Color.Gray\r\n        this.type.fontStyle = FontStyle.Italic\r\n        this.add(this.type)\r\n\r\n        if (entity) {\r\n            this.announce(entity)\r\n        }\r\n    }\r\n\r\n    announce(entity: Machine | Structure | SpaceFunction | Building | Device): any {\r\n        this.name.text = entity.name\r\n        this.color = entity.color.desaturate(0.5).darken(0.2)\r\n        if (entity instanceof Machine) { this.type.text = `${DeviceSize[entity.size]} Machine Type` }\r\n        if (entity instanceof Structure) { this.type.text = 'Structure' }\r\n        if (entity instanceof SpaceFunction) { this.type.text = 'Function' }\r\n        if (entity instanceof Building) { this.type.text = 'Building' }\r\n        if (entity instanceof Device) { this.type.text = `${DeviceSize[entity.size]} Machine` }\r\n    }\r\n}\r\n","import { Color, Actor } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nimport { CardTitle } from \"./CardTitle\";\r\nimport { CardBody } from \"./CardBody\";\r\nimport { SpaceFunction } from \"../../models/SpaceFunction\";\r\nimport { Building } from \"../Building\";\r\nimport { Device } from \"../Device\";\r\n\r\nexport class Card extends Actor {\r\n    title: CardTitle\r\n    cardBody: CardBody\r\n    image: HTMLImageElement\r\n\r\n    constructor(private entity: Machine | Structure | SpaceFunction | Building | Device, x: number, y: number) {\r\n        super(x + 160, y + 90, 320, 180, Color.White);\r\n        let x0 = -150, y0 = -50;\r\n        this.title = new CardTitle(entity, x0 - 3, y0); //x, y)\r\n        this.add(this.title);\r\n        this.cardBody = new CardBody(entity, x0 + 14, y0 + 40)\r\n        this.add(this.cardBody)\r\n\r\n        this.image = new Image();\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta) {\r\n        super.draw(ctx, delta)\r\n        if (this.entity) {\r\n            if (this.entity instanceof Machine || this.entity instanceof Device) {\r\n                // if (this.image.src !== null) {\r\n                    let ix = this.pos.x + 48, iy = this.pos.y - 16\r\n                    let isz = 92\r\n\r\n                    // maybe try-fail around this? something for painting?\r\n                    ctx.drawImage(this.image, ix, iy, isz, isz)\r\n                // }\r\n            }\r\n        }\r\n    }\r\n\r\n    present(entity: Machine | Structure | SpaceFunction | Building | Device): any {\r\n        this.title.announce(entity)\r\n        this.cardBody.show(entity)\r\n\r\n        this.entity = entity\r\n        let src = null\r\n        if (this.entity instanceof Machine) { //} || this.entity instanceof Device) {\r\n            src = this.entity.image\r\n        } else if (this.entity instanceof Device) {\r\n            src = this.entity.machine.image\r\n        }\r\n        // console.log(\"img src\", { src })\r\n        if (src) {\r\n            this.image.src = src\r\n        }\r\n    }\r\n\r\n}\r\n","import { Sound, Color } from \"excalibur\";\r\nimport { sample } from \"../../Util\";\r\n\r\ninterface MusicPlayerPlay { type: 'play'}\r\ninterface MusicPlayerPause { type: 'pause'}\r\ninterface MusicPlayerStop { type: 'stop'}\r\ninterface MusicPlayerNext { type: 'next'}\r\ntype MusicPlayerAction = MusicPlayerPlay | MusicPlayerPause | MusicPlayerStop | MusicPlayerNext\r\n\r\nexport class MusicPlayer {\r\n    private _wrapper: HTMLDivElement;\r\n    private _element: HTMLDivElement;\r\n    private _titleElem: HTMLSpanElement;\r\n\r\n    currentTrack: string\r\n    paused: boolean = false\r\n\r\n    constructor(private x: number, private y: number, private playlist: {\r\n        [track: string]: Sound;\r\n    }) {\r\n        this.makePlayer();\r\n        setTimeout(() => { this.startMusic() }, 3000)\r\n        this._titleElem.textContent = `Getting ready...`;\r\n        this.currentTrack = sample(Object.keys(this.playlist)); //[0];\r\n    }\r\n\r\n    startMusic() {\r\n        this._titleElem.textContent = `Playing: ${this.currentTrack}`;\r\n        this.playlist[this.currentTrack].play()\r\n        .then(() => {\r\n                this.advancePlaylist()\r\n        })\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D) {\r\n        if (this._element) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._wrapper.style.left = `${left + this.x}px`;\r\n            this._wrapper.style.top = `${top + this.y}px`;\r\n        }\r\n    }\r\n\r\n    private makePlayer() {\r\n        this._wrapper = document.createElement('div')\r\n        this._wrapper.style.position = 'absolute'\r\n        this._wrapper.style.width = '20%'\r\n        this._wrapper.style.maxHeight = '20px'\r\n        this._wrapper.style.textAlign = 'left'\r\n        this._wrapper.style.border = 'none';\r\n        this._wrapper.style.overflow = 'hidden';\r\n        document.body.appendChild(this._wrapper);\r\n\r\n        this._element = document.createElement('div');\r\n        this._element.style.display = 'inline-block';\r\n        this._element.style.border = 'none';\r\n        this._wrapper.appendChild(this._element)\r\n\r\n        this._titleElem = document.createElement('span');\r\n        this._titleElem.style.fontFamily = 'Verdana';\r\n        this._titleElem.style.fontSize = '7pt';\r\n        this._titleElem.style.padding = '24px'\r\n        this._titleElem.style.color = 'white';\r\n        this._wrapper.appendChild(this.inlineBlock(this._titleElem));\r\n\r\n        let play = this.iconFactory({ type: 'play' }, '&#9655;')\r\n        this._wrapper.appendChild(this.inlineBlock(play));\r\n\r\n        let pause = this.iconFactory({ type: 'pause' }, '&#10072; &#10072;')\r\n        this._wrapper.appendChild(this.inlineBlock(pause))\r\n\r\n        let next = this.iconFactory({ type: 'next' }, '&rarr;')\r\n        this._wrapper.appendChild(this.inlineBlock(next))\r\n\r\n    }\r\n\r\n    handleAction(action: MusicPlayerAction) {\r\n        if (action.type === 'pause') {\r\n            this.song.pause()\r\n            this.paused = true\r\n            this._titleElem.textContent = `Paused: ${this.currentTrack}`;\r\n        } else if (action.type === 'play') {\r\n            this.song.play()\r\n            this.paused = false\r\n            this._titleElem.textContent = `Playing: ${this.currentTrack}`;\r\n        } else if (action.type === 'next') {\r\n            if (this.paused) {\r\n                this.song.play()\r\n                this.paused = false\r\n            }\r\n            this.song.stop()\r\n        }\r\n    }\r\n\r\n    advancePlaylist() {\r\n        let ndx = this.trackNames.indexOf(this.currentTrack)\r\n        ndx = (ndx + 1) % this.trackNames.length\r\n        this.currentTrack = this.trackNames[ndx]\r\n        this.startMusic()\r\n    }\r\n\r\n    get trackNames() { return Object.keys(this.playlist) }\r\n    get song() { return this.playlist[this.currentTrack] }\r\n\r\n    private inlineBlock(elem) {\r\n        let block = document.createElement('div');\r\n        block.style.display = 'inline-block';\r\n        block.style.border = 'none';\r\n        block.append(elem)\r\n        return block\r\n    }\r\n\r\n    private iconFactory(\r\n        action: MusicPlayerAction,\r\n        iconContent: string,\r\n    ) {\r\n        let bg = Color.Transparent\r\n        let fg = Color.White\r\n        let icon = document.createElement('button')\r\n        icon.innerHTML = iconContent\r\n        icon.style.display = 'block';\r\n        icon.style.fontSize = '7pt';\r\n        icon.style.fontFamily = 'Verdana';\r\n        icon.style.border = 'none'\r\n        icon.style.padding = '4px'\r\n        icon.style.background = bg.toRGBA();\r\n        icon.style.color = fg.toRGBA();\r\n        icon.onclick = () => { this.handleAction(action) }\r\n        return icon\r\n    }\r\n\r\n}\r\n","import { Label, Color, Actor } from \"excalibur\";\r\nexport class EconomicValue extends Actor {\r\n    private nameLabel: Label;\r\n    private valueLabel: Label;\r\n    constructor(name: string, x: number, y: number) {\r\n        super(x, y, 0, 0);\r\n        this.nameLabel = new Label(name, x, y);\r\n        this.nameLabel.fontSize = 10;\r\n        this.nameLabel.color = Color.White.darken(0.2);\r\n        this.add(this.nameLabel);\r\n        this.valueLabel = new Label('0', x + 40, y);\r\n        this.valueLabel.fontSize = 10;\r\n        this.valueLabel.color = Color.White.darken(0.2);\r\n        this.add(this.valueLabel);\r\n    }\r\n    setCount(count: number) {\r\n        this.valueLabel.text = `${count}`;\r\n        let c = Color.Gray;\r\n        if (count > 0) {\r\n            c = Color.Green;\r\n        }\r\n        else if (count < 0) {\r\n            c = Color.Red;\r\n        }\r\n        this.valueLabel.color = c;\r\n    }\r\n}\r\n","import { Actor, Color } from \"excalibur\";\r\nimport { Economy, PureValue, availableCapacity, allValues } from \"../../models/Economy\";\r\nimport { EconomicValue } from \"./EconomicValue\";\r\nimport { eachChunk } from \"../../Util\";\r\n\r\nexport class EconomyView extends Actor {\r\n    private valueLabels: { [key in PureValue]: EconomicValue } = {\r\n        Power: null,\r\n        Oxygen: null,\r\n        Water: null,\r\n        Shelter: null,\r\n        Hope: null,\r\n        Joy: null,\r\n        Wisdom: null,\r\n        Wealth: null,\r\n        Beauty: null,\r\n        Wonder: null\r\n    }\r\n\r\n    constructor(market: Economy, x: number, y: number) {\r\n        super(x, y, 0, 0) //Color.DarkGray.clone().darken(0.5));\r\n\r\n        let index = 0\r\n        for (let [val1, val2] of eachChunk(allValues, 2)) {\r\n            this.addValue(index * 32, 0, val1)\r\n            this.addValue(index * 32, 7, val2)\r\n            index += 1\r\n        }\r\n\r\n        this.updateView(market);\r\n    }\r\n\r\n    private addValue(x: number, y: number, value: PureValue) {\r\n        let valueLabel: EconomicValue = new EconomicValue(value, x, y)\r\n        this.valueLabels[value] = valueLabel\r\n        this.add(valueLabel)\r\n    }\r\n\r\n    updateView(updatedEconomy: Economy): void {\r\n        let market = updatedEconomy;\r\n\r\n        for (let value of allValues) {\r\n            this.valueLabels[value].setCount(\r\n                availableCapacity(market, value)\r\n            )\r\n        }\r\n\r\n    }\r\n}\r\n","import { Label, Color, Actor, UIActor } from \"excalibur\";\r\nimport { ResourceBlock, blockColor } from \"../../models/Economy\";\r\nclass Tooltip extends Actor {\r\n    messageLabel: Label\r\n    constructor(x: number, y: number, message: string) {\r\n        super(x, y, 60, 16, Color.Black)\r\n        this.messageLabel = new Label(message, -16, 6, 'Verdana')\r\n        this.messageLabel.color = Color.White\r\n        this.add(this.messageLabel)\r\n    }\r\n}\r\n\r\nexport class ResourceListEntry extends UIActor {\r\n    icon: Actor;\r\n    count: Label;\r\n    hovering: boolean = false\r\n    tooltip: Tooltip\r\n\r\n    constructor(x: number, y: number, resourceBlock: ResourceBlock, protected value: number) {\r\n        super(x-5, y-5, 20, 10)\r\n        let icon = new Actor(5, 5, 10, 10, blockColor(resourceBlock));\r\n        this.add(icon);\r\n        this.count = new Label(`x${value}`, 15, 10, 'Helvetica');\r\n        this.count.fontSize = 10;\r\n        this.count.color = Color.White;\r\n        this.add(this.count);\r\n\r\n        this.tooltip = new Tooltip(0, 5, ResourceBlock[resourceBlock])\r\n        this.tooltip.visible = false\r\n        this.add(this.tooltip)\r\n\r\n\r\n        this.on('pointerenter', () => {\r\n            this.tooltip.visible = true\r\n        })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.tooltip.visible = false\r\n        })\r\n    }\r\n\r\n\r\n    credit(amt: number) {\r\n        this.value += amt;\r\n        this.count.text = `x${this.value}`;\r\n    }\r\n\r\n    debit(amt: number) {\r\n        this.value -= amt\r\n        this.count.text = `x${this.value}`\r\n    }\r\n}\r\n","import { Color, Actor } from \"excalibur\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\nimport { ResourceListEntry } from \"./ResourceListEntry\";\r\nimport { eachCons, eachChunk } from \"../../Util\";\r\nexport class ResourcesList extends Actor {\r\n    entries: {\r\n        [block in ResourceBlock]: ResourceListEntry;\r\n    } = {\r\n            [ResourceBlock.Biomass]: null,\r\n            [ResourceBlock.Idea]: null,\r\n            [ResourceBlock.Ore]: null,\r\n            [ResourceBlock.Meal]: null,\r\n            [ResourceBlock.Mineral]: null,\r\n            [ResourceBlock.Data]: null,\r\n            [ResourceBlock.Alloy]: null,\r\n            [ResourceBlock.Bioplasma]: null,\r\n            [ResourceBlock.Algorithm]: null,\r\n            [ResourceBlock.Argent]: null,\r\n            [ResourceBlock.Aurum]: null,\r\n            [ResourceBlock.Omnium]: null,\r\n        };\r\n\r\n    constructor(x: number, y: number) {\r\n        super(x,y,0,0); // 200, 60, Color.Green.clone().darken(0.8));\r\n        let rx0 = 0, ry0 = -5;\r\n        let resources = [\r\n            ResourceBlock.Meal,\r\n            ResourceBlock.Bioplasma,\r\n\r\n            ResourceBlock.Data,\r\n            ResourceBlock.Algorithm,\r\n\r\n            ResourceBlock.Mineral,\r\n            ResourceBlock.Alloy,\r\n\r\n            ResourceBlock.Argent,\r\n            ResourceBlock.Aurum,\r\n        ];\r\n\r\n        eachChunk(resources, 2).forEach(([res1, res2], index) => {\r\n            let rx = rx0 + index * 36, ry = ry0 + index * 0;\r\n            this.addEntry(rx, ry, res1)\r\n            this.addEntry(rx, ry + 14, res2)\r\n        });\r\n    }\r\n\r\n    private addEntry(x: number, y: number, res: ResourceBlock) {\r\n        let entry = new ResourceListEntry(x, y, res, 0);\r\n        this.add(entry);\r\n        this.entries[res] = entry;\r\n    }\r\n\r\n    increment(resource: ResourceBlock) {\r\n        let res = this.entries[resource]\r\n        if (res) {\r\n            res.credit(1);\r\n        }\r\n    }\r\n\r\n    decrement(resource: ResourceBlock) {\r\n        let res = this.entries[resource]\r\n        if (res) {\r\n            res.debit(1)\r\n        }\r\n    }\r\n}\r\n","import { Label, Color, Actor, FontStyle, FontUnit } from \"excalibur\";\r\nimport { Economy, ResourceBlock, PureValue } from \"../../models/Economy\";\r\nimport { ResourcesList } from \"./ResourcesList\";\r\nimport { EconomyView } from \"./EconomyView\";\r\nimport { MusicPlayer } from \"./MusicPlayer\";\r\nimport { Resources } from \"../../Resources\";\r\nimport { drawRect } from \"../../Painting\";\r\n\r\nexport class StatusAnalysisView extends Actor {\r\n    private messageLabel: Label\r\n    private popLabel: Label\r\n\r\n    private resources: ResourcesList\r\n    private economy: EconomyView\r\n\r\n    private musicPlayer: MusicPlayer\r\n    private clock: Label\r\n\r\n    constructor(market: Economy, w: number, h: number) {\r\n        super(0,0, w*2,h, Color.DarkGray.clone().darken(0.92));\r\n\r\n        let ty = 14\r\n\r\n        let brand = new Label(\"OSIRIS\", 5, ty+18)\r\n        brand.fontSize = 28\r\n        brand.color = Color.Gray\r\n        brand.fontStyle = FontStyle.Italic\r\n        this.add(brand)\r\n\r\n        let version = new Label(\"v0.1\", 100, ty + 14)\r\n        version.fontSize = 7\r\n        version.color = Color.Gray.darken(0.4)\r\n        this.add(version)\r\n\r\n\r\n        this.resources = new ResourcesList(130, ty)\r\n        this.add(this.resources)\r\n\r\n        this.economy = new EconomyView(market, 280, ty)\r\n        this.add(this.economy)\r\n\r\n        this.clock = new Label('current time', 600, ty, 'Verdana')\r\n        this.clock.color = Color.White // 'white'\r\n        this.add(this.clock)\r\n\r\n        this.popLabel = new Label(\"\", 600, ty + 14, 'Verdana')\r\n        this.popLabel.fontSize = 10\r\n        this.popLabel.color = Color.White\r\n        this.add(this.popLabel)\r\n\r\n        this.messageLabel = new Label('hi', 750, ty, 'Verdana')\r\n        this.messageLabel.fontSize = 10\r\n        this.messageLabel.color = Color.White\r\n        this.messageLabel.fontStyle = FontStyle.Italic\r\n        this.add(this.messageLabel)\r\n\r\n        this.musicPlayer = new MusicPlayer(726, 12, {\r\n            'Crater Rock': Resources.CraterRock,\r\n            'Indivision': Resources.Indivision,\r\n            'Future Tense': Resources.FutureTense,\r\n            // 'Isomer': Resources.Isomer,\r\n            'Understanding': Resources.Understanding,\r\n            // 'Outbound': Resources.Outbound,\r\n            'Assembler': Resources.Assembler,\r\n        })\r\n// // enable propagating pointer events\r\n// this.enableCapturePointer = true;\r\n// // // enable move events, warning: performance intensive!\r\n// this.capturePointer.captureMoveEvents = true;\r\n//         this.on('pointerenter', () => { alert('hover!')})\r\n    }\r\n\r\n    draw(ctx, delta) {\r\n        super.draw(ctx, delta)\r\n        this.musicPlayer.draw(ctx)\r\n        // drawRect(\r\n        //     ctx,\r\n        //     {x: this.x, y: this.y, width: this.getWidth(), height: this.getHeight() },\r\n        //     0,\r\n        //     Color.Magenta\r\n        // )\r\n    }\r\n\r\n    incrementResource(res: ResourceBlock) {\r\n        this.resources.increment(res)\r\n    }\r\n\r\n    decrementResource(res: ResourceBlock) {\r\n        this.resources.decrement(res)\r\n    }\r\n\r\n    setMessage(text: string) { this.messageLabel.text = text }\r\n\r\n    showEconomy(updatedEconomy: Economy): any {\r\n        this.economy.updateView(updatedEconomy)\r\n    }\r\n\r\n    showPopCap(curr: any, cap: any): any {\r\n        this.popLabel.text = `Pop: ${curr}/${cap}`\r\n    }\r\n\r\n    setClock(time: number = 0) {\r\n        let days = (Math.floor(time / (60 * 24))+1).toString()\r\n        let hh = Math.floor(time / 60) % 24\r\n        let hours = Math.floor((hh + 11) % 12 + 1).toString()\r\n        let minutes = Math.floor(time % 60).toString()\r\n        let ampm = hh < 12 ? 'AM' : 'PM'\r\n        this.clock.text = `Day ${days}. ${hours}:${minutes.padStart(2, '0')} ${ampm}`\r\n    }\r\n    \r\n}\r\n","import { UIActor, Label, Color } from \"excalibur\";\r\nimport { Structure, Corridor, SurfaceRoad, Ladder, allStructures } from \"../../models/Structure\";\r\nimport { Game } from \"../../Game\";\r\nimport { ResourceBlock, emptyMarket, PureValue } from \"../../models/Economy\";\r\nimport { Machine, allMachines } from \"../../models/Machine\";\r\nimport { flatSingle } from \"../../Util\";\r\nimport { Colony } from \"../Planet/Colony\";\r\nimport { StatusAnalysisView } from \"./StatusAnalysisView\";\r\nimport { Device } from \"../Device\";\r\nimport { Planet } from \"../Planet/Planet\";\r\nimport { Card } from \"./Card\";\r\nimport { allSpaceFunctions, SpaceFunction } from \"../../models/SpaceFunction\";\r\nimport { Palette } from \"./Palette\";\r\nimport { Building } from \"../Building\";\r\nimport { Modal } from \"./Modal\";\r\nimport { TechTree } from \"../../models/TechTree\";\r\nimport { Pane } from \"./Pane\";\r\nimport { Citizen } from \"../Citizen\";\r\n\r\nclass CitizenList extends Pane {\r\n    citizens: Citizen[] = []\r\n\r\n    constructor(x: number, y: number, private onCitizenSelect: (Citizen) => any = null) {\r\n        super(\"Citizens\", x, y)\r\n    }\r\n\r\n    updateRoster(citizens: Citizen[]): any {\r\n        this.citizens = citizens\r\n        this.makeRoster()\r\n    }\r\n\r\n    private makeRoster() {\r\n        this.makeRootElement()\r\n        this.citizens.forEach(citizen => {\r\n            let btn = this.buttonFactory(citizen.name, Color.DarkGray)\r\n            this._element.appendChild(btn)\r\n            if (this.onCitizenSelect) {\r\n                btn.onclick = () => { this.onCitizenSelect(citizen) }\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport class Hud extends UIActor {\r\n    // private hint: Label\r\n\r\n    private hidePalettes: boolean = true\r\n    private structurePalette: Palette\r\n    private machinePalette: Palette\r\n    private functionPalette: Palette\r\n\r\n    // private showCitizenList: boolean = false\r\n    private citizenList: CitizenList\r\n\r\n\r\n    private card: Card\r\n    private status: StatusAnalysisView\r\n\r\n    private modal: Modal = null\r\n\r\n    static structuresForPalette = [\r\n        SurfaceRoad,\r\n        Corridor,\r\n        Ladder,\r\n        ...allStructures\r\n    ];\r\n    static machinesForPalette = allMachines\r\n    static functionsForPalette = allSpaceFunctions\r\n\r\n    // viewportHeight: nu\r\n\r\n    constructor(\r\n        private game: Game,\r\n        private onBuildingSelect = null,\r\n        private onMachineSelect = null,\r\n        private onFunctionSelect = null,\r\n        private onCitizenSelect = null,\r\n    ) {\r\n        super(0, 0, game.canvasWidth, game.canvasHeight);\r\n        let canvasHeight = game.canvasHeight / window.devicePixelRatio;\r\n        let canvasWidth = game.canvasWidth / window.devicePixelRatio;\r\n\r\n        this.status = new StatusAnalysisView(emptyMarket(), game.canvasWidth, 64);\r\n        this.add(this.status)\r\n\r\n        let displayInfo = (e) => this.showCard(e)\r\n        this.machinePalette = new Palette('Machine', 20, 55, allMachines, onMachineSelect, displayInfo) // (e) => this.showCard(e))\r\n        this.structurePalette = new Palette('Structure', 20, 300, Hud.structuresForPalette, onBuildingSelect, displayInfo)\r\n        this.functionPalette = new Palette('Function', 20, 435, Hud.functionsForPalette, onFunctionSelect, displayInfo, false)\r\n\r\n        this.citizenList = new CitizenList(canvasWidth - 220, 55, onCitizenSelect) //, (citizen) => {})\r\n\r\n\r\n        this.card = new Card(null, 20, canvasHeight - 200)\r\n        this.add(this.card)\r\n\r\n\r\n    }\r\n\r\n    systemMessage(message: string, title: string = 'Commander, a message for you',\r\n      buttons: { [intent: string]: () => any }) {\r\n\r\n        let canvasHeight = this.game.canvasHeight / window.devicePixelRatio;\r\n        let canvasWidth = this.game.canvasWidth / window.devicePixelRatio;\r\n        this.modal = new Modal(\r\n            title,\r\n            message,\r\n            canvasWidth/2 - 100,\r\n            canvasHeight/2 - 100\r\n        ) \r\n        this.modal.addButtons(buttons)\r\n\r\n        // this.showModal = true\r\n        // this.modal = {\r\n            // message, title\r\n        // }\r\n    }\r\n\r\n    closeSystemMessage() {\r\n        console.log(\"hide system message\")\r\n        this.modal.teardown()\r\n        this.modal = null\r\n    }\r\n\r\n\r\n    showPalettes() {\r\n        this.hidePalettes = false\r\n    }\r\n\r\n    setStatus(text: string) { this.status.setMessage(text) }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta)\r\n        if (!this.hidePalettes) {\r\n            this.structurePalette.draw(ctx)\r\n            this.machinePalette.draw(ctx)\r\n            this.functionPalette.draw(ctx)\r\n        }\r\n\r\n        if (this.modal) {\r\n            // console.log(\"okay, we have modal!!\")\r\n            this.modal.draw(ctx)\r\n        } else {\r\n            // console.log(\"no modal\")\r\n        }\r\n        // if (this.showModal)\r\n        this.citizenList.draw(ctx)\r\n    }\r\n\r\n    update(game: Game, delta: number) {\r\n        super.update(game, delta)\r\n    }\r\n\r\n    resourceGathered(resource: ResourceBlock) {\r\n        this.status.incrementResource(resource)\r\n    }\r\n\r\n    resourceExpended(resource: ResourceBlock) {\r\n        this.status.decrementResource(resource)\r\n    }\r\n\r\n    updateDetails(planet: Planet, techTree: TechTree, rebuildPalettes: boolean = true, time: number = 0) {\r\n        if (!planet) { return }\r\n        if (rebuildPalettes) {\r\n            this.updatePalettes(planet.colony, techTree)\r\n        }\r\n        this.updateEconomy(planet)\r\n        this.updateMaxPop(planet.economy[PureValue.Shelter].demand, planet.maxPop)\r\n\r\n        this.status.setClock(time)\r\n\r\n        if (planet.population.citizens.some(c => !this.citizenList.citizens.includes(c))) { \r\n            this.citizenList.updateRoster(planet.population.citizens)\r\n        }\r\n    }\r\n\r\n    showCard(entity: Machine | Structure | SpaceFunction | Building | Device) {\r\n        this.card.present(entity)\r\n    }\r\n\r\n    private updateMaxPop(curr, cap) {\r\n        this.status.showPopCap(curr, cap)\r\n    }\r\n\r\n    private updateEconomy(planet: Planet) {\r\n        this.status.showEconomy(planet.economy)\r\n    }\r\n\r\n    private updatePalettes(colony: Colony, techTree: TechTree) {\r\n        this.updateBuildingPalette(colony)\r\n        this.updateMachinePalette(colony, techTree)\r\n        this.updateFunctionPalette(colony)\r\n    }\r\n\r\n    private updateBuildingPalette(colony: Colony) {\r\n        let builtStructures =\r\n            Hud.structuresForPalette.filter((structure) => colony.buildings.some(b => b.structure instanceof structure))\r\n        if (!builtStructures.every(s => this.structurePalette.built.includes(s))) {\r\n            this.structurePalette.updateBuilt(builtStructures)\r\n        }\r\n    }\r\n\r\n    private updateMachinePalette(colony: Colony, techTree: TechTree) {\r\n        let devices = colony.findAllDevices()\r\n        let builtMachines = [\r\n            ...Hud.machinesForPalette.filter((machine) => devices.some(d => d.machine instanceof machine && d.built)),\r\n            // ...techTree.allUnlockedMachines()\r\n        ]\r\n        if (!builtMachines.every(machine => this.machinePalette.built.includes(machine))) {\r\n            this.machinePalette.updateBuilt(builtMachines, techTree.allUnlockedMachines())\r\n        }\r\n    }\r\n\r\n    private updateFunctionPalette(colony: Colony) {\r\n        let builtReifiedFunctions = flatSingle(colony.buildings.map(b => b.spaceFunction))\r\n        let builtFunctions = Hud.functionsForPalette.filter((fn) => builtReifiedFunctions.some(rf => rf instanceof fn))\r\n        if (!builtFunctions.every(fn => this.functionPalette.built.includes(fn))) {\r\n            this.functionPalette.updateBuilt(builtFunctions)\r\n        }\r\n    }\r\n\r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Device } from \"../Device\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { drawPatternedRect, drawRect, drawPatternedPoly, drawPoly } from \"../../Painting\";\r\nimport { measureDistance, eachCons } from \"../../Util\";\r\nimport { BackgroundPattern } from \"./BackgroundPatterns\";\r\n// import { drawPatternedRect, drawRect } from \"../../Util\";\r\n\r\nexport class MediumSurfaceRoomView extends Building {\r\n    hideBox = true\r\n    showLabel = true\r\n    // hideLabe\r\n\r\n    devicePlaceSize = DeviceSize.Medium\r\n    devicePlaceCount = 3\r\n    get floorHeight() { return this.getHeight() / 6 }\r\n\r\n   nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight() - 16\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - 12 \r\n        y -= getVisibleDeviceSize(this.devicePlaceSize) / 3.5\r\n\r\n        let ds = [\r\n            new Vector(x - w/2, y),\r\n            ...(this.devicePlaceCount > 2 ? [new Vector(x,y)] : []),\r\n            new Vector(x + w/2, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, this.devicePlaceSize)) \r\n    }\r\n\r\n    //deviceInteractionPlaces() {\r\n\r\n    //}\r\n\r\n    graph(sg) {\r\n        let g = super.graph(sg)\r\n        let find = (s: Vector) => g.findOrCreate(s, measureDistance)\r\n        let slots: Vector[] = this.slots().map(s => s.pos)\r\n        // draw from left slot to each device place to right slot?\r\n        let devices = this.deviceInteractionPlaces().map(p => find(p)) //d.position))\r\n        eachCons(devices, 2).forEach(([left, right]) => g.edge(left, right))\r\n\r\n        if (this.isGroundFloor) {\r\n            let leftSlot = find(slots[0]), rightSlot = find(slots[slots.length - 1])\r\n            g.edge(leftSlot, devices[0])\r\n            g.edge(devices[devices.length - 1], rightSlot)\r\n        } else {\r\n            let topSlot = find(slots[1])\r\n            g.edge(devices[1], topSlot)\r\n        }\r\n\r\n        let node = this.nodes()[0]\r\n        devices.forEach(device => g.edge(device, find(node)))\r\n        // g.edge(devices[1], find(slots[1]))\r\n\r\n        return g\r\n    }\r\n\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n        let slotY = this.getHeight() - this.floorHeight;\r\n\r\n        if (this.isGroundFloor) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x, this.pos.y + slotY,\r\n                    Orientation.Left\r\n                )\r\n            )\r\n        }\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() / 2,\r\n                this.pos.y + this.getHeight(), // + (2*this.floorHeight),\r\n                Orientation.Down\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() / 2,\r\n                this.pos.y - 1, // + this.getHeight(),\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n\r\n        if (this.isGroundFloor) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x + this.getWidth(),\r\n                    this.pos.y + slotY,\r\n                    Orientation.Right\r\n                )\r\n            )\r\n        }\r\n\r\n\r\n        return theSlots;\r\n    }\r\n\r\n    get isGroundFloor() {\r\n        return !this.parentSlot || !(this.parentSlot.parent instanceof MediumSurfaceRoomView)\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        if (this.planet.colony.buildings.length === 0) {\r\n            cursor.y = this.planet.getTop();\r\n        } // else {\r\n            // this.alignToSlot(cursor)\r\n        // }\r\n        return cursor;\r\n    }\r\n\r\n    reshape(cursor: Vector) {\r\n        if (this.planet.colony.buildings.length === 0) {\r\n            this.pos = cursor\r\n            this.pos.y -= this.getHeight() - 2 - this.floorHeight // hm\r\n        } else {\r\n            this.alignToSlot(cursor)\r\n\r\n        }\r\n    }\r\n\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color = this.mainColor()\r\n\r\n        ctx.fillStyle = color.toRGBA()\r\n\r\n        // ctx.fillRect(this.pos.x, this.pos.y, this.getWidth(), this.getHeight())\r\n        // let rect = \r\n            // { x: this.pos.x, y: this.pos.y, width: this.getWidth(), height: this.getHeight() };\r\n        drawPatternedPoly(\r\n            ctx,\r\n            this.angledRoofPoly(),\r\n            this.backgroundPattern,\r\n            this.mainColor()\r\n        )\r\n\r\n\r\n        if (!this.isActive) {\r\n            // draw overlay rect that darkens\r\n            let c = Color.Black.clone()\r\n            c.a = 0.6\r\n            drawPoly(ctx, this.angledRoofPoly(), c)\r\n        }\r\n\r\n        // floor\r\n        let floorColor = this.planet.color.darken(0.6)\r\n        let floorEdgeHeight = 12 // 6\r\n        let floorOff = -5\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorEdgeHeight,\r\n              width: this.getWidth(), height: floorEdgeHeight - floorOff },\r\n              0,\r\n              floorColor.lighten(0.4)\r\n        )\r\n\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorOff,\r\n              width: this.getWidth(), height: this.floorHeight + floorOff },\r\n              0,\r\n              floorColor\r\n        )\r\n\r\n        // a little flag :)\r\n        let flagpoleHeight = 18\r\n        let flagX = this.pos.x + 3 * (this.getWidth() / 4)\r\n        let flagY = this.pos.y - flagpoleHeight\r\n\r\n        ctx.fillStyle = Color.Black.fillStyle()\r\n        ctx.fillRect(flagX, flagY-1, 1, flagpoleHeight+1)\r\n        drawPatternedRect(\r\n            ctx,\r\n            { x: flagX, y: flagY, width: 10, height: 6 },\r\n            BackgroundPattern.USSF\r\n        )\r\n        // ctx.fillRect(flagX, flagY, 10, 5)\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White.clone(); }\r\n}","import { CommonAreaView } from \".\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class MediumRoomThreeView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Medium\r\n    devicePlaceCount = 3\r\n\r\n    poly() { return this.angledRoofPoly() }\r\n\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - getVisibleDeviceSize(DeviceSize.Medium)/3\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    // }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class HugeRoomView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Huge\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - getVisibleDeviceSize(DeviceSize.Huge)/2 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Huge))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class LargeRoomView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Large\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - getVisibleDeviceSize(DeviceSize.Large)/2 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Large))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\n\r\nexport class MediumRoomView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Medium\r\n    devicePlaceCount = 2\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - this.floorHeight - getVisibleDeviceSize(DeviceSize.Medium)/3\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    // }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class SmallRoomThreeView extends CommonAreaView {\r\n    devicePlaceCount = 3\r\n    poly() { return this.angledRoofPoly() }\r\n    //devicePlaces() {\r\n    //    let w = this.getWidth()/2\r\n    //    let x = this.pos.x + w;\r\n    //    let y = this.pos.y + this.getHeight() - this.floorHeight - 10\r\n    //    let ds = [\r\n    //        new Vector(x - w / 2, y),\r\n    //        new Vector(x, y),\r\n    //        new Vector(x + w / 2, y),\r\n    //    ]\r\n\r\n    //    return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    //}\r\n}","import { DeviceSize } from \"../../values/DeviceSize\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DomeView } from \".\";\r\n\r\nexport class BigDomeView extends DomeView {\r\n\r\n    devicePlaceCount = 3\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - 20\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Large))\r\n    // }\r\n}","import { DomeView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class MidDomeView extends DomeView {\r\n\r\n    devicePlaceCount = 3\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - 20\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    // }\r\n}","import { DomeView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class SmallDomeThreeView extends DomeView {\r\n\r\n    devicePlaceCount = 3\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - 6\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    // }\r\n}","import { CorridorView } from \".\";\r\n\r\nexport class SurfaceRoadView extends CorridorView {\r\n    edgeWidth: 0\r\n    colorBase() { return this.color.lighten(0.1); }\r\n\r\n}","import { TunnelView } from \".\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Scale } from \"../../values/Scale\";\r\n\r\nexport class LadderView extends TunnelView {\r\n    originSlot: Slot = null\r\n    slotSize: number = Scale.major.third\r\n    constrainCursor(cursor: Vector): Vector {\r\n       if (this.pickingOrigin) {\r\n\r\n       } else {\r\n           cursor.x = this.pos.x\r\n       }\r\n       return cursor;\r\n    }\r\n\r\n    // minHeight: number = slt\r\n    reshape(cursor: Vector) {\r\n        if (this.pickingOrigin) { \r\n            let theSlot = this.alignToSlot(cursor)\r\n            if (theSlot) {\r\n                this.facing = theSlot.facing\r\n\r\n                if (theSlot) {\r\n                    this.originSlot = theSlot\r\n                }\r\n            }\r\n        } else {\r\n            if (this.facing === Orientation.Up) {\r\n                let maxHeight = this.originSlot.pos.y - this.planet.getTop() - 25\r\n\r\n                let h = Math.min(maxHeight, Math.max(this.slotSize, this.originSlot.pos.y - cursor.y))\r\n                this.setHeight((h/this.slotSize)*this.slotSize + 15)\r\n                this.pos.y = this.originSlot.pos.y - this.getHeight()\r\n            } else {\r\n                let h = Math.max(this.slotSize, cursor.y - this.originSlot.pos.y)\r\n                this.setHeight((h/this.slotSize)*this.slotSize + 15) // - cursor.y))\r\n            }\r\n        }\r\n    }\r\n}","import { DomeView } from \".\";\r\nimport { Color, Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class ArcologyView extends DomeView {\r\n\r\n    devicePlaces() {\r\n        let w = 3*this.getWidth()/5\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight()/2\r\n        let ds = [\r\n            new Vector(x, y-800),\r\n            new Vector(x, y),\r\n            new Vector(x, y+800),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Huge))\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        this.drawShape(ctx, this.pos.x, this.pos.y)\r\n        this.getDevices().forEach(device => device.draw(ctx, delta))\r\n\r\n    }\r\n\r\n    private drawShape(ctx, xoff, yoff) {\r\n        let h = this.getHeight()\r\n        let w = this.getWidth()\r\n        ctx.beginPath();\r\n        ctx.moveTo(0 + xoff, h + yoff);\r\n        ctx.bezierCurveTo(1 + xoff, h - 150 + yoff, 121 + xoff, 70 + yoff, w - 80 + xoff, 8 + yoff);\r\n        ctx.bezierCurveTo(w - 40 + xoff, 2 + yoff, w - 5 + xoff, 11 + yoff, w - 10 + xoff, 25 + yoff);\r\n        ctx.bezierCurveTo(w - 5 + xoff, 10 + yoff, w + xoff, (h-10) + yoff, w + xoff, h + yoff);\r\n        ctx.lineTo(0 + xoff, h + yoff);\r\n        ctx.fillStyle = this.mainColor().toRGBA()\r\n        ctx.fill();\r\n    }\r\n}","import { Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { range, eachCons, measureDistance } from \"../../Util\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip } from \"../../values/Orientation\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { drawRect } from \"../../Painting\";\r\nimport { Scale } from \"../../values/Scale\";\r\n\r\nexport class TunnelView extends Building {\r\n    slotSize: number = Scale.major.eighth + 10\r\n    pickingOrigin: boolean = true\r\n    hideBox = true\r\n\r\n    colorBase() { return this.planet.color.darken(0.2); }\r\n\r\n    draw(ctx, delta) {\r\n        let rect = this.aabb()\r\n        drawRect(ctx, rect, 0, this.color.darken(0.1)) \r\n\r\n        let n = 5\r\n        rect.x = rect.x + this.getWidth() / n\r\n        rect.width -= (2) * (this.getWidth() / n)\r\n        drawRect(ctx, rect, 0, this.color.darken(0.2)) \r\n        // super.draw(ctx, delta)\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y\r\n        return [\r\n            new Vector(Math.floor(x), y)\r\n        ];\r\n    }\r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph;\r\n\r\n        let halfWidth = this.getWidth()/2\r\n        let x = this.pos.x + halfWidth\r\n\r\n        let root = g.findOrCreate(this.nodes()[0], measureDistance)\r\n        let first = g.findOrCreate(new Vector(x,this.slotHeights()[0]), measureDistance)\r\n        g.edge(root,first)\r\n\r\n        let heights = this.slotHeights()\r\n\r\n        eachCons(heights, 2).forEach(([y0,y1]: [number,number]) => {\r\n            let top = g.findOrCreate(new Vector(x,y0), measureDistance)\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n            g.edge(top, btm)\r\n        })\r\n\r\n        let btm = g.findOrCreate(new Vector(x, this.pos.y + this.getHeight()), measureDistance)\r\n        let lst = g.findOrCreate(new Vector(x, heights[heights.length-1]), measureDistance)\r\n        g.edge(btm,lst)\r\n\r\n        heights.forEach(y1 => {\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n\r\n            let left = g.findOrCreate(new Vector(x-halfWidth,y1), measureDistance)\r\n            g.edge(left,btm)\r\n\r\n            let right = g.findOrCreate(new Vector(x+halfWidth,y1), measureDistance)\r\n            g.edge(btm,right)\r\n        });\r\n\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(childNode, slot)\r\n            g.edge(slot, childNode)\r\n\r\n            child.graph(g)\r\n        }\r\n\r\n        return g;\r\n    }\r\n\r\n    private slotHeights() {\r\n            // let minDepth = Scale.major.eighth + 50\r\n            // let buffer = 20\r\n\r\n        // let slotSize = Scale.major.eighth + 5 //minDepth + buffer\r\n        let slotCount = Math.floor((this.getHeight()) / this.slotSize)\r\n        let heights = []\r\n\r\n        let y = this.pos.y // + minDepth + buffer\r\n\r\n        if (slotCount > 0) {\r\n            for (let i of range(slotCount)) {\r\n                heights.push(\r\n                    y + ((i+1) * this.slotSize),\r\n                )\r\n            }\r\n        } else {\r\n            heights.push(this.slotSize)\r\n        }\r\n        return heights\r\n    }\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y,\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n        for (let y of this.slotHeights()) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x, y,\r\n                    Orientation.Left\r\n                )\r\n            )\r\n\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x + this.getWidth(),\r\n                    y,\r\n                    Orientation.Right,\r\n                )\r\n            )\r\n        }\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n        return theSlots;\r\n    } \r\n\r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        if (this.pickingOrigin) {\r\n            // this.alignToSlot(cursor)\r\n        } else {\r\n            // cursor.y = Math.max(this.planet.getTop() + 100, cursor.y)\r\n        }\r\n        return cursor;\r\n    }\r\n\r\n    reshape(cursor: Vector) {\r\n        // this.pos.y = this.planet.getTop() + 2\r\n        if (this.pickingOrigin) {\r\n            this.alignToSlot(cursor)\r\n        } // else {\r\n            // min depth/height has to be at least \r\n            // let minDepth = Scale.major.eighth\r\n            // let buffer = 100\r\n\r\n            let depth = \r\n                (this.slotSize * Math.floor(Math.abs(cursor.y - this.planet.getTop()) / this.slotSize)) + 15\r\n\r\n          this.setHeight(\r\n              Math.max(depth, this.slotSize + 15)\r\n          )\r\n        // }\r\n    }\r\n\r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { measureDistance, eachCons } from \"../../Util\";\r\n\r\nexport class DomeView extends Building {\r\n    hideBox = true\r\n    showLabel = true\r\n\r\n    graph(sg) {\r\n        let g = super.graph(sg)\r\n        let find = (s: Vector) => g.findOrCreate(s, measureDistance)\r\n\r\n        let slots: Vector[] = this.slots().map(s => s.pos)\r\n        let leftSlot = find(slots[0]), rightSlot = find(slots[slots.length-1])\r\n        let devices = this.deviceInteractionPlaces().map(position => find(position))\r\n        g.edge(leftSlot, devices[0])\r\n        eachCons(devices, 2).forEach(([left, right]) => g.edge(left, right))\r\n        g.edge(devices[devices.length-1], rightSlot)\r\n\r\n        let node = this.nodes()[0]\r\n        devices.forEach(device => g.edge(device, find(node)))\r\n\r\n        return g\r\n\r\n    }\r\n\r\n    slots() {\r\n        let theSlots = [];\r\n        let slotY = this.getHeight();\r\n\r\n        let buffer = this.getWidth() / 4\r\n\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x - buffer, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() + buffer,\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n    reshape(cursor: Vector) {\r\n        this.alignToSlot(cursor)\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color: Color = this.mainColor()\r\n\r\n        let h = this.getHeight() //getWidth()/2\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(\r\n            this.pos.x + this.getWidth()/2,\r\n            this.pos.y + h, //this.getHeight(),\r\n            this.getWidth()/1.5,\r\n            0,\r\n            Math.PI,\r\n            true\r\n        )\r\n        ctx.closePath()\r\n        ctx.fillStyle = color.toRGBA()\r\n        ctx.fill()\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White.clone().darken(0.05); } \r\n\r\n    deviceSize = DeviceSize.Small\r\n    devicePlaceCount = 2\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - getVisibleDeviceSize(this.deviceSize)/3 // - 16\r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            ...(this.devicePlaceCount === 3 ? [new Vector(x,y)] : []),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, this.deviceSize)) // DeviceSize.Small))\r\n    }\r\n}","import { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Vector, Color } from \"excalibur\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n// import { drawRect, drawPatternedRect } from \"../../Util\";\r\nimport { BackgroundPattern } from \"./BackgroundPatterns\";\r\nimport { drawPatternedRect, drawRect, drawPatternedPoly, drawPoly } from \"../../Painting\";\r\nimport { measureDistance, eachCons } from \"../../Util\";\r\n\r\nexport class CommonAreaView extends Building {\r\n    get floorHeight() { return this.getHeight() / 6 }\r\n    // floorHeight: number = 10\r\n    edgeWidth: number = 0 //.5 //.1\r\n    showLabel = true\r\n    hideBox = true\r\n\r\n    colorBase() { return this.color.darken(0.3); }\r\n\r\n    poly() { return this.aabbPoly() } //angledRoofPoly() }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n\r\n\r\n        drawPatternedPoly(\r\n            ctx,\r\n            this.poly(),\r\n            this.backgroundPattern,\r\n            this.mainColor()\r\n        )\r\n\r\n        if (!this.isActive) {\r\n            // draw overlay rect that darkens\r\n            let c = Color.Black.clone()\r\n            c.a = 0.6\r\n            drawPoly(ctx, this.poly(), c)\r\n        }\r\n\r\n        let floorEdgeHeight = 12 // 6\r\n        let floorColor = this.planet.color.darken(0.6)\r\n        let floorOff = -5\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorEdgeHeight,\r\n              width: this.getWidth(), height: floorEdgeHeight - floorOff },\r\n              0,\r\n              floorColor.lighten(0.4)\r\n        )\r\n\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorOff,\r\n              width: this.getWidth(), height: this.floorHeight + floorOff },\r\n              0,\r\n              floorColor\r\n        )\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n\r\n    slots() {\r\n        let theSlots = []\r\n        let slotY = this.getHeight() - this.floorHeight\r\n        let leftSlot: Slot = this.buildSlot(\r\n            this.pos.x,\r\n            this.pos.y + slotY,\r\n            Orientation.Left,\r\n        )\r\n        theSlots.push(leftSlot)\r\n\r\n        let rightSlot: Slot = this.buildSlot(\r\n            this.pos.x + this.getWidth(),\r\n            this.pos.y + slotY,\r\n            Orientation.Right,\r\n        )\r\n        theSlots.push(rightSlot)\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y,\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n        return theSlots;\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()-this.floorHeight\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n\r\n    graph(sg) {\r\n        let g = super.graph(sg)\r\n        let slots: Slot[] = this.slots()\r\n        let find = (s: Vector) => g.findOrCreate(s, measureDistance)\r\n        let leftSlot = find(slots[0].pos), rightSlot = find(slots[1].pos)\r\n        let devices = this.deviceInteractionPlaces().map(p => find(p))\r\n        g.edge(leftSlot, devices[0])\r\n        eachCons(devices, 2).forEach(([left, right]) => g.edge(left, right))\r\n        g.edge(devices[devices.length-1], rightSlot)\r\n\r\n        let node = this.nodes()[0]\r\n        devices.forEach(device => g.edge(device, find(node)))\r\n        return g\r\n    }\r\n  \r\n    reshape(cursor) {\r\n        this.alignToSlot(cursor);\r\n    }\r\n\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - 10 \r\n        y -= getVisibleDeviceSize(this.devicePlaceSize) / 3.5 ///2\r\n\r\n        let ds = [\r\n            new Vector(x - w/2, y),\r\n            ...(this.devicePlaceCount > 2 ? [new Vector(x,y)] : []),\r\n            new Vector(x + w/2, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, this.devicePlaceSize)) \r\n        //DeviceSize.Small))\r\n    }\r\n\r\n    devicePlaceSize: DeviceSize = DeviceSize.Small\r\n    devicePlaceCount: number = 2\r\n}","import { Building } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\n\r\nexport class CorridorView extends Building {\r\n    edgeWidth: number = 0\r\n\r\n    pickingOrigin: boolean = true\r\n    facing: Orientation = Orientation.Left\r\n\r\n   nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()/2\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n    colorBase() { return this.color.darken(0.2); }\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = [];\r\n        let slotY = this.getHeight() / 2;\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n    \r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            this.reshape(this.constrainCursor(cursor))\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        let newCursor = cursor.clone();\r\n        if (this.pickingOrigin) {\r\n        } else {\r\n            newCursor.y = this.pos.y\r\n        }\r\n\r\n        return newCursor;\r\n    }\r\n\r\n    originX: number = 0\r\n    reshape(cursor: Vector) {\r\n\r\n        if (this.pickingOrigin) {\r\n            let theSlot = this.alignToSlot(cursor)\r\n            if (theSlot) {\r\n                this.facing = theSlot.facing\r\n\r\n                if (theSlot && this.facing === Orientation.Left) {\r\n                    this.originX = theSlot.pos.x\r\n                }\r\n            }\r\n\r\n        } else {\r\n            if (this.facing === Orientation.Left) {\r\n                this.setWidth(Math.abs(this.originX - cursor.x))\r\n                this.pos.x = this.originX - this.getWidth()\r\n            } else {\r\n                this.setWidth(Math.abs(this.pos.x - cursor.x))\r\n            }\r\n        }\r\n    }\r\n}","module.exports = __webpack_public_path__ + \"0a266eded2bf27831b18735ffc081448.png\";","module.exports = __webpack_public_path__ + \"2475589a97ba4901bfa7ab53b5487778.png\";","module.exports = __webpack_public_path__ + \"98240dde9344ac8d071d076ac951e15d.png\";","module.exports = __webpack_public_path__ + \"da31cf43235263c1c3e0ad45a46360a1.png\";","module.exports = __webpack_public_path__ + \"a6a38278ac501400c6199e0df9e1bf84.png\";","module.exports = __webpack_public_path__ + \"ece1d5d5858bc048d2d949ecc3f5e9bc.png\";","module.exports = __webpack_public_path__ + \"3654f0489813e0668743efde017c9653.png\";","module.exports = __webpack_public_path__ + \"3abbdabf07943966f102ac7345a59986.png\";","module.exports = __webpack_public_path__ + \"d1b4690b9f5fa4957f98602afc8cfdb6.png\";","module.exports = __webpack_public_path__ + \"0eb7a15ea04678b14a2b88b5965aabeb.png\";","module.exports = __webpack_public_path__ + \"48be2487ecb6d75a112437662b61e05d.svg\";","module.exports = __webpack_public_path__ + \"c39dae9d5741e8fcd6c6a812b599a99c.svg\";","module.exports = __webpack_public_path__ + \"f91c0d7d285b0686ece2084cc3640bce.svg\";","module.exports = __webpack_public_path__ + \"824e22e59890ae78258b54985e42ca6d.svg\";","module.exports = __webpack_public_path__ + \"dfe6e4db2f0c22d18befa85c1e163369.svg\";","module.exports = __webpack_public_path__ + \"9a947d50110c1d1db07c76a4bba2e653.svg\";","module.exports = __webpack_public_path__ + \"4976b6042ef557ca6085c8d0168251f4.svg\";","module.exports = __webpack_public_path__ + \"46418cf15643d9b1b171c1b64160a5af.svg\";","module.exports = __webpack_public_path__ + \"36a02c2483b688be86ce07bea4bd7295.svg\";","module.exports = __webpack_public_path__ + \"29c5f1be64c99bbc14d5063eea2f0953.svg\";","module.exports = __webpack_public_path__ + \"502f86b65239e20806bbae8bc77a6116.svg\";","module.exports = __webpack_public_path__ + \"5289b20985e3c3a98081267a2da1772e.svg\";","module.exports = __webpack_public_path__ + \"1d893905e4eea3bbc48b0e129e318ea6.svg\";","module.exports = __webpack_public_path__ + \"bd556d00e484db4e52d198d0bf39d0f2.svg\";","module.exports = __webpack_public_path__ + \"650cd431226df0755357c71d61bef1f2.svg\";","module.exports = __webpack_public_path__ + \"f12c591f538ab3026bf13e93f3fa9485.svg\";","module.exports = __webpack_public_path__ + \"3aeb9dd24809ba3fbd4eeb31a28c3b19.svg\";","module.exports = __webpack_public_path__ + \"6cc6f6773bb6eb26fcef87b9629f7b87.svg\";","module.exports = __webpack_public_path__ + \"43062e54318df93f49e2be9a4281eb4a.svg\";","module.exports = __webpack_public_path__ + \"24611230ec712ba7ee38b99561aedd87.svg\";","module.exports = __webpack_public_path__ + \"c4ab2ceb2f61e18493fc776770c65654.svg\";","module.exports = __webpack_public_path__ + \"bbd50a175546bd70d21c5eadbc30d479.svg\";","module.exports = __webpack_public_path__ + \"7441c2ab240d0f733451d75204ac0792.svg\";","module.exports = __webpack_public_path__ + \"91a8cce06c3c05ce6e4b176afafd7b0a.svg\";","module.exports = __webpack_public_path__ + \"0ce4f9c3384680565b6bb16495b64233.svg\";","module.exports = __webpack_public_path__ + \"1db542acabeb82ec8da785e77afd4dca.svg\";","import { ResourceBlock } from \"./Economy\";\r\n\r\nexport type MechanicalOperation =\r\n    Recipe |\r\n    ResourceGenerator |\r\n    ResourceStorage |\r\n    SpawnClone |\r\n    AccelerateTime |\r\n    ExploreForResource |\r\n    Noop\r\n\r\nexport interface Noop {\r\n    type: 'noop'\r\n}\r\n\r\nexport interface Recipe {\r\n    type: 'recipe'\r\n    consumes: ResourceBlock[]\r\n    produces: ResourceBlock\r\n    workTime: number\r\n}\r\n\r\nexport interface ResourceGenerator {\r\n    type: 'generator'\r\n    generates: ResourceBlock\r\n    generationTime: number\r\n    capacity: number\r\n}\r\n\r\nexport interface ResourceStorage {\r\n    type: 'store'\r\n    stores: ResourceBlock[]\r\n    capacity: number\r\n}\r\n\r\nexport interface SpawnClone {\r\n    type: 'spawn'\r\n}\r\n\r\nexport interface AccelerateTime {\r\n    type: 'accelerate'\r\n    factor: number\r\n}\r\n\r\nexport interface ExploreForResource {\r\n    type: 'explore'\r\n    gathers: ResourceBlock\r\n    capacity: number\r\n}\r\n\r\nfunction store(res: ResourceBlock[], capacity: number = 10): ResourceStorage {\r\n    return {\r\n        type: 'store',\r\n        stores: res,\r\n        capacity\r\n    }\r\n}\r\n\r\nfunction generate(res: ResourceBlock, cap: number = 4): ResourceGenerator {\r\n    return {\r\n        type: 'generator',\r\n        generates: res,\r\n        generationTime: 1000,\r\n        capacity: cap\r\n    }\r\n}\r\n\r\nfunction recipe(input: ResourceBlock[], output: ResourceBlock): Recipe {\r\n    return {\r\n        type: 'recipe',\r\n        consumes: input,\r\n        produces: output,\r\n        workTime: 1000,\r\n    }\r\n}\r\n\r\nfunction spawn(): SpawnClone {\r\n    return {\r\n        type: 'spawn',\r\n    }\r\n}\r\n\r\nfunction accelerateTime(): AccelerateTime {\r\n    return {\r\n        type: 'accelerate',\r\n        factor: 2\r\n    }\r\n}\r\n\r\nfunction explore(block: ResourceBlock, cap: number = 4): ExploreForResource {\r\n    return {\r\n        type: 'explore',\r\n        gathers: block,\r\n        capacity: cap\r\n    }\r\n}\r\n\r\nexport const mechanicalOperations = {\r\n    store,\r\n    generate,\r\n    recipe,\r\n    spawn,\r\n    accelerateTime,\r\n    explore,\r\n}","import { Input, Scene, Timer, Vector, LockCameraToActorStrategy } from \"excalibur\";\r\nimport { Building, structureViews } from \"../actors/Building\";\r\nimport { DevicePlace } from \"../actors/Building/Building\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { Hud } from \"../actors/Hud/Hud\";\r\nimport { Planet } from \"../actors/Planet/Planet\";\r\nimport { Player } from \"../actors/player\";\r\nimport { Game } from \"../Game\";\r\nimport { Machine, allMachines } from \"../models/Machine\";\r\nimport { LivingQuarters, MissionControl, SolarArray, SpaceFunction, CloneReception, Kitchen, Workshop, Archive, Refinery, Mine } from \"../models/SpaceFunction\";\r\nimport { Corridor, HugeRoom, LargeRoom, MainTunnel, MediumRoomThree, SmallDome, SmallRoomThree, Structure, SurfaceRoad } from \"../models/Structure\";\r\nimport { flatSingle, zip } from \"../Util\";\r\nimport { DeviceSize } from \"../values/DeviceSize\";\r\nimport { Orientation } from \"../values/Orientation\";\r\nimport { TechnologyRank } from \"../models/TechnologyRank\";\r\nimport { TechTree } from \"../models/TechTree\";\r\n\r\n\r\nexport class Construct extends Scene {\r\n    game: Game\r\n    planet: Planet\r\n    hud: Hud\r\n    player: Player\r\n\r\n    dragging: boolean = false\r\n    dragOrigin: Vector\r\n\r\n    defaultMessage: string = 'Welcome to the Colony, Commander.'\r\n\r\n    placingFunction: SpaceFunction = null\r\n\r\n    time: number = Game.startHour*60\r\n\r\n    hasActiveModal: boolean = false\r\n\r\n    techTree: TechTree = new TechTree()\r\n\r\n    firstBuilding: boolean = true\r\n\r\n\r\n    static requiredStructuresAndFunctions: (typeof SpaceFunction | typeof Structure)[] = [\r\n        MissionControl,\r\n        SurfaceRoad,\r\n        SolarArray,\r\n        MainTunnel,\r\n        Corridor,\r\n        LivingQuarters,\r\n    ]\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n\r\n        let devices = this.planet.colony.findPoweredDevices()\r\n        let machines = allMachines.filter(machine => devices.some(device => device.machine instanceof machine))\r\n\r\n        let discipline = this.techTree.findDisciplineToRankUp(machines)\r\n        if (discipline) {\r\n            let rank = this.techTree.rankUp(discipline)\r\n            this.rankUp(rank)\r\n        }\r\n\r\n        // hmm!\r\n        this.hud.updateDetails(this.planet, this.techTree, true, this.time)\r\n\r\n    }\r\n\r\n    public onInitialize(game: Game) {\r\n        this.game = game\r\n\r\n        let buildIt = (e) => this.startConstructing(e)\r\n        let followIt = (c) => this.startFollowing(c)\r\n\r\n        this.hud = new Hud(game, buildIt, buildIt, buildIt, followIt)\r\n        this.add(this.hud)\r\n\r\n        this.planet = new Planet(\r\n            game.world,\r\n            this.hud,\r\n            (b) => this.hud.showCard(b),\r\n            (d) => this.hud.showCard(d)\r\n        )\r\n\r\n        this.add(this.planet)\r\n  \r\n        this.player = new Player()\r\n        this.add(this.player)\r\n\r\n        this.prepareNextBuilding()\r\n        this.camera.pos.y = this.planet.getTop() - 1000\r\n        this.camera.zoom(0.05)\r\n        this.camera.zoom(0.5, 10000)\r\n\r\n        this.addTimer(\r\n            new Timer(() => { this.stepTime() }, this.timeStepIntervalMillis, true)\r\n        )\r\n\r\n        this.systemMessage(\r\n            \"Welcome to the Colony, sir... \"\r\n            + \"We are what is left of the crew of the Osiris. \"\r\n            + \"Can you help us build a functioning society? \"\r\n            + \"First, choose a location for the Command post. \"\r\n            + \"Then we'll lay out some infrastructure.\"\r\n        )\r\n    }\r\n\r\n    showTutorial: boolean = true\r\n    private systemMessage(message: string) {\r\n        this.hasActiveModal = true\r\n        this.hud.systemMessage(message, \"commander, a moment\", {\r\n            continue: () => { this.closeSystemMessage() },\r\n            //stopTutorial: () => {\r\n            //    this.closeSystemMessage()\r\n            //    this.tuto\r\n            //}\r\n\r\n        })\r\n    }\r\n\r\n    private tutorialMessage(message: string) {\r\n        if (this.showTutorial) {\r\n        this.hasActiveModal = true\r\n            this.hud.systemMessage(message, \"commander, some advice\", {\r\n                continue: () => { this.closeSystemMessage() },\r\n                'i got this': () => {\r\n                    this.closeSystemMessage()\r\n                    this.showTutorial = false\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    private rankUp(rank: TechnologyRank) {\r\n        // systemMessage(`)\r\n        this.hasActiveModal = true\r\n        let rankUpMessage = `${rank.name} -- ${rank.description} -- unlocked: ${rank.unlocks.map(m => (new m()).name).join(', ')}`\r\n        this.hud.systemMessage(\r\n            rankUpMessage,\r\n            \"rank up\",\r\n            { yay: () => { this.closeSystemMessage() }\r\n        })\r\n    }\r\n\r\n    private closeSystemMessage() {\r\n        this.hud.closeSystemMessage()\r\n        this.hasActiveModal = false\r\n    }\r\n\r\n\r\n    timeStepIntervalMillis: number = 50\r\n    private stepTime() { \r\n        this.time += this.timeStepIntervalMillis / Game.minuteTickMillis  /// this.timeStepIntervalMillis //  0.125 //.25\r\n        this.planet.setTime(this.time) \r\n    }\r\n\r\n    public onActivate() {\r\n        this.game.input.pointers.primary.on('move', (e: Input.PointerMoveEvent) => {\r\n            if (this.hasActiveModal) { return }\r\n\r\n            if (this.dragging) {\r\n                this.camera.pos = this.camera.pos.add(\r\n                    this.dragOrigin.sub(e.pos)\r\n                )\r\n\r\n            } else {\r\n                this.player.pos = e.pos\r\n\r\n                let currentlyBuilding = this.planet.currentlyConstructing\r\n                if (currentlyBuilding instanceof Building) {\r\n\r\n                    let constrained = currentlyBuilding.constrainCursor(this.player.pos)\r\n                    this.player.pos = constrained\r\n\r\n                    currentlyBuilding.reshape(this.player.pos)\r\n                } else if (currentlyBuilding instanceof Device) {\r\n                    currentlyBuilding.snap(this.planet, this.player.pos)\r\n                }\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('up', () => {\r\n            if (this.dragging) { this.dragging = false; }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('down', (e: Input.PointerDownEvent) => {\r\n            if (this.hasActiveModal) { return }\r\n\r\n            if (e.button == Input.PointerButton.Left) {\r\n                const currentlyBuilding = this.planet.currentlyConstructing\r\n                if (currentlyBuilding) {\r\n                    if (currentlyBuilding instanceof Building) {\r\n                        let buildingUnderConstruction = currentlyBuilding\r\n                        let placementValid = !buildingUnderConstruction.overlapsAny()\r\n                        if (buildingUnderConstruction && placementValid && buildingUnderConstruction.handleClick(e.pos)) {\r\n                            this.planet.placeBuilding(buildingUnderConstruction)\r\n\r\n                            if (this.placingFunction) {\r\n                                let fn = this.placingFunction\r\n                                // console.log({ fn, bldg: buildingUnderConstruction })\r\n                                zip(fn.machines, buildingUnderConstruction.devicePlaces()).forEach(([machine, place]: [typeof Machine, DevicePlace]) => {\r\n                                    console.log(\"would add machine\", { machine, place })\r\n                                    let m = (new machine()).concretize()\r\n                                    let device = new Device(m, place.position)\r\n                                    buildingUnderConstruction.addDevice(device)\r\n                                })\r\n                                this.placingFunction = null\r\n                            }\r\n\r\n                            this.hud.setStatus(this.defaultMessage)\r\n                            this.planet.colony.currentlyConstructing = null\r\n                            this.prepareNextBuilding(e.pos)\r\n                            // this.hud.updateDetails(this.planet)\r\n                        }\r\n                    } else {\r\n                        let deviceUnderConstruction = currentlyBuilding\r\n                        let placementValid = (deviceUnderConstruction.size === DeviceSize.Tiny) ||\r\n                            !deviceUnderConstruction.overlapsAny()\r\n                        if (deviceUnderConstruction.snap(this.planet) && placementValid) {\r\n                            if (deviceUnderConstruction.size === DeviceSize.Tiny) {\r\n                                let parent = deviceUnderConstruction.parentDevice\r\n                                parent.addTinyDevice(deviceUnderConstruction)\r\n                            } else {\r\n                                let bldg = deviceUnderConstruction.building\r\n                                bldg.addDevice(deviceUnderConstruction)\r\n                            }\r\n                            this.planet.colony.currentlyConstructing = null\r\n                            this.hud.setStatus(this.defaultMessage)\r\n                            // this.hud.updateDetails(this.planet)\r\n                        }\r\n                    }\r\n                }\r\n            } else if (e.button === Input.PointerButton.Middle) {\r\n                this.dragging = true;\r\n                this.dragOrigin = e.pos\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('wheel', (e: Input.WheelEvent) => {\r\n            if (this.hasActiveModal) { return }\r\n\r\n            let z = this.camera.getZoom()\r\n            let step = 0.05\r\n            let min = 0.05, max = 8\r\n            if (e.deltaY < 0) {\r\n                this.camera.zoom(Math.min(z + step, max))\r\n            } else if (e.deltaY > 0) {\r\n                this.camera.zoom(Math.max(z - step, min))\r\n            }\r\n        })\r\n\r\n        let { Up, Down, Left, Right } = Orientation;\r\n        let moveCam = (direction: Orientation) => {\r\n            let camMoveSpeed = 10 * (1/this.camera.getZoom())\r\n            let dv = new Vector(0,0)\r\n            switch(direction) {\r\n            case Left: dv.x = -camMoveSpeed; break\r\n            case Right: dv.x = camMoveSpeed; break\r\n            case Up: dv.y = -camMoveSpeed; break\r\n            case Down: dv.y = camMoveSpeed; break\r\n            }\r\n            // console.log(\"MOVING CAM\", { direction, dv, camMoveSpeed })\r\n            this.camera.move(this.camera.pos.add(dv), 0) //pos.addEqual(dv)\r\n        }\r\n\r\n\r\n        this.game.input.keyboard.on('press', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.H) {\r\n                if (this.buildings && this.buildings[0]) {\r\n                    this.camera.move(this.buildings[0].pos, 500)\r\n                    this.camera.zoom(0.5, 1000)\r\n                }\r\n            } else if (e.key === Input.Keys.Esc) {\r\n                this.planet.colony.currentlyConstructing = null\r\n                this.placingFunction = null\r\n                this.stopFollowing()\r\n                this.hud.setStatus(this.defaultMessage); //'Welcome to the Colony, Commander.')\r\n            } else if (e.key === Input.Keys.Up || e.key === Input.Keys.W) {\r\n                moveCam(Up)\r\n            } else if (e.key === Input.Keys.Left || e.key === Input.Keys.A) {\r\n                moveCam(Left)\r\n            } else if (e.key === Input.Keys.Down || e.key === Input.Keys.S) {\r\n                moveCam(Down)\r\n            } else if (e.key === Input.Keys.Right || e.key === Input.Keys.D) {\r\n                moveCam(Right)\r\n            }\r\n        })\r\n        this.game.input.keyboard.on('hold', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.Up || e.key === Input.Keys.W) {\r\n                moveCam(Up)\r\n            } else if (e.key === Input.Keys.Left || e.key === Input.Keys.A) {\r\n                moveCam(Left)\r\n            } else if (e.key === Input.Keys.Down || e.key === Input.Keys.S) {\r\n                moveCam(Down)\r\n            } else if (e.key === Input.Keys.Right || e.key === Input.Keys.D) {\r\n                moveCam(Right)\r\n            }\r\n        })\r\n    }\r\n\r\n    public onDeactivate() {\r\n        this.game.input.pointers.primary.off('move')\r\n        this.game.input.pointers.primary.off('down')\r\n        this.game.input.pointers.primary.off('up')\r\n        this.game.input.pointers.primary.off('wheel')\r\n    }\r\n\r\n    get buildings() { return this.planet.colony.buildings }\r\n\r\n\r\n    private nextMissingStructureOrFunction(): Structure | SpaceFunction {\r\n        let reqs = Construct.requiredStructuresAndFunctions.map(req => new req())\r\n\r\n        let actualStructureNames = this.buildings.map(building => building.structure.name)\r\n        let actualFunctionNames = flatSingle(\r\n            this.buildings.map(building => building.spaceFunction && building.spaceFunction.name)\r\n        )\r\n        let actualNames = [...actualStructureNames, ...actualFunctionNames]\r\n        return reqs.find(req => !actualNames.includes(req.name))\r\n    }\r\n\r\n    protected prepareNextBuilding(pos: Vector = new Vector(0,0)) {\r\n        let structure = null;\r\n        let nextMissing = this.nextMissingStructureOrFunction() //this.nextMissingRequiredStructure();\r\n        if (nextMissing) { structure = nextMissing; }\r\n        if (structure) {\r\n            this.tutorialMessage(`Great work! Now we need to build a ${structure.name}...`)\r\n            this.startConstructing(structure, pos)\r\n        } else {\r\n            // this.systemMessage(`Now we need to build a ${structure.name}...`)\r\n            this.hud.showPalettes()\r\n        }\r\n    }\r\n\r\n    cameraStrategy: LockCameraToActorStrategy\r\n    startFollowing(citizen) {\r\n        this.stopFollowing()\r\n        this.cameraStrategy = new LockCameraToActorStrategy(citizen)\r\n        this.camera.zoom(2, 1000)\r\n        this.camera.addStrategy(this.cameraStrategy)\r\n    }\r\n\r\n    stopFollowing() {\r\n        if (this.cameraStrategy) {\r\n            this.camera.removeStrategy(this.cameraStrategy)\r\n            this.camera.zoom(1, 1000)\r\n        }\r\n    }\r\n\r\n    startConstructing(structureOrMachine: Structure | Machine | SpaceFunction, pos: Vector = new Vector(0, 0)) {\r\n        this.hud.showCard(structureOrMachine)\r\n        \r\n        let theNextOne = null\r\n        if (structureOrMachine instanceof Structure) {\r\n            let structure = structureOrMachine\r\n            this.hud.setStatus(`Place ${structure.name} (${structure.description})`)\r\n            theNextOne = this.spawnBuilding(structure, pos)\r\n            if (this.firstBuilding) {\r\n                this.camera.zoom(structure.zoom, 250)\r\n                this.camera.pos = theNextOne.pos\r\n                this.firstBuilding = false\r\n            } \r\n        } else if (structureOrMachine instanceof Machine) {\r\n            let machine = structureOrMachine\r\n            this.hud.setStatus(`Install ${machine.name} (${machine.description})`)\r\n            theNextOne = this.spawnDevice(machine, pos)\r\n            // this.camera.zoom(1.5, 250)\r\n        } else if (structureOrMachine instanceof SpaceFunction) {\r\n            let fn: SpaceFunction = structureOrMachine\r\n            this.hud.setStatus(`Place ${fn.name} (${fn.description})`)\r\n            theNextOne = this.spawnFunction(fn, pos)\r\n            this.placingFunction = fn\r\n\r\n        }\r\n\r\n        this.planet.colony.currentlyConstructing = null\r\n        if (theNextOne) {\r\n            this.planet.colony.currentlyConstructing = theNextOne\r\n            // this.camera.pos = theNextOne.pos\r\n        }\r\n    }\r\n\r\n    protected spawnDevice(machine: Machine, pos: Vector): Device {\r\n        let device = new Device(machine, pos)\r\n        if (device.snap(this.planet)) {\r\n            this.camera.pos = device.pos\r\n \r\n        }\r\n        return device\r\n    }\r\n\r\n    protected spawnBuilding(structure: Structure, pos: Vector): Building {\r\n        let anotherBuilding = this.assembleBuildingFromStructure(structure, pos)\r\n        anotherBuilding.reshape(anotherBuilding.constrainCursor(pos))\r\n        return anotherBuilding\r\n    }\r\n    \r\n    private assembleBuildingFromStructure(structure: Structure, pos: Vector): Building {\r\n        let View = structureViews[structure.view]\r\n        let building = new View(pos, structure, this.planet)\r\n        return building;\r\n    }\r\n\r\n    protected spawnFunction(fn: SpaceFunction, pos: Vector): Building {\r\n        let theStructure: Structure = (fn.structure && new fn.structure()) // || new SmallRoomThree()\r\n        if (!theStructure) {\r\n            theStructure = new SmallRoomThree()\r\n            let machines = fn.machines.map(m => new m())\r\n\r\n            if (machines.some(m => m.size === DeviceSize.Medium)) {\r\n                theStructure = new MediumRoomThree()\r\n            }\r\n\r\n            if (machines.some(m => m.size === DeviceSize.Large)) {\r\n                theStructure = new LargeRoom()\r\n            }\r\n\r\n            if (machines.some(m => m.size === DeviceSize.Huge)) {\r\n                theStructure = new HugeRoom()\r\n            }\r\n\r\n            if (machines.some(m => m.forDome)) {\r\n                theStructure = new SmallDome()\r\n            }\r\n        }\r\n\r\n        // console.log(\"SPAWN FUNCTION\", { fn, structure: theStructure })\r\n        let building = this.assembleBuildingFromStructure(theStructure, pos)\r\n        building.reshape(building.constrainCursor(building.pos))\r\n        return building\r\n    }\r\n} \r\n","module.exports = __webpack_public_path__ + \"37914c496c3c503f7a53d7c9a1457b53.mp3\";","module.exports = __webpack_public_path__ + \"1b8e735649248c4c552a84996e61f241.mp3\";","module.exports = __webpack_public_path__ + \"1a607294aebce07746d6f25ffa517d80.mp3\";","module.exports = __webpack_public_path__ + \"22bdefc1e8515661fdeb8e8076820641.mp3\";","module.exports = __webpack_public_path__ + \"cf150ab26eba01503f4f6dc3d9ab47f7.mp3\";","module.exports = __webpack_public_path__ + \"94754f62e0ae4d23d386e246f5e0cb6e.png\";","import { Game } from './Game';\r\nimport { World } from './models/World';\r\nimport { Construct } from './scenes/Construct';\r\nimport { Resources } from './Resources';\r\nimport { Sound } from 'excalibur';\r\n\r\nconst theWorld = new World();\r\nconst game = new Game(theWorld);\r\n\r\nconst construct = new Construct(game);\r\ngame.add('construct', construct);\r\n\r\ngame.start().then(() => {\r\n  game.goToScene('construct');\r\n  // setTimeout(() => {\r\n  //   console.log(\"let's jam!\");\r\n  //   let jam: Sound = Resources.CraterRock //play();\r\n  //   jam.play()\r\n  // }, 1500)\r\n  // jam.oncomplete = () => jam.play()\r\n});\r\n"],"sourceRoot":""}