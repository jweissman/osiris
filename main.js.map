{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Util.ts","webpack:///./src/Game.ts","webpack:///./src/values/DeviceSize.ts","webpack:///./src/actors/Building/index.ts","webpack:///./src/models/Economy.ts","webpack:///./src/models/Machine.ts","webpack:///./src/values/Orientation.ts","webpack:///./src/actors/Building/Building.ts","webpack:///./src/Painting.ts","webpack:///./src/strategies/Strategy.ts","webpack:///./src/actors/Device.ts","webpack:///./src/models/Structure.ts","webpack:///./src/models/RoomRecipe.ts","webpack:///./src/actors/Citizen.ts","webpack:///./src/Elemental.ts","webpack:///./src/actors/Hud/Pane.ts","webpack:///./src/actors/Building/BackgroundPatterns.ts","webpack:///./src/values/Scale.ts","webpack:///./src/models/World.ts","webpack:///./src/GameController.ts","webpack:///./src/actors/Planet/Planet.ts","webpack:///./src/actors/Hud/Hud.ts","webpack:///./src/values/Graph.ts","webpack:///./src/Resources.ts","webpack:///./src/scenes/Menu.ts","webpack:///./src/scenes/Arena.ts","webpack:///./src/models/TechnologyRank.ts","webpack:///./src/models/TechTree.ts","webpack:///./src/actors/player.ts","webpack:///./src/actors/Planet/PlanetBackground.ts","webpack:///./src/actors/Planet/SkyLayer.ts","webpack:///./src/actors/Planet/SkyLayers.ts","webpack:///./src/actors/LaserBeam.ts","webpack:///./src/strategies/CombatStrategy.ts","webpack:///./src/strategies/AttackNearestHostileStrategy.ts","webpack:///./src/strategies/EatingStrategy.ts","webpack:///./src/strategies/WhenHungryEatingStrategy.ts","webpack:///./src/strategies/SleepingStrategy.ts","webpack:///./src/strategies/AnyBedSleepingStrategy.ts","webpack:///./src/strategies/ConstructionStrategy.ts","webpack:///./src/strategies/ProximityBasedConstruction.ts","webpack:///./src/values/InteractionRequest.ts","webpack:///./src/strategies/ProductionStrategy.ts","webpack:///./src/strategies/CapacityBasedProduction.ts","webpack:///./src/actors/Planet/Population.ts","webpack:///./src/actors/Planet/NavigationTree.ts","webpack:///./src/actors/Planet/Colony.ts","webpack:///./src/actors/Hud/CitizenList.ts","webpack:///./src/actors/Hud/Modal.ts","webpack:///./src/actors/Hud/Palette.ts","webpack:///./src/actors/Hud/CardBody.ts","webpack:///./src/actors/Hud/CardTitle.ts","webpack:///./src/actors/Hud/Card.ts","webpack:///./src/actors/Hud/MusicPlayer.ts","webpack:///./src/actors/Hud/EconomicValue.ts","webpack:///./src/actors/Hud/EconomyView.ts","webpack:///./src/actors/Hud/ResourceListEntry.ts","webpack:///./src/actors/Hud/ResourcesList.ts","webpack:///./src/actors/Hud/StatusAnalysisView.ts","webpack:///./src/actors/Building/GroundVehiclePoolView.ts","webpack:///./src/actors/Building/MediumSurfaceRoomView.ts","webpack:///./src/actors/Building/MediumRoomThreeView.ts","webpack:///./src/actors/Building/HugeRoomView.ts","webpack:///./src/actors/Building/LargeRoomView.ts","webpack:///./src/actors/Building/MediumRoomView.ts","webpack:///./src/actors/Building/SmallRoomThreeView.ts","webpack:///./src/actors/Building/BigDomeView.ts","webpack:///./src/actors/Building/MidDomeView.ts","webpack:///./src/actors/Building/SmallDomeThreeView.ts","webpack:///./src/actors/Building/SurfaceRoadView.ts","webpack:///./src/actors/Building/LadderView.ts","webpack:///./src/actors/Building/ArcologyView.ts","webpack:///./src/actors/Building/TunnelView.ts","webpack:///./src/actors/Building/DomeView.ts","webpack:///./src/actors/Building/CommonAreaView.ts","webpack:///./src/actors/Building/CorridorView.ts","webpack:///./src/images/wood-panel-bg.png","webpack:///./src/images/ussf.png","webpack:///./src/images/window-bg.png","webpack:///./src/images/beige-bg.png","webpack:///./src/images/checker-bg.png","webpack:///./src/images/tech-bg.png","webpack:///./src/images/poster-wall-bg.png","webpack:///./src/images/books-bg.png","webpack:///./src/images/leafy-bg.png","webpack:///./src/images/raised-square-bg.png","webpack:///./src/images/mineral-processor-plain.svg","webpack:///./src/images/water-condenser-plain.svg","webpack:///./src/images/oxygen-extractor-plain.svg","webpack:///./src/images/greenhouse-plain.svg","webpack:///./src/images/books-plain.svg","webpack:///./src/images/telescope-plain.svg","webpack:///./src/images/orrery-plain.svg","webpack:///./src/images/lava-lamp-plain.svg","webpack:///./src/images/codex-plain.svg","webpack:///./src/images/statue-plain.svg","webpack:///./src/images/miner-plain.svg","webpack:///./src/images/solar-collector-plain.svg","webpack:///./src/images/couch-plain.svg","webpack:///./src/images/fabricator-plain.svg","webpack:///./src/images/mega-console-plain.svg","webpack:///./src/images/console-red-plain.svg","webpack:///./src/images/console-green-plain.svg","webpack:///./src/images/console-purple-plain.svg","webpack:///./src/images/console-plain.svg","webpack:///./src/images/workstation-plain.svg","webpack:///./src/images/houseplant-plain.svg","webpack:///./src/images/research-server-plain.svg","webpack:///./src/images/fridge-plain.svg","webpack:///./src/images/bed-plain.svg","webpack:///./src/images/cooking-fire-plain.svg","webpack:///./src/images/cabin-plain.svg","webpack:///./src/images/stove-plain.svg","webpack:///./src/images/bench-simple-plain.svg","webpack:///./src/images/vat-plain.svg","webpack:///./src/images/bookshelf-plain.svg","webpack:///./src/models/MechanicalOperation.ts","webpack:///./src/scenes/Construct.ts","webpack:///./src/sounds/future tense.mp3","webpack:///./src/sounds/understanding.mp3","webpack:///./src/sounds/indivision.mp3","webpack:///./src/sounds/assembler.mp3","webpack:///./src/sounds/crater-rock.mp3","webpack:///./src/images/sword.png","webpack:///./src/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","p","jsonpArray","window","webpackJsonp","oldJsonpFunction","bind","slice","excalibur_1","extremumBy","arr","pluck","extremum","reduce","best","next","pair","_ecRange","a","minBy","fn","Math","min","maxBy","max","sample","floor","random","range","Array","fill","map","_val","idx","closest","cursor","getVector","predicate","matching","filter","elem","distance","flatSingle","concat","deleteByValue","e","deleteByValueOnce","index","indexOf","eachCons","eachChunk","array","measureDistance","b","sleep","ms","Promise","resolve","setTimeout","shuffle","sort","zip","countOccurrences","counts","forEach","containsUniq","testElems","doesContain","arrCopy","missingItem_1","testElem","find","mixColors","factor","aFactor","bFactor","Color","g","onlyUnique","self","Resources_1","Game","_super","world","_this","this","width","height","displayMode","DisplayMode","FullScreen","backgroundColor","Black","__extends","start","loader","Loader","key","Resources","addResource","logo","logoWidth","logoHeight","startButtonFactory","myButton","document","createElement","textContent","style","border","display","padding","fontFamily","font","color","fontSize","fontWeight","onmouseenter","Red","darken","toRGBA","onmouseleave","then","console","log","citizenSpeed","debugPath","startHour","bulletSpeed","raidingPartyFrequency","minuteTickMillis","title","Engine","DeviceSize","Scale_1","major","Scale","minor","Tiny","Small","Medium","Large","Huge","getVisibleDeviceSize","size","sz","third","fourth","eighth","second","Building_1","Building","CorridorView_1","CorridorView","CommonAreaView_1","CommonAreaView","DomeView_1","DomeView","TunnelView_1","TunnelView","ArcologyView_1","ArcologyView","LadderView_1","LadderView","SurfaceRoadView_1","SurfaceRoadView","SmallDomeThreeView_1","SmallDomeThreeView","MidDomeView_1","MidDomeView","BigDomeView_1","BigDomeView","SmallRoomThreeView_1","SmallRoomThreeView","MediumRoomView_1","MediumRoomView","LargeRoomView_1","LargeRoomView","HugeRoomView_1","HugeRoomView","MediumRoomThreeView_1","MediumRoomThreeView","MediumSurfaceRoomView_1","MediumSurfaceRoomView","GroundVehiclePoolView_1","structureViews","GroundVehiclePoolView","PureValue","availableCapacity","market","supply","demand","Power","Oxygen","Water","Shelter","Hope","Joy","Wisdom","Wealth","Beauty","Wonder","allValues","emptyMarket","sumMarkets","ea","eb","newMarket","_a","sa","da","_b","equilibrium","every","ResourceBlock","Biomass","Ore","Idea","Meal","Data","Mineral","Bioplasma","Alloy","Algorithm","Argent","Aurum","Omnium","blockColors","Green","Blue","lighten","Yellow","cStep","Viridian","DarkGray","Gray","Orange","White","blockColor","block","desaturate","t","setPrototypeOf","__proto__","constructor","create","__assign","assign","arguments","Economy_1","DeviceSize_1","MechanicalOperation_1","Util_1","images","bookshelf","vat","bench","stove","cabin","fire","bed","fridge","server","plant","workstation","consolePurple","consoleGreen","consoleRed","megaconsole","fabricator","couch","solar","miner","statue","codex","lavaLamp","orrery","telescope","books","greenhouse","o2","h20","minProcessor","Violet","store","mechanicalOperations","generate","recipe","spawn","accelerateTime","explore","Machine","description","LightGray","cost","operation","type","image","prereqs","economy","forDome","hide","isVehicle","tinySlots","isEatingSurface","concretize","onPlacement","device","CommandCenter","built","produceResource","building","populate","pos","add","MissionLog","LavaLamp","Table","Figurine","Orrery","Books","OxygenExtractor","WaterCondensingMachine","SolarCell","Bed","Telescope","Statue","StudyMachine","Workstation","Codex","Bookshelf","Couch","Fridge","Stove","Houseplant","Botany","PersonnelRegistry","CloningVat","OrientationConsole","productionTime","AlgaeVat","DissolutionVat","PlasmaBank","Fabricator","LifeSciencesConsole","Miner","MineralProcessor","MiningDrill","MetalStorage","ResearchServer","Greenhouse","Cabin","Orchard","Arbor","ThinkingFountain","Mainframe","Megafabricator","MolecularEngine","fromHex","SilverForest","TimeCrystal","HoloProjector","SacredGrove","AtomicCompiler","Preserve","LogicPool","Cathedral","Microcity","LogicCrystal","allMachines","Orientation","Left","Up","Right","Down","compass","flip","orientation","Error","Orientation_1","Game_1","Graph_1","RoomRecipe_1","Machine_1","BackgroundPatterns_1","Painting_1","DevicePlace","structure","planet","x","y","infra","Transparent","edgeWidth","placed","hover","showLabel","facing","hideBox","childrenBuildings","devices","active","step","anchor","Vector","setup","traits","trait","Traits","OffscreenCulling","on","some","currentlyViewing","toggleActive","collisionType","CollisionType","PreventCollision","nameLabel","Label","draw","ctx","delta","drawRect","aabb","processedColor","spaceFunction","slots","slot","rect","nodes","node","update","engine","tryProduce","tinyDevices","tinyDevice","poly","aabbPoly","getHeight","emptyUnlessActive","isActive","machineEconomies","buildingEconomy","inUse","wasEquil","_i","allValues_1","localCap","globalCap","agg","constrainCursor","clone","reshape","alignToSlot","afterConstruct","handleClick","_pos","getWidth","devicePlaces","deviceInteractionPlaces","place","position","visibleSize","graph","supergraph","Graph","rootNode","findOrCreate","child","parentSlot","edge","childNode","redeem","res","gather","debit","spend","elite","pathFromRect","angledRoofPoly","angleStartY","overlaps","other","rect1","rect2","overlapsAny","colony","buildings","bldg","edgeColor","mainColor","colorBase","clr","connections","findSlot","validConnections","slotList","dir","validStructures","flipped","closestBuildingByType","matchingSlot","compass_1","theSlot","offset","sub","addEqual","buildSlot","parent","addDevice","subEqual","updateFunction","machine","hasPlaceForDevice","nextDevicePlace","getDevices","allTheMachines","machines","allSpaceFunctions","spaceFn","sf","text","background","BackgroundPattern","Grid","Actor","drawPatternedPoly","path","pattern","gridPattern","getBackgroundPattern","save","translate","beginPath","moveTo","pt","lineTo","closePath","fillStyle","strokeStyle","stroke","restore","drawLine","lineWidth","drawPatternedRect","rectangle","filled","dashed","main","fillRect","setLineDash","strokeRect","drawPoly","drawStar","cx","cy","outerRadius","innerRadius","spikes","rot","PI","cos","sin","drawCircle","radius","hemi","theta","arc","drawEllipse","radiusX","radiusY","ellipse","drawText","msg","tx","ty","fillText","InteractionRequest_1","Strategy","pawn","sleepInterval","currentPlanet","findPoweredDevices","recipes","operations","op","explores","attempt","label","sent","pause","gatherBlock","gathered","generatesDesiredBlock","product","stored","gen","closestDeviceByType","storesDesiredBlock","visitDevice","waitTimes","interact","retrieveResource","warn","visit","workExploration","exploring","knowsHow","reserved","vehicle","explored","drive","driven","gathers","workRecipe","debug","produces","knowsRecipe","maker","made","gatherIngredients","consumes","performRecipeTask","blocks","isCarryingUnique","blocks_1","ingredient","tries","timesToAttempt","worked","Structure_1","Device","initialPos","imageLoaded","parentDevice","Image","onload","src","computeEconomy","globalAlpha","imageX","imageY","vel","scale","drawImage","iv","bx","by","yOff","produced","blockSize","assemble","citizen","drop","progressBar","request","recipe_1","carrying","it","includes","consumed","workTime","getEffectiveWorkTime","carry","requires","has","storeOrExplore","dispense","store_1","stores","getEffectiveOperationalCapacity","res_1","origX","groundSpeed","xOff","actions","asPromise","stopDriving","bonus","bonuses","capacity","workSpeed","round","resource","generationTime","generates","snap","snapTiny","allStructures","snapped","halfSize","spot","getCenter","abs","gridGrain","floorY","findAllDevices","hasTinyPlace","nextTinyPlace","tx0","ndx","addTinyDevice","smallMachines","mediumMachines","largeMachines","hugeMachines","smallDome","smallBelow","midDome","midBelow","largeDome","largeBelow","hugeDome","hugeBelow","medGroundVehicles","Structure","view","zoom","Corridor","Ladder","MainTunnel","fifth","MediumSurfaceRoom","SurfaceRoad","first","Dome","seventh","CommonArea","SmallRoomThree","sixth","SmallRoomTwo","SmallDome","MediumRoom","MediumRoomThree","LargeRoom","HugeRoom","SmallDomeThree","MidDome","LargeDome","Arcology","GroundVehiclePool","RoomRecipe","Beige","MissionControl","Window","LivingQuarters","Barracks","Kitchen","Checker","LifeSupportPod","Retreat","CloneMatrix","CloneReception","ReadingRoom","Library","Study","Wood","ComputerLab","Archive","Arboretum","AlgaeFarm","SolarArray","Workshop","Nursery","Leafy","Farm","Factory","ComputerCore","Tech","LifeSciencesLab","Refinery","Mine","HoloMatrix","TimeChamber","LivingRoom","Statuary","CapacityBasedProduction_1","ProximityBasedConstruction_1","AnyBedSleepingStrategy_1","WhenHungryEatingStrategy_1","AttackNearestHostileStrategy_1","LaserBeam_1","Citizen","home","evil","alive","isPlanning","workInProgress","sleeping","hunger","energy","health","driving","currentBuilding","combatting","paceUnit","combatMovementUnit","firingRangeBuffer","firing","guarding","productionStrategy","CapacityBasedProduction","constructionStrategy","ProxmityBasedConstruction","sleepingStrategy","AnyBedSleepingStrategy","eatingStrategy","WhenHungryEatingStrategy","fightingStrategy","AttackNearestHostileStrategy","shirtColor","skinColor","weight","w","Passive","bloodEmitter","makeBloodEmitter","ParticleEmitter","emitterType","EmitterType","Circle","minVel","maxVel","minAngle","maxAngle","emitRate","opacity","fadeFlag","particleLife","maxSize","minSize","beginColor","endColor","isEmitting","speedMultiplier","timeFactor","now","Date","getTime","progress","workStarted","workDuration","fatigue","work","isTired","abortProgressBar","healthColor","drawBar","Cyan","rotate","drawSelf","carried","saturate","pw","px","py","c_1","ph","duration","reject","resources","target","targetForDevice","pathTo","glideTo","pathBetweenPoints","pop","followPath","walkSpeed","all","choice","strategies","strat","canApply","takeRest","eat","thirtyMinuteTimer","engageHostile","hostile","actionQueue","clearActions","distanceToHostile","getWorldPos","enemy","self_1","tooCloseToEnemyLine","enemyPosition","idealCombatRange","tooFarFromEnemyLine","withinFiringRange","advanceTowardsEnemy","nextGoal","unit","hostileDirectionSign","u","_c","numTimes","times","this_1","bullet_1","assembleBullet","scene","addTimer","Timer","kill","guard","hostileDir","LaserBeam","injure","amt","attacker","die","bleed","assembleButton","bg","fg","theButton","textTransform","onmouseover","Pane","dragging","dragStart","initialX","clientX","initialY","clientY","drag","preventDefault","currentX","currentY","dragEnd","makeRootElement","_element","parentElement","removeChild","flexWrap","body","appendChild","container","margin","addEventListener","left","canvas","offsetLeft","top_1","offsetTop","top","raisedSquare","leafy","bookish","posters","tech","checker","beige","ussf","wood","loadBg","loading","Poster","USSF","backgroundPatterns","matrix","DOMMatrix","createPattern","setTransform","majorUnit","minorUnit","minorScale","World","colors","skyColor","nameCitizen","Azure","GameController","game","camera","pointerMoveCallback","leftClickCallback","cameraPanCallback","keyPressCallback","onMove","cb","onLeftClick","onCameraPan","onKeyPress","activate","input","pointers","primary","dragOrigin","button","Input","PointerButton","Middle","z","getZoom","deltaY","moveCam","direction","camMoveSpeed","dv","move","keyboard","Keys","W","A","S","D","ex","Colony_1","Population_1","Device_1","SkyLayers_1","Citizen_1","Planet","hud","onBuildingHover","onDeviceHover","depth","hostiles","sky","yBase","createLayer","layerHeight","skyLayers","SkyLayers","Colony","population","Population","currentHour","hour","setTime","time","nextHour","inc","oldC","skyColorForHour","newC","mixC","assignColors","setHi","colorMap","night","dawn","morning","afternoon","evening","set","buildingOrDevice","theLayer","currentlyConstructing","theEconomy","popularDemand","citizens","resourceGathered","resourceExpended","placeBuilding","maxPop","increase","theEconomyWithoutPeople","values","val","structureTypes","closestDevice","machineTypes","pathBetween","origin","destination","acc","hasMachineKind","kind","sendRaidingParty","partySize","sendRaider","getTop","raider","raiders","StatusAnalysisView_1","Card_1","Palette_1","Modal_1","CitizenList_1","Hud","onBuildingSelect","onMachineSelect","onFunctionSelect","onCitizenSelect","canvasWidth","canvasHeight","hidePalettes","showCitizenList","modal","devicePixelRatio","status","StatusAnalysisView","displayInfo","showCard","machinePalette","Palette","structurePalette","structuresForPalette","functionPalette","functionsForPalette","citizenList","CitizenList","card","Card","systemMessage","message","buttons","Modal","addButtons","closeSystemMessage","teardown","showPalettes","setStatus","setMessage","comprehended","incrementResource","decrementResource","updateDetails","techTree","following","rebuildPalettes","updatePalettes","updateEconomy","updateMaxPop","setClock","updateRoster","entity","present","curr","cap","showPopCap","showEconomy","updateBuildingPalette","updateMachinePalette","updateFunctionPalette","builtStructures","updateBuilt","builtMachines","machinesForPalette","allUnlockedMachines","builtReifiedFunctions","builtFunctions","rf","UIActor","empty","edges","edgesInverse","isEmpty","newNode","contains","testNode","measure","tolerance","dfs","dst","union","otherGraph","edgeList","theEdges","otherIndex","otherNode","adjacent","adjacentIndices","testNodeIndex","es","esInv","root","visited","rIndex","dfsIndex","rootIndex","childIndex","bfs","bfsIndex","halt","visited_1","visitedNode","adj_1","adjacentNode","shortestPath","maxStep","prevStep","dstIndex","prev","steps","srcIndex","reverse","sword","assembler","futureTense","Sword","Texture","Assembler","Sound","FutureTense","Pane_1","Elemental_1","SceneList","btns","btn","onclick","goToScene","Menu","onInitialize","sceneList","halfCanvasWidth","halfCanvasHeight","emitter","Scene","Planet_1","World_1","Hud_1","GameController_1","noop","SpawnPalette","spawnFriendly","spawnEnemy","goodGuy","badGuy","Arena","friendly","spawnHostile","spawnPalette","Discipline","Survival","Agriculture","LibraryScience","Cooking","MineralProduction","disciplineTree","level","unlocks","TechnologyRank_1","TechTree","currentLevels","findDisciplineToRankUp","keys","disciplineName","discipline","canRankUp","rankUp","currentRank","nextLevel","unlocked","unlockedMachinesFor","tree","Player","setWidth","setHeight","PlanetBackground","MountainLayers","layers","layerCount","peakCount","layerIndex","unshift","baseY","deltas","genPeaks","wc","sc","ls_1","layer","drawLayer","ox","oy","peakWidth","dMax","last","pick","Mountains","peaks","peakDistance","drift","h","baseColor","brightColor","peak","y0","mtnWidth","PlanetBackground_1","SkyLayer","lo","hi","mid","backMountainLayers","mountains","mountainLayers","setLoHi","SkyLayer_1","c0","c1","source","targetDirectionSign","isEvil","collision","CombatStrategy","CombatStrategy_1","vigilanceRange","engagedInCombat","enemyCombatant","seek","attack","EatingStrategy","EatingStrategy_1","isHungry","storedResources","desk","SleepingStrategy","SleepingStrategy_1","Strategy_1","ConstructionStrategy","unbuiltDevice","constructDevice","__awaiter","throw","done","__generator","trys","ops","return","Symbol","iterator","TypeError","ProductionStrategy","storeBlock","tryStoreBlock","openStore","findStore","findRecipe","explorer","findExplorer","storage_1","storage_2","explorers","notKilled","NavigationTree","seekPath","dest","closestNode","closestNodeAtSameYCoordinate","tol","NavigationTree_1","debugTree","navTree","gradient","createLinearGradient","addColorStop","buildNavTree","st","srcNode","destNode","constrainSourceY","ctrl","activeBuildings","CitizenLine","onSelect","followed","buildLine","_line","isFollowed","hungry","tired","makeButton","sleepy","fighting","justifyContent","paddingLeft","join","alignSelf","citizenLines","Map","missingCitizens","doesRosterInclude","lostCitizens","makeRoster","updateRosterDetails","makeCitizenLine","line","makeDialog","clientHeight","buttonMap","entries","intent","buttonFactory","_footer","textAlign","_header","_body","paddingBottom","addHeading","heading","headerMessage","addIconMatrix","iconSet","img","lbl","icon","flexDirection","modalButton","onButtonClick","onButtonEnter","comprehend","makePalette","nowComprehended","prereq","CardBody","describeResources","freqs","notes","fontStyle","FontStyle","Italic","footer","show","describeEconomy","resourceDescription","domeStatus","bonusMessages","econ","toFixed","CardTitle","announce","CardTitle_1","CardBody_1","x0","cardBody","ix","iy","MusicPlayer","playlist","paused","makePlayer","startMusic","_titleElem","currentTrack","play","advancePlaylist","_wrapper","maxHeight","overflow","inlineBlock","iconFactory","handleAction","action","song","stop","trackNames","append","iconContent","innerHTML","EconomicValue","valueLabel","setCount","count","EconomicValue_1","EconomyView","valueLabels","val1","val2","addValue","updateView","updatedEconomy","Tooltip","messageLabel","ResourceListEntry","resourceBlock","hovering","tooltip","visible","credit","ResourceListEntry_1","ResourcesList","res1","res2","rx","ry","addEntry","entry","increment","decrement","ResourcesList_1","EconomyView_1","MusicPlayer_1","brand","version","clock","popLabel","musicPlayer","Future Tense","days","toString","hh","hours","minutes","ampm","padStart","_1","deviceSize","theSlots","slotY","buffer","devicePlaceSize","devicePlaceCount","floorHeight","sg","right","isGroundFloor","leftSlot","rightSlot","topSlot","backgroundPattern","floorColor","floorEdgeHeight","flagX","flagY","flagpoleHeight","originSlot","slotSize","pickingOrigin","drawShape","xoff","yoff","bezierCurveTo","halfWidth","slotHeights","heights","y1","btm","lst","slotCount","originX","newCursor","output","player_1","TechTree_1","Construct","defaultMessage","placingFunction","hasActiveModal","firstBuilding","followedCitizen","showTutorial","timeStepIntervalMillis","rank","buildIt","startConstructing","toggleFollowing","player","prepareNextBuilding","stepTime","continue","tutorialMessage","i got this","okay","onActivate","controller","stopFollowing","currentlyBuilding","constrained","buildingUnderConstruction_1","placementValid","deviceUnderConstruction","H","Esc","onDeactivate","off","nextMissingStructureOrFunction","reqs","requiredStructuresAndFunctions","req","actualStructureNames","actualFunctionNames","actualNames","nextMissing","congrats","nextUp","startFollowing","cameraStrategy","LockCameraToActorStrategy","addStrategy","resetZoom","removeStrategy","structureOrMachine","theNextOne","spawnBuilding","spawnDevice","spawnFunction","anotherBuilding","assembleBuildingFromStructure","theStructure","Construct_1","Arena_1","Menu_1","theWorld","construct","arena","menu"],"mappings":"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BJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,EAAAD,QAAiBJ,EAAAwB,EAAuB,iDAAA4C,EAAAoM,EAAArP,GCAxCd,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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([125,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import { Vector, Color } from \"excalibur\";\r\nimport { Rectangle } from \"./values/Rectangle\";\r\nimport { getBackgroundPattern, BackgroundPattern } from \"./actors/Building/BackgroundPatterns\";\r\n\r\nconst extremumBy = (arr, pluck, extremum) => {\r\n  return arr.reduce(function(best, next) {\r\n    var pair = [ pluck(next), next ];\r\n    if (!best) {\r\n       return pair;\r\n    } else if (extremum.apply(null, [ best[0], pair[0] ]) == best[0]) {\r\n       return best;\r\n    } else {\r\n       return pair;\r\n    }\r\n  },null)[1];\r\n}\r\n\r\nexport const minBy = (arr, fn) => extremumBy(arr, fn, Math.min)\r\nexport const maxBy = (arr, fn) => extremumBy(arr, fn, Math.max)\r\n\r\n\r\nexport const sample = (arr) => arr[Math.floor(Math.random() * arr.length)]\r\n\r\nexport const range = (n) => Array(n).fill(0).map((_val,idx) => idx)\r\n\r\nexport function closest<T>(cursor: Vector, arr: Array<T>, getVector: (elem: T) => Vector, predicate?: (elem: T) => boolean) {\r\n   let matching: Array<T> = arr;\r\n   if (predicate) { arr = arr.filter(predicate) }\r\n   if (matching) {\r\n      let distanceToCursor = (elem: T) => cursor.distance(getVector(elem))\r\n      return minBy(matching, distanceToCursor)\r\n   }\r\n}\r\n\r\nexport const flatSingle = arr => [].concat(...arr);\r\n\r\nexport const deleteByValue = (arr, elem) => arr.filter(e => e !== elem)\r\n\r\nexport const deleteByValueOnce = (arr, elem) => {\r\n  let index = arr.indexOf(elem);\r\n  if (index !== -1) arr.splice(index, 1);\r\n}\r\n\r\nexport function eachCons(a, n) {\r\n  var r = []\r\n  for (var i = 0; i < a.length - n + 1; i++) {\r\n    r.push(_ecRange(a, i, n))\r\n  }\r\n  return r\r\n}\r\n\r\nfunction _ecRange (a, i, n) {\r\n  var r = []\r\n  for (var j = 0; j < n; j++) {\r\n    r.push(a[i + j])\r\n  }\r\n  return r\r\n}\r\n\r\nexport function eachChunk(a, n) {\r\n  return a.reduce(function (result, value, index, array) {\r\n    if (index % n === 0)\r\n      result.push(array.slice(index, index + n));\r\n    return result;\r\n  }, []);\r\n}\r\n\r\nexport const measureDistance = (a: Vector, b: Vector) => a.distance(b)\r\n\r\n\r\nexport function sleep(ms) {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\nexport function shuffle(arr) {\r\n  return arr.sort(() => Math.random() > 0.5 ? 1 : -1)\r\n}\r\n\r\nexport const zip = (a, b) => a.map((e, i) => [e, b[i]])\r\n\r\nexport const countOccurrences = (arr) => {\r\n  let counts = {}\r\n  arr.forEach((elem) => {\r\n    counts[elem] = counts[elem] || 0\r\n    counts[elem] += 1\r\n  })\r\n  return counts\r\n}\r\n\r\nexport function containsUniq<T>(arr: T[], testElems: T[]) {\r\n  let doesContain = false\r\n  let arrCopy = arr.slice()\r\n  if (arr.length > 0) {\r\n    let missingItem = false\r\n    testElems.forEach(testElem => {\r\n      if (arrCopy.find(e => e === testElem)) {\r\n        deleteByValueOnce(arrCopy, testElem)\r\n      } else {\r\n        missingItem = true\r\n      }\r\n    })\r\n    doesContain = !missingItem\r\n  }\r\n  return doesContain\r\n}\r\n\r\n\r\nexport function mixColors(a: Color, b: Color, factor: number = 0.5): Color {\r\n  let aFactor = factor, bFactor = (1-factor)\r\n  return new Color(\r\n    (a.r * aFactor) + (b.r * bFactor),\r\n    (a.g * aFactor) + (b.g * bFactor),\r\n    (a.b * aFactor) + (b.b * bFactor),\r\n    1\r\n  )\r\n}\r\n\r\nexport function onlyUnique(value, index, self) { \r\n    return self.indexOf(value) === index;\r\n}","import { Engine, DisplayMode, Loader, Timer, Color } from 'excalibur';\r\nimport { World } from './models/World';\r\nimport { Resources } from './Resources';\r\n\r\nexport class Game extends Engine {\r\n  static citizenSpeed: number = 50\r\n  static debugPath: boolean = false\r\n  static startHour: number = 9\r\n\r\n  // combat knobs\r\n  static bulletSpeed: number = 800\r\n  static raidingPartyFrequency: number = 30000\r\n\r\n  // 10000 = 1 min / 10 sec\r\n  // 1000 = 1 min / second\r\n  // 100 = 10 min / second\r\n  static minuteTickMillis: number = 500\r\n\r\n  static font = 'Helvetica'\r\n  static title: string = 'ASTRA';\r\n\r\n  constructor(public world: World) {\r\n    super({\r\n      width: 800,\r\n      height: 600,\r\n      displayMode: DisplayMode.FullScreen,\r\n      backgroundColor: Color.Black //world.skyColor\r\n    });\r\n  }\r\n\r\n  public start() {\r\n    let loader = new Loader();\r\n    for (let key in Resources) {\r\n      loader.addResource(Resources[key]);\r\n    }\r\n    loader.backgroundColor = '#0a0e0c'\r\n    // loader.logo = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAACwklEQVR4nO3dQXKbMBQAULvTbXYe1u30fln0IF3kfp1mzXjnA7grMoRxDBISSOi9VSYBPsrw/xdg8OkEAAAAAAAAAAAAAAAAAAAAABTjvPcOHEXfX+/P/t51l6z/61zx+/56n647Fys27qNYIeum2o+WfN97B2o2Puj+/Pq5eNlUB2PINlPHX7qNIW6OBNxz/EehAETq++t9LunHxsuu6XSx2xgvmyJ+aNzUMWsZf+kUgEBDJwlJ/qnX7hLdGVN01K67nHN25mcxUxS+YXtr92Xtdo5AAQgQ2vWfee0uH9sMmU6nOmBzdea5mGvP82sef4m+7b0DtUiZ/D9eXj5+Hs8G5uLnOFDH3bBkrY8/FwWATbWecKVRABZI2f0fmZsF5J6mlp6UrY8/JwVgRu7kH3xVBLY6Ry01CVoff24KADRMAYCGKQBP5Jr+v99uD38/PQ3Y+hbVFtPgvW57LtHiaYACAA1TAPgkZ8et4UM3pe9fagrAxr6a/h9dDcnfIh8F3lBM8u9xTpr6oZ0126x9/KVTADYSk/x7HIhLE27pcmsf2oldN1ZrFwEVgA0ccdq/5Pn7ljpprVwDyGxN8tfcjVLcUqt5/LVQAJ7ousv5999/Ueu+327Byf/WXz911q3vS5fWtVsf/xYUgAyOOOWP0eIHa2rjGkAikv6xVG8CIg8FYMZwAA9v8MllOv2fxt/ircIlJmnr48/NKcACXXc5v/XXbNv/KvnH8XNOpUt/3r728ZdMAWATrgeUSQFYKNcsYK77j+PnSKBaul/r48/FNYAA44Nw7TWBoZiEvts+1eus93gt9trz+drHXyIFIND4ddKxRWBp15+LX8LrtUOlKAKnU73jL40CEGk6JZ0rBuPTh1RfzdXyV2O1Pv5UFIAVpl83tXTZo8SPlerWXq3jBwAAAAAAAAAAAAAAAAAAAAB46D+AUA+q0Ax9RQAAAABJRU5ErkJggg=='\r\n    loader.logo = 'data:image/png;base64,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'\r\n    // loader.logo = 'data:image/png;base64,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'\r\n    // loader.logo = 'data:image/png;base64,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'\r\n    loader.logoWidth = 3 * 256\r\n    loader.logoHeight = 3 * 64\r\n\r\n    // loader.playButtonText = 'make planetfall'\r\n    loader.startButtonFactory = () => {\r\n      let myButton = document.createElement('button');\r\n      myButton.textContent = 'Make Planetfall';\r\n      myButton.style.border = 'none'\r\n      myButton.style.display = 'block'\r\n      myButton.style.padding = '24px'\r\n      myButton.style.fontFamily = Game.font //'Helvetica'\r\n      myButton.style.color = 'white'\r\n      myButton.style.fontSize = '20pt'\r\n      myButton.style.fontWeight = '300'\r\n\r\n      myButton.style.backgroundColor = '#9a5e5c'\r\n\r\n\r\n      myButton.onmouseenter = () => {\r\n        myButton.style.backgroundColor = Color.Red.darken(0.5).toRGBA()\r\n      }\r\n      myButton.onmouseleave = () => { myButton.style.backgroundColor = '#9a5e5c' }\r\n      return myButton;\r\n    };\r\n\r\n    return super.start(loader).then(() => {\r\n      console.log(\"Osiris running.\")\r\n    });\r\n  }\r\n}","import { Scale } from \"./Scale\";\r\nlet { major, minor } = Scale\r\n\r\nexport enum DeviceSize {\r\n    Tiny,\r\n    Small,\r\n    Medium,\r\n    Large,\r\n    Huge,\r\n}\r\n\r\n\r\nexport function getVisibleDeviceSize(size: DeviceSize): number {\r\n    let sz = 10;\r\n    switch (size) {\r\n        case DeviceSize.Tiny: sz = minor.third; break;\r\n        case DeviceSize.Small: sz = major.third; break;\r\n        case DeviceSize.Medium: sz = major.fourth; break;\r\n        case DeviceSize.Large: sz = major.eighth + major.second; break;\r\n        case DeviceSize.Huge: sz = 6 * major.eighth; break;\r\n    }\r\n    return sz;\r\n}","import { Building } from './Building';\r\n\r\nimport { CorridorView } from './CorridorView';\r\nimport { CommonAreaView } from './CommonAreaView';\r\nimport { DomeView } from './DomeView';\r\nimport { TunnelView } from './TunnelView';\r\nimport { ArcologyView } from './ArcologyView';\r\nimport { LadderView } from './LadderView';\r\nimport { SurfaceRoadView } from './SurfaceRoadView';\r\nimport { SmallDomeThreeView } from './SmallDomeThreeView';\r\nimport { MidDomeView } from './MidDomeView';\r\nimport { BigDomeView } from './BigDomeView';\r\nimport { SmallRoomThreeView } from './SmallRoomThreeView';\r\nimport { MediumRoomView } from './MediumRoomView';\r\nimport { LargeRoomView } from './LargeRoomView';\r\nimport { HugeRoomView } from './HugeRoomView';\r\nimport { MediumRoomThreeView } from './MediumRoomThreeView';\r\nimport { MediumSurfaceRoomView } from './MediumSurfaceRoomView';\r\nimport { GroundVehiclePoolView } from './GroundVehiclePoolView';\r\n\r\n\r\nconst structureViews: { [key: string]: typeof Building } = {\r\n    CorridorView,\r\n    LadderView,\r\n    TunnelView,\r\n    SurfaceRoadView,\r\n\r\n    DomeView, // small dome 2\r\n    SmallDomeThreeView,\r\n    MidDomeView,\r\n    BigDomeView,\r\n\r\n    SmallRoomThreeView,\r\n\r\n    CommonAreaView,\r\n    MediumRoomView,\r\n    MediumRoomThreeView,\r\n    LargeRoomView,\r\n    HugeRoomView,\r\n\r\n    ArcologyView,\r\n    MediumSurfaceRoomView,\r\n\r\n    GroundVehiclePoolView,\r\n}\r\n\r\nexport {\r\n    Building,\r\n\r\n    CorridorView,\r\n    LadderView,\r\n    TunnelView,\r\n    SurfaceRoadView,\r\n\r\n    DomeView, // small dome 2\r\n    SmallDomeThreeView,\r\n    MidDomeView,\r\n    BigDomeView,\r\n\r\n    SmallRoomThreeView,\r\n\r\n    CommonAreaView,\r\n    MediumRoomView,\r\n    MediumRoomThreeView,\r\n\r\n    LargeRoomView,\r\n    HugeRoomView,\r\n\r\n    ArcologyView,\r\n\r\n    MediumSurfaceRoomView,\r\n\r\n\r\n    structureViews\r\n\r\n}","import { Color } from \"excalibur\";\r\n\r\n// an abstract/intangible thing (or at least something we don't represent)\r\nexport enum PureValue {\r\n    Power = 'Power',\r\n    Oxygen = 'Oxygen',\r\n    Water = 'Water',\r\n    Shelter = 'Shelter',\r\n    Hope = 'Hope',\r\n    Joy = 'Joy',\r\n    Wisdom = 'Wisdom',\r\n    Wealth = 'Wealth',\r\n    Beauty = 'Beauty',\r\n    Wonder = 'Wonder'\r\n}\r\n\r\nexport const allValues: PureValue[] = [\r\n    PureValue.Power,\r\n    PureValue.Oxygen,\r\n    PureValue.Water,\r\n    PureValue.Shelter,\r\n    PureValue.Hope,\r\n    PureValue.Joy,\r\n    PureValue.Wisdom,\r\n    PureValue.Wealth,\r\n    PureValue.Beauty,\r\n    PureValue.Wonder\r\n]\r\n\r\nexport type Economy = { [key in PureValue]: {\r\n    supply: number,\r\n    demand: number\r\n} }\r\n\r\nexport function emptyMarket() : Economy {\r\n    return {\r\n        Power: { supply: 0, demand: 0 },\r\n        Oxygen: { supply: 0, demand: 0 },\r\n        Water: { supply: 0, demand: 0 },\r\n        Shelter: { supply: 0, demand: 0 },\r\n        Hope: { supply: 0, demand: 0 },\r\n        Joy: { supply: 0, demand: 0 },\r\n        Wealth: { supply: 0, demand: 0 },\r\n        Wisdom: { supply: 0, demand: 0 },\r\n        Beauty: { supply: 0, demand: 0 },\r\n        Wonder: { supply: 0, demand: 0 },\r\n    }\r\n}\r\n\r\nexport function availableCapacity(market: Economy, value: PureValue) {\r\n    return Math.floor(market[value].supply - market[value].demand)\r\n}\r\n\r\nexport const sumMarkets: (ea: Economy, eb: Economy) => Economy = (ea, eb) => {\r\n    let newMarket = emptyMarket();\r\n    for (let value in PureValue) {\r\n        let { supply: sa, demand: da } = ea[value]\r\n        let { supply: sb, demand: db } = eb[value]\r\n        let supply = sa + sb\r\n        let demand = da + db\r\n        newMarket[value] = {\r\n            supply,\r\n            demand,\r\n        }\r\n    }\r\n    return newMarket\r\n}\r\n\r\nexport const equilibrium: (e: Economy) => boolean = (e) => {\r\n    return allValues.every(value => availableCapacity(e, value) >= 0)\r\n}\r\n\r\nexport enum ResourceBlock {\r\n    // base\r\n    Biomass = 'Biomass',\r\n    Ore = 'Ore',\r\n    Idea = 'Idea',\r\n\r\n    // derived\r\n    Meal = 'Meal',\r\n    Data = 'Data',\r\n    Mineral = 'Mineral',\r\n    Bioplasma = 'Bioplasma',\r\n\r\n    // higher-order\r\n    Alloy = \"Alloy\",\r\n    Algorithm = \"Algorithm\",\r\n\r\n    // superb\r\n    Argent = \"Argent\",\r\n    Aurum = \"Aurum\",\r\n\r\n    // hyperbolic\r\n    Omnium = \"Omnium\",\r\n}\r\n\r\nlet cStep = 0.3\r\nconst blockColors: { [key in ResourceBlock]: Color } = {\r\n    Biomass: Color.Green,\r\n    Data: Color.Blue.lighten(cStep),\r\n    Mineral: Color.Red,\r\n\r\n    Meal: Color.Yellow.darken(cStep),\r\n    Idea: Color.Blue.lighten(cStep*2), //.desaturate(cStep),\r\n    Ore: Color.Red.darken(cStep),\r\n\r\n    Bioplasma: Color.Viridian,\r\n\r\n    Alloy: Color.DarkGray.darken(cStep), //(cStep),\r\n    Algorithm: Color.Blue.darken(cStep), //.desaturate(cStep),\r\n\r\n    Argent: Color.Gray.lighten(cStep),\r\n    Aurum: Color.Orange.lighten(cStep),\r\n\r\n    Omnium: Color.White,\r\n}\r\n\r\nexport function blockColor(block: ResourceBlock) {\r\n    let baseColor = blockColors[block]\r\n    return baseColor.desaturate(0.1) //.lighten(0.1) //.desaturate(0.25).lighten(0.125)\r\n}\r\n\r\n","import { ResourceBlock, Economy, emptyMarket } from \"./Economy\";\r\nimport { Color, FontStyle, Resource } from \"excalibur\";\r\nimport { DeviceSize } from \"../values/DeviceSize\";\r\nimport { MechanicalOperation, mechanicalOperations } from \"./MechanicalOperation\";\r\nimport { shuffle, range, sample } from \"../Util\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { doesNotReject } from \"assert\";\r\n\r\nconst bookshelfSvg = require('../images/bookshelf-plain.svg');\r\nconst vatSvg = require('../images/vat-plain.svg');\r\nconst benchSimple = require('../images/bench-simple-plain.svg');\r\nconst stove = require('../images/stove-plain.svg');\r\nconst cabin = require('../images/cabin-plain.svg');\r\nconst fire = require('../images/cooking-fire-plain.svg')\r\nconst bed = require('../images/bed-plain.svg')\r\nconst fridge = require('../images/fridge-plain.svg')\r\nconst server = require('../images/research-server-plain.svg')\r\nconst plant = require('../images/houseplant-plain.svg')\r\nconst workstation = require('../images/workstation-plain.svg')\r\n\r\nconst console = require('../images/console-plain.svg')\r\nconst consolePurple = require('../images/console-purple-plain.svg')\r\nconst consoleGreen = require('../images/console-green-plain.svg')\r\nconst consoleRed = require('../images/console-red-plain.svg')\r\nconst megaconsole = require('../images/mega-console-plain.svg')\r\n\r\nconst fabricator = require('../images/fabricator-plain.svg')\r\n\r\nconst couch = require('../images/couch-plain.svg')\r\nconst solar = require('../images/solar-collector-plain.svg')\r\nconst miner = require('../images/miner-plain.svg')\r\n\r\nconst statue = require('../images/statue-plain.svg')\r\nconst codex = require('../images/codex-plain.svg')\r\n\r\nconst lavaLamp = require('../images/lava-lamp-plain.svg')\r\nconst orrery = require('../images/orrery-plain.svg')\r\nconst telescope = require('../images/telescope-plain.svg')\r\nconst books = require('../images/books-plain.svg')\r\n\r\nconst greenhouse = require('../images/greenhouse-plain.svg')\r\nconst o2 = require('../images/oxygen-extractor-plain.svg')\r\nconst h20 = require('../images/water-condenser-plain.svg')\r\n\r\nconst minProcessor = require('../images/mineral-processor-plain.svg')\r\n\r\nconst images = {\r\n    bookshelf: bookshelfSvg,\r\n    vat: vatSvg,\r\n    bench: benchSimple,\r\n    stove,\r\n    cabin,\r\n    fire,\r\n    bed,\r\n    fridge,\r\n    server,\r\n    plant,\r\n    workstation,\r\n\r\n    console,\r\n    consolePurple,\r\n    consoleGreen,\r\n    consoleRed,\r\n    megaconsole,\r\n\r\n    fabricator,\r\n\r\n    couch,\r\n    solar,\r\n    miner,\r\n    statue,\r\n\r\n    codex,\r\n    lavaLamp,\r\n    orrery,\r\n    telescope,\r\n    books,\r\n    greenhouse,\r\n\r\n    o2,\r\n    h20,\r\n\r\n    minProcessor,\r\n\r\n}\r\n\r\n\r\nconst { Red, Green, Blue, Orange, Violet, Yellow } = Color;\r\n\r\nlet { store, generate, recipe, spawn, accelerateTime, explore } = mechanicalOperations\r\n\r\nexport class Machine {\r\n    name: string = '(machine name)'\r\n    description: string = '(machine description)'\r\n    color: Color = Color.LightGray\r\n\r\n    cost: ResourceBlock[] = [ResourceBlock.Mineral]\r\n\r\n    size: DeviceSize = DeviceSize.Small\r\n    operation: MechanicalOperation = { type: 'noop' }\r\n    image = images.vat\r\n    prereqs: (typeof Machine)[] = []\r\n    economy: Economy = emptyMarket()\r\n    forDome: boolean = false\r\n    hide: boolean = false\r\n\r\n    capacity: boolean\r\n\r\n    isVehicle: boolean = false\r\n\r\n    tinySlots: boolean = false\r\n    isEatingSurface: boolean = false\r\n\r\n    concretize(): Machine { return this; } \r\n\r\n    onPlacement(device: Device) {\r\n        // ...whatever we need to script here?\r\n    }\r\n}\r\n\r\nexport class CommandCenter extends Machine {\r\n    name = 'Command Console'\r\n    description = 'commander, we need your help'\r\n    operation = store(\r\n        [ResourceBlock.Mineral, ResourceBlock.Ore], //,ResourceBlock.Biomass],\r\n        24\r\n    )\r\n    image = images.megaconsole\r\n    size = DeviceSize.Medium\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 1, demand: 0 },\r\n        Oxygen: { supply: 20, demand: 0 },\r\n        Water: { supply: 3, demand: 0 },\r\n        Hope: { supply: 1, demand: 0 },\r\n        Shelter: { supply: 3, demand: 0}\r\n    }\r\n\r\n    onPlacement(device: Device) {\r\n        device.built = true\r\n        for (let i in range(20)) {\r\n            device.produceResource(ResourceBlock.Mineral)\r\n        }\r\n        let { building } = device\r\n        building.populate(device.pos.add(building.pos), true)\r\n        building.populate(device.pos.add(building.pos), false)\r\n        building.populate(device.pos.add(building.pos), false)\r\n    }\r\n}\r\n\r\nexport class MissionLog extends Machine {\r\n    name = 'Mission Log'\r\n    description = 'gather data'\r\n    operation = store(\r\n        [ResourceBlock.Data],\r\n        8\r\n    )\r\n    image = images.consolePurple\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.1 },\r\n        Hope: { supply: 1, demand: 0 }\r\n    }\r\n}\r\n\r\n//export class Energon extends Machine {\r\n//    name = 'Energon'\r\n//    description = 'food paste'\r\n//}\r\n\r\n// tiny\r\nexport class LavaLamp extends Machine {\r\n    name = 'Lava Lamp'\r\n    description = 'mesmerizing'\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image  = images.lavaLamp\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Joy: { supply: 1, demand: 0 },\r\n        Power: { supply: 0, demand: 0.1 },\r\n    }\r\n}\r\n\r\nexport class Figurine extends Machine {\r\n    name = 'Figurine'\r\n    description = 'not an action figure'\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image = images.statue   \r\n    economy = {\r\n        ...emptyMarket(),\r\n        Beauty: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Orrery extends Machine {\r\n    name = 'Orrery'\r\n    description = 'to the stars'\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image = images.orrery\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wonder: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Books extends Machine {\r\n    name = 'Books'\r\n    description = 'all there in black and white'\r\n    operation = generate(ResourceBlock.Idea, 2)\r\n    size = DeviceSize.Tiny\r\n    prereqs = [ Table ]\r\n    image = images.books\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\n// small\r\n/// small surface\r\n\r\nexport class OxygenExtractor extends Machine {\r\n    name = 'O2 Extractor'\r\n    description = 'breathe deep'\r\n    image = images.o2\r\n    prereqs = [ WaterCondensingMachine, SolarCell ]\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 6, demand: 0 },\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class SolarCell extends Machine {\r\n    name = 'Solar Cell'\r\n    description = 'feel the warmth'\r\n    image = images.solar\r\n    prereqs = [ Bed ] \r\n\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 10, demand: 0 },\r\n    }\r\n}\r\n\r\n\r\nexport class WaterCondensingMachine extends Machine {\r\n    name = 'H2O Condenser'\r\n    description = 'have a drink'\r\n// setup a loop here so we have to get survival I?\r\n    prereqs = [ SolarCell, OxygenExtractor ]\r\n    image = images.h20\r\n\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 5, demand: 0 },\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Telescope extends Machine {\r\n    name = 'Telescope'\r\n    description = 'look to the stars'\r\n    prereqs = [ Orrery ]\r\n    forDome = true\r\n    image = images.telescope\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 1, demand: 0 },\r\n    } \r\n}\r\n\r\n\r\n// /// small subsurface\r\n\r\nexport class Table extends Machine {\r\n    name = 'Table'\r\n    description = 'a simple table'\r\n    image = images.bench\r\n    isEatingSurface = true\r\n    // this device provides slots for tiny-sized deviecs\r\n    tinySlots = true\r\n}\r\n\r\nexport class Statue extends Machine {\r\n    name = 'Statue'\r\n    description = 'for honor'\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Hope: { supply: 0.1, demand: 0 },\r\n        Beauty: { supply: 1, demand: 0 },\r\n    }\r\n    image = images.statue\r\n    prereqs = [ Figurine ]\r\n}\r\n\r\nexport class StudyMachine extends Machine {\r\n    operation = recipe(\r\n        [ ResourceBlock.Idea, ResourceBlock.Idea, ResourceBlock.Idea ],\r\n        ResourceBlock.Data\r\n    )\r\n    color = Blue\r\n    concretize(): Machine { return new Workstation() } //(sample([Workstation, Desk]))() }\r\n}\r\n\r\n// export class Desk extends StudyMachine {\r\n//     name = 'Desk'\r\n//     description = 'get to work'\r\n//     image = images.bench\r\n//     prereqs = [ OxygenExtractor ]\r\n//     concretize() { return this }\r\n// }\r\n\r\nexport class Codex extends Machine {\r\n    name = 'Codex'\r\n    description = 'read it closely'\r\n    image = images.codex\r\n    prereqs = [ Bookshelf ]\r\n    operation = store([ResourceBlock.Data], 3)\r\n    color = Blue\r\n    // concretize() { return this }\r\n}\r\n\r\nexport class Workstation extends StudyMachine {\r\n    name = 'Workstation'\r\n    description = 'hackety hack'\r\n    prereqs = [ Bookshelf ]\r\n    image = images.workstation\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n    concretize() { return this }\r\n}\r\n\r\nexport class Couch extends Machine {\r\n    name = 'Couch'\r\n    description = 'take it easy'\r\n    prereqs = []\r\n    image = images.couch\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Joy: { supply: 0.1, demand: 0 },\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class Bookshelf extends Machine {\r\n    name = 'Shelf'\r\n    description = 'brainstorm'\r\n    operation = generate(ResourceBlock.Idea)\r\n    image = images.bookshelf\r\n    prereqs = [ Books, Codex ] // setup a loop...\r\n    color = Blue\r\n}\r\n\r\n\r\nexport class Fridge extends Machine {\r\n    name = 'Fridge'\r\n    description = 'store meals'\r\n    operation = store([ResourceBlock.Meal], 6)\r\n    image = images.fridge\r\n    prereqs = [Bookshelf]\r\n    color = Yellow\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Stove extends Machine {\r\n    name = 'Stove'\r\n    description = 'make a meal'\r\n    operation = recipe(\r\n        [ResourceBlock.Biomass, ResourceBlock.Biomass],\r\n        ResourceBlock.Meal\r\n    )\r\n    image = images.stove\r\n\r\n    prereqs = [Bookshelf, Fridge]\r\n    color = Yellow\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Bed extends Machine {\r\n    name = 'Bed'\r\n    description = 'sweet dreams'\r\n    image = images.bed\r\n    prereqs = [ OxygenExtractor ]\r\n    color = Orange\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Shelter: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Houseplant extends Machine {\r\n    name = 'House Plant'\r\n    description = 'so nice'\r\n    prereqs = [ Botany, Bed ]\r\n    // produces = ResourceBlock.Food\r\n    cost = [ ResourceBlock.Biomass ]\r\n    operation = generate(ResourceBlock.Biomass, 1)\r\n    color = Green\r\n    image = images.plant\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 1, demand: 0 },\r\n        Water: { supply: 0, demand: 0.1 },\r\n    }\r\n}\r\n\r\nexport class PersonnelRegistry extends Machine {\r\n    name = 'Personnel Registry'\r\n    description = 'track everybody'\r\n    prereqs = [ CloningVat ]\r\n    operation = store([ResourceBlock.Data], 4)\r\n    color = Yellow\r\n    image = images.console\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.1 },\r\n        Wisdom: { supply: 1, demand: 0 },\r\n    }\r\n\r\n    // onPlacement(device: Device) {\r\n    //     device.building.planet\r\n    // }\r\n}\r\n\r\nexport class OrientationConsole extends Machine {\r\n    name = 'Orientation Console'\r\n    description = 'welcome to the colony'\r\n    prereqs = [CloningVat]\r\n    operation = generate(ResourceBlock.Data, 1)\r\n    image = images.consoleRed\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.1 },\r\n        Hope: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class CloningVat extends Machine {\r\n    name = 'Cloning Vat'\r\n    description = 'we all grow'\r\n    // behavior = MachineOperation.SpawnCitizen \r\n    operation = spawn()\r\n    productionTime = 1500\r\n    image = images.vat\r\n    prereqs = [AlgaeVat]\r\n    size = DeviceSize.Small\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\nexport class DissolutionVat extends Machine {\r\n    name = 'Dissolution Vat'\r\n    description = 'back to basics'\r\n    // behavior = MachineOperation.SpawnCitizen \r\n    operation = recipe(\r\n        [ ResourceBlock.Biomass, ResourceBlock.Biomass ],\r\n        ResourceBlock.Bioplasma\r\n    )\r\n    productionTime = 1500\r\n    image = images.vat\r\n    prereqs = [PlasmaBank]\r\n    size = DeviceSize.Small\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class PlasmaBank extends Machine {\r\n    name = 'Bioplasm Bank'\r\n    description = 'hold on'\r\n    operation = store([ ResourceBlock.Bioplasma ])\r\n    prereqs = [AlgaeVat]\r\n    color = Green\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\n    \r\nexport class Fabricator extends Machine {\r\n    name = 'Fabricator'\r\n    description = 'you made that'\r\n    operation = recipe(\r\n        [ResourceBlock.Mineral, ResourceBlock.Mineral],\r\n         ResourceBlock.Alloy\r\n    )\r\n    size = DeviceSize.Small\r\n    color = Red\r\n    prereqs = [Workstation]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 3 },\r\n    }\r\n    image = images.fabricator\r\n}\r\n\r\nexport class AlgaeVat extends Machine {\r\n    name = 'Algae Vat'\r\n    description = 'where there is a will'\r\n    operation = generate(ResourceBlock.Biomass)\r\n    prereqs = [ OxygenExtractor, Bookshelf, Fridge ]\r\n    size = DeviceSize.Small\r\n    color = Violet\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\nexport class LifeSciencesConsole extends Machine {\r\n    name = 'Life Sciences Console'\r\n    description = 'mind and body together'\r\n    operation = store([ResourceBlock.Biomass, ResourceBlock.Data], 5)\r\n    prereqs = [Houseplant, Botany]\r\n    color = Green\r\n    image = images.consoleGreen\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 0.2 },\r\n    }\r\n}\r\n\r\n// medium\r\n\r\nexport class Miner extends Machine {\r\n    name = 'Miner (Rover)'\r\n    description = 'mobile drill unit'\r\n\r\n    // gather actually takes the machine/citizen around?\r\n    operation = explore(ResourceBlock.Ore, 2)\r\n\r\n    prereqs = [MineralProcessor, MiningDrill]\r\n    color = Red\r\n    size = DeviceSize.Medium\r\n    isVehicle = true\r\n    image = images.miner\r\n}\r\n\r\nexport class MetalStorage extends Machine {\r\n    name = 'Metal Storage'\r\n    description = 'contain minerals and alloys?'\r\n    operation = store([ResourceBlock.Mineral, ResourceBlock.Alloy], 8)\r\n    prereqs = [Bookshelf]\r\n    color = Red\r\n    size = DeviceSize.Medium\r\n}\r\n\r\nexport class ResearchServer extends Machine {\r\n    name = 'Research Server'\r\n    description = 'hold data'\r\n    operation = store([ResourceBlock.Data, ResourceBlock.Algorithm], 10)\r\n    image = images.server\r\n    prereqs = [Bookshelf, Workstation]\r\n    size = DeviceSize.Medium\r\n    color = Blue\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 4 },\r\n    }\r\n}\r\n\r\nexport class Greenhouse extends Machine {\r\n   name = 'Greenhouse'\r\n   description = 'grow some food'\r\n   operation = generate(ResourceBlock.Biomass)\r\n   size = DeviceSize.Medium\r\n   prereqs = [AlgaeVat]\r\n   color = Green\r\n    forDome = true\r\n    image = images.greenhouse\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n        Water: { supply: 0, demand: 1 },\r\n        Oxygen: { supply: 4, demand: 0 },\r\n    }\r\n}\r\n\r\n\r\nexport class Cabin extends Machine {\r\n   name = 'Cabin'\r\n   description = 'home on the plains'\r\n   operation = recipe(\r\n       [ ResourceBlock.Biomass, ResourceBlock.Biomass ],\r\n       ResourceBlock.Meal\r\n   )\r\n   image = images.cabin\r\n   prereqs = [Orchard]\r\n   size = DeviceSize.Medium\r\n   color = Orange\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n        Water: { supply: 0, demand: 1 },\r\n        Shelter: { supply: 4, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class Arbor extends Machine {\r\n    name = 'Arbor'\r\n    description = 'arbor around the clock'\r\n    operation = generate(ResourceBlock.Biomass)\r\n    prereqs = [Orchard]\r\n    size = DeviceSize.Medium\r\n    color = Green\r\n    forDome = true\r\n}\r\n\r\n\r\nexport class Botany extends Machine {\r\n    name = 'Botany'\r\n    description = 'plant lab'\r\n    operation = generate(ResourceBlock.Biomass)\r\n    prereqs = [ OxygenExtractor, Bookshelf ]\r\n    size = DeviceSize.Medium\r\n    color = Green\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\n\r\nexport class MineralProcessor extends Machine {\r\n    name = 'Mineral Processor'\r\n    description = 'wheat from the chaff'\r\n    operation = recipe(\r\n        [ResourceBlock.Ore, ResourceBlock.Ore, ResourceBlock.Ore],\r\n         ResourceBlock.Mineral\r\n    )\r\n    size = DeviceSize.Medium\r\n    color = Red\r\n    image = images.minProcessor\r\n    prereqs = [Workstation, Fabricator]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n    }\r\n}\r\n\r\nexport class ThinkingFountain extends Machine {\r\n    name = 'Thinking Fountain'\r\n    description = 'slowly growing'\r\n    size = DeviceSize.Medium\r\n    prereqs = [ Mainframe, Megafabricator, MolecularEngine ]\r\n    color = Color.fromHex('daa520')\r\n    operation = generate(ResourceBlock.Aurum, 8)\r\n    cost = [ResourceBlock.Aurum]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 2, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 }\r\n    }\r\n}\r\n\r\nexport class SilverForest extends Machine {\r\n    name = 'Silver Forest'\r\n    description = 'immense serenity'\r\n    size = DeviceSize.Medium\r\n    prereqs = [ Megafabricator, Mainframe ]\r\n    color = Color.fromHex('c0c0c0')\r\n    operation = store([ResourceBlock.Argent], 12)\r\n    cost = [ResourceBlock.Alloy, ResourceBlock.Algorithm]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Beauty: { supply: 2, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 }\r\n    }\r\n    forDome = true\r\n}\r\n\r\nexport class TimeCrystal extends Machine {\r\n    name = 'Time Crystal'\r\n    description = 'xlr8'\r\n    size = DeviceSize.Medium\r\n    color = Color.fromHex('e5e4e2')\r\n    operation = accelerateTime()\r\n    cost = [ResourceBlock.Omnium]\r\n    prereqs = [ Megafabricator, SilverForest ]\r\n}\r\n\r\nexport class HoloProjector extends Machine {\r\n    name = 'Holo Projector'\r\n    description = 'whatever your heart desires'\r\n    size = DeviceSize.Medium\r\n    color = Blue\r\n    operation = generate(ResourceBlock.Data, 3)\r\n    cost = [ResourceBlock.Algorithm, ResourceBlock.Mineral]\r\n    prereqs = [ Mainframe ]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 2 },\r\n        Joy: { supply: 3, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class SacredGrove extends Machine {\r\n    name = 'Sacred Grove'\r\n    description = 'where the furies play'\r\n    size = DeviceSize.Medium\r\n    forDome = true\r\n    cost = [ ResourceBlock.Omnium ]\r\n    prereqs = [ AtomicCompiler ]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Oxygen: { supply: 4, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class AtomicCompiler extends Machine {\r\n    name = 'Atomic Compiler'\r\n    description = 'super position'\r\n    operation = recipe(\r\n        [ ResourceBlock.Aurum, ResourceBlock.Argent ],\r\n        ResourceBlock.Omnium\r\n    )\r\n    cost = [ ResourceBlock.Argent, ResourceBlock.Algorithm ]\r\n    prereqs = [ ThinkingFountain, SilverForest ]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 3 },\r\n    }\r\n}\r\n\r\n\r\n// large devices!\r\n\r\nexport class Orchard extends Machine {\r\n   name = 'Orchard'\r\n   description = 'grow some food'\r\n   operation = generate(ResourceBlock.Biomass, 10)\r\n   size = DeviceSize.Large\r\n   prereqs = [AlgaeVat]\r\n   color = Green\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 1 },\r\n        Water: { supply: 0, demand: 1 },\r\n        Oxygen: { supply: 2, demand: 0 },\r\n    }\r\n}\r\n\r\n\r\nexport class MiningDrill extends Machine {\r\n    name = 'Mining Drill'\r\n    description = 'ore away'\r\n    operation = generate(ResourceBlock.Ore)\r\n    size = DeviceSize.Large\r\n    prereqs = [ Fabricator ]\r\n    image = images.miner\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 5 },\r\n    }\r\n}    \r\n\r\nexport class Megafabricator extends Machine {\r\n    name = 'Mega-Fabricator'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Fabricator ]\r\n    color = Red\r\n    operation = recipe(\r\n        [ResourceBlock.Alloy, ResourceBlock.Algorithm],\r\n        ResourceBlock.Argent\r\n    )\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 8 },\r\n    }\r\n}\r\n\r\nexport class MolecularEngine extends Machine {\r\n    name = 'Molecular Engine'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Megafabricator ]\r\n    color = Violet\r\n    operation = recipe(\r\n        [ResourceBlock.Bioplasma, ResourceBlock.Algorithm],\r\n        ResourceBlock.Aurum\r\n    )\r\n    image = images.megaconsole\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 3 },\r\n        Water: { supply: 0, demand: 1 },\r\n    }\r\n}\r\n\r\nexport class Mainframe extends Machine {\r\n    name = 'Mainframe'\r\n    size = DeviceSize.Large\r\n    color = Blue\r\n    prereqs = [ResearchServer]\r\n    cost = [ ResourceBlock.Mineral, ResourceBlock.Mineral ]\r\n    operation = recipe(\r\n        [ ResourceBlock.Data, ResourceBlock.Data ],\r\n        ResourceBlock.Algorithm\r\n    )\r\n    image = images.server\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Power: { supply: 0, demand: 6 },\r\n    }\r\n}\r\n\r\nexport class Preserve extends Machine {\r\n    name = 'Nature Preserve'\r\n    size = DeviceSize.Large\r\n    prereqs = [ Arbor ]\r\n    color = Green\r\n    forDome = true\r\n    operation = generate(ResourceBlock.Biomass, 12)\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 0, demand: 4 },\r\n        Oxygen: { supply: 12, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class LogicPool extends Machine {\r\n    name = 'Logic Pool'\r\n    size = DeviceSize.Large\r\n    prereqs = [ MolecularEngine ]\r\n    color = Color.fromHex('daa520')\r\n    operation = store([ResourceBlock.Aurum], 12)\r\n    cost = [ResourceBlock.Algorithm, ResourceBlock.Bioplasma]\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Wisdom: { supply: 2, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 }\r\n    }\r\n}\r\n\r\nexport class Cathedral extends Machine {\r\n    name = 'Cathedral'\r\n    description = 'first ultrahumanist'\r\n    size = DeviceSize.Large\r\n    prereqs = [ SacredGrove ]\r\n}\r\n\r\n\r\n/// huge devices\r\n\r\nexport class Microcity extends Machine {\r\n    name = 'Microcity'\r\n    size = DeviceSize.Huge\r\n    prereqs = [ Megafabricator ]\r\n    color = Orange\r\n    forDome = true\r\n    economy = {\r\n        ...emptyMarket(),\r\n        Water: { supply: 0, demand: 2 },\r\n        Power: { supply: 0, demand: 2 },\r\n        Joy: { supply: 5, demand: 0 },\r\n        Hope: { supply: 5, demand: 0 },\r\n        Beauty: { supply: 1, demand: 0 },\r\n        Wonder: { supply: 1, demand: 0 },\r\n    }\r\n}\r\n\r\nexport class LogicCrystal extends Machine {\r\n    name = 'Logic Crystal'\r\n    size = DeviceSize.Huge\r\n    prereqs = [ Megafabricator ]\r\n    color = Blue\r\n}\r\n\r\n// export class MiniSun extends Machine {}\r\n\r\nexport const allMachines: (typeof Machine)[] = [\r\n    AlgaeVat,\r\n    Arbor,\r\n    Bed,\r\n    Bookshelf,\r\n    Cabin,\r\n    CloningVat,\r\n    // Desk,\r\n    Fabricator,\r\n    Fridge,\r\n    Houseplant,\r\n    Megafabricator,\r\n    MiningDrill,\r\n    Orchard,\r\n    OxygenExtractor,\r\n    Preserve,\r\n    ResearchServer,\r\n    SolarCell,\r\n    Stove,\r\n    WaterCondensingMachine,\r\n    Workstation,\r\n    Microcity,\r\n    LogicCrystal,\r\n    Botany,\r\n\r\n    MineralProcessor,\r\n    PlasmaBank,\r\n    DissolutionVat,\r\n    MetalStorage,\r\n    Mainframe,\r\n\r\n    PersonnelRegistry,\r\n    MolecularEngine,\r\n    ThinkingFountain,\r\n    SilverForest,\r\n\r\n    OrientationConsole,\r\n    LifeSciencesConsole,\r\n\r\n    TimeCrystal,\r\n    LogicPool,\r\n    HoloProjector,\r\n    Cathedral,\r\n    SacredGrove,\r\n    AtomicCompiler,\r\n\r\n    Couch,\r\n    Statue,\r\n    Codex,\r\n\r\n    Table,\r\n    LavaLamp,\r\n\r\n    Figurine,\r\n\r\n    Miner,\r\n    Orrery,\r\n    Telescope,\r\n    Books,\r\n]","\r\nexport enum Orientation { Left, Up, Right, Down } //, Angle }\r\n\r\nexport const compass = [\r\n    Orientation.Left,\r\n    Orientation.Right,\r\n    Orientation.Up,\r\n    Orientation.Down,\r\n]\r\n\r\n\r\nexport function flip(orientation: Orientation): Orientation {\r\n    switch (orientation) {\r\n        case Orientation.Left: return Orientation.Right\r\n        case Orientation.Right: return Orientation.Left\r\n        case Orientation.Up: return Orientation.Down\r\n        case Orientation.Down: return Orientation.Up\r\n    }\r\n    throw new Error(`Don't know orientation ${ orientation }`)\r\n}","import { Actor, Vector, CollisionType, Color, Label, Traits, FontStyle } from \"excalibur\";\r\nimport { Planet } from \"../Planet/Planet\";\r\nimport { Structure, } from \"../../models/Structure\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip, compass } from \"../../values/Orientation\";\r\nimport { Game } from \"../../Game\";\r\nimport { Rectangle } from \"../../values/Rectangle\";\r\nimport { closest, measureDistance, deleteByValue, containsUniq, flatSingle } from \"../../Util\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { ResourceBlock, emptyMarket, Economy, sumMarkets, equilibrium, allValues, availableCapacity } from \"../../models/Economy\";\r\nimport { Device } from \"../Device\";\r\nimport { allSpaceFunctions, RoomRecipe } from \"../../models/RoomRecipe\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { World } from \"../../models/World\";\r\nimport { Machine, allMachines, CommandCenter, MissionLog, StudyMachine } from \"../../models/Machine\";\r\nimport { BackgroundPattern } from \"./BackgroundPatterns\";\r\nimport { EconomicValue } from \"../Hud/EconomicValue\";\r\nimport { drawRect, pathFromRect } from \"../../Painting\";\r\n\r\nexport class DevicePlace {\r\n    constructor(private pos: Vector, private size: DeviceSize) {}\r\n    get position() { return this.pos }\r\n    get visibleSize() { return getVisibleDeviceSize(this.size) }\r\n\r\n}\r\n\r\nexport class Building extends Actor {\r\n    edgeWidth: number = 0\r\n\r\n    nameLabel: Label\r\n\r\n    placed: boolean = false\r\n    hover: boolean = false\r\n    showLabel: boolean = false\r\n    facing: Orientation = Orientation.Right\r\n    hideBox: boolean = false\r\n    parentSlot: Slot\r\n    childrenBuildings: Building[] = []\r\n\r\n    spaceFunction: RoomRecipe\r\n\r\n    private devices: Device[] = []\r\n    givenName: string\r\n\r\n\r\n    private active: boolean = true\r\n    // private built: boolean = false\r\n\r\n    constructor(pos: Vector, public structure: Structure, public planet: Planet) {\r\n        super(\r\n          pos.x,\r\n          pos.y,\r\n          structure.width,\r\n          structure.height,\r\n          structure.infra ? planet.color.darken(0.3) : Color.Transparent\r\n        )\r\n        this.anchor = new Vector(0,0)\r\n\r\n        this.setup();\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling))\r\n\r\n        this.on('pointerenter', () => {\r\n            this.hover = true\r\n            if (!this.devices.some(d => d.hover)) {\r\n                this.planet.currentlyViewing = this\r\n            }\r\n        })\r\n\r\n\r\n        this.on('pointerdown', () => {\r\n            // console.log(\"CLICKED BUILDING\", { building: this })\r\n            this.toggleActive();\r\n        })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.hover = false\r\n        })\r\n\r\n        this.collisionType = CollisionType.PreventCollision\r\n\r\n        this.nameLabel = new Label(this.structure.name, 0, 0, Game.font) // 'Helvetica')\r\n        this.nameLabel.fontSize = 9\r\n        // this.nameLabel.fontStyle = FontStyle.Italic\r\n        this.nameLabel.color = Color.White\r\n\r\n        if (this.structure.infra) { this.active = true }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        if (!this.hideBox) {\r\n            drawRect(ctx, this.aabb(), this.edgeWidth, this.processedColor())\r\n        }\r\n        // this.devices.forEach(device => device.draw(ctx, delta))\r\n        super.draw(ctx, delta)\r\n\r\n        if (this.showLabel && this.spaceFunction) {\r\n            this.nameLabel.pos = this.pos.add(new Vector(28, 24)) //get getCenter().\r\n            // this.nameLabel.color = Color.White\r\n            // this.nameLabel.pos.x = this.getCenter().x //ctx.measureText(this.structure.name).width / 2\r\n            // this.nameLabel.pos.x -= ctx.measureText(this.structure.name).width / 2\r\n            this.nameLabel.draw(ctx, delta)\r\n\r\n        }\r\n\r\n        // let debug = true;\r\n        if (Game.debugPath) {\r\n            if (this.slots().length > 0) {\r\n                // draw slots\r\n                this.slots().forEach((slot: Slot) => {\r\n                    let rect: Rectangle = { x: slot.pos.x, y: slot.pos.y, width: 3, height: 3 }\r\n                    drawRect(ctx, rect, 1, Color.Gray.lighten(0.5))\r\n                })\r\n            }\r\n         if (this.nodes().length > 0) {\r\n                // draw nodes\r\n                this.nodes().forEach((node: Vector) => {\r\n                    let rect: Rectangle = { x: node.x, y: node.y, width: 4, height: 4 }\r\n                    drawRect(ctx, rect, 1, Color.Yellow.lighten(0.5))\r\n                })\r\n            }\r\n\r\n        }\r\n\r\n        let showDevicePlaces = false\r\n        if (showDevicePlaces && this.devicePlaces().length > 0 && this.devices.length < this.devicePlaces().length) {\r\n            this.devicePlaces().forEach(p => {\r\n                let place = p.position\r\n                let sz = p.visibleSize\r\n                drawRect(ctx,\r\n                    { x: place.x - sz/2, y: place.y - sz/2, width: sz, height: sz },\r\n                    0.1,\r\n                    Color.White,\r\n                    false,\r\n                    true\r\n                )\r\n            })\r\n        }\r\n    }\r\n\r\n\r\n    step: number = 0\r\n    update(engine: Game, delta: number) {\r\n        super.update(engine, delta)\r\n\r\n        let tryProduce = this.placed;\r\n        if (tryProduce) {\r\n            this.devices.forEach(device => {\r\n                device.tryProduce(this.step)\r\n                if(device.tinyDevices.length > 0) {\r\n                    device.tinyDevices.forEach(tinyDevice => tinyDevice.tryProduce(this.step))\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        // this.devices.forEach(d => d.update(engine, delta))\r\n\r\n        this.step += 1\r\n    }\r\n\r\n\r\n    poly() { return this.aabbPoly() }\r\n\r\n\r\n    get name() {\r\n        if (this.spaceFunction) {\r\n            return this.spaceFunction.name\r\n        } else {\r\n            return this.structure.name\r\n        }\r\n    }\r\n\r\n    get description() {\r\n        if (this.spaceFunction) {\r\n            return this.spaceFunction.description\r\n        } else {\r\n            return this.structure.description\r\n        }\r\n    }\r\n\r\n    get floorY() {\r\n        return this.pos.y + this.getHeight() //().y\r\n    }\r\n\r\n    economy(emptyUnlessActive: boolean = true): Economy {\r\n        if (emptyUnlessActive && !this.isActive) {\r\n            return emptyMarket()\r\n        } else {\r\n            let machineEconomies = this.devices.map(d => d.economy)\r\n            //machine.economy)\r\n\r\n            let buildingEconomy = {\r\n                ...emptyMarket(),\r\n                Oxygen: { demand: 1, supply: 0 }, // structural demand\r\n                // Water: { demand: 0.1, supply: 0 },\r\n            }\r\n\r\n            let aggregate = [...machineEconomies, buildingEconomy]\r\n                .reduce(sumMarkets, emptyMarket())\r\n\r\n            return aggregate\r\n        }\r\n    }\r\n\r\n    private toggleActive() {\r\n        if (!this.structure.infra) {\r\n            if (this.active) {\r\n                if (this.devices.some(d => d.inUse)) { return }\r\n                let wasEquil = equilibrium(this.planet.economy)\r\n                this.active = false\r\n                if (wasEquil) {\r\n                    if (!equilibrium(this.planet.economy)) {\r\n                        this.active = true\r\n                        // return\r\n                    }\r\n                    // this.active = true\r\n                } else {\r\n                    // we weren't at equilibrium previously\r\n                    // permit it, if we don't have any supply that would go negative without us?\r\n                    // console.log(\"can we toggle?\")\r\n                    for (let value of allValues) {\r\n                        let localCap = availableCapacity(this.economy(false), value)\r\n                        let globalCap = availableCapacity(this.planet.economy, value)\r\n                        // console.log(\"value\", { value, localCap, globalCap})\r\n                        if (localCap > 0 && globalCap < 0) {\r\n                            // don't permit it to be turned off\r\n                            this.active = true\r\n                        }\r\n                    }\r\n                }\r\n            } else { // this.active is false now\r\n                let agg = [\r\n                    this.planet.economy,\r\n                    this.economy(false)\r\n                ].reduce(sumMarkets, emptyMarket())\r\n\r\n                if (equilibrium(agg)) {\r\n                    this.active = true\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    get isActive() { return !!this.active }\r\n\r\n\r\n    setup(): void { }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        return cursor.clone();\r\n    }\r\n    reshape(cursor: Vector): void {\r\n        // this.pos = cursor.clone()\r\n        this.alignToSlot(cursor)\r\n    }\r\n\r\n    afterConstruct(): void {}\r\n\r\n    handleClick(_pos): boolean { return true; }\r\n\r\n    slots(): Slot[] {\r\n        return []\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n\r\n    devicePlaces(): DevicePlace[] {\r\n        return []; //this.nodes();\r\n    }\r\n\r\n    deviceInteractionPlaces(): Vector[] {\r\n        return this.devicePlaces().map(place => {\r\n            place.position.y += (place.visibleSize/2)\r\n            return place.position\r\n        })\r\n    }\r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph\r\n        // assemble subgraph\r\n        let nodes = this.nodes()\r\n        let rootNode = g.findOrCreate(nodes[0], measureDistance)\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            g.edge(rootNode, slot)\r\n\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(slot, childNode)\r\n\r\n            child.graph(g)\r\n        }\r\n        return g\r\n    }\r\n\r\n    // just a patch through to planet -- but could animate something here?\r\n    public redeem(res: ResourceBlock) {\r\n        this.planet.gather(res)\r\n    }\r\n\r\n    public debit(res: ResourceBlock) {\r\n        this.planet.spend(res)\r\n    }\r\n\r\n    public populate(pos: Vector, elite: boolean = false) {\r\n        this.planet.populate(pos, elite) //this.pos)\r\n    }\r\n\r\n    protected aabb(): Rectangle {\r\n        return {\r\n            x: this.pos.x,\r\n            y: this.pos.y,\r\n            width: this.getWidth(),\r\n            height: this.getHeight()\r\n        }\r\n    }\r\n\r\n    protected aabbPoly(): {x:number,y:number}[] {\r\n        return pathFromRect(this.aabb());\r\n\r\n    }\r\n\r\n    protected angledRoofPoly(): {x: number, y: number}[] {\r\n        let angleStartY = 1 * (this.getHeight() / 3) - 3\r\n        let angleStartX = 20 // 1 * (this.getWidth() / 10)\r\n        return [\r\n            // bottom-left\r\n            { x: this.pos.x, y: this.pos.y + this.getHeight() },\r\n\r\n            // upper-left\r\n            { x: this.pos.x, y: this.pos.y + angleStartY },\r\n            { x: this.pos.x + angleStartX, y: this.pos.y },\r\n\r\n            // upper-right\r\n            { x: this.pos.x + this.getWidth() - angleStartX, y: this.pos.y },\r\n            { x: this.pos.x + this.getWidth(), y: this.pos.y + angleStartY },\r\n\r\n            // bottom-right\r\n            { x: this.pos.x + this.getWidth(), y: this.pos.y + this.getHeight() },\r\n        ]\r\n            \r\n    }\r\n\r\n    protected overlaps(other: Building): boolean {\r\n        let rect1 = this.aabb(), rect2 = other.aabb();\r\n        let doesOverlap = (\r\n            rect1.x < rect2.x + rect2.width &&\r\n            rect1.x + rect1.width > rect2.x &&\r\n            rect1.y < rect2.y + rect2.height &&\r\n            rect1.y + rect1.height > rect2.y\r\n        )\r\n        return(!!doesOverlap);\r\n    }\r\n\r\n    public overlapsAny(): boolean {\r\n        return !!this.planet.colony.buildings.find(bldg => bldg !== this && this.overlaps(bldg))\r\n    }\r\n\r\n    protected edgeColor(): Color {\r\n        let edge = this.processedColor().lighten(0.85);\r\n        return edge;\r\n    }\r\n\r\n    protected mainColor(): Color {\r\n        let main = this.processedColor().darken(0.08);\r\n        return main;\r\n    }\r\n\r\n    protected colorBase(): Color {\r\n        return this.color;\r\n    }\r\n\r\n    protected processedColor(): Color {\r\n        let clr = this.colorBase().clone();\r\n        if (!this.placed)  { \r\n            if (this.overlapsAny()) { clr = Color.Red }\r\n            clr.a = 0.8\r\n        }\r\n        if (!this.active) {\r\n            clr = clr.darken(0.8)\r\n        }\r\n\r\n        if (this.hover) { clr.a = 0.5 }\r\n        return clr;\r\n    }\r\n\r\n    get connections() {\r\n        return this.structure.connections;\r\n    }\r\n\r\n\r\n    protected findSlot(\r\n        pos: Vector,\r\n        validConnections: { [key in Orientation]: (typeof Structure)[] } = this.connections\r\n    ): Slot {\r\n        let slotList = []\r\n            for (let dir of compass) {\r\n                const validStructures = validConnections[dir];\r\n                let flipped = flip(dir)\r\n                const buildings = validStructures.map(structure =>\r\n                    this.planet.closestBuildingByType(pos, [structure])\r\n                )\r\n                buildings.forEach(building => {\r\n                    if (building) {\r\n                        let neighborSlots = building.slots()\r\n                        neighborSlots.filter(slot => slot.facing === flipped)\r\n                        .forEach(matchingSlot => {\r\n                            slotList.push(matchingSlot)\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n\r\n        if (slotList.length > 0) {\r\n            return closest(pos, slotList, (slot) => slot.pos)\r\n        } else {\r\n            // console.warn('no conecting structures found')\r\n        }\r\n    }\r\n\r\n    protected alignToSlot(\r\n        cursor: Vector,\r\n        validConnections: { [key in Orientation]: (typeof Structure)[] } = this.connections\r\n    ) {\r\n        let theSlot = this.findSlot(cursor, validConnections)\r\n        if (theSlot) {\r\n            let matchingSlot = this.slots()\r\n                .find(s => s.facing == flip(theSlot.facing))\r\n            if (matchingSlot) {\r\n                let offset = theSlot.pos.sub(matchingSlot.pos)\r\n                this.pos.addEqual(offset)\r\n\r\n                this.parentSlot = theSlot;\r\n                return theSlot;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected buildSlot(x: number, y: number, facing: Orientation = Orientation.Right): Slot {\r\n        return {\r\n            pos: new Vector(x,y),\r\n            facing,\r\n            parent: this\r\n        }\r\n    }\r\n\r\n    public addDevice(device: Device) {\r\n        // device.finalize()\r\n        if (device.building !== this) {\r\n            device.building = this\r\n        }\r\n        this.devices.push(device)\r\n        device.pos.subEqual(this.pos) // = this.devicePlaces()[0].position\r\n        // console.log(\"DEVICE IS AT\", { pos: device.pos })\r\n        this.add(device)\r\n        this.updateFunction()\r\n        device.machine.onPlacement(device)\r\n        this.toggleActive()\r\n\r\n        device.placed = true\r\n    }\r\n\r\n    public hasPlaceForDevice() {\r\n        return this.devices.length < this.devicePlaces().length\r\n    }\r\n\r\n    public nextDevicePlace(): DevicePlace {\r\n        // could throw an err if we have no place\r\n        return this.devicePlaces()[\r\n            this.devices.length\r\n        ]\r\n    }\r\n\r\n    public getDevices() {\r\n        return [ ...this.devices, ...flatSingle(this.devices.map(d => d.tinyDevices)) ]\r\n    }\r\n\r\n    public updateFunction() {\r\n        let allTheMachines = [ StudyMachine, ...allMachines, CommandCenter, MissionLog ]\r\n        let machines = this.devices.map(\r\n            d => allTheMachines.find((m: typeof Machine) => d.machine instanceof m)\r\n        )\r\n        let fn = allSpaceFunctions.find(spaceFn => {\r\n            let sf = new spaceFn()\r\n\r\n            return containsUniq(\r\n              machines,\r\n              sf.machines\r\n            );\r\n        })\r\n        if (fn) {\r\n            // console.log(\"Determined building function\", { fn })\r\n            let sf = new fn()\r\n            this.spaceFunction = sf\r\n            this.nameLabel.text = sf.name\r\n        } else {\r\n            // console.warn(\"Could not identify function!\")\r\n        }\r\n    }\r\n\r\n    get backgroundPattern() {\r\n        if (this.spaceFunction) {\r\n            return this.spaceFunction.background\r\n        } else {\r\n            return BackgroundPattern.Grid\r\n        }\r\n    }\r\n}","import { Vector, Color } from \"excalibur\";\r\nimport { Rectangle } from \"./values/Rectangle\";\r\nimport { BackgroundPattern, getBackgroundPattern } from \"./actors/Building/BackgroundPatterns\";\r\nimport { Game } from \"./Game\";\r\n\r\ntype PaintingPath = { x: number, y: number }[]\r\n\r\nexport function pathFromRect(rect: Rectangle): PaintingPath {\r\n  let pos = { x: rect.x, y: rect.y }\r\n  let path = [\r\n            // bottom-left\r\n            { x: pos.x, y: pos.y + rect.height }, // this.getHeight() },\r\n\r\n            // upper-left\r\n            { x: pos.x, y: pos.y },\r\n\r\n            // upper-right\r\n            { x: pos.x + rect.width, y: pos.y },\r\n\r\n            // bottom-right\r\n            { x: pos.x + rect.width, y: pos.y + rect.height },\r\n        ];\r\n\r\n  return path\r\n}\r\n\r\n// tiny rendering lib\r\nexport function drawLine(ctx: CanvasRenderingContext2D, a: Vector, b: Vector, clr: Color = Color.White, lineWidth: number = 1) {\r\n  let c = clr.clone()\r\n  // c.a = 0.5\r\n  ctx.beginPath()\r\n  ctx.moveTo(a.x, a.y)\r\n  ctx.lineTo(b.x, b.y)\r\n  ctx.strokeStyle = c.toRGBA()\r\n  ctx.lineWidth = lineWidth\r\n  ctx.stroke()\r\n  ctx.lineWidth = 1\r\n}\r\n\r\nexport function drawPatternedRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  rect: Rectangle,\r\n  pattern: BackgroundPattern = BackgroundPattern.Grid\r\n) {\r\n  const gridPattern = getBackgroundPattern(ctx, pattern)\r\n  if (gridPattern) {\r\n    drawPatternedPoly(ctx, pathFromRect(rect), pattern)\r\n\r\n  }\r\n}\r\n\r\nexport function drawPatternedPoly(\r\n  ctx: CanvasRenderingContext2D,\r\n  path: {x:number, y:number}[],\r\n  // rect: Rectangle,\r\n  pattern: BackgroundPattern = BackgroundPattern.Grid,\r\n  edgeColor: Color = Color.Black\r\n) {\r\n  const gridPattern = getBackgroundPattern(ctx, pattern)\r\n  if (gridPattern) {\r\n    ctx.save()\r\n    ctx.translate(path[0].x, path[0].y)\r\n    // ctx.moveTo(0, 0)\r\n    ctx.beginPath()\r\n    ctx.moveTo(0,0) //path[0].x, path[0].y)\r\n    path.forEach(pt => ctx.lineTo(pt.x - path[0].x, pt.y-path[0].y))\r\n    ctx.lineTo(0,0) // path[0].x, path[0].y)\r\n    ctx.closePath()\r\n    // let { x, y, width, height } = rect;\r\n    ctx.fillStyle = gridPattern\r\n    ctx.fill()\r\n\r\n\r\n    ctx.strokeStyle = edgeColor.fillStyle()\r\n    ctx.stroke()\r\n    ctx.restore()\r\n    // ctx.fillRect(x,y,width,height)\r\n\r\n    // ctx.lineWidth = 2\r\n    // ctx.setLineDash([])\r\n    // ctx.strokeStyle = Color.White.toRGBA()\r\n    // ctx.strokeRect(x,y,width,height)\r\n  }\r\n}\r\n\r\nexport function drawRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  rectangle: Rectangle,\r\n  edgeWidth: number = 0,\r\n  color: Color = Color.White,\r\n  filled: boolean = true,\r\n  dashed: boolean = false\r\n) {\r\n  let { x, y, width, height } = rectangle;\r\n\r\n  if (filled) {\r\n    let main = color.clone();\r\n    // main.a = 1\r\n    ctx.fillStyle = main.toRGBA();\r\n    ctx.fillRect(\r\n      x,\r\n      y,\r\n      width,\r\n      height\r\n    )\r\n  }\r\n\r\n  if (edgeWidth > 0) {\r\n    let edge = Color.White.clone();\r\n    ctx.strokeStyle = edge.toRGBA();\r\n    ctx.lineWidth=edgeWidth\r\n    if (dashed) { ctx.setLineDash([5, 10]) }\r\n    else { ctx.setLineDash([]) }\r\n    ctx.strokeRect(\r\n      x, y, width, height\r\n    )\r\n  }\r\n}\r\n\r\nexport function drawPoly(\r\n  ctx: CanvasRenderingContext2D,\r\n  path: {x:number, y:number}[],\r\n  color: Color\r\n  // rect: Rectangle,\r\n  // pattern: BackgroundPattern = BackgroundPattern.Grid\r\n) {\r\n  // const gridPattern = getBackgroundPattern(ctx, pattern)\r\n  // if (gridPattern) {\r\n    ctx.beginPath()\r\n    ctx.moveTo(path[0].x, path[0].y)\r\n    path.forEach(pt => ctx.lineTo(pt.x, pt.y))\r\n    ctx.lineTo(path[0].x, path[0].y)\r\n    ctx.closePath()\r\n    // let { x, y, width, height } = rect;\r\n    ctx.fillStyle = color.fillStyle()\r\n    ctx.fill()\r\n    // ctx.fillRect(x,y,width,height)\r\n\r\n    // ctx.lineWidth = 2\r\n    // ctx.setLineDash([])\r\n    // ctx.strokeStyle = Color.White.toRGBA()\r\n    // ctx.strokeRect(x,y,width,height)\r\n  // }\r\n}\r\n\r\nexport function drawStar(ctx, cx, cy, outerRadius=3.6, innerRadius=1.4, spikes=5, ) {\r\n    var rot = Math.PI / 2 * 3;\r\n    var x = cx;\r\n    var y = cy;\r\n    var step = Math.PI / spikes;\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(cx, cy - outerRadius)\r\n    for (let i = 0; i < spikes; i++) {\r\n        x = cx + Math.cos(rot) * outerRadius;\r\n        y = cy + Math.sin(rot) * outerRadius;\r\n        ctx.lineTo(x, y)\r\n        rot += step\r\n\r\n        x = cx + Math.cos(rot) * innerRadius;\r\n        y = cy + Math.sin(rot) * innerRadius;\r\n        ctx.lineTo(x, y)\r\n        rot += step\r\n    }\r\n    ctx.lineTo(cx, cy - outerRadius);\r\n    ctx.closePath();\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeStyle = 'yellow';\r\n    ctx.stroke();\r\n    ctx.fillStyle = 'yellow';\r\n    ctx.fill();\r\n}\r\n\r\nexport function drawCircle(ctx, cx, cy: number, radius: number, color: Color, hemi=false) {\r\n  let theta = hemi ? Math.PI : (2 * Math.PI)\r\n  ctx.beginPath()\r\n\r\n  ctx.arc(\r\n    cx,\r\n    cy, //this.getHeight(),\r\n    radius,\r\n    0,\r\n    theta,\r\n    true\r\n  )\r\n  ctx.closePath()\r\n\r\n  ctx.fillStyle = color.toRGBA()\r\n  ctx.fill()\r\n}\r\n\r\nexport function drawEllipse(ctx: CanvasRenderingContext2D, cx, cy, radiusX: number, radiusY: number, color: Color, hemi=false) {\r\n  let theta = hemi ? Math.PI : (2 * Math.PI)\r\n  ctx.beginPath()\r\n\r\n  ctx.ellipse(\r\n    cx,\r\n    cy, //this.getHeight(),\r\n    radiusX,\r\n    radiusY,\r\n    0,\r\n    0,\r\n    theta,\r\n    // true\r\n  )\r\n  ctx.closePath()\r\n\r\n  ctx.fillStyle = color.toRGBA()\r\n  ctx.fill()\r\n}\r\n\r\nexport function drawText(ctx: CanvasRenderingContext2D, msg: string, tx: number, ty: number) {\r\n  ctx.font = `6pt ${Game.font}`\r\n  ctx.fillStyle = Color.White.toRGBA()\r\n  ctx.fillText(msg, tx, ty)\r\n}","import { Citizen } from \"../actors/Citizen\";\r\nimport { Planet } from \"../actors/Planet/Planet\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { sleep } from \"../Util\";\r\nimport { ResourceBlock } from \"../models/Economy\";\r\nimport { retrieveResource, drive } from \"../values/InteractionRequest\";\r\nimport { Recipe, MechanicalOperation, ExploreForResource } from \"../models/MechanicalOperation\";\r\n\r\nexport abstract class Strategy {\r\n    private sleepInterval: number = 150\r\n    protected isActive: boolean = false;\r\n    constructor(protected pawn: Citizen) { }\r\n\r\n    protected abstract async apply();\r\n    abstract canApply(): boolean;\r\n\r\n    protected get planet(): Planet { return this.pawn.currentPlanet; }\r\n    protected get devices(): Device[] { return this.planet.colony.findPoweredDevices(); }\r\n    protected get operations(): MechanicalOperation[] { return this.devices.map(d => d.operation); }\r\n    protected get recipes(): Recipe[] {\r\n        let recipes: Recipe[] = [];\r\n        this.operations.forEach(op => {\r\n            if (op.type === 'recipe') {\r\n                recipes.push(op);\r\n            }\r\n        });\r\n        return recipes;\r\n    }\r\n\r\n    protected get explorers(): ExploreForResource[] {\r\n        let explores: ExploreForResource[] = []\r\n        this.operations.forEach(op => {\r\n            if (op.type === 'explore') {\r\n                explores.push(op)\r\n            }\r\n        })\r\n        return explores;\r\n    }\r\n\r\n\r\n    async attempt(): Promise<void> {\r\n        if (this.isActive) {\r\n            return;\r\n        }\r\n        if (!this.isActive) {\r\n            this.isActive = true\r\n            // note apply will need to set this.isActive around its critical section\r\n            await this.apply();\r\n            this.isActive = false\r\n        }\r\n\r\n        // await this.pause()\r\n        // setInterval(() => { this.attempt() }, this.sleepInterval)\r\n    }\r\n\r\n    protected async pause() {\r\n        await sleep(this.sleepInterval)\r\n    }\r\n\r\n    protected async gatherBlock(res: ResourceBlock): Promise<boolean> {\r\n        let gathered = false\r\n        let generatesDesiredBlock = (d: Device) => (d.operation.type === 'generator') &&\r\n            d.product.some(stored => res === stored) //&& !d.inUse\r\n        let gen: Device = this.planet.colony.closestDeviceByType(this.pawn.pos, [], generatesDesiredBlock)\r\n\r\n        let storesDesiredBlock = (d: Device) => (d.operation.type === 'store') &&\r\n              d.product.some(stored => res === stored) //&& !d.inUse\r\n        let store: Device = this.planet.colony.closestDeviceByType(this.pawn.pos, [], storesDesiredBlock)\r\n\r\n        let device: Device = gen || store\r\n\r\n        if (device) {\r\n            // device.inUse = true\r\n            await this.visitDevice(device)\r\n\r\n            if (device.inUse) {\r\n                // at least wait a bit and try again?\r\n                let waitTimes = 0\r\n                while (device.inUse) {\r\n                    await this.pause() //sleep(5000) //this.pause()\r\n                    if (waitTimes++ > 10) {\r\n                        return false \r\n                    }\r\n                }\r\n            }\r\n\r\n            if (await device.interact(this.pawn, retrieveResource(res))) {\r\n                gathered = true\r\n            }\r\n        } else {\r\n            console.warn(\"Didn't gather...\")\r\n            // don't work sub-recipes??\r\n            // let recipe = this.recipes.find(recipe => recipe.produces === res);\r\n            // if (recipe) {\r\n                // gathered = await this.workRecipe(recipe);\r\n                // gathered = true\r\n            // }\r\n        }\r\n\r\n        return gathered\r\n    }\r\n\r\n    protected async visitDevice(device: Device) {\r\n        await this.pawn.visit(device)\r\n    }\r\n\r\n    protected async workExploration(exploring: ExploreForResource): Promise<boolean> {\r\n        let knowsHow = (d: Device) => d.operation === exploring && !d.reserved\r\n        let vehicle = this.planet.colony.closestDeviceByType(this.pawn.pos, [], knowsHow)\r\n        let explored = false\r\n        if (vehicle) {\r\n            vehicle.reserved = true\r\n            if (await this.drive(vehicle, exploring)) {\r\n                explored = true\r\n            }\r\n\r\n            vehicle.reserved = false\r\n        }\r\n        return explored\r\n    }\r\n\r\n    private async drive(vehicle: Device, exploring: ExploreForResource) {\r\n        let driven = false\r\n        if (!vehicle.machine.isVehicle) {\r\n            throw new Error(\"Tried to drive a device that wasn't a vehicle!\")\r\n        } else {\r\n            await this.visitDevice(vehicle)\r\n            if (await vehicle.interact(this.pawn, drive())) {\r\n                if (await vehicle.interact(this.pawn, retrieveResource(exploring.gathers))) {\r\n                    driven = true\r\n                }\r\n            }\r\n        }\r\n        return driven\r\n    }\r\n\r\n    protected async workRecipe(recipe: Recipe): Promise<boolean> {\r\n        console.debug(\"Working recipe\", { product: recipe.produces })\r\n        let knowsRecipe = (d: Device) => d.operation === recipe && !d.reserved\r\n        let maker = this.planet.colony.closestDeviceByType(this.pawn.pos, [], knowsRecipe)\r\n        let made = false\r\n        if (maker) {\r\n            maker.reserved = true\r\n            // maker.inUse = true\r\n            if (await this.gatherIngredients(recipe.consumes)) {\r\n                await this.visitDevice(maker)\r\n                if (await this.performRecipeTask(maker, recipe)) {\r\n                    made = true\r\n                }\r\n            }\r\n            maker.reserved = false\r\n            // maker.inUse = false\r\n        }\r\n        // await this.pause()\r\n        // await this.workRecipe(recipe);\r\n        return made\r\n    }\r\n\r\n    protected async gatherIngredients(blocks: ResourceBlock[]): Promise<boolean> {\r\n        if (!this.pawn.isCarryingUnique(blocks)) {\r\n            console.debug(\"Gathering blocks...\")\r\n            for (let ingredient of blocks) {\r\n                let tries = 0\r\n                let gathered = false\r\n                while (!gathered && tries < 20) {\r\n                    tries += 1\r\n                    if (await this.gatherBlock(ingredient)) {\r\n                        gathered = true\r\n                    } else {\r\n                        await this.pause()\r\n                    }\r\n                }\r\n\r\n                if (!gathered) {\r\n                    console.warn(\"couldn't gather one of the ingredients!!\")\r\n                    return false\r\n                }\r\n                //else {\r\n                //    console.warn(\"didn't gather it!\")\r\n                //    return false\r\n                //}\r\n            }\r\n        }\r\n        return true\r\n    }\r\n\r\n    protected async performRecipeTask(maker: Device, recipe: Recipe, timesToAttempt: number = 5) {\r\n        console.debug(\"Try to perform recipe task...\", { produces: recipe.produces })\r\n        let worked = await maker.interact(this.pawn, { type: 'work', recipe })\r\n        if (!worked) {\r\n            // await this.pause()\r\n            console.warn(\"waiting for machine to become available...\")\r\n            for (let i = 0; i < timesToAttempt; i ++) {\r\n                await this.pause()\r\n                if (await this.performRecipeTask(maker, recipe)) {\r\n                    worked = true\r\n                    break\r\n                }\r\n            }\r\n        }\r\n        return worked\r\n    }\r\n}","import { Actor, Label, Color, Vector } from \"excalibur\";\r\nimport { Machine } from \"../models/Machine\";\r\nimport { Building } from \"./Building\";\r\nimport { ResourceBlock, blockColor, emptyMarket, sumMarkets } from \"../models/Economy\";\r\nimport { Citizen } from \"./Citizen\";\r\nimport { Planet } from \"./Planet/Planet\";\r\nimport { allStructures } from \"../models/Structure\";\r\nimport { getVisibleDeviceSize, DeviceSize } from \"../values/DeviceSize\";\r\nimport { Recipe, ResourceStorage, MechanicalOperation, ResourceGenerator, ExploreForResource } from \"../models/MechanicalOperation\";\r\nimport { range, deleteByValueOnce, closest } from \"../Util\";\r\nimport { drawRect } from \"../Painting\";\r\nimport { InteractionRequest, retrieveResource } from \"../values/InteractionRequest\";\r\nimport { Game } from \"../Game\";\r\nimport { Rectangle } from \"../values/Rectangle\";\r\n\r\nexport class Device extends Actor {\r\n    // constructionMaterials: ResourceBlock[] = []\r\n\r\n    // could also use for storage?\r\n    product: ResourceBlock[] = []\r\n    nameLabel: Label\r\n    image: HTMLImageElement\r\n    building: Building\r\n    inUse: boolean = false\r\n    hover: boolean = false\r\n\r\n    imageLoaded: boolean = false\r\n\r\n    built: boolean = false\r\n    reserved: boolean = false\r\n\r\n    constructor(\r\n        public machine: Machine,\r\n        initialPos: Vector\r\n    ) {\r\n        super(\r\n            initialPos.x,\r\n            initialPos.y,\r\n            getVisibleDeviceSize(machine.size),\r\n            getVisibleDeviceSize(machine.size),\r\n            Color.Transparent\r\n            // machine.color\r\n        )\r\n\r\n        this.nameLabel = new Label(this.machine.name, 0, 0, Game.font) // 'Helvetica')\r\n        this.nameLabel.fontSize = this.machine.size === DeviceSize.Tiny ? 2 : 6\r\n        this.nameLabel.color = Color.White\r\n\r\n        this.image = new Image();\r\n        this.image.onload = () => { this.imageLoaded = true }\r\n        this.image.src = machine.image\r\n\r\n        this.on('pointerenter', () => {\r\n            // console.log(\"HOVER OVER\", { machine: this.machine })\r\n            this.hover = true\r\n            let tinyDevices = this.tinyDevices.length > 0 &&\r\n              this.tinyDevices.some(d => d.hover)\r\n            if (this.building && !tinyDevices) {\r\n                this.building.planet.currentlyViewing = this\r\n            }\r\n        })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.hover = false\r\n            if (this.building && this.building.planet.currentlyViewing === this) {\r\n                this.building.planet.currentlyViewing = null\r\n            }\r\n        })\r\n    }\r\n\r\n    get imageX() { return this.pos.x - this.getWidth() / 2 }\r\n    get imageY() { return this.pos.y - this.getHeight() / 2 } //- 10 }\r\n\r\n    get economy() { return this.built ? this.computeEconomy() : emptyMarket() }\r\n\r\n    private computeEconomy() {\r\n        let econs = [ this.machine.economy, ...this.tinyDevices.map(d => d.economy) ]\r\n        return econs.reduce(sumMarkets, emptyMarket())\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        if (this.imageLoaded) {\r\n            ctx.save()\r\n            if (!this.built) { ctx.globalAlpha = 0.5 }\r\n            ctx.translate(this.imageX, this.imageY)\r\n            if (this.vel.x > 0) {\r\n                // flip? (assume we're drawn facing left)\r\n                ctx.translate(this.getWidth(), 0)\r\n                ctx.scale(-1,1)\r\n            }\r\n            ctx.drawImage(\r\n                this.image,\r\n                0,\r\n                0, //this.imageY,\r\n\r\n                this.getWidth(),\r\n                this.getHeight()\r\n            )\r\n            // if (!this.built) { ctx.globalAlpha = 1.0 }\r\n\r\n            let c = Color.Transparent.clone()\r\n            if (this.hover) {\r\n                c = Color.White.clone()\r\n                c.a = 0.5\r\n            }\r\n            if (!(this.size === DeviceSize.Tiny || this.placed) && this.overlapsAny()) {\r\n                c = Color.Red.clone()\r\n                c.a = 0.3\r\n            }\r\n\r\n            // if (this.hover || this.overlapsAny()) {\r\n                // let c = Color.White.clone()\r\n                // c.a = 0.6\r\n                drawRect(\r\n                    ctx,\r\n                    { x: 0, y: 0, width: this.getWidth(), height: this.getHeight() },\r\n                    0,\r\n                    c\r\n                )\r\n            // }\r\n            ctx.restore()\r\n        }\r\n\r\n        let iv = new Vector(this.imageX, this.imageY + this.getHeight() / 8)\r\n\r\n        let showLabel = true\r\n        if (showLabel) {\r\n            this.nameLabel.pos = iv\r\n            this.nameLabel.draw(ctx, delta)\r\n        }\r\n\r\n        let { x: bx, y: by } = iv\r\n        let blockSize = 5\r\n        let yOff = this.nameLabel.fontSize\r\n        this.product.forEach((produced, index) => {\r\n            ctx.fillStyle = blockColor(produced).toRGBA()\r\n            ctx.fillRect(bx + blockSize * index, by - blockSize + yOff, blockSize-1, blockSize-1)\r\n        })\r\n\r\n        super.draw(ctx ,delta)\r\n        // this.tinyDevices.forEach(d => d.draw(ctx, delta))\r\n    }\r\n\r\n    get name() { return this.machine.name }\r\n    get description() { return this.machine.description }\r\n    get size() { return this.machine.size }\r\n    get operation() { return this.machine.operation }\r\n\r\n    async assemble(citizen: Citizen) {\r\n        if (citizen.isCarryingUnique(this.machine.cost)) {\r\n            for (let res of this.machine.cost) {\r\n                citizen.drop(res)\r\n                await citizen.progressBar(3000)\r\n            }\r\n            this.built = true\r\n        }\r\n    }\r\n\r\n    async interact(citizen: Citizen, request: InteractionRequest): Promise<boolean> {\r\n        if (this.inUse || !this.built) {\r\n            return false\r\n        }\r\n\r\n        let worked = false\r\n        let op = this.operation\r\n        if (op.type === 'recipe' && request.type === 'work') {\r\n            let recipe: Recipe = op\r\n            // do we have all the things?\r\n            if (citizen.carrying.some(it => recipe.consumes.includes(it))) {\r\n                this.inUse = true\r\n                if (citizen.isCarryingUnique(recipe.consumes)) {\r\n                    recipe.consumes.forEach(consumed => citizen.drop(consumed))\r\n                    let workTime = this.getEffectiveWorkTime(recipe)\r\n                    await citizen.progressBar(workTime) // recipe.workTime)\r\n                    citizen.carry(recipe.produces)\r\n\r\n                    worked = true\r\n                } else {\r\n                    console.warn(\"not carrying all requirements?\", { requires: recipe.consumes, has: citizen.carrying })\r\n                }\r\n                this.inUse = false\r\n            }\r\n        } else if ((op.type === 'store' || op.type === 'explore') && (request.type === 'retrieve' || request.type === 'store')) {\r\n            // accept it! (whatever you have that matches...?)\r\n            let storeOrExplore: ResourceStorage | ExploreForResource = op\r\n            if (request && request.type === 'retrieve') { // assume dispense request for now?\r\n                this.inUse = true\r\n                await citizen.progressBar(1000)\r\n                worked = this.dispense(citizen, request)\r\n                //if (worked) {\r\n                //    await citizen.progressBar(500)\r\n                //}\r\n                this.inUse = false\r\n            } else {\r\n                if (storeOrExplore.type === 'store') {\r\n                    let store: ResourceStorage = storeOrExplore\r\n                    if (request.type === 'store' &&\r\n                        citizen.carrying.some(it => store.stores.includes(it))) { // maybe trying to store?\r\n                        if (this.product.length < this.getEffectiveOperationalCapacity(store)) { // store.capacity) {\r\n                            let res = null\r\n                            if (store.stores.some(stored => { res = citizen.drop(stored); return res })) {\r\n                                if (res) {\r\n                                    this.produceResource(res)\r\n                                    // this.product.push(res)\r\n                                    // this.building.redeem(res)\r\n                                    worked = true\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    console.warn(\"no capacity in this store!!\")\r\n                    worked = false\r\n                }\r\n            }\r\n        } else if (op.type === 'generator') {\r\n            this.inUse = true\r\n            worked = this.dispense(citizen, request)\r\n            if (worked) {\r\n                await citizen.progressBar(500)\r\n            }\r\n            this.inUse = false\r\n        } else if (op.type === 'explore') {\r\n            this.inUse = true\r\n            let origX = this.pos.x\r\n            let groundSpeed = Game.citizenSpeed * 3\r\n            citizen.drive(this)\r\n            let xOff = 25000 * (Math.random() > 0.5 ? -1 : 1)\r\n            await this.actions.moveTo(this.pos.x + xOff, this.pos.y, groundSpeed).asPromise()\r\n            await citizen.progressBar(5000)\r\n            this.produceResource(op.gathers)\r\n            await this.actions.moveTo(origX, this.pos.y, groundSpeed).asPromise()\r\n            worked = true\r\n            citizen.stopDriving()\r\n            this.inUse = false\r\n        }\r\n\r\n        return worked\r\n    }\r\n\r\n\r\n\r\n    getEffectiveOperationalCapacity(op: ResourceGenerator | ResourceStorage | ExploreForResource) {\r\n        let bonus = this.building.spaceFunction\r\n            ? this.building.spaceFunction.bonuses.capacity \r\n        : 0\r\n        return op.capacity + bonus\r\n    }\r\n\r\n    getEffectiveWorkTime(op: Recipe) {\r\n        let bonus = this.building.spaceFunction \r\n         ? this.building.spaceFunction.bonuses.workSpeed\r\n         : 1\r\n\r\n        return Math.round(op.workTime * (1/bonus))\r\n    } \r\n\r\n\r\n    private dispense(citizen: Citizen, request: InteractionRequest) {\r\n        if (request && request.type === 'retrieve') {\r\n            let canFulfill = this.product.find(p => p === request.resource)\r\n            if (canFulfill) {\r\n                deleteByValueOnce(this.product, request.resource)\r\n                citizen.carry(request.resource)\r\n                this.building.debit(request.resource)\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    }\r\n\r\n    public tryProduce(step: number) {\r\n        if (this.building.isActive && this.built) {\r\n            if (this.machine.operation.type === 'generator') {\r\n                if (step % this.machine.operation.generationTime === 0) {\r\n                    if (this.product.length < this.machine.operation.capacity) {\r\n                        this.produceResource(this.machine.operation.generates)\r\n                    }\r\n                }\r\n\r\n            } else if (this.machine.operation.type === 'spawn') {\r\n                if (step % 1000 == 0) {\r\n                    // console.log(\"WOULD SPAWN\")\r\n                    setTimeout(() => this.building.populate(this.pos.add(this.building.pos)), 100)\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    public produceResource(res: ResourceBlock) {\r\n        this.product.push(res)\r\n        this.building.redeem(res)\r\n    }\r\n\r\n    snap(planet: Planet, pos: Vector = this.pos) {\r\n        if (this.size === DeviceSize.Tiny) { // or large...\r\n            return this.snapTiny(planet, pos)\r\n        } else {\r\n            console.log(\"attempt to snap device...\")\r\n            let bldg = planet.colony.closestBuildingByType(pos,\r\n                allStructures,\r\n                (bldg: Building) => {\r\n                    // let hasSpace = bldg.hasPlaceForDevice()\r\n                    let compatible = bldg.structure.machines.some(Machine => this.machine instanceof Machine)\r\n                    return compatible\r\n\r\n                }\r\n            )\r\n\r\n            let snapped = false\r\n            let halfSize = getVisibleDeviceSize(this.size) / 2\r\n            if (bldg) {\r\n                // console.log(\"we have a building!\", { bldg })\r\n                let spot = bldg.getCenter()\r\n                let d = spot.distance(pos)\r\n                snapped = d < (bldg.getWidth()/2 - halfSize) && (Math.abs(spot.y - pos.y) < 80)\r\n            } else {\r\n                // console.log(\"no bldg found\")\r\n            }\r\n\r\n            if (snapped) {\r\n                this.building = bldg;\r\n                this.pos = pos //.x //this.building.nextDevicePlace().position\r\n                let gridGrain = halfSize\r\n                this.pos.x += bldg.x\r\n                this.pos.x = Math.floor(this.pos.x / gridGrain) * gridGrain\r\n                this.pos.x -= bldg.x\r\n                this.pos.x = Math.max(\r\n                    bldg.x,\r\n                    this.pos.x\r\n                )\r\n                this.pos.x = Math.min(\r\n                    bldg.x + bldg.getWidth() - halfSize,\r\n                    this.pos.x\r\n                )\r\n                this.pos.y = bldg.floorY - getVisibleDeviceSize(this.size)/2 //getCenter().y + (bldg.getHeight()/8)\r\n            } else {\r\n                this.pos = pos\r\n            }\r\n\r\n            // let overlapping = !this.overlapsAny()\r\n\r\n            return snapped // && !overlapping\r\n        }\r\n    }\r\n\r\n    public overlapsAny(): boolean {\r\n        if (this.building) {\r\n            return !!this.building.planet.colony.findAllDevices().find(device => device !== this && this.overlaps(device))\r\n        } else {\r\n            return true\r\n        }\r\n    }\r\n\r\n    private overlaps(other: Device): boolean {\r\n        let rect1 = this.aabb(), rect2 = other.aabb();\r\n        let doesOverlap = (\r\n            rect1.x < rect2.x + rect2.width &&\r\n            rect1.x + rect1.width > rect2.x &&\r\n            rect1.y < rect2.y + rect2.height &&\r\n            rect1.y + rect1.height > rect2.y\r\n        )\r\n        return(!!doesOverlap);\r\n    }\r\n\r\n    placed: boolean = false\r\n    private aabb(): Rectangle {\r\n        let pos = this.pos.clone()\r\n        if (this.placed) {\r\n            pos.addEqual(this.building.pos)\r\n        }\r\n        return {\r\n            x: pos.x,\r\n            y: pos.y,\r\n            width: this.getWidth(),\r\n            height: this.getHeight()\r\n        }\r\n    }\r\n    // private overlapsAny()\r\n\r\n    private snapTiny(planet: Planet, pos: Vector) {\r\n        // okay, we need the closest building with any built machine that HAS a tiny slot\r\n        let bldg = planet.colony.closestBuildingByType(pos,\r\n            allStructures,\r\n            (bldg: Building) => bldg.getDevices().some(\r\n                (device: Device) => device.built && device.hasTinyPlace()\r\n            )\r\n        )\r\n\r\n        // todo look at all devices? (closest bldg may not house closest device!!)\r\n        let device: Device = closest(\r\n            pos,\r\n            bldg.getDevices().filter((d: Device) => d.built && d.hasTinyPlace()),\r\n            (d: Device) => d.pos,\r\n        )\r\n\r\n        this.pos = pos\r\n        let snapped = false\r\n        if (device) {\r\n            let spot = device.nextTinyPlace().add(device.pos).add(device.building.pos)\r\n            let d = spot.distance(pos)\r\n            snapped = d < 50\r\n\r\n            if (snapped) {\r\n                this.building = device.building\r\n                this.parentDevice = device\r\n                this.pos = spot\r\n            }\r\n        }\r\n\r\n        return snapped\r\n    }\r\n\r\n    public parentDevice: Device = null\r\n    tinyDevices: Device[] = []\r\n    private hasTinyPlace() {\r\n        if (!this.machine.tinySlots) {\r\n            return false\r\n        } else {\r\n            return this.tinyDevices.length < 3\r\n        }\r\n    }\r\n\r\n    private nextTinyPlace() {\r\n        let tx0 = -this.getWidth()/3, ty0 = -3\r\n        let ndx = this.tinyDevices.length\r\n        return new Vector(tx0 + (ndx * 14), ty0)\r\n    }\r\n\r\n    public addTinyDevice(device: Device) {\r\n        // console.log(\"ADD TINY DEVICE\", { device: device.machine })\r\n        device.pos = this.nextTinyPlace() //.add(this.pos)\r\n        // device.pos.addEqual(this.pos.add(this.nextTinyPlace()))\r\n        this.tinyDevices.push(device)\r\n        this.add(device)\r\n    }\r\n}","import { Color } from 'excalibur';\r\nimport { Scale } from '../values/Scale';\r\nimport { Orientation } from '../values/Orientation';\r\nimport { Machine, OxygenExtractor, WaterCondensingMachine, SolarCell, allMachines } from './Machine';\r\nimport { DeviceSize } from '../values/DeviceSize';\r\n\r\nconst { major, minor } = Scale\r\n\r\nconst smallMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Small)\r\nconst mediumMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Medium)\r\nconst largeMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Large)\r\nconst hugeMachines = allMachines.filter(machine => (new machine()).size === DeviceSize.Huge)\r\n\r\nconst smallDome = smallMachines.filter(machine => (new machine()).forDome)\r\nconst smallBelow = smallMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst midDome = mediumMachines.filter(machine => (new machine()).forDome)\r\nconst midBelow = mediumMachines.filter(machine => !(new machine()).forDome && !(new machine()).isVehicle)\r\n\r\nconst largeDome = largeMachines.filter(machine => (new machine()).forDome)\r\nconst largeBelow = largeMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst hugeDome = hugeMachines.filter(machine => (new machine()).forDome)\r\nconst hugeBelow = hugeMachines.filter(machine => !(new machine()).forDome)\r\n\r\nconst medGroundVehicles = mediumMachines.filter(machine => (new machine()).isVehicle)\r\n\r\nexport class Structure {\r\n    name: string = '(structure name)';\r\n    description: string = '(structure description)';\r\n    view: string = '<structure (room) view>';\r\n    width: number = 10\r\n    height: number = 10\r\n    zoom: number = 1\r\n    color: Color = Color.Gray\r\n    infra: boolean = false\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Corridor ],\r\n        [Orientation.Right]: [ Corridor ],\r\n        [Orientation.Up]: [ Ladder ],\r\n        [Orientation.Down]: [ Ladder ],\r\n    }\r\n\r\n    machines: (typeof Machine)[] = []\r\n    prereqs: (typeof Structure)[] = []\r\n\r\n\r\n    hide: boolean = false\r\n}\r\n\r\n\r\nexport class MainTunnel extends Structure {\r\n    name: string = 'Main Tunnel';\r\n    description: string = 'Elevating';\r\n    view: string = 'TunnelView';\r\n    width: number = major.fifth\r\n    height: number = major.eighth\r\n    zoom = 0.25\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Corridor ],\r\n        [Orientation.Right]: [ Corridor ],\r\n        [Orientation.Up]: [ MediumSurfaceRoom ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n    infra = true\r\n}\r\n\r\n\r\nexport class SurfaceRoad extends Structure {\r\n    name: string = 'Road'\r\n    description: string = 'go for a walk'\r\n    view: string = 'SurfaceRoadView'\r\n    width: number = minor.fifth\r\n    height: number = minor.first\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ Dome, MediumSurfaceRoom ],\r\n        [Orientation.Right]: [  Dome, MediumSurfaceRoom ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n    infra = true\r\n}\r\n\r\nexport class Corridor extends Structure {\r\n    name: string = 'Corridor'\r\n    description: string = 'in the hallway'\r\n    view: string = 'CorridorView'\r\n    width: number = minor.fifth\r\n    height: number = minor.seventh\r\n    zoom = 0.5\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [\r\n            MainTunnel,\r\n            CommonArea,\r\n            Ladder,\r\n        ],\r\n        [Orientation.Right]: [\r\n            MainTunnel,\r\n            CommonArea,\r\n            Ladder,\r\n        ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n    prereqs = [SurfaceRoad] //MainTunnel]\r\n    infra = true\r\n}\r\n\r\nexport class Ladder extends Structure {\r\n    name = 'Ladder'\r\n    description = 'connect vertically'\r\n    view = 'LadderView'\r\n    width = major.second\r\n    height = major.third\r\n    zoom = 0.5\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Up]: [ CommonArea ],\r\n        [Orientation.Down]: [ CommonArea ],\r\n        [Orientation.Left]: [ ],\r\n        [Orientation.Right]: [ ],\r\n    }\r\n    prereqs = [Corridor, SmallRoomThree]\r\n    infra = true\r\n}\r\n\r\n// 'abstract' structure...\r\n\r\nclass Dome extends Structure {\r\n    description: string = 'Biome sweet biome';\r\n\r\n    view: string = 'DomeView';\r\n    width: number  = 2 * major.sixth\r\n    height: number = major.fifth\r\n    zoom = 0.2\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ SurfaceRoad ],\r\n        [Orientation.Right]: [ SurfaceRoad ],\r\n        [Orientation.Up]: [ ],\r\n        [Orientation.Down]: [ ],\r\n    }\r\n\r\n    machines = [\r\n        SolarCell,\r\n        OxygenExtractor, WaterCondensingMachine,\r\n    ]\r\n}\r\n\r\n// common subsurface room...\r\nclass CommonArea extends Structure {\r\n    name: string = 'Commons'\r\n    description: string = 'hallway cap'\r\n    view: string = 'CommonAreaView'\r\n    width: number = major.eighth\r\n    height: number = major.fifth\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [\r\n            Corridor, CommonArea\r\n            ],\r\n        [Orientation.Right]: [\r\n            Corridor,\r\n            CommonArea,\r\n        ],\r\n        [Orientation.Up]: [ Ladder ],\r\n        [Orientation.Down]: [ Ladder ],\r\n    }\r\n\r\n    machines = []\r\n\r\n    prereqs = [\r\n    ]\r\n}\r\n\r\nexport class SmallRoomTwo extends CommonArea {\r\n    name = 'Sm. Room (2)'\r\n    width = major.eighth\r\n    height = major.fifth\r\n    prereqs = [ SmallDome ]\r\n    machines = smallBelow\r\n}\r\n\r\nexport class SmallRoomThree extends CommonArea {\r\n    name = 'Sm. Room (3)'\r\n    prereqs = [SmallRoomTwo]\r\n    view = 'SmallRoomThreeView'\r\n    width = 2 * major.eighth\r\n    height = major.eighth\r\n    machines = smallBelow\r\n}\r\n\r\nexport class MediumRoom extends CommonArea {\r\n    name = 'Mid Room'\r\n    prereqs = [ SmallRoomThree ]\r\n    view = 'MediumRoomView'\r\n    width = 2 * major.eighth\r\n    machines = [ ...midBelow, ...smallBelow ]\r\n}\r\n\r\nexport class MediumRoomThree extends CommonArea {\r\n    name = 'Mid Room (3)'\r\n    prereqs = [ MediumRoom ]\r\n    view = 'MediumRoomThreeView'\r\n    width = 3 * major.eighth\r\n    height = major.eighth\r\n\r\n    machines = [ ...midBelow, ...smallBelow ]\r\n}\r\n\r\nexport class LargeRoom extends CommonArea {\r\n    name = 'Lg. Room'\r\n    view = 'LargeRoomView'\r\n    prereqs = [ MediumRoom ]\r\n    width = 4 * major.eighth\r\n    height = 2*major.eighth\r\n    machines = [ ...largeBelow, ...midBelow, ...smallBelow ]\r\n}\r\n\r\nexport class HugeRoom extends CommonArea {\r\n    name = 'Huge Room'\r\n    view = 'HugeRoomView'\r\n    width = 10 * major.eighth\r\n    height = 8 * major.eighth\r\n\r\n    prereqs = [LargeRoom]\r\n    machines = hugeBelow\r\n}\r\n\r\n// export class Octagon extends CommonArea {\r\n//     // ...\r\n//     name = 'Octagon'\r\n//     view = 'OctagonView'\r\n// }\r\n\r\n/// surface bldgs\r\n\r\nexport class MediumSurfaceRoom extends Dome {\r\n    name = 'Mid Surf Bldg'\r\n    description = 'home away from home';\r\n\r\n    view: string = 'MediumSurfaceRoomView';\r\n\r\n    width: number = 4 * major.eighth\r\n    height: number = major.seventh\r\n\r\n    zoom = 0.1\r\n\r\n    prereqs = [ SmallDome ]\r\n\r\n    connections: { [key in Orientation]: (typeof Structure)[] } = {\r\n        [Orientation.Left]: [ SurfaceRoad ],\r\n        [Orientation.Right]: [ SurfaceRoad ],\r\n        [Orientation.Up]: [ MainTunnel, MediumSurfaceRoom ],\r\n        [Orientation.Down]: [ MainTunnel, MediumSurfaceRoom ],\r\n    }\r\n\r\n    machines = [ ...midBelow, ...smallBelow ]\r\n\r\n    // hide = false // need another one which cares about connecting to roads...\r\n}\r\n\r\nexport class SmallDome extends Dome {\r\n    name = 'Sm. Dome'\r\n    width = 2 * major.fifth\r\n    // height = major.seventh\r\n    machines = smallDome\r\n}\r\n\r\nexport class SmallDomeThree extends Dome {\r\n    name = 'Sm. Dome (3)'\r\n    view = 'SmallDomeThreeView'\r\n    width = 3 * major.fifth\r\n    // height = 2*major.fifth\r\n    machines = smallDome\r\n}\r\n\r\nexport class MidDome extends Dome {\r\n    name = 'Mid Dome'\r\n    view = 'MidDomeView'\r\n    width = 3 * major.seventh\r\n    // height = 2 * major.seventh\r\n    prereqs = [ SmallDome, MediumRoom ]\r\n    machines = [ ...midDome, ...smallDome ]\r\n}\r\n\r\nexport class LargeDome extends Dome {\r\n    name = 'Lg. Dome'\r\n    view = 'BigDomeView'\r\n    width = 4 * major.eighth\r\n    // height = 3 * major.eighth\r\n    prereqs = [MidDome, LargeRoom]\r\n    machines = [ ...largeDome, ...midDome, ...smallDome ]\r\n}\r\n\r\nexport class Arcology extends Dome {\r\n    name = 'Arcology'\r\n    view = 'ArcologyView'\r\n    width = 12 * major.eighth\r\n    height = 36 * major.eighth\r\n    prereqs = [LargeDome, HugeRoom]\r\n    machines = hugeDome\r\n\r\n}\r\n\r\n/// vehicles...!\r\n\r\nexport class GroundVehiclePool extends Dome {\r\n    name = 'Veh. Pool'\r\n    description = 'ground transit hub'\r\n    view = 'GroundVehiclePoolView'\r\n    width = 2 * major.eighth\r\n    height = minor.second\r\n    machines = medGroundVehicles\r\n}\r\n\r\n\r\nexport const allStructures =\r\n    [\r\n        SmallDome,\r\n        SmallDomeThree,\r\n        MidDome,\r\n        LargeDome,\r\n        Arcology,\r\n        MediumSurfaceRoom,\r\n\r\n        SmallRoomTwo,\r\n        SmallRoomThree,\r\n        MediumRoom,\r\n        MediumRoomThree,\r\n        LargeRoom,\r\n        HugeRoom,\r\n\r\n        GroundVehiclePool,\r\n    ]\r\n\r\n\r\n","import { Machine, OxygenExtractor, WaterCondensingMachine, CloningVat, Bookshelf, Bed, Stove, AlgaeVat, ResearchServer, Fridge, SolarCell, Arbor, Cabin, Workstation, Fabricator, Houseplant, Orchard, Megafabricator, StudyMachine, Mainframe, CommandCenter, MissionLog, Botany, OrientationConsole, PersonnelRegistry, MineralProcessor, MiningDrill, HoloProjector, TimeCrystal, Couch, Statue } from './Machine';\r\nimport { Color } from 'excalibur';\r\nimport { Structure, MediumSurfaceRoom } from './Structure';\r\nimport { BackgroundPattern } from '../actors/Building/BackgroundPatterns';\r\n\r\nexport class RoomRecipe {\r\n     name: string = '(generic)'\r\n     description: string = '(generic description)'\r\n     machines: (typeof Machine)[] = []\r\n     color: Color = Color.Gray\r\n\r\n     prereqs: (typeof RoomRecipe)[] =  [] \r\n\r\n     structure: typeof Structure = null\r\n     hide: boolean = false\r\n     background: BackgroundPattern = BackgroundPattern.Beige\r\n\r\n     bonuses: {\r\n          capacity: number, // every store/generator gets this??\r\n          workSpeed: number, // 2 should double work speed (dur *= 1/multiplier)\r\n     } = {\r\n          capacity: 0, // boost cap by one\r\n          workSpeed: 1.00 // 20% bonus to work speed\r\n     }\r\n}\r\n\r\nexport class MissionControl extends RoomRecipe {\r\n     hide = true\r\n     name = 'Mission Control'\r\n     description = 'keeping everything on track'\r\n     structure = MediumSurfaceRoom\r\n     prereqs = [] //ComputerCore, Factory, Farm ]\r\n     machines = [ CommandCenter, MissionLog ]\r\n     background = BackgroundPattern.Window\r\n}\r\n\r\nexport class LivingQuarters extends RoomRecipe {\r\n     name = 'Living Quarters'\r\n     description = 'good night'\r\n     machines = [ Bed ]\r\n}\r\n\r\nclass Barracks extends RoomRecipe {\r\n     name = 'Barracks'\r\n     description = 'sleep tight'\r\n     machines = [ Bed, Bed, Bed ]\r\n}\r\n\r\nexport class Kitchen extends RoomRecipe {\r\n     name = 'Kitchen'\r\n     description = 'stay together'\r\n     machines = [ Stove, Fridge ]\r\n     bonuses = {\r\n          capacity: 2,\r\n          workSpeed: 1.1\r\n     }\r\n     background = BackgroundPattern.Checker\r\n}\r\n\r\nexport class LifeSupportPod extends RoomRecipe {\r\n     name = 'Life Support'\r\n     description = 'keep it going'\r\n     machines = [ OxygenExtractor, WaterCondensingMachine ]\r\n}\r\n\r\nclass Retreat extends RoomRecipe {\r\n     name = 'Retreat'\r\n     description = 'take it easy'\r\n     machines = [ Cabin, Cabin ]\r\n}\r\n\r\nexport class CloneMatrix extends RoomRecipe {\r\n     name = 'Clone Matrix'\r\n     description = 'clone home'\r\n     machines = [ CloningVat, CloningVat ]\r\n}\r\n\r\nexport class CloneReception extends RoomRecipe {\r\n     name = 'Clone Reception'\r\n     description = 'welcome clone'\r\n     machines = [ CloningVat, OrientationConsole, PersonnelRegistry ]\r\n}\r\n\r\nclass ReadingRoom extends RoomRecipe {\r\n     name = 'Reading Room'\r\n     description = 'butterflies in the sky'\r\n     machines = [ Bookshelf, Bookshelf ]\r\n}\r\n\r\nexport class Library extends RoomRecipe {\r\n     name = 'Library'\r\n     description = 'take a look'\r\n     machines = [ Bookshelf, Bookshelf, Bookshelf ]\r\n     background = BackgroundPattern.Books\r\n}\r\n\r\nexport class Study extends RoomRecipe {\r\n     name = 'Study'\r\n     description = 'plan it out'\r\n     machines = [ StudyMachine, Bookshelf ]\r\n     background = BackgroundPattern.Wood\r\n}\r\n\r\nclass ComputerLab extends RoomRecipe {\r\n     name = 'Computer Lab'\r\n     description = 'make it happen'\r\n     machines = [ Workstation, Workstation, Workstation ]\r\n}\r\n\r\nexport class Archive extends RoomRecipe {\r\n     name = 'Archive'\r\n     description = 'write it down'\r\n     machines = [ ResearchServer, ResearchServer ]\r\n}\r\n\r\nclass Arboretum extends RoomRecipe {\r\n     name = 'Arboretum'\r\n     description = 'walk it out'\r\n     machines = [ Arbor, Arbor ]\r\n}\r\n\r\nclass AlgaeFarm extends RoomRecipe {\r\n     name = 'Algae Farm'\r\n     description = 'make do'\r\n     machines = [ AlgaeVat, AlgaeVat ]\r\n}\r\n\r\nexport class SolarArray extends RoomRecipe {\r\n     name = 'Solar Array'\r\n     description = 'warm up'\r\n     machines = [ SolarCell, SolarCell ]\r\n}\r\n\r\nexport class Workshop extends RoomRecipe {\r\n     name = 'Workshop'\r\n     description = 'take form'\r\n     machines = [ Fabricator, Fabricator ]\r\n}\r\n\r\nclass Nursery extends RoomRecipe {\r\n     name = 'Nursery'\r\n     description = 'quiet please'\r\n     machines = [ Houseplant, Houseplant, Houseplant ]\r\n     background = BackgroundPattern.Leafy\r\n}\r\n\r\nclass Farm extends RoomRecipe {\r\n     name = 'Farm'\r\n     description = 'food for the masses'\r\n     machines = [ Orchard, Orchard ]\r\n}\r\n\r\nclass Factory extends RoomRecipe {\r\n     name = 'Factory'\r\n     description = 'production lines'\r\n     machines = [ Megafabricator, Megafabricator ]\r\n}\r\n\r\n\r\nexport class ComputerCore extends RoomRecipe {\r\n     name = 'Computer Core'\r\n     description = 'let us calculate'\r\n     machines = [ Mainframe, Mainframe ]\r\n     background = BackgroundPattern.Tech\r\n}\r\n\r\nexport class LifeSciencesLab extends RoomRecipe {\r\n     name = 'Life Sciences Lab'\r\n     description = 'where do i come from'\r\n     machines = [ Botany, Botany ]\r\n}\r\n\r\nexport class Refinery extends RoomRecipe {\r\n     name = 'Refinery'\r\n     description = 'separation'\r\n     machines = [ MineralProcessor ]\r\n}\r\n\r\nexport class Mine extends RoomRecipe {\r\n     name = 'Mine'\r\n     description = 'ore from the stone'\r\n     machines = [ MiningDrill ]\r\n}\r\n\r\nexport class HoloMatrix extends RoomRecipe {\r\n     name = 'Hologram Matrix'\r\n     description = 'dream it'\r\n     machines = [ HoloProjector, HoloProjector ]\r\n}\r\n\r\nexport class TimeChamber extends RoomRecipe {\r\n     name = 'Time Chamber'\r\n     description = 'believe it'\r\n     machines = [ TimeCrystal, TimeCrystal ]\r\n}\r\n\r\n// export class DreamMatrix extends \r\n\r\nexport class LivingRoom extends RoomRecipe {\r\n     name = 'Living Room'\r\n     description = 'just relax'\r\n     machines = [ Couch, Couch ]\r\n}\r\n\r\nexport class Statuary extends RoomRecipe {\r\n     name = 'Statuary'\r\n     description = 'to remember'\r\n     machines = [ Statue, Statue, Statue ]\r\n}\r\n\r\nexport const allSpaceFunctions = [\r\n    MissionControl,\r\n\r\n    Library,\r\n    Barracks,\r\n    LifeSupportPod,\r\n    CloneMatrix,\r\n    LivingQuarters,\r\n    Kitchen,\r\n    AlgaeFarm,\r\n    Archive,\r\n    Arboretum,\r\n    SolarArray,\r\n    Retreat,\r\n    Study,\r\n    Workshop,\r\n    ReadingRoom,\r\n    Nursery,\r\n    Farm,\r\n    Factory,\r\n    ComputerLab,\r\n\r\n    ComputerCore,\r\n\r\n    LifeSciencesLab,\r\n\r\n    CloneReception,\r\n    \r\n    Refinery,\r\n    Mine,\r\n    HoloMatrix,\r\n    TimeChamber,\r\n\r\n    LivingRoom,\r\n    Statuary,\r\n]","import { Actor, Color, Traits, Vector, VisibleEvent, Label, CollisionType, Timer, EmitterType, ParticleEmitter } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { Planet } from \"./Planet/Planet\";\r\nimport { ResourceBlock, blockColor } from \"../models/Economy\";\r\nimport { Game } from \"../Game\";\r\nimport { eachCons, deleteByValueOnce, sleep, containsUniq, deleteByValue, sample, range } from \"../Util\";\r\nimport { Device } from \"./Device\";\r\nimport { Scale } from \"../values/Scale\";\r\nimport { ProductionStrategy } from \"../strategies/ProductionStrategy\";\r\nimport { CapacityBasedProduction } from \"../strategies/CapacityBasedProduction\";\r\nimport { drawStar, drawRect, drawCircle, drawEllipse, drawText, drawLine } from \"../Painting\";\r\nimport { ConstructionStrategy } from \"../strategies/ConstructionStrategy\";\r\nimport { ProxmityBasedConstruction } from \"../strategies/ProximityBasedConstruction\";\r\nimport { SleepingStrategy } from \"../strategies/SleepingStrategy\";\r\nimport { AnyBedSleepingStrategy } from \"../strategies/AnyBedSleepingStrategy\";\r\nimport { EatingStrategy } from \"../strategies/EatingStrategy\";\r\nimport { WhenHungryEatingStrategy } from \"../strategies/WhenHungryEatingStrategy\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../values/DeviceSize\";\r\nimport { CombatStrategy } from \"../strategies/CombatStrategy\";\r\nimport { AttackNearestHostileStrategy } from \"../strategies/AttackNearestHostileStrategy\";\r\nimport { randomBytes } from \"crypto\";\r\nimport { LaserBeam } from \"./LaserBeam\";\r\n\r\nexport class Citizen extends Actor {\r\n    alive: boolean = true\r\n\r\n    isPlanning: boolean = false // \r\n\r\n    // walkSpeed: number = Game.citizenSpeed\r\n    carrying: ResourceBlock[] = [] // null\r\n    path: Vector[] = []\r\n\r\n    private workInProgress: boolean = false\r\n    private workStarted: number\r\n    private workDuration: number\r\n    private progress: number\r\n\r\n    private sleeping: boolean = false\r\n\r\n\r\n    private productionStrategy: ProductionStrategy\r\n    private constructionStrategy: ConstructionStrategy\r\n    private sleepingStrategy: SleepingStrategy\r\n    private eatingStrategy: EatingStrategy\r\n    private fightingStrategy: CombatStrategy\r\n\r\n    hunger: number = 0.0;\r\n    energy: number = 100\r\n    health: number = 100\r\n\r\n    private driving: Device = null\r\n\r\n    private shirtColor: Color\r\n    private skinColor: Color\r\n    private weight: number\r\n    // private nameLabel: Label\r\n\r\n    private bloodEmitter: ParticleEmitter\r\n\r\n    constructor(public name: string, private home: Vector, protected planet: Planet, private elite: boolean = false, private evil: boolean = false) {\r\n        super(\r\n            home.x, home.y,\r\n            18,20,\r\n            // Scale.minor.first, Scale.minor.fourth,\r\n            Color.Transparent.clone()\r\n            )\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling))\r\n\r\n        this.productionStrategy = new CapacityBasedProduction(this)\r\n        this.constructionStrategy = new ProxmityBasedConstruction(this)\r\n        this.sleepingStrategy = new AnyBedSleepingStrategy(this)\r\n        this.eatingStrategy = new WhenHungryEatingStrategy(this)\r\n        this.fightingStrategy = new AttackNearestHostileStrategy(this)\r\n\r\n        this.shirtColor = (this.elite ? Color.Red : sample([\r\n            Color.Green,\r\n            Color.Blue,\r\n            Color.Orange,\r\n            Color.Yellow,\r\n        ])).clone()\r\n\r\n        if (this.evil) {\r\n            this.shirtColor = Color.Black.clone()\r\n        }\r\n\r\n        this.skinColor = sample([\r\n            Color.Orange.lighten(0.5),\r\n            Color.Orange.lighten(0.6),\r\n            Color.Orange.lighten(0.7),\r\n            Color.Orange.lighten(0.8),\r\n        ])\r\n\r\n        this.weight = sample(range(7).map(w => w + 4)) //[ 5, 6, 7, 8, 9, 10 ])\r\n\r\n        // this.nameLabel = new Label(name, this.pos.x, this.pos.y, Game.font)\r\n        // this.add(this.nameLabel)\r\n\r\n        this.collisionType = CollisionType.Passive\r\n        // this.collisionArea\r\n        this.bloodEmitter = this.makeBloodEmitter();  // should the emitter be emitting\r\n\r\n        // add the emitter as a child actor, it will draw on top of the parent actor\r\n        // and move with the parent\r\n        this.add(this.bloodEmitter);\r\n    }\r\n\r\n    private makeBloodEmitter() {\r\n        let bloodEmitter = new ParticleEmitter();\r\n        bloodEmitter.emitterType = EmitterType.Circle; // Shape of emitter nozzle\r\n        bloodEmitter.radius = 7;\r\n        bloodEmitter.minVel = 10;\r\n        bloodEmitter.maxVel = 30;\r\n        bloodEmitter.minAngle = 0;\r\n        bloodEmitter.maxAngle = Math.PI * 2;\r\n        bloodEmitter.emitRate = 350; // 300 particles/second\r\n        bloodEmitter.opacity = 0.5;\r\n        bloodEmitter.fadeFlag = true; // fade particles overtime\r\n        bloodEmitter.particleLife = 500; // in milliseconds = 1 sec\r\n        bloodEmitter.maxSize = 2; // in pixels\r\n        bloodEmitter.minSize = 1;\r\n        bloodEmitter.beginColor = Color.Red.darken(0.12);\r\n        bloodEmitter.endColor = Color.Red.darken(0.36);\r\n        bloodEmitter.isEmitting = false;\r\n        return bloodEmitter\r\n    }\r\n\r\n    get title() {\r\n        let title = this.elite ? 'Cmdr. ' : ''\r\n        return title\r\n    }\r\n\r\n    get isHungry() { return this.hunger > 60 }\r\n    get isTired()  { return this.energy < 90 }\r\n\r\n    // get isWorking() { return this.isWorking }\r\n    get currentPlanet() { return this.planet }\r\n\r\n    get walkSpeed() {\r\n        let speedMultiplier = this.planet.timeFactor * (this.elite ? 1.6 : 1)\r\n        return Game.citizenSpeed * speedMultiplier\r\n    }\r\n\r\n    get isEvil(): boolean { return !!this.evil }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n\r\n        // check wip\r\n        if (this.workInProgress) {\r\n            let now = (new Date()).getTime()\r\n            this.progress = \r\n              Math.min(\r\n                  (now - this.workStarted) / this.workDuration,\r\n                  1\r\n              )\r\n\r\n            this.fatigue()\r\n        } else if (this.path.length > 0) {\r\n            // we have a non-empty path\r\n        } else {\r\n\r\n            // we aren't working or walking -- make sure we are busy!\r\n            this.work()\r\n        }\r\n\r\n        if (this.driving) {\r\n            this.pos = this.driving.pos.add(this.driving.building.pos)\r\n        }\r\n\r\n        if (this.combatting && !this.combatting.alive) { //isKilled()) {\r\n            console.warn(\"enemy was killed?\", this.combatting)\r\n            this.combatting = null\r\n        }\r\n\r\n        if (this.sleeping) {\r\n            // heal during sleep\r\n            this.health = Math.min(100, this.health+0.1)\r\n            this.energy = Math.min(100, this.energy+0.1)\r\n            if (this.health === 100 && !this.isTired) { //} && this.planet.hour > 6) {\r\n                this.sleeping = false\r\n                this.abortProgressBar()\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n\r\n        let { x, y } = this\r\n        ctx.save()\r\n        ctx.translate(x, y - this.getHeight()/2) // - 5)\r\n\r\n        if (this.alive) {\r\n            drawText(ctx, this.name, -14, -22)\r\n\r\n            if (this.health < 100) {\r\n                let healthColor = this.health > 60 ? Color.Green : Color.Yellow\r\n                if (this.health < 10) { healthColor = Color.Red }\r\n                this.drawBar(ctx, -13, -18, 32, 4, (this.health / 100), healthColor)\r\n            }\r\n\r\n            if (this.guarding) {\r\n                let c = Color.Cyan.clone()\r\n                c.a = 0.3\r\n                drawCircle(ctx, 2, 2, 24, c) //Color.Cyan)\r\n            }\r\n        }\r\n\r\n        if (this.sleeping || !this.alive) {\r\n            ctx.rotate(-Math.PI / 2);\r\n            if (this.sleeping) {\r\n                ctx.translate(5, -10)\r\n            } else {\r\n                ctx.translate(-5, 0)\r\n            }\r\n        }\r\n        this.drawSelf(ctx)\r\n        if (this.carrying) {\r\n            let dx = 5\r\n            this.carrying.forEach((carried, idx) => {\r\n                ctx.fillStyle = blockColor(carried).clone().saturate(0.2).toRGBA()\r\n                ctx.fillRect(dx, 2 - 4 * idx, 5, 5)\r\n            })\r\n        }\r\n        ctx.restore()\r\n\r\n        if (this.workInProgress) {\r\n            ctx.lineWidth = 1\r\n            let pw = 10 + Math.floor(this.workDuration / 10000), ph = 3\r\n            let px = this.x - pw/2, py = this.y - 10;\r\n            this.drawBar(ctx, px, py, pw, ph, this.progress)\r\n        }\r\n\r\n        if (this.path && Game.debugPath) {\r\n            let c = Color.White.clone().lighten(0.5)\r\n            c.a = 0.5\r\n            eachCons(this.path, 2).forEach(([a,b]) => {\r\n                ctx.beginPath()\r\n                ctx.moveTo(a.x,a.y)\r\n                ctx.lineTo(b.x,b.y)\r\n                ctx.strokeStyle = c.toRGBA()\r\n                ctx.lineWidth = 4\r\n                ctx.stroke()\r\n            })\r\n        }\r\n\r\n        if (this.combatting) {\r\n            // drawLine(ctx, this.combatting.pos, this.pos, Color.Red, 4)\r\n        }\r\n\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    private drawBar(ctx: CanvasRenderingContext2D, px: number, py: number, pw: number, ph: number, progress: number, color: Color = Color.Violet) {\r\n        let c = color.clone()\r\n        ctx.strokeStyle = Color.White.toRGBA()\r\n        ctx.strokeRect(px, py, pw, ph)\r\n        ctx.fillStyle = c.darken(0.9).toRGBA()\r\n        ctx.fillRect(px, py, pw, ph)\r\n        ctx.fillStyle = c.toRGBA()\r\n        ctx.fillRect(px, py, progress * pw, ph)\r\n    }\r\n\r\n\r\n    private drawSelf(ctx: CanvasRenderingContext2D) {\r\n        drawEllipse(ctx, 2, 8,\r\n            this.weight, 9,\r\n            this.shirtColor.desaturate(0.1).lighten(0.1))\r\n        drawCircle(ctx, 2, -3,\r\n            4.5, this.skinColor.desaturate(0.2))\r\n        if (this.elite) {\r\n            drawStar(ctx, 12, -8)\r\n        }\r\n\r\n    }\r\n\r\n    async progressBar(duration: number) {\r\n        this.workInProgress = true\r\n        this.workStarted = (new Date()).getTime()\r\n        this.workDuration = duration\r\n        await new Promise((resolve, reject) => setTimeout(resolve, duration));\r\n        this.workInProgress = false\r\n    }\r\n\r\n    abortProgressBar() {\r\n        this.log(\"work in progress aborted...!\")\r\n        this.workInProgress = false\r\n    }\r\n\r\n    drive(d: Device) {\r\n        this.driving = d\r\n    }\r\n\r\n    stopDriving() {\r\n        this.driving = null\r\n    }\r\n\r\n    carry(c: ResourceBlock) {\r\n        this.carrying.push(c);\r\n    }\r\n\r\n    isCarryingUnique(resources: ResourceBlock[]): boolean {\r\n        let isCarrying = containsUniq(this.carrying, resources)\r\n        return isCarrying\r\n    }\r\n\r\n    drop(res: ResourceBlock): ResourceBlock {\r\n        if (this.carrying.length > 0) {\r\n            if (this.carrying.find(r => r === res)) {\r\n                deleteByValueOnce(this.carrying, res)\r\n                return res\r\n            }\r\n        }\r\n        return null\r\n    }\r\n\r\n    currentBuilding: Building = null\r\n    async visit(device: Device) {\r\n        let target = this.targetForDevice(device)\r\n        // if (this.currentBuilding != device.building) {\r\n            await this.pathTo(target)\r\n        // }\r\n        await this.glideTo(target)\r\n        this.currentBuilding = device.building\r\n    }\r\n\r\n    async pathTo(pos: Vector) {\r\n        const path = this.planet.pathBetweenPoints(this.pos.clone(), pos)\r\n        path.pop()\r\n        await this.followPath(path)\r\n    }\r\n\r\n    private targetForDevice(device: Device) {\r\n        let target = device.pos.add(device.building.pos)\r\n        if (device.parentDevice) {\r\n            target = (device.parentDevice.pos).add(device.building.pos)\r\n            target.x += device.pos.x\r\n            target.y += getVisibleDeviceSize(device.parentDevice.size) / 2\r\n        } else {\r\n            target.y += getVisibleDeviceSize(device.size) / 2\r\n        }\r\n        return target\r\n    }\r\n\r\n    glideTo(pos: Vector) {\r\n        if (pos) {\r\n            return this.actions.moveTo(pos.x, pos.y, this.walkSpeed).asPromise()\r\n        }\r\n    }\r\n\r\n    async followPath(path: Vector[]) {\r\n        if (path.length > 0) {\r\n            this.path = path\r\n            await Promise.all(\r\n                path.map(step => {\r\n                    // if we are engaged in combat, and enemy is at same level\r\n\r\n                    // let engaged = this.engagedInCombat\r\n\r\n                    // if (engaged) { \r\n                    //     let dy = Math.abs(this.combatting.y - this.y) // < 10\r\n                    //     if (dy < 40) {\r\n                    //     // don't try to glide around anymore? (maybe make this action q and we can clear if need be???)\r\n                    //     // this.path = []\r\n                    //         this.log(\"not following path, engaged in combat\")\r\n                    //         return\r\n                    //     }\r\n                    // } //else {\r\n                    this.log(\"glide to next step\")\r\n                    this.glideTo(step)\r\n                    // }\r\n                })\r\n            )\r\n            this.path = []\r\n        }\r\n    }\r\n    \r\n    protected get strategies() {\r\n        return [\r\n            this.fightingStrategy,\r\n            ...(this.evil ? [] : [this.sleepingStrategy]),\r\n            ...(this.evil ? [] : [this.eatingStrategy]),\r\n            ...(this.evil ? [] : [this.constructionStrategy]),\r\n            ...(this.evil ? [] : [this.productionStrategy])\r\n        ]\r\n    }\r\n\r\n    async work() {\r\n        if (this.isPlanning || this.sleeping || !this.alive) { return }\r\n        this.isPlanning = true\r\n        if (this.carrying.length > 0) { this.carrying = [] }\r\n        let choice = this.strategies.find(strat => strat.canApply())\r\n        if (choice) {\r\n            await choice.attempt()\r\n        }\r\n        this.isPlanning = false\r\n    }\r\n\r\n    async takeRest(duration: number = 8 * 60 * Game.minuteTickMillis) {\r\n        // this.abortProgressBar()\r\n        // this.combatting = null\r\n\r\n        this.sleeping = true\r\n        this.progressBar(duration)\r\n        // this.energy = 100\r\n        // this.sleeping = false\r\n    }\r\n\r\n    async eat() {\r\n        let thirtyMinuteTimer = 30 * Game.minuteTickMillis\r\n        await this.progressBar(thirtyMinuteTimer)\r\n        deleteByValueOnce(this.carrying, ResourceBlock.Meal)\r\n        this.hunger = 0\r\n    }\r\n\r\n    private combatting: Citizen = null\r\n\r\n    engageHostile(hostile: Citizen) {\r\n        this.abortProgressBar()\r\n        this.actionQueue.clearActions()\r\n        if (!this.combatting && !this.workInProgress) {\r\n            // this.log(`ENGAGE HOSTILE ${hostile.name}`)\r\n            // this.abortProgressBar()\r\n            this.combatting = hostile\r\n            //if (!hostile.engagedInCombat) {\r\n            //    hostile.engageHostile(this)\r\n            //}\r\n        }\r\n    }\r\n\r\n    get enemyCombatant() { return this.combatting }\r\n\r\n    get engagedInCombat() {\r\n        // console.log(\"is engaged in combat\", { enemyCombatant: this.combatting })\r\n        return this.combatting !== null // && this.combatting.health > 0\r\n    }\r\n\r\n    distanceToHostile(): number { \r\n        if (this.combatting) {\r\n            return this.combatting.getWorldPos().distance(this.getWorldPos())\r\n        } else {\r\n            return 0\r\n        }\r\n    }\r\n\r\n    private paceUnit: number = 20\r\n    get idealCombatRange() {\r\n        // let paceUnit = 20\r\n        let idealDistance = 20 * this.paceUnit\r\n        return idealDistance\r\n    }\r\n\r\n    get hostileDirectionSign() {\r\n        if (this.combatting) {\r\n            let enemy = this.combatting.getWorldPos()\r\n            let self = this.getWorldPos()\r\n            if (enemy.x > self.x) {\r\n                return 1\r\n            } else {\r\n                return -1\r\n            }\r\n        } else {\r\n            return 0\r\n        }\r\n    }\r\n\r\n    get enemyPosition() { return this.combatting.getWorldPos().clone() }\r\n    // get horiistanceToEnemyLine() {}\r\n\r\n    combatMovementUnit: number = this.paceUnit * 5\r\n    firingRangeBuffer: number = this.combatMovementUnit * 2\r\n\r\n    tooCloseToEnemyLine(): boolean {\r\n        let dx = Math.abs(this.enemyPosition.x - this.x)\r\n        return dx < this.idealCombatRange - this.firingRangeBuffer\r\n    }\r\n\r\n    tooFarFromEnemyLine(): boolean {\r\n        let dx = Math.abs(this.enemyPosition.x - this.x)\r\n        return dx > this.idealCombatRange + this.firingRangeBuffer\r\n    }\r\n\r\n    withinFiringRange(): boolean {\r\n        return !(this.tooCloseToEnemyLine() || this.tooFarFromEnemyLine())\r\n    }\r\n\r\n    async advanceTowardsEnemy() {\r\n        //let idealDistance = this.idealCombatRange //20 * paceUnit\r\n        //let enemy = this.combatting.getWorldPos().clone()\r\n        //let self = this.getWorldPos().clone()\r\n        let nextGoal = this.getWorldPos().clone()\r\n        let unit = this.combatMovementUnit //paceUnit * 7\r\n        //let dx = Math.abs(enemy.x - self.x) //this.distanceToHostile()\r\n        //let buffer = 3 * unit // * this.paceUnit\r\n        if (this.tooFarFromEnemyLine()) { // dx > idealDistance+buffer) {\r\n            unit *= this.hostileDirectionSign\r\n            this.log(`ADVANCE TOWARD ENEMY LINE`)\r\n            nextGoal.x += unit // enemy.x - (idealDistance * this.hostileDirectionSign)\r\n            await this.glideTo(nextGoal) //this.combatting.pos)\r\n        } else if (this.tooCloseToEnemyLine()) { //dx < idealDistance-buffer) {\r\n            unit *= -this.hostileDirectionSign\r\n            this.log(`RETREAT FROM ENEMY LINE`)\r\n            nextGoal.x += unit // enemy.x - (idealDistance * this.hostileDirectionSign)\r\n            await this.glideTo(nextGoal) //this.combatting.pos)\r\n        }\r\n    }\r\n\r\n    // bullets: Actor[]\r\n    firing: boolean = false\r\n    async fire() {\r\n        if (!this.firing) {\r\n            // console.log(\"FIRE!!!\")\r\n            // launch a (few) projectile(s)!!!\r\n\r\n            await sleep(500)\r\n            let numTimes = range(sample(range(3)))\r\n            for (let times in numTimes) {\r\n                await this.progressBar(150)\r\n                if (this.alive && this.combatting && this.combatting.alive) {\r\n                    this.firing = true\r\n                    let bullet = this.assembleBullet()\r\n                    this.scene.add(bullet)\r\n                    this.scene.addTimer(new Timer(() => { bullet.kill() }, 2000))\r\n                    this.firing = false\r\n                }\r\n            }\r\n            await sleep(250) //this.progressBar(250)\r\n        }\r\n    }\r\n\r\n    guarding: boolean = false\r\n    async guard() {\r\n        if (!this.guarding) {\r\n            // this.guarding = true\r\n            if (this.alive && this.combatting) {\r\n                // await this.progressBar(100)\r\n                this.guarding = true\r\n                await sleep(1500)\r\n                // await this. //progressBar(5000)\r\n                this.guarding = false\r\n            }\r\n        }\r\n    }\r\n\r\n    private assembleBullet() {\r\n        let hostileDir = this.hostileDirectionSign\r\n        let bullet = new LaserBeam(this, hostileDir)\r\n        return bullet\r\n    }\r\n\r\n    injure(amt: number, attacker: Citizen) {\r\n        if (this.elite) {\r\n            amt = amt * 0.3\r\n        }\r\n        this.health -= amt\r\n        if (this.health <= 0) {\r\n            this.die()\r\n        }\r\n        this.bleed()\r\n        this.engageHostile(attacker)\r\n    }\r\n\r\n    die() {\r\n        this.actionQueue.clearActions()\r\n        this.path = []\r\n        this.alive = false\r\n        this.collisionType = CollisionType.Passive\r\n        this.scene.addTimer(new Timer(() => { this.kill() }, 5000))\r\n    }\r\n\r\n    bleed() {\r\n\r\n        this.bloodEmitter.isEmitting = true\r\n        this.scene.addTimer(new Timer(() => { this.bloodEmitter.isEmitting = false }, 50))\r\n\r\n    }\r\n\r\n    private fatigue() {\r\n        let unit = 1e-4;\r\n        this.energy -= unit;\r\n        this.hunger += unit;\r\n    }\r\n\r\n    log(msg) {\r\n        // console.log(`${this.name}: ${msg}`)\r\n    }\r\n}","import { Color } from \"excalibur\";\r\nimport { Game } from \"./Game\";\r\n\r\nexport function assembleButton(label: string, color: Color = Color.LightGray) {\r\n    let c = color.clone()\r\n    let bg = c.darken(0.5).desaturate(0.5).clone();\r\n    bg.a = 0.8;\r\n    let fg = c.lighten(0.8).desaturate(0.4).clone();\r\n    let theButton = document.createElement('button');\r\n    theButton.textContent = label;\r\n\r\n    theButton.style.display = 'block';\r\n    theButton.style.fontSize = '6pt';\r\n    theButton.style.fontFamily = Game.font // 'Verdana';\r\n    theButton.style.fontWeight = '500';\r\n    theButton.style.padding = '2px';\r\n    theButton.style.width = '100px';\r\n    // theButton.style.height = '100px';\r\n    theButton.style.textTransform = 'uppercase';\r\n    theButton.style.border = 'none' //1px solid rgba(255,255,255,0.08)';\r\n    theButton.style.background = bg.toRGBA();\r\n    theButton.style.color = fg.toRGBA();\r\n    theButton.onmouseover = () => {\r\n        theButton.style.background = bg.saturate(0.5).lighten(0.95).toRGBA();\r\n        theButton.style.color = fg.lighten(0.9).toRGBA();\r\n    };\r\n    theButton.onmouseleave = () => {\r\n        theButton.style.background = bg.toRGBA();\r\n        theButton.style.color = fg.toRGBA();\r\n    };\r\n    return theButton;\r\n}","import { Color } from \"excalibur\";\r\nimport { Game } from \"../../Game\";\r\n\r\nexport class Pane {\r\n    protected _element: HTMLDivElement;\r\n    title: HTMLDivElement\r\n    dragging: boolean = false\r\n    xOff: number = 0\r\n    yOff: number = 0\r\n    initialX: number\r\n    initialY: number\r\n\r\n\r\n    constructor(protected name: string, private x: number, private y: number) {\r\n        this.makeRootElement()\r\n\r\n    }\r\n\r\n    protected makeRootElement() {\r\n        if (this._element) {\r\n            this._element.parentElement.removeChild(this._element);\r\n        }\r\n        // if (!(this.comprehended.length > 0)) { return }\r\n\r\n        this._element = document.createElement('div');\r\n        this._element.style.position = 'absolute';\r\n        this._element.style.display = 'flex';\r\n        this._element.style.flexWrap = 'wrap';\r\n        this._element.style.width = '200px';\r\n        this._element.style.border = 'none'; //1px solid black'; //0.5px solid white';\r\n        // this._element.style.zIndex = '1'; //1px solid black'; //0.5px solid white';\r\n\r\n\r\n        document.body.appendChild(this._element);\r\n\r\n        // make title...\r\n        if (this.name) {\r\n            let container = document.createElement('div')\r\n            container.style.width = '200px'\r\n            // container.draggable = true\r\n            // container.position = 'absolute'\r\n            container.style.backgroundColor = Color.Violet.darken(0.92).toRGBA()\r\n\r\n            this.title = document.createElement('div')\r\n            this.title.textContent = this.name\r\n            this.title.style.fontFamily = Game.font //'Verdana'\r\n            this.title.style.border = 'none'\r\n            this.title.style.fontSize = '8pt'\r\n            this.title.style.fontWeight = '600'\r\n            this.title.style.color = Color.White.toRGBA()\r\n            this.title.style.padding = '4px'\r\n            this.title.style.margin = '0px'\r\n\r\n            container.appendChild(this.title)\r\n            this._element.appendChild(\r\n                container\r\n            )\r\n\r\n            /// hmmmm\r\n            document.addEventListener(\"pointerdown\", (e) => { this.dragStart(e) }, false);\r\n            document.addEventListener(\"pointerup\", (e) => { this.dragEnd(e) }, false);\r\n            document.addEventListener(\"pointermove\", (e) => { this.drag(e) }, false);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): any {\r\n        if (this._element) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._element.style.left = `${left + this.x + this.xOff}px`;\r\n            this._element.style.top = `${top + this.y + this.yOff}px`;\r\n        }\r\n    }\r\n    private dragStart = (e) => {\r\n        if (e.target === this.title) {\r\n            // console.log(\"drag start\")\r\n            this.initialX = e.clientX - this.xOff;\r\n            this.initialY = e.clientY - this.yOff;\r\n            this.dragging = true\r\n        }\r\n    }\r\n\r\n    private drag = (e) => {\r\n        if (this.dragging) {\r\n            e.preventDefault()\r\n            // console.log(\"drag\")\r\n            let currentX = e.clientX - this.initialX;\r\n            let currentY = e.clientY - this.initialY;\r\n            this.xOff = currentX\r\n            this.yOff = currentY\r\n        }\r\n\r\n    }\r\n\r\n    private dragEnd = (e) => {\r\n        if (this.dragging) {\r\n            // console.log(\"drag end\")\r\n            this.dragging = false\r\n        }\r\n\r\n    }\r\n\r\n    // protected buttonFactory\r\n}","const raisedSquare = require('../../images/raised-square-bg.png')\r\nconst leafy = require('../../images/leafy-bg.png')\r\nconst bookish = require('../../images/books-bg.png')\r\nconst posters = require('../../images/poster-wall-bg.png')\r\nconst tech = require('../../images/tech-bg.png')\r\nconst checker = require('../../images/checker-bg.png')\r\nconst beige = require('../../images/beige-bg.png')\r\nconst window = require('../../images/window-bg.png')\r\nconst ussf = require('../../images/ussf.png')\r\nconst wood = require('../../images/wood-panel-bg.png')\r\n\r\ninterface Background {\r\n    image: HTMLImageElement\r\n    pattern: CanvasPattern\r\n    loading: boolean\r\n}\r\n\r\nconst loadBg = (path, scale = 1) => {\r\n    let background: Background = { image: null, pattern: null, loading: true }\r\n    background.image = new Image();\r\n    background.image.src = path\r\n    background.image.onload = function () {\r\n      background.loading = false\r\n    }\r\n    return { background, scale }\r\n}\r\n\r\nexport enum BackgroundPattern {\r\n    Leafy = 'Leafy',\r\n    Grid = 'Grid',\r\n    Books = 'Books',\r\n    Poster = 'Poster',\r\n    Tech = 'Tech',\r\n    Checker = 'Checker',\r\n    Beige = 'Beige',\r\n    Window = 'Window',\r\n    USSF = 'USSF',\r\n    Wood = 'Wood',\r\n}\r\n\r\nconst backgroundPatterns: { [ key in BackgroundPattern ]: { background: Background, scale: number } } = {\r\n    Leafy: loadBg(leafy),\r\n    Grid: loadBg(raisedSquare),\r\n    Books: loadBg(bookish),\r\n    Poster: loadBg(posters),\r\n    Tech: loadBg(tech),\r\n    Checker: loadBg(checker),\r\n    Beige: loadBg(beige),\r\n    Window: loadBg(window),\r\n    USSF: loadBg(ussf, 0.5),\r\n    Wood: loadBg(wood),\r\n}\r\n\r\nexport const getBackgroundPattern = (ctx: CanvasRenderingContext2D, p: BackgroundPattern) => {\r\n    let pattern = backgroundPatterns[p]\r\n    let bg = pattern.background\r\n    if (!bg.loading) {\r\n        if (!bg.pattern) {\r\n            let matrix = new DOMMatrix() //bg.pattern.cre //ctx. // new SVGMatrix()\r\n\r\n            // bg.image.scal\r\n            // bg.image.scale\r\n            bg.pattern = ctx.createPattern(bg.image, 'repeat');\r\n            bg.pattern.setTransform(matrix.scale(pattern.scale)) //0.5))\r\n\r\n        }\r\n        return bg.pattern\r\n    }\r\n}","const majorUnit = 16\r\nconst minorUnit = 4\r\n\r\nconst majorScale = {\r\n    first: majorUnit,\r\n    second: majorUnit * 2,\r\n    third: majorUnit * 3,\r\n    fourth: majorUnit * 4,\r\n    fifth: majorUnit * 5,\r\n    sixth: majorUnit * 6,\r\n    seventh: majorUnit * 7,\r\n    eighth: majorUnit * 8,\r\n}\r\n\r\nconst minorScale = {\r\n    first:   minorUnit,\r\n    second:  minorUnit * 2,\r\n    third:   minorUnit * 3,\r\n    fourth:  minorUnit * 4,\r\n    fifth:   minorUnit * 5,\r\n    sixth:   minorUnit * 6,\r\n    seventh: minorUnit * 7,\r\n    eighth:  minorUnit * 8,\r\n}\r\n\r\nexport const Scale = {\r\n    major: majorScale,\r\n    minor: minorScale\r\n}","import { Color } from 'excalibur';\r\nimport { Structure } from './Structure';\r\nimport { sample } from '../Util';\r\nimport { Planet } from '../actors/Planet/Planet';\r\n\r\n\r\nexport class World {\r\n    static nameCitizen(): string {\r\n      return sample([\r\n        'Parthas',\r\n        'Athos',\r\n        'Karzak',\r\n        'Echo',\r\n        'Jaen',\r\n        'Xavier',\r\n        'Mante',\r\n        'Ern',\r\n        'Leor',\r\n        'Exiel',\r\n        'Tomlien',\r\n        'Amriel',\r\n        'Sariel',\r\n        'Arthax',\r\n        'Avalon',\r\n        'Kor',\r\n        'Exelon',\r\n        'Dominel',\r\n        'Prinz',\r\n        'Etsa',\r\n        'Corinth',\r\n        'Coade',\r\n        'Exter',\r\n        'Domnek',\r\n        'Tahm',\r\n        'Esk',\r\n        'Ith',\r\n        'Torl',\r\n        'Klapaucius',\r\n        'Antonidus',\r\n        'Exeleron',\r\n        'Moab',\r\n        'Thim',\r\n        'Pol',\r\n        'Maigel',\r\n      ])\r\n    }\r\n  static colors = [Color.Orange, Color.Azure] //, Color.Red, Color.Blue, Color.Green] //, Color.Violet] //, Color.White]\r\n\r\n  color: Color = sample(World.colors).\r\n      clone().\r\n      darken(0.1).\r\n      desaturate(0.8);\r\n  skyColor: Color = sample(\r\n    //   [ Color.Blue ]\r\n      [Color.Cyan] //, Color.Vermillion, Color.Violet, Color.Chartreuse, Color.Orange, Color.Rose]\r\n  ).\r\n        clone().\r\n        lighten(0.15).\r\n        desaturate(0.8) //65)\r\n\r\n}","import { Game } from \"./Game\";\r\nimport { BaseCamera, Vector, Input } from \"excalibur\";\r\nimport { Orientation } from \"./values/Orientation\";\r\n\r\nexport class GameController {\r\n\r\n    private dragging: boolean = false\r\n    private dragOrigin: Vector\r\n    pointerMoveCallback: (pos: Vector) => any = null\r\n    leftClickCallback: (pos: Vector) => any = null\r\n    cameraPanCallback: () => any = null\r\n    keyPressCallback: (key) => any = null\r\n\r\n    constructor(private game: Game, private camera: BaseCamera) {\r\n        \r\n    }\r\n\r\n    onMove(cb: (pos: Vector) => any) {\r\n        this.pointerMoveCallback = cb\r\n    }\r\n\r\n    onLeftClick(cb: (pos: Vector) => any) {\r\n        this.leftClickCallback = cb\r\n    }\r\n\r\n    onCameraPan(cb: () => any) {\r\n        this.cameraPanCallback = cb\r\n    }\r\n\r\n    onKeyPress(cb: (key) => any) {\r\n        this.keyPressCallback = cb\r\n\r\n    }\r\n\r\n    activate() {\r\n        this.game.input.pointers.primary.on('move', (e: Input.PointerMoveEvent) => {\r\n\r\n            if (this.dragging) {\r\n                this.camera.pos = this.camera.pos.add(\r\n                    this.dragOrigin.sub(e.pos)\r\n                )\r\n            } else {\r\n                if (this.pointerMoveCallback) {\r\n                    this.pointerMoveCallback(e.pos)\r\n                }\r\n\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('up', () => {\r\n            if (this.dragging) { this.dragging = false; }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('down', (e: Input.PointerDownEvent) => {\r\n            if (e.button == Input.PointerButton.Left) {\r\n                if (this.leftClickCallback) {\r\n                    this.leftClickCallback(e.pos)\r\n                }\r\n\r\n            } else if (e.button === Input.PointerButton.Middle) {\r\n                this.dragging = true;\r\n                this.dragOrigin = e.pos\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('wheel', (e: Input.WheelEvent) => {\r\n            let z = this.camera.getZoom()\r\n            let step = 0.05\r\n            let min = 0.05, max = 8\r\n            if (e.deltaY < 0) {\r\n                this.camera.zoom(Math.min(z + step, max))\r\n            } else if (e.deltaY > 0) {\r\n                this.camera.zoom(Math.max(z - step, min))\r\n            }\r\n        })\r\n\r\n        let { Up, Down, Left, Right } = Orientation;\r\n        let moveCam = (direction: Orientation) => {\r\n            if (this.cameraPanCallback) {\r\n                this.cameraPanCallback()\r\n            }\r\n            let camMoveSpeed = 10 * (1 / this.camera.getZoom())\r\n            let dv = new Vector(0, 0)\r\n            switch (direction) {\r\n                case Left: dv.x = -camMoveSpeed; break\r\n                case Right: dv.x = camMoveSpeed; break\r\n                case Up: dv.y = -camMoveSpeed; break\r\n                case Down: dv.y = camMoveSpeed; break\r\n            }\r\n            this.camera.move(this.camera.pos.add(dv), 0)\r\n        }\r\n\r\n\r\n        this.game.input.keyboard.on('press', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.Up || e.key === Input.Keys.W) {\r\n                moveCam(Up)\r\n            } else if (e.key === Input.Keys.Left || e.key === Input.Keys.A) {\r\n                moveCam(Left)\r\n            } else if (e.key === Input.Keys.Down || e.key === Input.Keys.S) {\r\n                moveCam(Down)\r\n            } else if (e.key === Input.Keys.Right || e.key === Input.Keys.D) {\r\n                moveCam(Right)\r\n            } else {\r\n                if (this.keyPressCallback) {\r\n                    this.keyPressCallback(e.key)\r\n                }\r\n            }\r\n        })\r\n        this.game.input.keyboard.on('hold', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.Up || e.key === Input.Keys.W) {\r\n                moveCam(Up)\r\n            } else if (e.key === Input.Keys.Left || e.key === Input.Keys.A) {\r\n                moveCam(Left)\r\n            } else if (e.key === Input.Keys.Down || e.key === Input.Keys.S) {\r\n                moveCam(Down)\r\n            } else if (e.key === Input.Keys.Right || e.key === Input.Keys.D) {\r\n                moveCam(Right)\r\n            }\r\n        })\r\n    }\r\n}","import * as ex from 'excalibur';\r\nimport { Actor, Color, Vector, Scene } from 'excalibur';\r\nimport { Building } from '../Building';\r\nimport { range, flatSingle, mixColors, sample, closest } from '../../Util';\r\nimport { Structure } from '../../models/Structure';\r\nimport { Hud } from '../Hud/Hud';\r\nimport { ResourceBlock, Economy, sumMarkets, emptyMarket, availableCapacity, PureValue } from '../../models/Economy';\r\nimport { Colony } from './Colony';\r\nimport { Population } from './Population';\r\nimport { Machine } from '../../models/Machine';\r\nimport { Device } from '../Device';\r\nimport { MechanicalOperation } from '../../models/MechanicalOperation';\r\nimport { World } from '../../models/World';\r\nimport { Colorize } from 'excalibur/dist/Drawing/SpriteEffects';\r\nimport { SkyLayers } from './SkyLayers';\r\nimport { Citizen } from '../Citizen';\r\n\r\nexport class Planet extends Actor {\r\n    colony: Colony\r\n    population: Population\r\n    hostiles: Citizen[] = []\r\n    // baseColor: Color\r\n    sky: Actor\r\n    skyLayers: SkyLayers\r\n\r\n    constructor(\r\n        public world: World,\r\n        public hud: Hud,\r\n        // public color: Color,\r\n        private onBuildingHover: (b: Building) => any,\r\n        private onDeviceHover: (d: Device) => any,\r\n        private w: number = 200000,\r\n        private depth: number = 40000,\r\n        public scene: Scene\r\n    ) {\r\n        super(0, depth / 2, w, depth, world.color)\r\n        this.traits = this.traits.filter(trait => !(trait instanceof ex.Traits.OffscreenCulling))\r\n\r\n        this.sky = new Actor(0, -depth, w, depth, world.skyColor)\r\n        this.add(this.sky)\r\n\r\n        let yBase = -depth / 2\r\n        let crustHeight = 40\r\n        this.createLayer(yBase, crustHeight, this.color.lighten(0.45))\r\n\r\n\r\n        let layerCount = 10\r\n        let layerHeight = depth / layerCount\r\n        for (let i of range(layerCount)) {\r\n            this.createLayer(\r\n                yBase + crustHeight + (layerHeight / 2) + (layerHeight * (i + 1)),\r\n                layerHeight,\r\n                this.color.darken(0.05 + 0.01 * i)\r\n            )\r\n        }\r\n        let c = this.color.clone()\r\n\r\n        this.skyLayers =new SkyLayers(\r\n           -depth/2, // - 20,\r\n           this.getWidth(),\r\n           this.color.lighten(0.04),\r\n           world.skyColor,\r\n           6\r\n        )\r\n        this.add(this.skyLayers)\r\n\r\n        this.colony = new Colony(0, -depth / 2)\r\n        this.add(this.colony)\r\n\r\n        console.log(\"in planet, scene is: \", { scene: this.scene })\r\n        this.population = new Population(this, scene)\r\n        this.add(this.population)\r\n\r\n    }\r\n\r\n\r\n    private currentHour: number\r\n    get hour() { return this.currentHour }\r\n\r\n    setTime(time: number) {\r\n        this.hour = (Math.floor(time / 60)) % 24\r\n\r\n        let nextHour = this.hour + 1\r\n\r\n        let minute = Math.floor(time % 60)\r\n        let inc = (minute / 60)\r\n        // console.log({ hour: this.hour, nextHour: nextHour, minute, inc })\r\n\r\n        let oldC = this.skyColorForHour(this.hour),\r\n            newC = this.skyColorForHour(nextHour)\r\n\r\n        let mixC = mixColors(newC, oldC, inc)\r\n\r\n        // this.sky.color = mixC // skyColor\r\n        this.assignColors(mixC)\r\n    }\r\n\r\n    private assignColors(skyColor: Color) {\r\n        this.sky.color = skyColor\r\n\r\n        let inc = 0.08\r\n\r\n        let c = mixColors(\r\n            this.sky.color.lighten(5 * inc), //.lighten(3*inc).saturate(5*inc),\r\n            this.color.darken(5 * inc), //.lighten(2*inc)\r\n            0.7\r\n        )\r\n\r\n        this.skyLayers.setHi(c)\r\n\r\n        // this.skyLayer.mountainLayers.color = this.color.lighten(inc) //0.1)\r\n        // this.skyLayer.mountainLayers.skyColor = c.lighten(inc)\r\n        // this.skyLayer.mountains.color = c.lighten(inc)\r\n        // this.skyLayer.backMountainLayers.color = c.lighten(inc)\r\n        // this.skyLayer.backMountainLayers.skyColor = c.lighten(inc * 3).desaturate(inc)\r\n    }\r\n\r\n    skyColorForHour(hour: number) {\r\n        let c = this.world.skyColor.clone().darken(0.2).desaturate(0.1)\r\n\r\n        let colorMap = {\r\n            night: c.darken(0.7),\r\n            dawn: c.darken(0.2),\r\n            morning: c.lighten(0.1),\r\n            afternoon: c.lighten(0.2).desaturate(0.1),\r\n            evening: c,\r\n        }\r\n\r\n        let result: Color = null\r\n        if (hour >= 5 && hour < 8) { // dawn\r\n            let inc = (hour - 6) / 5\r\n            result = colorMap.dawn.lighten(inc)\r\n        } else if (hour >= 8 && hour < 12) { // morning\r\n            let inc = (hour - 8) / 24\r\n            result = colorMap.morning.lighten(inc)\r\n        } else if (hour >= 12 && hour < 14) { // early afternoon\r\n            result = colorMap.afternoon //.darken(inc)\r\n        } else if (hour >= 14 && hour < 18) {  // late afternoon\r\n            let inc = (hour - 14) / 16\r\n            result = colorMap.afternoon.darken(inc)\r\n        } else if (hour >= 18 && hour < 23) { // evening\r\n            let inc = (hour - 18) / 10\r\n            result = colorMap.evening.darken(inc)\r\n        } else if (hour >= 23) { // late night\r\n            result = colorMap.night\r\n        } else if (hour < 5) { // early morning\r\n            result = colorMap.night\r\n        }\r\n        return result\r\n    }\r\n\r\n    set hour(hour: number) {\r\n        this.currentHour = hour\r\n    }\r\n\r\n    set currentlyViewing(buildingOrDevice: Building | Device) {\r\n        if (buildingOrDevice instanceof Building) {\r\n            let b: Building = buildingOrDevice\r\n            this.onBuildingHover(b)\r\n        } else if (buildingOrDevice instanceof Device) {\r\n            let d: Device = buildingOrDevice\r\n            this.onDeviceHover(d)\r\n        }\r\n    }\r\n\r\n    private createLayer(y: number, size: number, color: Color) {\r\n        let theLayer = new Actor(0, y, this.getWidth(), size, color);\r\n        this.add(theLayer);\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta) {\r\n        super.draw(ctx, delta)\r\n\r\n        if (this.currentlyConstructing) {\r\n            this.currentlyConstructing.draw(ctx, delta)\r\n        }\r\n    }\r\n\r\n    get economy(): Economy {\r\n        // let devices = this.colony.findPoweredDevices()\r\n        // let economies = devices.map((d: Device) => d.machine.economy)\r\n\r\n        let buildings = this.colony.buildings\r\n        let economies = buildings.map(b => b.economy())\r\n        let theEconomy = economies.reduce(sumMarkets, emptyMarket())\r\n\r\n        let popularDemand = this.population.citizens.length\r\n        theEconomy['Shelter'].demand = popularDemand\r\n        theEconomy['Oxygen'].demand += popularDemand\r\n        theEconomy['Water'].demand += popularDemand\r\n        return theEconomy\r\n    }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n        this.colony.buildings.forEach(building => building.update(engine, delta))\r\n        this.population.citizens.forEach(citizen => citizen.update(engine, delta))\r\n    }\r\n\r\n    get currentlyConstructing() {\r\n        return this.colony.currentlyConstructing\r\n    }\r\n\r\n    gather(resource: ResourceBlock): any {\r\n        this.hud.resourceGathered(resource)\r\n    }\r\n\r\n    spend(resource: ResourceBlock): any {\r\n        this.hud.resourceExpended(resource)\r\n    }\r\n\r\n    placeBuilding(building: Building) {\r\n        this.colony.placeBuilding(building)\r\n    }\r\n\r\n    populate(pos: Vector, elite: boolean = false) {\r\n        if (this.population.citizens.length < this.maxPop) {\r\n            // console.log(\"POPULATIN'!\")\r\n            // let home = this.closestDevice(pos, [CloningVat])\r\n            this.population.increase(pos, elite) //home)\r\n        } else {\r\n            console.warn(\"too many citizens already to populate more!\")\r\n        }\r\n    }\r\n\r\n    get maxPop() {\r\n        let devices = this.colony.findPoweredDevices()\r\n        let economies = devices.map((d: Device) => d.machine.economy)\r\n        let theEconomyWithoutPeople = economies.reduce(sumMarkets, emptyMarket())\r\n\r\n        let values = [PureValue.Shelter, PureValue.Water, PureValue.Oxygen]\r\n        return Math.max(0, Math.min(\r\n            ...values.map(val => availableCapacity(theEconomyWithoutPeople, val))\r\n        ))\r\n    }\r\n\r\n    closestBuildingByType(cursor: Vector, structureTypes: (typeof Structure)[], predicate: (Building) => boolean = () => true): Building {\r\n        return this.colony.closestBuildingByType(cursor, structureTypes, predicate)\r\n    }\r\n\r\n    closestDevice(cursor: Vector, machineTypes: (typeof Machine)[] = [], predicate: (Device) => boolean = () => true) {\r\n        return this.colony.closestDeviceByType(cursor, machineTypes, predicate);\r\n    }\r\n\r\n    pathBetween(origin: Vector, destination: Building): Vector[] {\r\n        return this.colony.pathBetween(origin, destination)\r\n    }\r\n\r\n    pathBetweenPoints(origin: Vector, destination: Vector): Vector[] {\r\n        return this.colony.pathBetweenPoints(origin, destination)\r\n    }\r\n\r\n    get timeFactor() {\r\n        let devices = this.colony.findPoweredDevices()\r\n        let ops: MechanicalOperation[] = devices.map(d => d.operation) //.filter(op => op.type === 'accelerate')\r\n        return ops\r\n            .map(op => op.type === 'accelerate' ? op.factor : 1)\r\n            .reduce((acc, val) => val * acc, 1.0)\r\n    }\r\n\r\n    get storedResources(): ResourceBlock[] {\r\n        let devices = this.colony.findAllDevices()\r\n        return flatSingle(devices.map(d => d.product))\r\n    }\r\n\r\n    hasMachineKind(kind: typeof Machine) {\r\n        return this.colony.findPoweredDevices().find(d => d.machine instanceof kind);\r\n    }\r\n\r\n    sendRaidingParty() {\r\n        let partySize =1+sample(range(3))\r\n        for (let times in range(partySize)) {\r\n            this.sendRaider()\r\n        }\r\n        console.warn(`Sent ${partySize} raiders!`)\r\n    }\r\n\r\n    private async sendRaider() {\r\n        let origin = this.colony.origin.clone()\r\n        origin.y = this.getTop() + 5\r\n        let xOff = Math.random() * 50\r\n        let raider = \r\n            new Citizen('Raider', origin.add(new Vector(3000 + xOff,0)), this, false, true)\r\n\r\n        this.population.raiders.push(\r\n            raider\r\n        )\r\n\r\n        this.scene.add(raider)\r\n        await raider.glideTo(origin) //.add(new Vector(2400,0))) //.add(new Vector(300,0)))\r\n        // this.population.citizens.forEach(c => c.engageHostile(raider))\r\n        // let target = closest(raider.pos, this.population.citizens, (c) => c.pos)\r\n        // raider.engageHostile(target) //sample(this.population.citizens))\r\n    }\r\n}","import { UIActor, Label } from \"excalibur\";\r\nimport { Structure, Corridor, SurfaceRoad, Ladder, allStructures } from \"../../models/Structure\";\r\nimport { Game } from \"../../Game\";\r\nimport { ResourceBlock, emptyMarket, PureValue } from \"../../models/Economy\";\r\nimport { Machine, allMachines, PersonnelRegistry } from \"../../models/Machine\";\r\nimport { flatSingle } from \"../../Util\";\r\nimport { Colony } from \"../Planet/Colony\";\r\nimport { StatusAnalysisView } from \"./StatusAnalysisView\";\r\nimport { Device } from \"../Device\";\r\nimport { Planet } from \"../Planet/Planet\";\r\nimport { Card } from \"./Card\";\r\nimport { allSpaceFunctions, RoomRecipe } from \"../../models/RoomRecipe\";\r\nimport { Palette } from \"./Palette\";\r\nimport { Building } from \"../Building\";\r\nimport { Modal } from \"./Modal\";\r\nimport { TechTree } from \"../../models/TechTree\";\r\nimport { CitizenList } from \"./CitizenList\";\r\nimport { Citizen } from \"../Citizen\";\r\n\r\nexport class Hud extends UIActor {\r\n    private hidePalettes: boolean = true\r\n    private structurePalette: Palette\r\n    private machinePalette: Palette\r\n    private functionPalette: Palette\r\n\r\n    private showCitizenList: boolean = true\r\n    private citizenList: CitizenList\r\n\r\n\r\n    private card: Card\r\n    private status: StatusAnalysisView\r\n\r\n    private modal: Modal = null\r\n\r\n    static structuresForPalette = [\r\n        SurfaceRoad,\r\n        Corridor,\r\n        Ladder,\r\n        ...allStructures\r\n    ];\r\n    static machinesForPalette = allMachines\r\n    static functionsForPalette = allSpaceFunctions\r\n\r\n\r\n    constructor(\r\n        private game: Game,\r\n        private onBuildingSelect = null,\r\n        private onMachineSelect = null,\r\n        private onFunctionSelect = null,\r\n        private onCitizenSelect = null,\r\n    ) {\r\n        super(0, 0, game.canvasWidth, game.canvasHeight);\r\n        let canvasHeight = game.canvasHeight / window.devicePixelRatio;\r\n        let canvasWidth = game.canvasWidth / window.devicePixelRatio;\r\n\r\n        this.status = new StatusAnalysisView(emptyMarket(), game.canvasWidth, 64);\r\n        this.add(this.status)\r\n\r\n        let displayInfo = (e) => this.showCard(e)\r\n        this.machinePalette = new Palette('Machine', 20, 55, allMachines, onMachineSelect, displayInfo) // (e) => this.showCard(e))\r\n        this.structurePalette = new Palette('Structure', 20, 300, Hud.structuresForPalette, onBuildingSelect, displayInfo)\r\n        this.functionPalette = new Palette('Room Recipe', 20, 435, Hud.functionsForPalette, onFunctionSelect, displayInfo, false)\r\n\r\n        this.citizenList = new CitizenList(canvasWidth - 220, 55, onCitizenSelect) //, (citizen) => {})\r\n\r\n\r\n        this.card = new Card(null, 20, canvasHeight - 200)\r\n        this.add(this.card)\r\n\r\n\r\n    }\r\n\r\n    systemMessage(\r\n        message: string,\r\n        title: string = 'Commander...',\r\n        // subtitle: string = ''\r\n        buttons: { [intent: string]: () => any },\r\n    ): Modal {\r\n\r\n        let canvasHeight = this.game.canvasHeight / window.devicePixelRatio;\r\n        let canvasWidth = this.game.canvasWidth / window.devicePixelRatio;\r\n        this.modal = new Modal(\r\n            title,\r\n            message,\r\n            canvasWidth/2, // - 100,\r\n            canvasHeight/2, // - 100\r\n        ) \r\n        this.modal.addButtons(buttons)\r\n        return this.modal\r\n\r\n        // this.showModal = true\r\n        // this.modal = {\r\n            // message, title\r\n        // }\r\n    }\r\n\r\n    closeSystemMessage() {\r\n        console.log(\"hide system message\")\r\n        this.modal.teardown()\r\n        this.modal = null\r\n    }\r\n\r\n\r\n    showPalettes() {\r\n        this.hidePalettes = false\r\n    }\r\n\r\n    setStatus(text: string) { this.status.setMessage(text) }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta)\r\n        if (!this.hidePalettes) {\r\n            this.structurePalette.draw(ctx)\r\n            this.functionPalette.draw(ctx)\r\n\r\n            if (this.machinePalette.comprehended.length > 0) {\r\n                this.machinePalette.draw(ctx)\r\n            }\r\n        }\r\n\r\n        if (this.modal) {\r\n            // console.log(\"okay, we have modal!!\")\r\n            this.modal.draw(ctx)\r\n        } else {\r\n            // console.log(\"no modal\")\r\n        }\r\n        // if (this.showModal)\r\n\r\n        if (this.showCitizenList) {\r\n            this.citizenList.draw(ctx)\r\n        }\r\n    }\r\n\r\n    update(game: Game, delta: number) {\r\n        super.update(game, delta)\r\n    }\r\n\r\n    resourceGathered(resource: ResourceBlock) {\r\n        this.status.incrementResource(resource)\r\n    }\r\n\r\n    resourceExpended(resource: ResourceBlock) {\r\n        this.status.decrementResource(resource)\r\n    }\r\n\r\n    updateDetails(planet: Planet, techTree: TechTree, following: Citizen, rebuildPalettes: boolean = true, time: number = 0) {\r\n        if (!planet) { return }\r\n        if (rebuildPalettes) {\r\n            this.updatePalettes(planet.colony, techTree)\r\n        }\r\n        this.updateEconomy(planet)\r\n        this.updateMaxPop(planet.economy[PureValue.Shelter].demand, planet.maxPop)\r\n\r\n        this.status.setClock(time)\r\n\r\n        // let missingCitizens = planet.population.citizens.some(c => !this.citizenList.doesRosterInclude(c))\r\n        // let followedChanged = following !== this.citizenList.following\r\n        // if (missingCitizens || followedChanged) {\r\n        this.citizenList.updateRoster(planet.population.citizens.filter(c => c.alive), following)\r\n        // }\r\n\r\n        if (!this.showCitizenList && planet.hasMachineKind(PersonnelRegistry)) {\r\n            this.showCitizenList = true\r\n        }\r\n    }\r\n\r\n    showCard(entity: Machine | Structure | RoomRecipe | Building | Device) {\r\n        this.card.present(entity)\r\n    }\r\n\r\n    private updateMaxPop(curr, cap) {\r\n        this.status.showPopCap(curr, cap)\r\n    }\r\n\r\n    private updateEconomy(planet: Planet) {\r\n        this.status.showEconomy(planet.economy)\r\n    }\r\n\r\n    private updatePalettes(colony: Colony, techTree: TechTree) {\r\n        this.updateBuildingPalette(colony)\r\n        this.updateMachinePalette(colony, techTree)\r\n        this.updateFunctionPalette(colony)\r\n    }\r\n\r\n    private updateBuildingPalette(colony: Colony) {\r\n        let builtStructures =\r\n            Hud.structuresForPalette.filter((structure) => colony.buildings.some(b => b.structure instanceof structure))\r\n        if (!builtStructures.every(s => this.structurePalette.built.includes(s))) {\r\n            this.structurePalette.updateBuilt(builtStructures)\r\n        }\r\n    }\r\n\r\n    private updateMachinePalette(colony: Colony, techTree: TechTree) {\r\n        let devices = colony.findAllDevices()\r\n        let builtMachines = [\r\n            ...Hud.machinesForPalette.filter((machine) => devices.some(d => d.machine instanceof machine && d.built)),\r\n            // ...techTree.allUnlockedMachines()\r\n        ]\r\n        if (!builtMachines.every(machine => this.machinePalette.built.includes(machine))) {\r\n            this.machinePalette.updateBuilt(builtMachines, techTree.allUnlockedMachines())\r\n        }\r\n    }\r\n\r\n    private updateFunctionPalette(colony: Colony) {\r\n        let builtReifiedFunctions = flatSingle(colony.buildings.map(b => b.spaceFunction))\r\n        let builtFunctions = Hud.functionsForPalette.filter((fn) => builtReifiedFunctions.some(rf => rf instanceof fn))\r\n        if (!builtFunctions.every(fn => this.functionPalette.built.includes(fn))) {\r\n            this.functionPalette.updateBuilt(builtFunctions)\r\n        }\r\n    }\r\n\r\n}","import { minBy } from \"../Util\";\r\n\r\nexport class Graph<T> {\r\n    private empty: boolean = true\r\n    public nodes: T[] = []\r\n    private edges: { [key: number]: number[] } = {}\r\n    private edgesInverse: { [key: number]: number[] } = {}\r\n\r\n    public isEmpty(): boolean {\r\n        return this.empty;\r\n    }\r\n\r\n    public get size() { return this.nodes.length }\r\n\r\n    public node(newNode: T) {\r\n        this.empty = false;\r\n        if (!this.contains(newNode)) {\r\n            this.nodes.push(newNode)\r\n        }\r\n    }\r\n\r\n    public contains(testNode: T) {\r\n        return this.nodes.includes(testNode)\r\n    }\r\n\r\n    public findOrCreate(testNode: T, measure: (a: T, b: T) => number, tolerance: number = 5): T {\r\n        let nodes = this.dfs();\r\n        let closest = minBy(nodes, (node: T) => measure(testNode, node))\r\n        if (closest && measure(closest, testNode) < tolerance) {\r\n            return closest;\r\n        }\r\n        return testNode;\r\n    }\r\n\r\n    public edge(src: T, dst: T) {\r\n        this.node(src)\r\n        this.node(dst)\r\n\r\n        let s = this.indexOf(src), d = this.indexOf(dst)\r\n        this.edges[s] = this.edges[s] || []\r\n        this.edges[s].push(d)\r\n\r\n        this.edgesInverse[d] = this.edgesInverse[d] || []\r\n        this.edgesInverse[d].push(s)\r\n    }\r\n\r\n    public union(otherGraph: Graph<T>) {\r\n       otherGraph.edgeList().forEach(([a,b]) => this.edge(a,b))\r\n    }\r\n\r\n    public edgeList(): [T,T][] {\r\n        let theEdges = []\r\n        for (let node of this.nodes) {\r\n            let index = this.indexOf(node)\r\n            if (this.edges[index]) {\r\n                for (let otherIndex of this.edges[index]) {\r\n                    let otherNode = this.nodes[otherIndex]\r\n                    if (!theEdges.includes([otherNode, node])) {\r\n                        theEdges.push([node, otherNode])\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return theEdges\r\n    }\r\n\r\n    public adjacent(testNode: T): T[] {\r\n        let index = this.indexOf(testNode)\r\n        let vertex = this.adjacentIndices(index)\r\n        return vertex.map((n) => this.nodes[n])\r\n    }\r\n\r\n    private adjacentIndices(testNodeIndex: number): number[] {\r\n        let es = this.edges[testNodeIndex] || []\r\n        let esInv = this.edgesInverse[testNodeIndex] || []\r\n        let vertex = [...es, ...esInv ]\r\n        return vertex\r\n    }\r\n\r\n    public dfs(root:T=null, visited=[]): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.dfsIndex(rIndex).map(n => this.nodes[n])\r\n    }\r\n\r\n    private dfsIndex(rootIndex:number=0, visited:number[]=[]) {\r\n        visited.push(rootIndex)\r\n        let children = this.adjacentIndices(rootIndex)\r\n        children.forEach((childIndex: number) => {\r\n            if (!visited.includes(childIndex)) {\r\n                this.dfsIndex(childIndex, visited)\r\n            }\r\n        })\r\n\r\n        return visited\r\n    }\r\n\r\n    public bfs(root:T=null, cb: (x: number,y: number)=>boolean = ()=>true): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.bfsIndex(rIndex, cb).map(n => this.nodes[n])\r\n    }\r\n\r\n    private bfsIndex(rootIndex:number=null, cb: (x: number, y: number) => boolean = () => true): number[] {\r\n        let halt = false;\r\n        let visited: number[] = []\r\n        visited.push(rootIndex)\r\n        let tries = 0\r\n        while (visited.length < this.nodes.length && tries++ < this.nodes.length * 20) {\r\n            for (let visitedNode of visited) {\r\n                let adj: number[] = this.adjacentIndices(visitedNode)\r\n                for (let adjacentNode of adj) {\r\n                    if (!visited.includes(adjacentNode)) {\r\n                        if (!cb(visitedNode, adjacentNode)) {\r\n                            halt = true;\r\n                            break;\r\n                        }\r\n                        visited.push(adjacentNode)\r\n                    }\r\n                }\r\n                if (halt) break;\r\n            }\r\n            if (halt) break;\r\n        }\r\n        return visited\r\n    }\r\n\r\n    public shortestPath(src: T, dst: T, maxStep: number = 256): T[] {\r\n        let prevStep = {}\r\n        let dstIndex = this.indexOf(dst)\r\n        this.bfs(src, (prev, curr) => {\r\n            prevStep[curr] = prev;\r\n            return curr !== dstIndex\r\n        })\r\n        let path = []\r\n        let curr = dstIndex\r\n        let steps = 0\r\n        let srcIndex = this.indexOf(src)\r\n        while (!path.includes(srcIndex) && steps < maxStep) {\r\n            path.push(curr)\r\n            curr = prevStep[curr]\r\n            steps += 1\r\n        }\r\n        let pathNodes = path.map(n => this.nodes[n])\r\n        return pathNodes.reverse()\r\n    }\r\n\r\n    private indexOf(node: T) {\r\n        return this.nodes.indexOf(node)\r\n    }\r\n\r\n}","import { Texture, Sound } from 'excalibur';\r\nconst sword = require('./images/sword.png');\r\nconst craterRock = require('./sounds/crater-rock.mp3')\r\nconst assembler = require('./sounds/assembler.mp3')\r\nconst indivision = require('./sounds/indivision.mp3')\r\nconst understanding = require('./sounds/understanding.mp3')\r\nconst futureTense = require('./sounds/future tense.mp3')\r\n// const isomer = require('./sounds/isomer.mp3')\r\n// const outbound = require('./sounds/outbound.mp3')\r\n\r\nlet Resources = {\r\n    Sword: new Texture(sword),\r\n\r\n    // CraterRock: new Sound(craterRock),\r\n    Assembler: new Sound(assembler),\r\n    // Indivision: new Sound(indivision),\r\n    // Understanding: new Sound(understanding),\r\n    FutureTense: new Sound(futureTense),\r\n    // Isomer: new Sound(isomer),\r\n    // Outbound: new Sound(outbound),\r\n\r\n\r\n}\r\n\r\nexport { Resources }\r\n","import { Pane } from \"../actors/Hud/Pane\";\r\nimport { Scene, Color, Engine, ParticleEmitter } from \"excalibur\";\r\nimport { assembleButton } from \"../Elemental\";\r\n\r\nclass SceneList extends Pane {\r\n    setup(btns: { label: string, scene: string }[], engine: Engine) {\r\n        btns.forEach(btn => {\r\n            let theButton = assembleButton(btn.label, Color.Blue)\r\n            theButton.onclick = () => {\r\n                engine.goToScene(btn.scene)\r\n                this._element.style.display = 'none'\r\n            }\r\n            this._element.appendChild(theButton)\r\n        })\r\n    }\r\n}\r\n\r\nexport class Menu extends Scene {\r\n    sceneList: SceneList\r\n\r\n    onInitialize() {\r\n        this.sceneList = new SceneList(\r\n            'AD ASTRA: OSIRIS',\r\n            this.engine.halfCanvasWidth - 100, this.engine.halfCanvasHeight - 30\r\n        )\r\n\r\n        this.sceneList.setup([\r\n            { label: 'Play', scene: 'construct' },\r\n            { label: 'Arena', scene: 'arena' }\r\n        ], this.engine)\r\n\r\n        let emitter = new ParticleEmitter(\r\n            this.engine.halfCanvasWidth,\r\n            this.engine.halfCanvasHeight\r\n\r\n        )\r\n        emitter.endColor = Color.Blue //Cyan.darken(0.36);\r\n        emitter.beginColor = Color.White\r\n        emitter.radius = 100\r\n        emitter.minVel = 10\r\n        emitter.maxVel = 150\r\n        emitter.minAngle = 0\r\n        emitter.maxAngle = Math.PI * 2;\r\n        emitter.emitRate = 250 // 300 particles/second\r\n        emitter.opacity = 0.5\r\n        emitter.fadeFlag = true // fade particles overtime\r\n        emitter.particleLife = 6000 // in milliseconds = 1 sec\r\n        emitter.maxSize = 20 // in pixels\r\n        emitter.minSize = 1\r\n        // emitter.beginColor = Color.Red.darken(0.12);\r\n        emitter.isEmitting = true;\r\n        this.add(emitter)\r\n    }\r\n\r\n    draw(ctx, delta) {\r\n        super.draw(ctx, delta)\r\n        this.sceneList.draw(ctx)\r\n    }\r\n}","import { Scene, Vector, LockCameraToActorStrategy, Color } from \"excalibur\";\r\nimport { Citizen } from \"../actors/Citizen\";\r\nimport { Game } from \"../Game\";\r\nimport { Planet } from \"../actors/Planet/Planet\";\r\nimport { World } from \"../models/World\";\r\nimport { Hud } from \"../actors/Hud/Hud\";\r\nimport { Pane } from \"../actors/Hud/Pane\";\r\nimport { assembleButton } from \"../Elemental\";\r\nimport { ENOTEMPTY } from \"constants\";\r\nimport { sample } from \"../Util\";\r\nimport { GameController } from \"../GameController\";\r\n\r\nconst noop = () => { }\r\n\r\nclass SpawnPalette extends Pane {\r\n    constructor(x: number, y: number, spawnFriendly: () => any, spawnEnemy: () => any) {\r\n        super(\"Spawn\", x, y)\r\n        this.makeRootElement()\r\n        let goodGuy = assembleButton('Good guy', Color.Green)\r\n        goodGuy.onclick = spawnFriendly\r\n        this._element.appendChild(goodGuy)\r\n        let badGuy = assembleButton('Bad guy', Color.Red)\r\n        badGuy.onclick = spawnEnemy\r\n        this._element.appendChild(badGuy)\r\n    }\r\n}\r\n\r\n// arenaaaaa\r\nexport class Arena extends Scene {\r\n    planet: Planet\r\n    // defenders: Citizen[] = []\r\n    // enemies: Citizen[] = []\r\n    spawnPalette: SpawnPalette\r\n    floorY: number\r\n\r\n    public onInitialize(game: Game) {\r\n\r\n        let controller = new GameController(game, this.camera)\r\n        controller.activate()\r\n\r\n        let world = new World()\r\n        let hud = new Hud(game)\r\n        this.planet = new Planet(world, hud, noop, noop, 200000, 40000, this)\r\n        this.add(this.planet)\r\n\r\n        this.floorY = this.planet.getTop()\r\n\r\n        this.spawnFriendly()\r\n\r\n\r\n        this.spawnHostile()\r\n\r\n\r\n        this.camera.move(this.planet.population.citizens[0].pos, 1000)\r\n\r\n        this.spawnPalette = new SpawnPalette(100,100,\r\n            this.spawnFriendly, \r\n            this.spawnHostile\r\n        )\r\n    }\r\n\r\n    draw(ctx, delta) {\r\n        super.draw(ctx,delta)\r\n\r\n        this.spawnPalette.draw(ctx)\r\n    }\r\n\r\n    //update(engine, delta) {\r\n    //    super.update(engine, delta)\r\n    //    let notKilled = c => c.alive // && !c.isKilled()\r\n    //    this.defenders = this.defenders.filter(notKilled)\r\n    //    this.enemies = this.enemies.filter(notKilled)\r\n\r\n    //    let defender = this.defenders.find(notKilled)\r\n    //    if (defender) {\r\n    //        this.enemies.forEach(e => {\r\n    //            if (!e.engagedInCombat) {\r\n    //                e.engageHostile(defender)\r\n    //            }\r\n    //        })\r\n    //    }\r\n    //    let enemy = this.enemies.find(notKilled)\r\n    //    if (enemy) {\r\n    //        this.defenders.forEach(d => {\r\n    //            if (!d.engagedInCombat) {\r\n    //                d.engageHostile(enemy)\r\n    //            }\r\n    //        })\r\n    //    }\r\n    //}\r\n\r\n    spawnFriendly = () => {\r\n        let friendly = new Citizen('Good Guy', new Vector((Math.random() * 200) + 800, this.floorY), this.planet, true)\r\n        this.planet.population.citizens.push(friendly)\r\n        this.add(friendly)\r\n\r\n    }\r\n\r\n    spawnHostile = () => {\r\n        let hostile = new Citizen('Bad Guy', new Vector((Math.random() * 200) - 100, this.floorY), this.planet, false, true)\r\n        this.planet.population.raiders.push(hostile)\r\n        this.add(hostile)\r\n\r\n    }\r\n}","import { Machine, Houseplant, Orchard, Bed, OxygenExtractor, WaterCondensingMachine, Codex, Bookshelf, SolarCell, Fridge, Stove, Books, Workstation, Greenhouse, Botany, MineralProcessor, Miner, Table } from \"./Machine\";\r\n\r\nexport enum Discipline {\r\n    Survival = 'Environmental Control',\r\n    Agriculture = 'Food Production',\r\n    LibraryScience = 'Library Science',\r\n    Cooking = 'Food Preparation',\r\n    // PowerGeneration = 'Power Generation',\r\n    // LifeScience = 'Life Sciences',\r\n    // PlasticArts = 'Plastic Arts',\r\n    MineralProduction = 'Mineral Production',\r\n}\r\n\r\nexport interface TechnologyRank {\r\n    name: string\r\n    level: number\r\n    description: string\r\n    prereqs: (typeof Machine)[]\r\n    unlocks: (typeof Machine)[]\r\n}\r\n\r\nexport const disciplineTree: { [key in Discipline]: TechnologyRank[] } = {\r\n    [Discipline.Survival]: [\r\n        { \r\n            name: \"Survival I\",\r\n            level: 1,\r\n            description: \"staying alive\",\r\n            prereqs: [ Bed, SolarCell ],\r\n            unlocks: [ OxygenExtractor, WaterCondensingMachine ]\r\n        },\r\n    ],\r\n\r\n    [Discipline.Agriculture]: [\r\n        // small planter?\r\n        {\r\n            name: 'Food Prod. I',\r\n            level: 1,\r\n            description: \"watch the calories\",\r\n            prereqs: [Botany],\r\n            unlocks: [Houseplant, Greenhouse, Orchard],\r\n        } // Greenhouse...? ] }\r\n    ],\r\n\r\n    [Discipline.Cooking]: [\r\n        {\r\n            name: 'Food Prep. I',\r\n            level: 1,\r\n            description: \"bam\",\r\n            prereqs: [Fridge],\r\n            unlocks: [Stove],\r\n        }\r\n    ],\r\n\r\n    [Discipline.LibraryScience]: [\r\n        {\r\n            name: \"Library Science I\",\r\n            level: 1,\r\n            description: \"try to understand\",\r\n            prereqs: [ Books ],\r\n            unlocks: [ Bookshelf, Workstation, Codex ],\r\n        }\r\n    ],\r\n\r\n    [Discipline.MineralProduction]: [\r\n        {\r\n            name: 'Mineral Production I',\r\n            level: 1,\r\n            description: 'make it work',\r\n            prereqs: [ Table ],\r\n            unlocks: [ Miner, MineralProcessor ],\r\n        }\r\n    ]\r\n\r\n    // [Discipline.LifeScience]: [ \r\n    //     { prereqs: [], unlocks: [ Botany, AlgaeVat ]}\r\n    // ],\r\n\r\n    // [Discipline.PlasticArts]: [\r\n    //     { prereqs: [ Figurine ], unlocks: [ Statue ] }\r\n\r\n    // ],\r\n}\r\n\r\n","import { Machine } from \"./Machine\";\r\nimport { range } from \"../Util\";\r\nimport { Discipline, TechnologyRank, disciplineTree } from \"./TechnologyRank\";\r\n\r\nexport class TechTree {\r\n    currentLevels: {\r\n        [key in Discipline]: number;\r\n    } = {\r\n            [Discipline.Survival]: -1,\r\n            [Discipline.LibraryScience]: -1,\r\n            [Discipline.Agriculture]: -1,\r\n            [Discipline.Cooking]: -1,\r\n            [Discipline.MineralProduction]: -1,\r\n        };\r\n\r\n    findDisciplineToRankUp(machines: (typeof Machine)[]): Discipline {\r\n        for (let disciplineName of Object.keys(Discipline)) {\r\n            let discipline: Discipline = Discipline[disciplineName];\r\n            if (this.canRankUp(discipline, machines)) {\r\n                return discipline;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    rankUp(discipline: Discipline): TechnologyRank {\r\n        this.currentLevels[discipline] += 1;\r\n        return this.currentRank(discipline);\r\n    }\r\n\r\n    private currentRank(discipline: Discipline): TechnologyRank {\r\n        return disciplineTree[discipline][this.currentLevels[discipline]];\r\n    }\r\n\r\n    private canRankUp(discipline: Discipline, machines: (typeof Machine)[]): boolean {\r\n        let level = this.currentLevels[discipline];\r\n        let nextLevel: TechnologyRank = disciplineTree[discipline][level + 1];\r\n        if (nextLevel) {\r\n            if (nextLevel.prereqs.every(machine => machines.includes(machine))) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    allUnlockedMachines(): (typeof Machine)[] {\r\n        let unlocked = [];\r\n        for (let disciplineName of Object.keys(Discipline)) {\r\n            unlocked.push(...this.unlockedMachinesFor(Discipline[disciplineName]));\r\n        }\r\n        return unlocked;\r\n    }\r\n\r\n    private unlockedMachinesFor(discipline: Discipline) {\r\n        let tree = disciplineTree[discipline];\r\n        let unlocked = [];\r\n        let level = this.currentLevels[discipline] + 1;\r\n        for (let i in range(level)) {\r\n            unlocked.push(...tree[i].unlocks);\r\n        }\r\n        return unlocked;\r\n    }\r\n}\r\n","import * as ex from 'excalibur';\r\n\r\nexport class Player extends ex.Actor {\r\n  constructor() {\r\n    super();\r\n    this.setWidth(5);\r\n    this.setHeight(5);\r\n    this.x = 5;\r\n    this.y = 5;\r\n    this.color = new ex.Color(255, 255, 255);\r\n  }\r\n}\r\n","import { Actor, Color } from 'excalibur';\r\nimport { range, mixColors } from '../../Util';\r\nimport { drawRect } from '../../Painting';\r\n\r\nclass PlanetBackground extends Actor {\r\n    constructor(y: number, width: number, color: Color) {\r\n        super(0, y, width, 1500, color)\r\n    }\r\n}\r\n\r\nexport class MountainLayers extends PlanetBackground {\r\n    layers: {\r\n        baseY: number,\r\n        // color: Color,\r\n        deltas: number[]\r\n    }[] = []\r\n\r\n    skyColor: Color = Color.Blue.clone()\r\n    layerHeight: number = 80\r\n    layerCount = 1\r\n    peakCount = 1000\r\n\r\n    get peakWidth() {\r\n        return Math.floor(this.getWidth() / this.peakCount)\r\n    }\r\n\r\n    onInitialize() {\r\n        // let min = -this.layerHeight\r\n        for (let layerIndex of range(this.layerCount)) {\r\n            this.layers.unshift({\r\n                baseY: (layerIndex+1) * -this.layerHeight, // - (20 * layerIndex),\r\n                deltas: this.genPeaks(layerIndex)\r\n            })\r\n        }\r\n    }\r\n\r\n    draw(ctx, delta) {\r\n        let wc = this.color.clone() //.lighten(0.1)\r\n        let sc = this.skyColor.clone() //.lighten(0.1)\r\n\r\n        let ndx = 1\r\n        let ls = this.layers.slice()\r\n        for (let layer of ls) {\r\n            let c = mixColors(wc, sc, (ndx / (this.layers.length)))\r\n            this.drawLayer(ctx, layer, c) //.lighten(0.1))\r\n            ndx += 1\r\n        }\r\n    }\r\n\r\n    private drawLayer(ctx, layer, color) {\r\n        let ox = -this.getWidth()/2, oy = this.pos.y + layer.baseY \r\n        let c = color.clone()\r\n\r\n        ctx.beginPath()\r\n        ctx.moveTo(ox, oy)\r\n        let ndx = 0\r\n        for (let delta of layer.deltas) {\r\n            ctx.lineTo(ox + (ndx * this.peakWidth), oy + delta)\r\n            ndx += 1\r\n        }\r\n        ctx.lineTo(ox + (this.peakCount * this.peakWidth), oy)\r\n        ctx.lineTo(ox + (this.peakCount * this.peakWidth), oy + this.layerHeight)\r\n        ctx.lineTo(ox, oy+this.layerHeight)\r\n        ctx.closePath()\r\n        c.a = 1\r\n        ctx.fillStyle = c.toRGBA()\r\n        ctx.fill()\r\n    }\r\n\r\n    private genPeaks(n) {\r\n        let dMax = 2*(this.layerHeight/3)\r\n        let deltas = []\r\n        let randomDelta = () => (Math.random() * (dMax)) - (dMax/2)\r\n        let last = 0\r\n        let maxDiff = 15 // + (n*2)\r\n        for (let times in range(this.peakCount)) {\r\n            let curr = randomDelta()\r\n            let pick = Math.max(\r\n                   last - maxDiff,\r\n                   Math.min(curr, last + maxDiff),\r\n               )\r\n            deltas.push(\r\n               pick\r\n            )\r\n            last = pick\r\n        }\r\n        return deltas\r\n    }\r\n}\r\n\r\nexport class Mountains extends PlanetBackground {\r\n    peaks: {\r\n        x: number;\r\n        height: number;\r\n    }[] = [];\r\n    onInitialize() {\r\n        let peakCount = 9\r\n        let peakHeight = 800\r\n        let xOff = this.getWidth() / 2\r\n        let peakDistance = this.getWidth() / peakCount\r\n        // for (let times of range(2)) {\r\n        let heightRange = 100\r\n        let drift = 3 * (peakDistance / 2)\r\n        for (let i of range(peakCount)) {\r\n            let h = Math.max(400, 200 + (Math.random() * peakHeight) + ((Math.random() * heightRange) - (heightRange / 2))) //(Util.randomIntInRange(-160,160))\r\n            this.peaks.push({\r\n                x: Math.min(this.getWidth() / 2 - h / 2, -xOff + i * peakDistance + ((Math.random() * drift))), // - (drift / 2)),\r\n                height: h\r\n            })\r\n        }\r\n        // }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let baseColor = this.color.desaturate(0.35)\r\n        let brightColor = baseColor.lighten(0.1)\r\n        ctx.fillStyle = baseColor.toRGBA()\r\n        let yBase = this.pos.y-3\r\n        this.peaks.forEach(peak => {\r\n            let y0 = yBase - peak.height;\r\n            let mtnWidth = peak.height * 3.4;\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x - mtnWidth, yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n\r\n            ctx.fillStyle = baseColor.toRGBA()\r\n            ctx.fill();\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x + 3*(mtnWidth/4), yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n            ctx.fillStyle = brightColor.toRGBA()\r\n            ctx.fill();\r\n\r\n        });\r\n    }\r\n}","import { Actor, Color } from 'excalibur';\r\nimport { mixColors } from '../../Util';\r\nimport { Mountains, MountainLayers } from './PlanetBackground';\r\nexport class SkyLayer extends Actor {\r\n    mountains: Mountains;\r\n    mountainLayers: MountainLayers;\r\n    backMountainLayers: MountainLayers;\r\n    constructor(y: number, width: number, lo: Color, hi: Color) {\r\n        super(0, y, width, 1500); //width,1500) //height)\r\n        let mid = mixColors(lo, hi);\r\n        this.backMountainLayers = new MountainLayers(-60, width, mid);\r\n        this.backMountainLayers.skyColor = hi;\r\n        this.add(this.backMountainLayers);\r\n        this.mountains = new Mountains(0, width, mid);\r\n        this.add(this.mountains);\r\n        this.mountainLayers = new MountainLayers(0, this.getWidth(), lo);\r\n        this.mountainLayers.skyColor = mid;\r\n        this.add(this.mountainLayers);\r\n    }\r\n    setLoHi(lo: Color, hi: Color) {\r\n        let mid = mixColors(lo, hi);\r\n        this.backMountainLayers.color = mid;\r\n        this.backMountainLayers.skyColor = hi;\r\n        this.mountains.color = mid;\r\n        this.mountainLayers.color = lo;\r\n        this.mountainLayers.skyColor = mid;\r\n    }\r\n}\r\n","import { Actor, Color } from 'excalibur';\r\nimport { range, mixColors } from '../../Util';\r\nimport { SkyLayer } from \"./SkyLayer\";\r\nexport class SkyLayers extends Actor {\r\n    layers: SkyLayer[] = [];\r\n    constructor(y: number, width: number, private lo: Color, hi: Color, private layerCount: number = 5) {\r\n        super(0, y, width, 1500);\r\n        for (let i of range(layerCount)) {\r\n            let c0 = mixColors(lo, hi, (i / (layerCount + 1)));\r\n            let c1 = mixColors(lo, hi, ((i + 1) / (layerCount + 1)));\r\n            let layer = new SkyLayer(-20 - (50 * (layerCount - i - 1)), this.getWidth(), c1, c0);\r\n            this.layers.push(layer);\r\n            this.add(layer);\r\n        }\r\n    }\r\n    setHi(hi: Color) {\r\n        let lo = this.lo;\r\n        for (let i of range(this.layerCount)) {\r\n            let c0 = mixColors(lo, hi, (i / (this.layerCount + 1)));\r\n            let c1 = mixColors(lo, hi, ((i + 1) / (this.layerCount + 1)));\r\n            this.layers[i].setLoHi(c1, c0);\r\n            // let layer = new SkyLayer(-100 * (layerCount-i-1), this.getWidth(), c1, c0)\r\n        }\r\n    }\r\n}\r\n","import { Actor, Color, CollisionType } from \"excalibur\";\r\nimport { Game } from \"../Game\";\r\nimport { Citizen } from \"./Citizen\";\r\n\r\nexport class LaserBeam extends Actor {\r\n    private evil: boolean\r\n    constructor(private source: Citizen, private targetDirectionSign: number) {\r\n        super(\r\n            source.pos.x + 42 * targetDirectionSign,\r\n            source.pos.y - 10,\r\n            18,\r\n            1 //0.8\r\n        )\r\n\r\n        this.evil = source.isEvil\r\n\r\n        this.color = (this.evil ? Color.Green : Color.Cyan).clone().lighten(0.3)\r\n        this.vel.x = Game.bulletSpeed * targetDirectionSign\r\n        this.vel.y = (Math.random() * 10) - 5\r\n        this.on('collisionstart', (collision) => {\r\n            // console.log(\"COLLISION\", { collision })\r\n            if (collision.other instanceof Citizen) {\r\n                if (collision.other.alive && this.evil !== collision.other.isEvil) {\r\n                    if (collision.other.guarding) { \r\n                        this.vel.x = -this.vel.x\r\n                        this.evil = !this.evil \r\n                        // this.\r\n                        // bullet.kill() // absorb..\r\n                    } else if (Math.random() > 0.3) {\r\n                        // console.log(\"someone got hit!\", { person: collision.other.name })\r\n                        this.kill()\r\n                        collision.other.injure(6 + (Math.random() * 4), this.source)\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        this.collisionType = CollisionType.Passive\r\n    }\r\n\r\n    // private get evil() { return this.source.isEvil }\r\n}","import { Strategy } from \"./Strategy\";\r\n\r\nexport abstract class CombatStrategy extends Strategy {}","import { CombatStrategy } from \"./CombatStrategy\";\r\nimport { minBy, closest, sleep } from \"../Util\";\r\nimport { Citizen } from \"../actors/Citizen\";\r\n\r\nexport class AttackNearestHostileStrategy extends CombatStrategy {\r\n    vigilanceRange: number = 2000\r\n\r\n    protected async apply() {\r\n        if (!this.pawn.engagedInCombat) {\r\n            let target = closest(this.pawn.pos, this.hostiles.filter(h => h.alive), (h) => h.pos)\r\n            if (target) {\r\n                this.pawn.log(\"found new target\")\r\n                this.pawn.engageHostile(target)\r\n            } else {\r\n                this.pawn.log(\"no new targets?\")\r\n            }\r\n        } else {\r\n            let enemy = this.pawn.enemyCombatant\r\n            let dy = Math.abs(this.pawn.pos.y - enemy.y)\r\n            if (dy > 40) {\r\n                await this.seek(enemy)\r\n            } else if (this.pawn.withinFiringRange()) {\r\n                await this.attack()\r\n            } else {\r\n                await this.pawn.advanceTowardsEnemy()\r\n            }\r\n        }\r\n    }\r\n\r\n    private async seek(enemy: Citizen) {\r\n        const path = this.planet.pathBetweenPoints(this.pawn.pos.clone(), enemy.pos.clone());\r\n        if (path[1]) {\r\n            await this.pawn.glideTo(path[1]);\r\n        }\r\n        let dy = Math.abs(this.pawn.pos.y - enemy.y)\r\n        if (dy > 40 && path[2]) {\r\n            await this.pawn.glideTo(path[2]);\r\n        }\r\n    }\r\n\r\n    async attack() {\r\n        this.pawn.y = this.pawn.enemyCombatant.y\r\n        if (!(this.pawn.guarding || this.pawn.firing)) {\r\n            await sleep(Math.random() * 150)\r\n            if (this.pawn.isEvil || Math.random() > 0.5 || (this.pawn.health > 90)) {\r\n                await this.pawn.fire()\r\n            } else {\r\n                await this.pawn.guard()\r\n            }\r\n        }\r\n    }\r\n\r\n    canApply(): boolean {\r\n        return this.hostiles.some(hostile =>\r\n            this.pawn.pos.distance(hostile.pos) < this.vigilanceRange)\r\n    }\r\n\r\n    get hostiles() {\r\n        return this.pawn.isEvil\r\n            ? this.planet.population.citizens\r\n            : this.planet.population.raiders\r\n    }\r\n}","import { Strategy } from \"./Strategy\";\r\n\r\nexport abstract class EatingStrategy extends Strategy {}","import { EatingStrategy } from \"./EatingStrategy\";\r\nimport { ResourceBlock } from \"../models/Economy\";\r\n\r\nexport class WhenHungryEatingStrategy extends EatingStrategy {\r\n    canApply(): boolean {\r\n        return this.pawn.isHungry &&\r\n            this.planet.storedResources.includes(ResourceBlock.Meal)\r\n        // hunger > 0.6\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    protected async apply() {\r\n        // find the store with the food! reserve it maybe?\r\n        let fridge = this.devices.find(d => d.machine.operation.type === 'store' &&\r\n          d.machine.operation.stores.includes(ResourceBlock.Meal) &&\r\n          d.product.includes(ResourceBlock.Meal) &&\r\n          !d.reserved\r\n        )\r\n\r\n        if (fridge) {\r\n            fridge.reserved = true\r\n            // take the meal to a desk? (maybe need table here... or eatingSurface aspect?)\r\n            await this.visitDevice(fridge)\r\n            await fridge.interact(this.pawn, { type: 'retrieve', resource: ResourceBlock.Meal })\r\n            fridge.reserved = false\r\n\r\n            let desk = this.devices.find(d => d.machine.isEatingSurface) // instanceof Desk)\r\n            if (desk) {\r\n                await this.visitDevice(desk)\r\n            }\r\n            await this.pawn.eat()\r\n            // fridge.interac\r\n            // this.pawn.interact()\r\n        }\r\n    }\r\n    \r\n    \r\n}","import { Strategy } from \"./Strategy\";\r\n\r\nexport abstract class SleepingStrategy extends Strategy {\r\n\r\n}","import { SleepingStrategy } from \"./SleepingStrategy\";\r\nimport { Bed } from \"../models/Machine\";\r\nimport { shuffle } from \"../Util\";\r\n\r\nexport class AnyBedSleepingStrategy extends SleepingStrategy {\r\n    canApply(): boolean {\r\n        if (!this.bed) {\r\n            // no available beds..\r\n            return false\r\n        }\r\n\r\n        if (this.planet.population.raiders.some(raider => raider.pos.distance(this.pawn.pos) < 1000)) {\r\n            // you can't sleep now!\r\n            return false\r\n        }\r\n\r\n        if (this.pawn.health < 100) {\r\n            return true\r\n        }\r\n\r\n        if (!this.pawn.isTired) {\r\n            return false\r\n        }\r\n\r\n        let bedtime = this.planet.hour > 21 || this.planet.hour < 4\r\n        return bedtime\r\n    }\r\n\r\n    protected async apply() {\r\n        // find a bed\r\n        // let bed = shuffle(this.devices).find(d => d.machine instanceof Bed && !d.inUse)\r\n        let bed = this.bed\r\n        if (bed) {\r\n            bed.inUse = true\r\n            await this.visitDevice(bed)\r\n        // }\r\n            await this.pawn.takeRest() //1000 * 24)\r\n        // if (bed) { \r\n            bed.inUse = false\r\n        }\r\n        return true\r\n    }\r\n\r\n\r\n    private get bed() {\r\n        return shuffle(this.devices).find(d => d.machine instanceof Bed && !d.inUse)\r\n    }\r\n}","import { Strategy } from \"./Strategy\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { containsUniq } from \"../Util\";\r\n\r\nexport abstract class ConstructionStrategy extends Strategy {\r\n    canApply(): boolean {\r\n        return !!this.unbuiltDevice\r\n    }\r\n\r\n    get unbuiltDevice() {\r\n        const isUnbuilt = (d: Device) => !d.built && !d.inUse && d.building.isActive &&\r\n          // the player can TRY to build it, we don't have to hang forever on it though\r\n          containsUniq(this.planet.storedResources, d.machine.cost)\r\n        return this.planet.colony.findAllDevices().find(isUnbuilt)\r\n    }\r\n}","import { ConstructionStrategy } from \"./ConstructionStrategy\";\r\nimport { Device } from \"../actors/Device\";\r\n\r\nexport class ProxmityBasedConstruction extends ConstructionStrategy {\r\n    async apply() {\r\n        if (this.unbuiltDevice && this.unbuiltDevice.building) {\r\n            await this.constructDevice(this.unbuiltDevice)\r\n        }\r\n        await this.pause()\r\n    }\r\n\r\n    private async constructDevice(device: Device) {\r\n        device.inUse = true\r\n        let resources = device.machine.cost\r\n        if (await this.gatherIngredients(resources)) {\r\n            await this.visitDevice(device)\r\n            await device.assemble(this.pawn)\r\n        } \r\n\r\n        device.inUse = false\r\n    }\r\n}","import { ResourceBlock } from \"../models/Economy\";\r\n\r\nimport { Recipe } from \"../models/MechanicalOperation\";\r\n\r\nexport interface RetrieveResource {\r\n    type: 'retrieve'\r\n    resource: ResourceBlock\r\n    // count: number\r\n}\r\n\r\nexport interface WorkRecipe {\r\n    type: 'work'\r\n    recipe: Recipe\r\n}\r\n\r\nexport interface StoreResource {\r\n    type: 'store'\r\n    resource: ResourceBlock\r\n}\r\n\r\nexport interface DriveAround {\r\n    type: 'drive'\r\n}\r\n\r\nexport function retrieveResource(res: ResourceBlock): RetrieveResource {\r\n    return {\r\n        type: 'retrieve',\r\n        resource: res,\r\n        // count: 1\r\n    }\r\n}\r\n\r\nexport function drive(): DriveAround {\r\n    return { type: 'drive' }\r\n}\r\n\r\nexport type InteractionRequest = StoreResource | RetrieveResource | WorkRecipe | DriveAround\r\n\r\n","import { Device } from \"../actors/Device\";\r\nimport { MechanicalOperation, Recipe } from \"../models/MechanicalOperation\";\r\nimport { ResourceBlock } from \"../models/Economy\";\r\nimport { retrieveResource } from \"../values/InteractionRequest\";\r\nimport { Strategy } from \"./Strategy\";\r\n\r\nexport abstract class ProductionStrategy extends Strategy {\r\n\r\n    protected async storeBlock(res: ResourceBlock) {\r\n        let stored = false\r\n        let tries = 0\r\n        while (!stored && tries < 30) {\r\n            tries++\r\n            if (await this.tryStoreBlock(res)) {\r\n                stored = true\r\n            } else {\r\n                await this.pause()\r\n            }\r\n        }\r\n    }\r\n\r\n    private async tryStoreBlock(res: ResourceBlock): Promise<boolean> {\r\n        let storesDesiredBlock = (d: Device) => d.operation.type === 'store' &&\r\n            d.product.length < d.getEffectiveOperationalCapacity(d.operation) && //operation.capacity &&\r\n            d.operation.stores.includes(res)\r\n        let openStore = this.planet.colony.closestDeviceByType(this.pawn.pos, [], storesDesiredBlock)\r\n        let stored = false\r\n        if (openStore) {\r\n            await this.visitDevice(openStore)\r\n            if (await openStore.interact(this.pawn, { type: 'store', resource: res })) {\r\n                stored = true\r\n            }\r\n        }\r\n\r\n        //if (!stored) {\r\n        //    await this.pause()\r\n        //    // should try agi\r\n        //    // await this.storeBlock(res)\r\n        //}\r\n\r\n        return stored\r\n    }\r\n\r\n}\r\n","import { shuffle, containsUniq } from \"../Util\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { Recipe, ResourceStorage, ExploreForResource } from \"../models/MechanicalOperation\";\r\nimport { ProductionStrategy } from \"./ProductionStrategy\";\r\nimport { Resource } from \"excalibur\";\r\n\r\nexport class CapacityBasedProduction extends ProductionStrategy {\r\n    canApply(): boolean {\r\n        let hasOpenStore = !!(this.findStore())\r\n        return hasOpenStore\r\n    }\r\n\r\n    async apply() {\r\n        let store = this.findStore()\r\n        let recipe = this.findRecipe(store)\r\n        let explorer = this.findExplorer(store)\r\n\r\n\r\n        if (recipe && containsUniq(this.planet.storedResources, recipe.consumes)) {\r\n            if (await this.workRecipe(recipe)) {\r\n                await this.storeBlock(recipe.produces)\r\n            }\r\n        } else if (explorer) {\r\n            if (await this.workExploration(explorer)) {\r\n                await this.storeBlock(explorer.gathers)\r\n            }\r\n        } else {\r\n            // console.warn(\"No recipe or explorer!\")\r\n        }\r\n    }\r\n\r\n    private findStore() {\r\n        const storeWithCapacity = (d: Device) => d.operation.type === 'store' &&\r\n            d.product.length < d.getEffectiveOperationalCapacity(d.operation) //&&\r\n        let store: Device = shuffle(this.devices).find(storeWithCapacity)\r\n        return store\r\n    }\r\n\r\n\r\n    private findRecipe(store: Device): Recipe {\r\n        if (store && store.operation.type === 'store') {\r\n            const storage: ResourceStorage = store.operation\r\n            const recipeForStoredResource = (r: Recipe) => storage.stores.some(stored => r.produces === stored)\r\n            let recipe: Recipe = shuffle(this.recipes).find(recipeForStoredResource)\r\n            return recipe\r\n        }\r\n    }\r\n\r\n    private findExplorer(store: Device): ExploreForResource {\r\n        if (store && store.operation.type === 'store') {\r\n            const storage: ResourceStorage = store.operation\r\n            // console.log(\"Looking for explorer for\", { stored: storage.stores })\r\n            const explorerForStored = (e: ExploreForResource) => storage.stores.some(stored => e.gathers === stored)\r\n            let explorer: ExploreForResource = shuffle(this.explorers).find(explorerForStored)\r\n            // console.log(\"Looked for explorer, found: \", { explorer })\r\n            return explorer\r\n        }\r\n    }\r\n}\r\n","import { Actor, Traits, Scene } from 'excalibur';\r\nimport { Citizen } from '../Citizen';\r\nimport { Planet } from './Planet';\r\nimport { Device } from '../Device';\r\nimport { World } from '../../models/World';\r\n\r\nexport class Population extends Actor {\r\n    citizens: Citizen[] = []\r\n    raiders: Citizen[] = []\r\n\r\n    constructor(private planet: Planet, public scene: Scene) {\r\n        super(0, -planet.getHeight() / 2, 0, 0);\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling));\r\n        console.log(\"in pop ctor, scene is: \", { scene: this.scene })\r\n    }\r\n\r\n    update(engine, delta) {\r\n        // purge...\r\n        let notKilled = c => c.alive // && !c.isKilled()\r\n        this.citizens = this.citizens.filter(notKilled)\r\n        this.raiders = this.raiders.filter(notKilled)\r\n\r\n\r\n    }\r\n\r\n    increase(pos, elite: boolean = false) {\r\n        let citizen = new Citizen(World.nameCitizen(), pos, this.planet, elite);\r\n        citizen.work();\r\n        this.citizens.push(citizen);\r\n        // scene.add?\r\n        if (this.scene) {\r\n            this.scene.add(citizen);\r\n        } else {\r\n            console.warn(\"no scene to add citizen to!?!?\")\r\n        }\r\n    }\r\n}\r\n","import { Graph } from \"../../values/Graph\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Building } from \"../Building\";\r\nimport { minBy } from \"../../Util\";\r\n\r\nexport class NavigationTree {\r\n   graph: Graph<Vector>\r\n\r\n   constructor(root: Building) {\r\n       this.graph = root.graph()\r\n   }\r\n\r\n   seekPath(origin: Vector, dest: Vector): Vector[] {\r\n      return this.graph.shortestPath(origin, dest)\r\n   }\r\n\r\n   closestNode(testNode: Vector) {\r\n       let nodes = this.graph.dfs()\r\n       let closest = minBy(nodes,\r\n           (node: Vector) => Math.abs(testNode.distance(node))\r\n       )\r\n       if (closest) {\r\n           return closest\r\n       }\r\n       return false\r\n   }\r\n\r\n   closestNodeAtSameYCoordinate(testNode: Vector, tol: number = 50) {\r\n       let nodes = this.graph.dfs()\r\n       let closest = minBy(\r\n           nodes.filter((node: Vector) => Math.abs(node.y - testNode.y) < tol),\r\n           (node: Vector) => Math.abs(testNode.distance(node)),\r\n       )\r\n       if (closest) {\r\n           return closest\r\n       }\r\n       return false\r\n   }\r\n}","import { Actor, Vector, Traits, Color } from 'excalibur';\r\nimport { Building } from '../Building';\r\nimport { minBy, flatSingle } from '../../Util';\r\nimport { Structure } from '../../models/Structure';\r\nimport { NavigationTree } from './NavigationTree';\r\nimport { Machine } from '../../models/Machine';\r\nimport { Device } from '../Device';\r\nimport { Game } from '../../Game';\r\n\r\nexport class Colony extends Actor {\r\n    navTree: NavigationTree;\r\n    buildings: Building[] = [];\r\n    currentlyConstructing: Building | Device = null;\r\n\r\n    constructor(x: number, y: number) {\r\n        super(x, y, 0, 0); // 1000, 1000);\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling));\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta);\r\n\r\n        let debugTree = Game.debugPath\r\n        if (this.navTree && debugTree) {\r\n            let edges = this.navTree.graph.edgeList();\r\n            edges.forEach((edge) => {\r\n                let [a,b] = edge;\r\n                var gradient = ctx.createLinearGradient(a.x,a.y+this.pos.y,b.x,b.y+this.pos.y);\r\n\r\n                gradient.addColorStop(0, 'green');\r\n                gradient.addColorStop(1, 'blue');\r\n\r\n                ctx.beginPath()\r\n                ctx.moveTo(a.x, a.y + this.pos.y)\r\n                ctx.lineTo(b.x, b.y + this.pos.y)\r\n                ctx.closePath()\r\n                ctx.strokeStyle = gradient\r\n                ctx.lineWidth = 0.5\r\n                ctx.stroke()\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n\r\n    placeBuilding(building: Building) {\r\n        building.placed = true;\r\n        if (building.parentSlot) {\r\n            building.parentSlot.parent.childrenBuildings.push(building);\r\n            this.buildNavTree();\r\n        }\r\n        this.buildings.push(building);\r\n        building.afterConstruct();\r\n        this.add(building);\r\n    }\r\n\r\n    closestBuildingByType(cursor: Vector, structureTypes: (typeof Structure)[] = [], predicate: (Building) => boolean = () => true): Building {\r\n        let matching = this.buildings\r\n        .filter(building => //predicate(building) &&\r\n            (structureTypes.length > 0\r\n            ? structureTypes.some(st => building.structure instanceof st)\r\n            : true)\r\n             && predicate(building)\r\n        )\r\n\r\n        if (matching && matching.length > 0) {\r\n            let distanceToCursor = (building) => cursor.distance(building.nodes()[0]);\r\n            return minBy(matching, distanceToCursor);\r\n        }\r\n    }\r\n\r\n    pathBetween(origin: Vector, destination: Building): Vector[] {\r\n        if (!this.navTree) {\r\n            this.buildNavTree();\r\n        }\r\n        let srcNode = this.navTree.closestNode(origin);\r\n        let dest = destination.nodes()[0] //.length > 1 ? destination.nodes()[1] : destination.nodes()[0];\r\n        let destNode = this.navTree.closestNode(dest);\r\n        let path = this.navTree.seekPath(srcNode, destNode);\r\n        return path;\r\n    }\r\n\r\n    pathBetweenPoints(origin: Vector, destination: Vector, constrainSourceY: boolean = true): Vector[] {\r\n        if (!this.navTree) {\r\n            this.buildNavTree();\r\n        }\r\n        let srcNode = constrainSourceY ? this.navTree.closestNodeAtSameYCoordinate(origin) : this.navTree.closestNode(origin);\r\n        let dest = destination; //.nodes()[0];\r\n        let destNode = this.navTree.closestNode(dest);\r\n        let path = this.navTree.seekPath(srcNode, destNode);\r\n        // console.log(\"PATH FOUND BTWN POINTS\", { srcNode, destNode, path })\r\n        return path;\r\n    }\r\n\r\n\r\n\r\n    closestDeviceByType(cursor: Vector, machineTypes: (typeof Machine)[] = [], predicate: (Device) => boolean = () => true) {\r\n        let devices = this.findPoweredDevices()\r\n        devices = devices.filter(d => \r\n            (machineTypes.length > 0 ? machineTypes.some(machine => d.machine instanceof machine) : true)\r\n             && predicate(d)\r\n        )\r\n\r\n        if (devices && devices.length > 0) {\r\n            let proximity = (d) => cursor.distance(d.pos.add(d.building.pos))\r\n            return minBy(devices, proximity)\r\n        }\r\n    }\r\n\r\n    get origin() { return this.buildings[0].pos }\r\n\r\n    private buildNavTree() {\r\n        let ctrl = this.buildings[0] //.find(building => building.structure instanceof MissionControl);\r\n        if (ctrl) {\r\n            this.navTree = new NavigationTree(ctrl);\r\n        }\r\n    }\r\n\r\n    findAllDevices(): Device[] {\r\n        return flatSingle(this.buildings.map(b => b.getDevices()))\r\n    }\r\n\r\n    findPoweredDevices(): Device[] {\r\n        return flatSingle(this.activeBuildings.map(b => b.getDevices()))\r\n            .filter(d => d.built) /// ....\r\n    }\r\n\r\n    protected get activeBuildings() {\r\n        return this.buildings.filter(b => b.isActive)\r\n    }\r\n}\r\n","import { Color } from \"excalibur\";\r\nimport { Pane } from \"./Pane\";\r\nimport { Citizen } from \"../Citizen\";\r\nimport { spawn } from \"child_process\";\r\nimport { Game } from \"../../Game\";\r\nimport { WhenHungryEatingStrategy } from \"../../strategies/WhenHungryEatingStrategy\";\r\nimport { assembleButton } from \"../../Elemental\";\r\n\r\nclass CitizenLine {\r\n    private _line: HTMLDivElement\r\n    private button: HTMLButtonElement\r\n    private sleepy: HTMLSpanElement\r\n    private hunger: HTMLSpanElement\r\n    private fighting: HTMLSpanElement\r\n    private followed: boolean = false\r\n    // ...\r\n    constructor(private citizen: Citizen, private onSelect: (Citizen) => any) {\r\n        this.buildLine()\r\n    }\r\n\r\n    get root() { return this._line }\r\n\r\n    update(isFollowed: boolean, hungry: boolean, tired: boolean) {\r\n        if (isFollowed !== this.followed) {\r\n            this.followed = isFollowed\r\n            // rebuild button\r\n            this._line.removeChild(this.button)\r\n            this.button = this.makeButton()\r\n            this._line.appendChild(this.button)\r\n        // this.button.textContent = isFollowed ? 'Following' : 'Follow'\r\n        // this.button.backg clr = Color.DarkGray // followed ? Color.Violet : Color.DarkGray\r\n        }\r\n\r\n\r\n        this.sleepy.style.display = tired ? 'inline' : 'none'\r\n        // this.sleepy.textContent = `tired (${this.citizen.energy.toFixed()})`\r\n        this.hunger.style.display = hungry ? 'inline' : 'none'\r\n        // this.hunger.textContent = `hungry (${this.citizen.hunger.toFixed()})`\r\n\r\n        this.fighting.style.display = this.citizen.engagedInCombat ? 'inline' : 'none'\r\n    }\r\n\r\n    buildLine() {\r\n        this._line = document.createElement('div')\r\n        this._line.style.fontFamily = Game.font\r\n        this._line.style.color = 'white'\r\n        this._line.style.backgroundColor = '#6a6a6a'\r\n        this._line.style.display = 'flex'\r\n        this._line.style.width = '100%'\r\n        this._line.style.justifyContent = 'space-between'\r\n        this._line.style.paddingLeft = '5px'\r\n        this._line.style.fontSize = '7pt'\r\n\r\n        let nameLabel = document.createElement('span')\r\n\r\n        nameLabel.textContent = [this.citizen.title, this.citizen.name].join(' ')\r\n        nameLabel.style.alignSelf = 'center'\r\n        this._line.appendChild(nameLabel)\r\n\r\n        this.hunger = document.createElement('span')\r\n        this.hunger.textContent = 'hungry'\r\n        this.hunger.style.color = 'yellow'\r\n        this.hunger.style.padding = '2px'\r\n        this._line.appendChild(this.hunger)\r\n\r\n        this.sleepy = document.createElement('span')\r\n        this.sleepy.textContent = 'sleepy'\r\n        this.sleepy.style.color = 'blue'\r\n        this.sleepy.style.padding = '2px'\r\n        this._line.appendChild(this.sleepy)\r\n\r\n        this.fighting = document.createElement('span')\r\n        this.fighting.textContent = 'fighting'\r\n        this.fighting.style.color = 'red'\r\n        this.fighting.style.padding = '2px'\r\n        this._line.appendChild(this.fighting)\r\n\r\n\r\n        this.button = this.makeButton()\r\n        this._line.appendChild(this.button)\r\n    }\r\n\r\n    makeButton() {\r\n        let msg = this.followed ? \"Following\" : \"Follow\"\r\n        let clr = this.followed ? Color.Violet : Color.DarkGray\r\n        let button = assembleButton(msg, clr)\r\n        button.style.padding = '15px'\r\n        if (this.onSelect) {\r\n            button.onclick = () => {\r\n                this.onSelect(this.citizen)\r\n            }\r\n        }\r\n        return button\r\n    }\r\n}\r\n\r\nexport class CitizenList extends Pane {\r\n    private citizens: Citizen[] = []\r\n    following: Citizen = null\r\n    private citizenLines: Map<Citizen, CitizenLine> = new Map()\r\n\r\n    constructor(\r\n        x: number,\r\n        y: number,\r\n        private onCitizenSelect: (Citizen) => any = null\r\n    ) {\r\n        super(\"Colony Roster\", x, y);\r\n    }\r\n\r\n    updateRoster(citizens: Citizen[], following: Citizen): any {\r\n        let missingCitizens = citizens.some(c => !this.doesRosterInclude(c))\r\n        let lostCitizens = this.citizens.some(c => !citizens.includes(c))\r\n        if (missingCitizens || lostCitizens) { // rebuild\r\n            this.citizens = citizens\r\n            this.makeRoster()\r\n        }\r\n        // let followedChanged = following !== this.citizenList.following\r\n        this.following = following\r\n        this.updateRosterDetails()\r\n    }\r\n\r\n    updateRosterDetails() {\r\n        this.citizens.forEach(citizen => {\r\n            let line: CitizenLine = this.citizenLines.get(citizen)\r\n            line.update(this.following === citizen, citizen.isHungry, citizen.isTired)\r\n        })\r\n    }\r\n\r\n    doesRosterInclude(citizen) {\r\n        return this.citizens.includes(citizen)\r\n    }\r\n\r\n    private makeRoster() {\r\n        this.makeRootElement();\r\n        this.citizens.forEach(c => this.makeCitizenLine(c))\r\n        // citizen => \r\n        // });\r\n    }\r\n\r\n    private makeCitizenLine(citizen: Citizen) {\r\n        let line = new CitizenLine(citizen, this.onCitizenSelect)\r\n        this.citizenLines.set(citizen, line)\r\n        this._element.appendChild(line.root);\r\n    }\r\n}\r\n","import { Color } from \"excalibur\";\r\nimport { Game } from \"../../Game\";\r\nexport class Modal {\r\n    private _element: HTMLDivElement\r\n\r\n    private _header: HTMLDivElement\r\n    private _body: HTMLDivElement\r\n    private _footer: HTMLDivElement\r\n    // private titleLabel: Label\r\n    // private messageLabel: Label\r\n    constructor(private title: string, private message: string, private x: number, private y: number, private width: number = 500) {\r\n        this.makeDialog();\r\n        // super(x,y,200,200, Color.DarkGray)\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): any {\r\n        // console.log(\"DRAW MODAL\")\r\n        if (this._element) {\r\n            let left = ctx.canvas.offsetLeft - this.width/2;\r\n            let top = ctx.canvas.offsetTop - this._element.clientHeight/2;\r\n            this._element.style.left = `${left + this.x}px`;\r\n            this._element.style.top = `${top + this.y}px`;\r\n        }\r\n    }\r\n\r\n    addButtons(buttonMap: {\r\n        [intent: string]: () => any;\r\n    }) {\r\n        // throw new Error(\"Method not implemented.\");\r\n        let buttons = Object.entries(buttonMap)\r\n        buttons.forEach(([intent, cb]) => {\r\n            let btn = this.buttonFactory(intent, Color.Gray, this.width/(buttons.length))\r\n            btn.onclick = cb\r\n            this._footer.appendChild(btn)\r\n        })\r\n    }\r\n\r\n    teardown() {\r\n        document.body.removeChild(this._element)\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    private makeDialog() {\r\n        this._element = document.createElement('div');\r\n        this._element.style.position = 'absolute';\r\n        this._element.style.display = 'flex';\r\n        this._element.style.flexWrap = 'wrap';\r\n        this._element.style.width = `${this.width}px`;\r\n        this._element.style.border = 'none'; //1px solid black'; //0.5px solid white';\r\n        document.body.appendChild(this._element);\r\n\r\n        let bg = Color.Violet.clone().darken(0.92) //.clone..toRGBA()\r\n        bg.a = 0.3\r\n\r\n        let title = document.createElement('div');\r\n        title.textContent = this.title;\r\n        title.style.fontFamily = Game.font //'Verdana';\r\n        title.style.fontSize = '14pt';\r\n        title.style.fontWeight = '700';\r\n        title.style.textTransform = 'uppercase';\r\n        title.style.textAlign = 'center'\r\n        title.style.width = `${this.width}px`;\r\n        title.style.color = Color.White.toRGBA();\r\n        title.style.backgroundColor = bg.toRGBA() //Color.Violet.darken(0.92).toRGBA();\r\n        title.style.padding = '12px';\r\n        title.style.margin = '0px';\r\n        this._element.appendChild(title);\r\n\r\n        this._header = document.createElement('div')\r\n        this._header.style.width = `${this.width}px`;\r\n        this._header.style.backgroundColor = bg.toRGBA() // Color.Violet.darken(0.92).toRGBA();\r\n        this._element.appendChild(this._header)\r\n\r\n        this._body = document.createElement('div');\r\n        this._body.textContent = this.message;\r\n        this._body.style.fontFamily = Game.font //'Verdana';\r\n        this._body.style.fontSize = '9pt';\r\n        this._body.style.fontWeight = '400';\r\n        this._body.style.width = `${this.width}px`;\r\n        this._body.style.color = Color.White.toRGBA();\r\n        this._body.style.backgroundColor = bg.toRGBA() //Color.Violet.darken(0.92).toRGBA();\r\n        this._body.style.padding = '24px';\r\n        this._body.style.paddingBottom = '48px';\r\n        this._body.style.margin = '0px';\r\n        this._element.appendChild(this._body);\r\n\r\n        this._footer = document.createElement('div')\r\n        this._footer.style.width = `${this.width}px`\r\n        this._footer.style.display = 'flex';\r\n        this._footer.style.flexWrap = 'wrap';\r\n        this._element.appendChild(this._footer)\r\n    }\r\n\r\n    addHeading(heading: string, size: number = 24, color: Color = Color.White) {\r\n        let headerMessage = document.createElement('div');\r\n        headerMessage.textContent = heading;\r\n        headerMessage.style.fontFamily = Game.font // 'Helvetica';\r\n        headerMessage.style.fontSize = `${size}pt`;\r\n        headerMessage.style.fontWeight = '600';\r\n        headerMessage.style.textAlign = 'center';\r\n        headerMessage.style.width = `${this.width}px`;\r\n        headerMessage.style.color = color.clone().toRGBA();\r\n        // headerMessage.style.backgroundColor = Color.Violet.darken(0.8).toRGBA();\r\n        headerMessage.style.padding = '0px';\r\n        headerMessage.style.margin = '0px';\r\n        this._header.appendChild(headerMessage)\r\n    }\r\n\r\n    addIconMatrix(iconSet: { image: string, label: string }[] = []) {\r\n        // build a icon matrix\r\n        let matrix = document.createElement('div')\r\n        matrix.style.display = 'flex'\r\n        matrix.style.flexWrap = 'wrap'\r\n        matrix.style.padding = '15px'\r\n        matrix.style.width = `100%` //${this.width}px`\r\n\r\n        iconSet.forEach(({ label, image }) => {\r\n            let img = new Image()\r\n            img.width = 64\r\n            img.height = 64\r\n            img.src = image\r\n            img.style.padding = '8px'\r\n\r\n            let lbl = document.createElement('span')\r\n            lbl.textContent = label\r\n            lbl.style.textAlign = 'center'\r\n            lbl.style.padding = '8px'\r\n            lbl.style.fontSize = '6pt'\r\n            lbl.style.fontFamily = Game.font\r\n\r\n            let icon = document.createElement('div')\r\n            icon.style.display = 'flex'\r\n            icon.style.flexDirection = 'column'\r\n            icon.style.padding = '4px'\r\n            icon.appendChild(img)\r\n            icon.appendChild(lbl)\r\n            \r\n            matrix.appendChild(icon)\r\n\r\n        })\r\n\r\n        this._body.appendChild(matrix)\r\n    }\r\n\r\n    private buttonFactory(label: string, color: Color = Color.DarkGray, width: number = this.width/2) {\r\n        let bg = color.darken(0.5).desaturate(0.5).clone();\r\n        bg.a = 0.8;\r\n        let fg = color.lighten(0.8).desaturate(0.4).clone();\r\n        let modalButton = document.createElement('button');\r\n        modalButton.textContent = label;\r\n        modalButton.style.display = 'block';\r\n        modalButton.style.fontSize = '7pt';\r\n        modalButton.style.fontFamily = Game.font //'Verdana';\r\n        modalButton.style.fontWeight = '500';\r\n        modalButton.style.padding = '20px';\r\n        modalButton.style.width = `${width}px`;\r\n        modalButton.style.textTransform = 'uppercase';\r\n        modalButton.style.border = 'none'; //1px solid rgba(255,255,255,0.08)';\r\n        modalButton.style.background = bg.toRGBA();\r\n        modalButton.style.color = fg.toRGBA();\r\n        modalButton.onmouseover = () => {\r\n            modalButton.style.background = bg.saturate(0.5).lighten(0.95).toRGBA();\r\n            modalButton.style.color = fg.lighten(0.9).toRGBA();\r\n        };\r\n        modalButton.onmouseleave = () => {\r\n            modalButton.style.background = bg.toRGBA();\r\n            modalButton.style.color = fg.toRGBA();\r\n        };\r\n        return modalButton;\r\n    }\r\n}\r\n","import { Color } from \"excalibur\";\r\nimport { EntityKind } from \"../../values/Entity\";\r\nimport { onlyUnique } from \"../../Util\";\r\nimport { Pane } from \"./Pane\";\r\nimport { assembleButton } from \"../../Elemental\";\r\n\r\nexport class Palette extends Pane {\r\n    built: EntityKind[] = [];\r\n    comprehended: EntityKind[] = [];\r\n\r\n    constructor(\r\n        name: string,\r\n        x: number,\r\n        y: number,\r\n        private all: EntityKind[],\r\n        private onButtonClick: (EntityKind) => any = null,\r\n        private onButtonEnter: (EntityKind) => any = null,\r\n        private comprehend = true \r\n    ) {\r\n        super(name, x, y)\r\n        this.makePalette();\r\n    }\r\n\r\n\r\n    updateBuilt(built: (EntityKind)[], unlocked: (EntityKind)[] = []) {\r\n        this.built = built;\r\n        if (this.comprehend) {\r\n            let nowComprehended = this.all.filter((e: EntityKind) => {\r\n                let s = new e();\r\n                let prereqs: (EntityKind)[] = s.prereqs;\r\n                return prereqs.every((prereq: EntityKind) => {\r\n                    let built = this.built.some((s: EntityKind) => s === prereq);\r\n                    return built;\r\n                });\r\n            });\r\n            this.comprehended = [\r\n                ...nowComprehended,\r\n                ...unlocked\r\n            ].filter(onlyUnique)\r\n        } else {\r\n            this.comprehended = [ ...this.built, ...unlocked ].filter(onlyUnique)\r\n        }\r\n        this.makePalette();\r\n    }\r\n\r\n    private makePalette() {\r\n\r\n        this.makeRootElement()\r\n\r\n\r\n        this.comprehended\r\n            .map((elem: EntityKind) => new elem())\r\n            .sort((a, b) => a.color > b.color ? -1 : 1)\r\n            .forEach(elem => {\r\n                if (elem.hide) { return }\r\n                let label = elem.name;\r\n                if (!this.built.map(m => new m().name).includes(elem.name)) {\r\n                    label += ' *';\r\n                }\r\n                let clr = elem.color;\r\n                let btn = assembleButton(label, clr);\r\n                this._element.appendChild(btn);\r\n                if (this.onButtonEnter) {\r\n                    btn.onmouseenter = () => { this.onButtonEnter(elem); };\r\n                }\r\n                if (this.onButtonClick) {\r\n                    btn.onclick = () => { this.onButtonClick(elem); };\r\n                }\r\n            });\r\n    }\r\n\r\n}\r\n","import { Label, Actor, FontStyle, Color } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nimport { PureValue, Economy, ResourceBlock } from \"../../models/Economy\";\r\nimport { RoomRecipe } from \"../../models/RoomRecipe\";\r\nimport { Building } from \"../Building\";\r\nimport { Device } from \"../Device\";\r\nimport { countOccurrences, flatSingle } from \"../../Util\";\r\nimport { Game } from \"../../Game\";\r\n\r\nexport class CardBody extends Actor {\r\n    description: Label\r\n    values: Label\r\n    notes: Label\r\n    footer: Label\r\n\r\n    constructor(private entity: Machine | Structure | RoomRecipe | Building | Device, x: number, y: number) {\r\n        super(x, y, 0, 0)\r\n        // resources / recipes\r\n\r\n        this.values = new Label('', 0, 0, Game.font)\r\n        this.values.fontSize = 10\r\n        this.add(this.values)\r\n\r\n        this.notes = new Label('behavioral notes', 0, 30, Game.font)\r\n        this.notes.fontSize = 11\r\n        this.add(this.notes)\r\n\r\n        this.description = new Label('description', 0, 60, Game.font)\r\n        this.description.fontSize = 12\r\n        this.description.fontStyle = FontStyle.Italic\r\n        this.description.color = Color.DarkGray\r\n        this.add(this.description)\r\n\r\n        this.footer = new Label('footer', 20, 80, Game.font)\r\n        this.footer.fontSize = 10\r\n        this.footer.fontStyle = FontStyle.Italic\r\n        this.add(this.footer)\r\n\r\n        this.show(entity)\r\n    }\r\n\r\n    describeResources = (arr: ResourceBlock[]) => {\r\n        let freqs = countOccurrences(arr)\r\n        return Object.keys(freqs)\r\n            .map(elem => `${elem} x${freqs[elem]}`)\r\n            .join(' + ')\r\n    }\r\n\r\n    show(entity: Machine | Structure | RoomRecipe | Building | Device) {\r\n        if (entity) {\r\n            this.description.text = entity.description;\r\n\r\n            if (entity instanceof Machine || entity instanceof Device) {\r\n                this.values.text =  this.describeEconomy(entity.economy)\r\n                // let footerNotes = []\r\n                let resourceDescription = entity instanceof Machine\r\n                    ? `Cost: ${this.describeResources(entity.cost)}`\r\n                    : (entity.built ? this.describeResources(entity.product) : 'under construction')\r\n                let forDome = entity instanceof Machine ? entity.forDome : entity.machine.forDome\r\n                let domeStatus = `For Dome: ${forDome ? 'Yes' : 'No'}`\r\n                this.footer.text = resourceDescription === ''\r\n                    ? domeStatus\r\n                    : [resourceDescription, domeStatus].join(' | ') \r\n                this.notes.text = '' //\r\n                let op = entity.operation\r\n                if (op) {\r\n                    if (op.type === 'recipe') {\r\n                        this.notes.text = `Turns ${op.consumes.join(' + ')} -> ${op.produces}.`\r\n                    } else if (op.type === 'generator') {\r\n                        this.notes.text = `Generates ${op.generates}.`\r\n                    } else if (op.type === 'store') {\r\n                        this.notes.text = `Stores ${op.stores.join(' + ')}`\r\n                    } else if (op.type === 'spawn') {\r\n                        this.notes.text = 'Decants clones.'\r\n                    }\r\n                }\r\n            } else if (entity instanceof RoomRecipe) {\r\n                let { capacity, workSpeed } = entity.bonuses\r\n                let bonusMessages = [];\r\n                if (capacity > 0) {\r\n                    bonusMessages.push(`+${capacity} cap`)\r\n                }\r\n                if (workSpeed > 1.0) {\r\n                    bonusMessages.push(`+${Math.floor((workSpeed*100)-100)}% efficiency` )\r\n                }\r\n                this.values.text = bonusMessages.join('; ') \r\n                this.notes.text = entity.machines.map(m => (new m()).name).join(' + ')\r\n                this.footer.text = ''\r\n            } else if (entity instanceof Building) {\r\n                this.values.text =  this.describeEconomy(entity.economy(false))\r\n                this.notes.text = entity.getDevices().map(d => d.machine.name).join(' + ')\r\n\r\n                let product = entity.getDevices()\r\n                    .map(d => d.product)\r\n                    .reduce((a, b) => a.concat(b), [])\r\n                this.footer.text = product.length > 0\r\n                    ? \"Currently contains: \" + this.describeResources(product)\r\n                    : ''\r\n            } else {\r\n                this.values.text = ''\r\n                this.notes.text = ''\r\n                this.footer.text = ''\r\n            }\r\n\r\n        }\r\n        // other bonuses? behaviors?\r\n    }\r\n\r\n    private describeEconomy(e: Economy): string {\r\n        let values = []\r\n        let econ = e // entity.economy\r\n        for (let value in PureValue) {\r\n            let { supply, demand } = econ[value]\r\n            let delta = supply - demand\r\n            if (delta > 0) {\r\n                values.push(`+${delta.toFixed()} ${value}`)\r\n            } else if (delta < 0) {\r\n                values.push(`${delta.toFixed()} ${value}`)\r\n            }\r\n        }\r\n        return values.join(' | ')\r\n    }\r\n}\r\n","import { Label, Color, Actor, FontStyle } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\nimport { RoomRecipe } from \"../../models/RoomRecipe\";\r\nimport { Building } from \"../Building\";\r\nimport { Device } from \"../Device\";\r\nimport { Game } from \"../../Game\";\r\nexport class CardTitle extends Actor {\r\n    \r\n    name: Label;\r\n    type: Label;\r\n    constructor(private entity: Machine | Structure | RoomRecipe | Building | Device, x: number, y: number) {\r\n        super(x, y, 14, 32, entity && entity.color || Color.Gray);\r\n        this.name = new Label(entity && entity.name || '..', 20, 16, Game.font)\r\n        this.name.fontSize = 28\r\n        this.name.color = Color.Black\r\n        this.add(this.name)\r\n\r\n        this.type = new Label('..', 220, 18, Game.font)\r\n        this.type.fontSize = 10\r\n        this.type.color = Color.Gray\r\n        this.type.fontStyle = FontStyle.Italic\r\n        this.add(this.type)\r\n\r\n        if (entity) {\r\n            this.announce(entity)\r\n        }\r\n    }\r\n\r\n    announce(entity: Machine | Structure | RoomRecipe | Building | Device): any {\r\n        this.name.text = entity.name\r\n        this.color = entity.color.desaturate(0.5).darken(0.2)\r\n        if (entity instanceof Machine) { this.type.text = `${DeviceSize[entity.size]} Machine Type` }\r\n        if (entity instanceof Structure) { this.type.text = 'Structure' }\r\n        if (entity instanceof RoomRecipe) { this.type.text = 'Function' }\r\n        if (entity instanceof Building) { this.type.text = 'Building' }\r\n        if (entity instanceof Device) { this.type.text = `${DeviceSize[entity.size]} Machine` }\r\n    }\r\n}\r\n","import { Color, Actor } from \"excalibur\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport { Machine } from \"../../models/Machine\";\r\nimport { CardTitle } from \"./CardTitle\";\r\nimport { CardBody } from \"./CardBody\";\r\nimport { RoomRecipe } from \"../../models/RoomRecipe\";\r\nimport { Building } from \"../Building\";\r\nimport { Device } from \"../Device\";\r\n\r\nexport class Card extends Actor {\r\n    title: CardTitle\r\n    cardBody: CardBody\r\n    image: HTMLImageElement\r\n\r\n    constructor(private entity: Machine | Structure | RoomRecipe | Building | Device, x: number, y: number) {\r\n        super(x + 160, y + 90, 320, 180, Color.White);\r\n        let x0 = -150, y0 = -50;\r\n        this.title = new CardTitle(entity, x0 - 3, y0); //x, y)\r\n        this.add(this.title);\r\n        this.cardBody = new CardBody(entity, x0 + 14, y0 + 40)\r\n        this.add(this.cardBody)\r\n\r\n        this.image = new Image();\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta) {\r\n        super.draw(ctx, delta)\r\n        if (this.entity) {\r\n            if (this.entity instanceof Machine || this.entity instanceof Device) {\r\n                // if (this.image.src !== null) {\r\n                    let ix = this.pos.x + 48, iy = this.pos.y - 16\r\n                    let isz = 92\r\n\r\n                    // maybe try-fail around this? something for painting?\r\n                    ctx.drawImage(this.image, ix, iy, isz, isz)\r\n                // }\r\n            }\r\n        }\r\n    }\r\n\r\n    present(entity: Machine | Structure | RoomRecipe | Building | Device): any {\r\n        this.title.announce(entity)\r\n        this.cardBody.show(entity)\r\n\r\n        this.entity = entity\r\n        let src = null\r\n        if (this.entity instanceof Machine) { //} || this.entity instanceof Device) {\r\n            src = this.entity.image\r\n        } else if (this.entity instanceof Device) {\r\n            src = this.entity.machine.image\r\n        }\r\n        // console.log(\"img src\", { src })\r\n        if (src) {\r\n            this.image.src = src\r\n        }\r\n    }\r\n\r\n}\r\n","import { Sound, Color } from \"excalibur\";\r\nimport { sample } from \"../../Util\";\r\nimport { Game } from \"../../Game\";\r\n\r\ninterface MusicPlayerPlay { type: 'play'}\r\ninterface MusicPlayerPause { type: 'pause'}\r\ninterface MusicPlayerStop { type: 'stop'}\r\ninterface MusicPlayerNext { type: 'next'}\r\ntype MusicPlayerAction = MusicPlayerPlay | MusicPlayerPause | MusicPlayerStop | MusicPlayerNext\r\n\r\nexport class MusicPlayer {\r\n    private _wrapper: HTMLDivElement;\r\n    private _element: HTMLDivElement;\r\n    private _titleElem: HTMLSpanElement;\r\n\r\n    currentTrack: string\r\n    paused: boolean = false\r\n\r\n    constructor(private x: number, private y: number, private playlist: {\r\n        [track: string]: Sound;\r\n    }) {\r\n        this.makePlayer();\r\n        setTimeout(() => { this.startMusic() }, 3000)\r\n        this._titleElem.textContent = `Getting ready...`;\r\n        this.currentTrack = sample(Object.keys(this.playlist)); //[0];\r\n    }\r\n\r\n    startMusic() {\r\n        this._titleElem.textContent = `Playing: ${this.currentTrack}`;\r\n        this.playlist[this.currentTrack].play()\r\n        .then(() => {\r\n                this.advancePlaylist()\r\n        })\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D) {\r\n        if (this._element) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._wrapper.style.left = `${left + this.x}px`;\r\n            this._wrapper.style.top = `${top + this.y}px`;\r\n        }\r\n    }\r\n\r\n    private makePlayer() {\r\n        this._wrapper = document.createElement('div')\r\n        this._wrapper.style.position = 'absolute'\r\n        this._wrapper.style.width = '20%'\r\n        this._wrapper.style.maxHeight = '20px'\r\n        this._wrapper.style.textAlign = 'left'\r\n        this._wrapper.style.border = 'none';\r\n        this._wrapper.style.overflow = 'hidden';\r\n        document.body.appendChild(this._wrapper);\r\n\r\n        this._element = document.createElement('div');\r\n        this._element.style.display = 'inline-block';\r\n        this._element.style.border = 'none';\r\n        this._wrapper.appendChild(this._element)\r\n\r\n        this._titleElem = document.createElement('span');\r\n        this._titleElem.style.fontFamily = Game.font //'Verdana';\r\n        this._titleElem.style.fontSize = '7pt';\r\n        this._titleElem.style.padding = '24px'\r\n        this._titleElem.style.color = 'white';\r\n        this._wrapper.appendChild(this.inlineBlock(this._titleElem));\r\n\r\n        let play = this.iconFactory({ type: 'play' }, '&#9655;')\r\n        this._wrapper.appendChild(this.inlineBlock(play));\r\n\r\n        let pause = this.iconFactory({ type: 'pause' }, '&#10072; &#10072;')\r\n        this._wrapper.appendChild(this.inlineBlock(pause))\r\n\r\n        let next = this.iconFactory({ type: 'next' }, '&rarr;')\r\n        this._wrapper.appendChild(this.inlineBlock(next))\r\n\r\n    }\r\n\r\n    handleAction(action: MusicPlayerAction) {\r\n        if (action.type === 'pause') {\r\n            this.song.pause()\r\n            this.paused = true\r\n            this._titleElem.textContent = `Paused: ${this.currentTrack}`;\r\n        } else if (action.type === 'play') {\r\n            this.song.play()\r\n            this.paused = false\r\n            this._titleElem.textContent = `Playing: ${this.currentTrack}`;\r\n        } else if (action.type === 'next') {\r\n            if (this.paused) {\r\n                this.song.play()\r\n                this.paused = false\r\n            }\r\n            this.song.stop()\r\n        }\r\n    }\r\n\r\n    advancePlaylist() {\r\n        let ndx = this.trackNames.indexOf(this.currentTrack)\r\n        ndx = (ndx + 1) % this.trackNames.length\r\n        this.currentTrack = this.trackNames[ndx]\r\n        this.startMusic()\r\n    }\r\n\r\n    get trackNames() { return Object.keys(this.playlist) }\r\n    get song() { return this.playlist[this.currentTrack] }\r\n\r\n    private inlineBlock(elem) {\r\n        let block = document.createElement('div');\r\n        block.style.display = 'inline-block';\r\n        block.style.border = 'none';\r\n        block.append(elem)\r\n        return block\r\n    }\r\n\r\n    private iconFactory(\r\n        action: MusicPlayerAction,\r\n        iconContent: string,\r\n    ) {\r\n        let bg = Color.Transparent\r\n        let fg = Color.White\r\n        let icon = document.createElement('button')\r\n        icon.innerHTML = iconContent\r\n        icon.style.display = 'block';\r\n        icon.style.fontSize = '7pt';\r\n        icon.style.fontFamily = Game.font //'Verdana';\r\n        icon.style.border = 'none'\r\n        icon.style.padding = '4px'\r\n        icon.style.background = bg.toRGBA();\r\n        icon.style.color = fg.toRGBA();\r\n        icon.onclick = () => { this.handleAction(action) }\r\n        return icon\r\n    }\r\n\r\n}\r\n","import { Label, Color, Actor } from \"excalibur\";\r\nimport { Game } from \"../../Game\";\r\nexport class EconomicValue extends Actor {\r\n    private nameLabel: Label;\r\n    private valueLabel: Label;\r\n    constructor(name: string, x: number, y: number) {\r\n        super(x, y, 0, 0);\r\n        this.nameLabel = new Label(name, x, y, Game.font);\r\n        this.nameLabel.fontSize = 10;\r\n        this.nameLabel.color = Color.White.darken(0.2);\r\n        this.add(this.nameLabel);\r\n        this.valueLabel = new Label('0', x + 40, y, Game.font);\r\n        this.valueLabel.fontSize = 10;\r\n        this.valueLabel.color = Color.White.darken(0.2);\r\n        this.add(this.valueLabel);\r\n    }\r\n    setCount(count: number) {\r\n        this.valueLabel.text = `${count}`;\r\n        let c = Color.Gray;\r\n        if (count > 0) {\r\n            c = Color.Green;\r\n        }\r\n        else if (count < 0) {\r\n            c = Color.Red;\r\n        }\r\n        this.valueLabel.color = c;\r\n    }\r\n}\r\n","import { Actor, Color } from \"excalibur\";\r\nimport { Economy, PureValue, availableCapacity, allValues } from \"../../models/Economy\";\r\nimport { EconomicValue } from \"./EconomicValue\";\r\nimport { eachChunk } from \"../../Util\";\r\n\r\nexport class EconomyView extends Actor {\r\n    private valueLabels: { [key in PureValue]: EconomicValue } = {\r\n        Power: null,\r\n        Oxygen: null,\r\n        Water: null,\r\n        Shelter: null,\r\n        Hope: null,\r\n        Joy: null,\r\n        Wisdom: null,\r\n        Wealth: null,\r\n        Beauty: null,\r\n        Wonder: null\r\n    }\r\n\r\n    constructor(market: Economy, x: number, y: number) {\r\n        super(x, y, 0, 0) //Color.DarkGray.clone().darken(0.5));\r\n\r\n        let index = 0\r\n        for (let [val1, val2] of eachChunk(allValues, 2)) {\r\n            this.addValue(index * 32, 0, val1)\r\n            this.addValue(index * 32, 7, val2)\r\n            index += 1\r\n        }\r\n\r\n        this.updateView(market);\r\n    }\r\n\r\n    private addValue(x: number, y: number, value: PureValue) {\r\n        let valueLabel: EconomicValue = new EconomicValue(value, x, y)\r\n        this.valueLabels[value] = valueLabel\r\n        this.add(valueLabel)\r\n    }\r\n\r\n    updateView(updatedEconomy: Economy): void {\r\n        let market = updatedEconomy;\r\n\r\n        for (let value of allValues) {\r\n            this.valueLabels[value].setCount(\r\n                availableCapacity(market, value)\r\n            )\r\n        }\r\n\r\n    }\r\n}\r\n","import { Label, Color, Actor, UIActor } from \"excalibur\";\r\nimport { ResourceBlock, blockColor } from \"../../models/Economy\";\r\nimport { Game } from \"../../Game\";\r\nclass Tooltip extends Actor {\r\n    messageLabel: Label\r\n    constructor(x: number, y: number, message: string) {\r\n        super(x, y, 60, 16, Color.Black)\r\n        this.messageLabel = new Label(message, -16, 6, Game.font) //'Verdana')\r\n        this.messageLabel.color = Color.White\r\n        this.add(this.messageLabel)\r\n    }\r\n}\r\n\r\nexport class ResourceListEntry extends UIActor {\r\n    icon: Actor;\r\n    count: Label;\r\n    hovering: boolean = false\r\n    tooltip: Tooltip\r\n\r\n    constructor(x: number, y: number, resourceBlock: ResourceBlock, protected value: number) {\r\n        super(x-5, y-5, 20, 10)\r\n        let icon = new Actor(5, 5, 10, 10, blockColor(resourceBlock));\r\n        this.add(icon);\r\n        this.count = new Label(`x${value}`, 15, 10, Game.font) //'Helvetica');\r\n        this.count.fontSize = 10;\r\n        this.count.color = Color.White;\r\n        this.add(this.count);\r\n\r\n        this.tooltip = new Tooltip(0, 5, ResourceBlock[resourceBlock])\r\n        this.tooltip.visible = false\r\n        this.add(this.tooltip)\r\n\r\n\r\n        this.on('pointerenter', () => {\r\n            this.tooltip.visible = true\r\n        })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.tooltip.visible = false\r\n        })\r\n    }\r\n\r\n\r\n    credit(amt: number) {\r\n        this.value += amt;\r\n        this.count.text = `x${this.value}`;\r\n    }\r\n\r\n    debit(amt: number) {\r\n        this.value -= amt\r\n        this.count.text = `x${this.value}`\r\n    }\r\n}\r\n","import { Color, Actor } from \"excalibur\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\nimport { ResourceListEntry } from \"./ResourceListEntry\";\r\nimport { eachCons, eachChunk } from \"../../Util\";\r\nexport class ResourcesList extends Actor {\r\n    entries: {\r\n        [block in ResourceBlock]: ResourceListEntry;\r\n    } = {\r\n            [ResourceBlock.Biomass]: null,\r\n            [ResourceBlock.Idea]: null,\r\n            [ResourceBlock.Ore]: null,\r\n            [ResourceBlock.Meal]: null,\r\n            [ResourceBlock.Mineral]: null,\r\n            [ResourceBlock.Data]: null,\r\n            [ResourceBlock.Alloy]: null,\r\n            [ResourceBlock.Bioplasma]: null,\r\n            [ResourceBlock.Algorithm]: null,\r\n            [ResourceBlock.Argent]: null,\r\n            [ResourceBlock.Aurum]: null,\r\n            [ResourceBlock.Omnium]: null,\r\n        };\r\n\r\n    constructor(x: number, y: number) {\r\n        super(x,y,0,0); // 200, 60, Color.Green.clone().darken(0.8));\r\n        let rx0 = 0, ry0 = -5;\r\n        let resources = [\r\n            ResourceBlock.Meal,\r\n            ResourceBlock.Bioplasma,\r\n\r\n            ResourceBlock.Data,\r\n            ResourceBlock.Algorithm,\r\n\r\n            ResourceBlock.Mineral,\r\n            ResourceBlock.Alloy,\r\n\r\n            ResourceBlock.Argent,\r\n            ResourceBlock.Aurum,\r\n        ];\r\n\r\n        eachChunk(resources, 2).forEach(([res1, res2], index) => {\r\n            let rx = rx0 + index * 36, ry = ry0 + index * 0;\r\n            this.addEntry(rx, ry, res1)\r\n            this.addEntry(rx, ry + 14, res2)\r\n        });\r\n    }\r\n\r\n    private addEntry(x: number, y: number, res: ResourceBlock) {\r\n        let entry = new ResourceListEntry(x, y, res, 0);\r\n        this.add(entry);\r\n        this.entries[res] = entry;\r\n    }\r\n\r\n    increment(resource: ResourceBlock) {\r\n        let res = this.entries[resource]\r\n        if (res) {\r\n            res.credit(1);\r\n        }\r\n    }\r\n\r\n    decrement(resource: ResourceBlock) {\r\n        let res = this.entries[resource]\r\n        if (res) {\r\n            res.debit(1)\r\n        }\r\n    }\r\n}\r\n","import { Label, Color, Actor, FontStyle, FontUnit } from \"excalibur\";\r\nimport { Economy, ResourceBlock, PureValue } from \"../../models/Economy\";\r\nimport { ResourcesList } from \"./ResourcesList\";\r\nimport { EconomyView } from \"./EconomyView\";\r\nimport { MusicPlayer } from \"./MusicPlayer\";\r\nimport { Resources } from \"../../Resources\";\r\nimport { drawRect } from \"../../Painting\";\r\nimport { Game } from \"../../Game\";\r\n\r\nexport class StatusAnalysisView extends Actor {\r\n    private messageLabel: Label\r\n    private popLabel: Label\r\n\r\n    private resources: ResourcesList\r\n    private economy: EconomyView\r\n\r\n    private musicPlayer: MusicPlayer\r\n    private clock: Label\r\n\r\n    constructor(market: Economy, w: number, h: number) {\r\n        super(0,0, w*2,h, Color.DarkGray.clone().darken(0.92));\r\n\r\n        let ty = 14\r\n\r\n        let brand = new Label(Game.title, 5, ty+18, Game.font)\r\n        brand.fontSize = 28\r\n        brand.color = Color.Gray\r\n        brand.fontStyle = FontStyle.Italic\r\n        this.add(brand)\r\n\r\n        let version = new Label(\"v0.1\", 100, ty + 14, Game.font)\r\n        version.fontSize = 7\r\n        version.color = Color.Gray.darken(0.4)\r\n        this.add(version)\r\n\r\n\r\n        this.resources = new ResourcesList(130, ty)\r\n        this.add(this.resources)\r\n\r\n        this.economy = new EconomyView(market, 280, ty)\r\n        this.add(this.economy)\r\n\r\n        this.clock = new Label('current time', 600, ty, Game.font) // 'Verdana')\r\n        this.clock.color = Color.White // 'white'\r\n        this.add(this.clock)\r\n\r\n        this.popLabel = new Label(\"\", 600, ty + 14, Game.font) // 'Verdana')\r\n        this.popLabel.fontSize = 10\r\n        this.popLabel.color = Color.White\r\n        this.add(this.popLabel)\r\n\r\n        this.messageLabel = new Label('hi', 750, ty, Game.font) // 'Verdana')\r\n        this.messageLabel.fontSize = 10\r\n        this.messageLabel.color = Color.White\r\n        this.messageLabel.fontStyle = FontStyle.Italic\r\n        this.add(this.messageLabel)\r\n\r\n        this.musicPlayer = new MusicPlayer(726, 12, {\r\n            // 'Crater Rock': Resources.CraterRock,\r\n            // 'Indivision': Resources.Indivision,\r\n            'Future Tense': Resources.FutureTense,\r\n            // 'Isomer': Resources.Isomer,\r\n            // 'Understanding': Resources.Understanding,\r\n            // 'Outbound': Resources.Outbound,\r\n            'Assembler': Resources.Assembler,\r\n        })\r\n// // enable propagating pointer events\r\n// this.enableCapturePointer = true;\r\n// // // enable move events, warning: performance intensive!\r\n// this.capturePointer.captureMoveEvents = true;\r\n//         this.on('pointerenter', () => { alert('hover!')})\r\n    }\r\n\r\n    draw(ctx, delta) {\r\n        super.draw(ctx, delta)\r\n        this.musicPlayer.draw(ctx)\r\n        // drawRect(\r\n        //     ctx,\r\n        //     {x: this.x, y: this.y, width: this.getWidth(), height: this.getHeight() },\r\n        //     0,\r\n        //     Color.Magenta\r\n        // )\r\n    }\r\n\r\n    incrementResource(res: ResourceBlock) {\r\n        this.resources.increment(res)\r\n    }\r\n\r\n    decrementResource(res: ResourceBlock) {\r\n        this.resources.decrement(res)\r\n    }\r\n\r\n    setMessage(text: string) { this.messageLabel.text = text }\r\n\r\n    showEconomy(updatedEconomy: Economy): any {\r\n        this.economy.updateView(updatedEconomy)\r\n    }\r\n\r\n    showPopCap(curr: any, cap: any): any {\r\n        this.popLabel.text = `Pop: ${curr}/${cap}`\r\n    }\r\n\r\n    setClock(time: number = 0) {\r\n        let days = (Math.floor(time / (60 * 24))+1).toString()\r\n        let hh = Math.floor(time / 60) % 24\r\n        let hours = Math.floor((hh + 11) % 12 + 1).toString()\r\n        let minutes = Math.floor(time % 60).toString()\r\n        let ampm = hh < 12 ? 'AM' : 'PM'\r\n        this.clock.text = `Day ${days}. ${hours}:${minutes.padStart(2, '0')} ${ampm}`\r\n    }\r\n    \r\n}\r\n","import { drawRect } from \"../../Painting\";\r\nimport { DomeView, Building } from \".\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Color } from \"excalibur\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class GroundVehiclePoolView extends Building {\r\n\r\n    deviceSize = DeviceSize.Small\r\n    colorBase() { return Color.Orange.clone().darken(0.05); } \r\n    draw(ctx, delta) {\r\n        // drawRect(ctx, this.aabb())\r\n       super.draw(ctx, delta)\r\n    }\r\n\r\n    slots() {\r\n        let theSlots = [];\r\n        let slotY = this.getHeight();\r\n\r\n        let buffer = this.getWidth() / 4\r\n\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x - buffer, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() + buffer,\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Device } from \"../Device\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { drawPatternedRect, drawRect, drawPatternedPoly, drawPoly } from \"../../Painting\";\r\nimport { measureDistance, eachCons } from \"../../Util\";\r\nimport { BackgroundPattern } from \"./BackgroundPatterns\";\r\n// import { drawPatternedRect, drawRect } from \"../../Util\";\r\n\r\nexport class MediumSurfaceRoomView extends Building {\r\n    hideBox = true\r\n    showLabel = true\r\n    // hideLabe\r\n\r\n    devicePlaceSize = DeviceSize.Medium\r\n    devicePlaceCount = 3\r\n    get floorHeight() { return this.getHeight() / 6 }\r\n\r\n    get floorY() {\r\n        return this.pos.y + this.getHeight() - this.floorHeight\r\n    }\r\n\r\n   nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight() - 16\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - 12 \r\n        y -= getVisibleDeviceSize(this.devicePlaceSize) / 3.5\r\n\r\n        let ds = [\r\n            new Vector(x - w/2, y),\r\n            ...(this.devicePlaceCount > 2 ? [new Vector(x,y)] : []),\r\n            new Vector(x + w/2, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, this.devicePlaceSize)) \r\n    }\r\n\r\n    //deviceInteractionPlaces() {\r\n\r\n    //}\r\n\r\n    graph(sg) {\r\n        let g = super.graph(sg)\r\n        let find = (s: Vector) => g.findOrCreate(s, measureDistance)\r\n        let slots: Vector[] = this.slots().map(s => s.pos)\r\n        // draw from left slot to each device place to right slot?\r\n        let devices = this.deviceInteractionPlaces().map(p => find(p)) //d.position))\r\n        eachCons(devices, 2).forEach(([left, right]) => g.edge(left, right))\r\n\r\n        if (this.isGroundFloor) {\r\n            let leftSlot = find(slots[0]), rightSlot = find(slots[slots.length - 1])\r\n            g.edge(leftSlot, devices[0])\r\n            g.edge(devices[devices.length - 1], rightSlot)\r\n        } else {\r\n            let topSlot = find(slots[1])\r\n            g.edge(devices[1], topSlot)\r\n        }\r\n\r\n        let node = this.nodes()[0]\r\n        devices.forEach(device => g.edge(device, find(node)))\r\n        // g.edge(devices[1], find(slots[1]))\r\n\r\n        return g\r\n    }\r\n\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n        let slotY = this.getHeight() - this.floorHeight;\r\n\r\n        if (this.isGroundFloor) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x, this.pos.y + slotY,\r\n                    Orientation.Left\r\n                )\r\n            )\r\n        }\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() / 2,\r\n                this.pos.y + this.getHeight(), // + (2*this.floorHeight),\r\n                Orientation.Down\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() / 2,\r\n                this.pos.y - 1, // + this.getHeight(),\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n\r\n        if (this.isGroundFloor) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x + this.getWidth(),\r\n                    this.pos.y + slotY,\r\n                    Orientation.Right\r\n                )\r\n            )\r\n        }\r\n\r\n\r\n        return theSlots;\r\n    }\r\n\r\n    get isGroundFloor() {\r\n        return !this.parentSlot || !(this.parentSlot.parent instanceof MediumSurfaceRoomView)\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        if (this.planet.colony.buildings.length === 0) {\r\n            cursor.y = this.planet.getTop();\r\n        } // else {\r\n            // this.alignToSlot(cursor)\r\n        // }\r\n        return cursor;\r\n    }\r\n\r\n    reshape(cursor: Vector) {\r\n        if (this.planet.colony.buildings.length === 0) {\r\n            this.pos = cursor\r\n            this.pos.y -= this.getHeight() - 2 - this.floorHeight // hm\r\n        } else {\r\n            this.alignToSlot(cursor)\r\n\r\n        }\r\n    }\r\n\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color = this.mainColor()\r\n\r\n        ctx.fillStyle = color.toRGBA()\r\n\r\n        // ctx.fillRect(this.pos.x, this.pos.y, this.getWidth(), this.getHeight())\r\n        // let rect = \r\n            // { x: this.pos.x, y: this.pos.y, width: this.getWidth(), height: this.getHeight() };\r\n        drawPatternedPoly(\r\n            ctx,\r\n            this.angledRoofPoly(),\r\n            this.backgroundPattern,\r\n            this.mainColor()\r\n        )\r\n\r\n\r\n        if (!this.isActive) {\r\n            // draw overlay rect that darkens\r\n            let c = Color.Black.clone()\r\n            c.a = 0.6\r\n            drawPoly(ctx, this.angledRoofPoly(), c)\r\n        }\r\n\r\n        // floor\r\n        let floorColor = this.planet.color.darken(0.6)\r\n        let floorEdgeHeight = 12 // 6\r\n        let floorOff = -5\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorEdgeHeight,\r\n              width: this.getWidth(), height: floorEdgeHeight - floorOff },\r\n              0,\r\n              floorColor.lighten(0.4)\r\n        )\r\n\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorOff,\r\n              width: this.getWidth(), height: this.floorHeight + floorOff },\r\n              0,\r\n              floorColor\r\n        )\r\n\r\n        // a little flag :)\r\n        let flagpoleHeight = 18\r\n        let flagX = this.pos.x + 3 * (this.getWidth() / 4)\r\n        let flagY = this.pos.y - flagpoleHeight\r\n\r\n        ctx.fillStyle = Color.Black.fillStyle()\r\n        ctx.fillRect(flagX, flagY-1, 1, flagpoleHeight+1)\r\n        drawPatternedRect(\r\n            ctx,\r\n            { x: flagX, y: flagY, width: 10, height: 6 },\r\n            BackgroundPattern.USSF\r\n        )\r\n        // ctx.fillRect(flagX, flagY, 10, 5)\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White.clone(); }\r\n}","import { CommonAreaView } from \".\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class MediumRoomThreeView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Medium\r\n    devicePlaceCount = 3\r\n\r\n    poly() { return this.angledRoofPoly() }\r\n\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - getVisibleDeviceSize(DeviceSize.Medium)/3\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    // }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class HugeRoomView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Huge\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - getVisibleDeviceSize(DeviceSize.Huge)/2 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Huge))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class LargeRoomView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Large\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - getVisibleDeviceSize(DeviceSize.Large)/2 \r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Large))\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\n\r\nexport class MediumRoomView extends CommonAreaView {\r\n    devicePlaceSize = DeviceSize.Medium\r\n    devicePlaceCount = 2\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - this.floorHeight - getVisibleDeviceSize(DeviceSize.Medium)/3\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    // }\r\n}","import { CommonAreaView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class SmallRoomThreeView extends CommonAreaView {\r\n    devicePlaceCount = 3\r\n    poly() { return this.angledRoofPoly() }\r\n    //devicePlaces() {\r\n    //    let w = this.getWidth()/2\r\n    //    let x = this.pos.x + w;\r\n    //    let y = this.pos.y + this.getHeight() - this.floorHeight - 10\r\n    //    let ds = [\r\n    //        new Vector(x - w / 2, y),\r\n    //        new Vector(x, y),\r\n    //        new Vector(x + w / 2, y),\r\n    //    ]\r\n\r\n    //    return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    //}\r\n}","import { DeviceSize } from \"../../values/DeviceSize\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DomeView } from \".\";\r\n\r\nexport class BigDomeView extends DomeView {\r\n\r\n    devicePlaceCount = 3\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - 20\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Large))\r\n    // }\r\n}","import { DomeView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class MidDomeView extends DomeView {\r\n\r\n    devicePlaceCount = 3\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - 20\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Medium))\r\n    // }\r\n}","import { DomeView } from \".\";\r\nimport { Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class SmallDomeThreeView extends DomeView {\r\n\r\n    devicePlaceCount = 3\r\n    // devicePlaces() {\r\n    //     let w = this.getWidth()/2\r\n    //     let x = this.pos.x + w;\r\n    //     let y = this.pos.y + this.getHeight() - 6\r\n    //     let ds = [\r\n    //         new Vector(x - w/3, y),\r\n    //         new Vector(x, y),\r\n    //         new Vector(x + w/3, y),\r\n    //     ]\r\n\r\n    //     return ds.map(d => new DevicePlace(d, DeviceSize.Small))\r\n    // }\r\n}","import { CorridorView } from \".\";\r\n\r\nexport class SurfaceRoadView extends CorridorView {\r\n    edgeWidth: 0\r\n    colorBase() { return this.color.lighten(0.1); }\r\n\r\n}","import { TunnelView } from \".\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Scale } from \"../../values/Scale\";\r\n\r\nexport class LadderView extends TunnelView {\r\n    originSlot: Slot = null\r\n    slotSize: number = Scale.major.third\r\n    constrainCursor(cursor: Vector): Vector {\r\n       if (this.pickingOrigin) {\r\n\r\n       } else {\r\n           cursor.x = this.pos.x\r\n       }\r\n       return cursor;\r\n    }\r\n\r\n    // minHeight: number = slt\r\n    reshape(cursor: Vector) {\r\n        if (this.pickingOrigin) { \r\n            let theSlot = this.alignToSlot(cursor)\r\n            if (theSlot) {\r\n                this.facing = theSlot.facing\r\n\r\n                if (theSlot) {\r\n                    this.originSlot = theSlot\r\n                }\r\n            }\r\n        } else {\r\n            if (this.facing === Orientation.Up) {\r\n                let maxHeight = this.originSlot.pos.y - this.planet.getTop() - 25\r\n\r\n                let h = Math.min(maxHeight, Math.max(this.slotSize, this.originSlot.pos.y - cursor.y))\r\n                this.setHeight((h/this.slotSize)*this.slotSize + 15)\r\n                this.pos.y = this.originSlot.pos.y - this.getHeight()\r\n            } else {\r\n                let h = Math.max(this.slotSize, cursor.y - this.originSlot.pos.y)\r\n                this.setHeight((h/this.slotSize)*this.slotSize + 15) // - cursor.y))\r\n            }\r\n        }\r\n    }\r\n}","import { DomeView } from \".\";\r\nimport { Color, Vector } from \"excalibur\";\r\nimport { DevicePlace } from \"./Building\";\r\nimport { DeviceSize } from \"../../values/DeviceSize\";\r\n\r\nexport class ArcologyView extends DomeView {\r\n\r\n    devicePlaces() {\r\n        let w = 3*this.getWidth()/5\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight()/2\r\n        let ds = [\r\n            new Vector(x, y-800),\r\n            new Vector(x, y),\r\n            new Vector(x, y+800),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, DeviceSize.Huge))\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        this.drawShape(ctx, this.pos.x, this.pos.y)\r\n        this.getDevices().forEach(device => device.draw(ctx, delta))\r\n\r\n    }\r\n\r\n    private drawShape(ctx, xoff, yoff) {\r\n        let h = this.getHeight()\r\n        let w = this.getWidth()\r\n        ctx.beginPath();\r\n        ctx.moveTo(0 + xoff, h + yoff);\r\n        ctx.bezierCurveTo(1 + xoff, h - 150 + yoff, 121 + xoff, 70 + yoff, w - 80 + xoff, 8 + yoff);\r\n        ctx.bezierCurveTo(w - 40 + xoff, 2 + yoff, w - 5 + xoff, 11 + yoff, w - 10 + xoff, 25 + yoff);\r\n        ctx.bezierCurveTo(w - 5 + xoff, 10 + yoff, w + xoff, (h-10) + yoff, w + xoff, h + yoff);\r\n        ctx.lineTo(0 + xoff, h + yoff);\r\n        ctx.fillStyle = this.mainColor().toRGBA()\r\n        ctx.fill();\r\n    }\r\n}","import { Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { range, eachCons, measureDistance } from \"../../Util\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip } from \"../../values/Orientation\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { drawRect } from \"../../Painting\";\r\nimport { Scale } from \"../../values/Scale\";\r\n\r\nexport class TunnelView extends Building {\r\n    slotSize: number = Scale.major.eighth + 10\r\n    pickingOrigin: boolean = true\r\n    hideBox = true\r\n\r\n    colorBase() { return this.planet.color.darken(0.2); }\r\n\r\n    draw(ctx, delta) {\r\n        let rect = this.aabb()\r\n        drawRect(ctx, rect, 0, this.color.darken(0.1)) \r\n\r\n        let n = 5\r\n        rect.x = rect.x + this.getWidth() / n\r\n        rect.width -= (2) * (this.getWidth() / n)\r\n        drawRect(ctx, rect, 0, this.color.darken(0.2)) \r\n        // super.draw(ctx, delta)\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y\r\n        return [\r\n            new Vector(Math.floor(x), y)\r\n        ];\r\n    }\r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph;\r\n\r\n        let halfWidth = this.getWidth()/2\r\n        let x = this.pos.x + halfWidth\r\n\r\n        let root = g.findOrCreate(this.nodes()[0], measureDistance)\r\n        let first = g.findOrCreate(new Vector(x,this.slotHeights()[0]), measureDistance)\r\n        g.edge(root,first)\r\n\r\n        let heights = this.slotHeights()\r\n\r\n        eachCons(heights, 2).forEach(([y0,y1]: [number,number]) => {\r\n            let top = g.findOrCreate(new Vector(x,y0), measureDistance)\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n            g.edge(top, btm)\r\n        })\r\n\r\n        let btm = g.findOrCreate(new Vector(x, this.pos.y + this.getHeight()), measureDistance)\r\n        let lst = g.findOrCreate(new Vector(x, heights[heights.length-1]), measureDistance)\r\n        g.edge(btm,lst)\r\n\r\n        heights.forEach(y1 => {\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n\r\n            let left = g.findOrCreate(new Vector(x-halfWidth,y1), measureDistance)\r\n            g.edge(left,btm)\r\n\r\n            let right = g.findOrCreate(new Vector(x+halfWidth,y1), measureDistance)\r\n            g.edge(btm,right)\r\n        });\r\n\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(childNode, slot)\r\n            g.edge(slot, childNode)\r\n\r\n            child.graph(g)\r\n        }\r\n\r\n        return g;\r\n    }\r\n\r\n    private slotHeights() {\r\n            // let minDepth = Scale.major.eighth + 50\r\n            // let buffer = 20\r\n\r\n        // let slotSize = Scale.major.eighth + 5 //minDepth + buffer\r\n        let slotCount = Math.floor((this.getHeight()) / this.slotSize)\r\n        let heights = []\r\n\r\n        let y = this.pos.y // + minDepth + buffer\r\n\r\n        if (slotCount > 0) {\r\n            for (let i of range(slotCount)) {\r\n                heights.push(\r\n                    y + ((i+1) * this.slotSize),\r\n                )\r\n            }\r\n        } else {\r\n            heights.push(this.slotSize)\r\n        }\r\n        return heights\r\n    }\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y,\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n        for (let y of this.slotHeights()) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x, y,\r\n                    Orientation.Left\r\n                )\r\n            )\r\n\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x + this.getWidth(),\r\n                    y,\r\n                    Orientation.Right,\r\n                )\r\n            )\r\n        }\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n        return theSlots;\r\n    } \r\n\r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        if (this.pickingOrigin) {\r\n            // this.alignToSlot(cursor)\r\n        } else {\r\n            // cursor.y = Math.max(this.planet.getTop() + 100, cursor.y)\r\n        }\r\n        return cursor;\r\n    }\r\n\r\n    reshape(cursor: Vector) {\r\n        // this.pos.y = this.planet.getTop() + 2\r\n        if (this.pickingOrigin) {\r\n            this.alignToSlot(cursor)\r\n        } // else {\r\n            // min depth/height has to be at least \r\n            // let minDepth = Scale.major.eighth\r\n            // let buffer = 100\r\n\r\n            let depth = \r\n                (this.slotSize * Math.floor(Math.abs(cursor.y - this.planet.getTop()) / this.slotSize)) + 15\r\n\r\n          this.setHeight(\r\n              Math.max(depth, this.slotSize + 15)\r\n          )\r\n        // }\r\n    }\r\n\r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { measureDistance, eachCons } from \"../../Util\";\r\n\r\nexport class DomeView extends Building {\r\n    hideBox = true\r\n    showLabel = true\r\n\r\n    graph(sg) {\r\n        let g = super.graph(sg)\r\n        let find = (s: Vector) => g.findOrCreate(s, measureDistance)\r\n\r\n        let slots: Vector[] = this.slots().map(s => s.pos)\r\n        let leftSlot = find(slots[0]), rightSlot = find(slots[slots.length-1])\r\n        let devices = this.deviceInteractionPlaces().map(position => find(position))\r\n        g.edge(leftSlot, devices[0])\r\n        eachCons(devices, 2).forEach(([left, right]) => g.edge(left, right))\r\n        g.edge(devices[devices.length-1], rightSlot)\r\n\r\n        let node = this.nodes()[0]\r\n        devices.forEach(device => g.edge(device, find(node)))\r\n\r\n        return g\r\n\r\n    }\r\n\r\n    slots() {\r\n        let theSlots = [];\r\n        let slotY = this.getHeight();\r\n\r\n        let buffer = this.getWidth() / 4\r\n\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x - buffer, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth() + buffer,\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n    //reshape(cursor: Vector) {\r\n    //    this.alignToSlot(cursor)\r\n    //}\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color: Color = this.mainColor()\r\n\r\n        let h = this.getHeight() //getWidth()/2\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(\r\n            this.pos.x + this.getWidth()/2,\r\n            this.pos.y + h, //this.getHeight(),\r\n            this.getWidth()/1.5,\r\n            0,\r\n            Math.PI,\r\n            true\r\n        )\r\n        ctx.closePath()\r\n        ctx.fillStyle = color.toRGBA()\r\n        ctx.fill()\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White.clone().darken(0.05); } \r\n\r\n    deviceSize = DeviceSize.Small\r\n    devicePlaceCount = 2\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - getVisibleDeviceSize(this.deviceSize)/3 // - 16\r\n        let ds = [\r\n            new Vector(x - w/3, y),\r\n            ...(this.devicePlaceCount === 3 ? [new Vector(x,y)] : []),\r\n            new Vector(x + w/3, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, this.deviceSize)) // DeviceSize.Small))\r\n    }\r\n}","import { Building, DevicePlace } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Vector, Color } from \"excalibur\";\r\nimport { DeviceSize, getVisibleDeviceSize } from \"../../values/DeviceSize\";\r\nimport { drawRect, drawPatternedPoly, drawPoly } from \"../../Painting\";\r\nimport { measureDistance, eachCons } from \"../../Util\";\r\n\r\nexport class CommonAreaView extends Building {\r\n    get floorHeight() { return this.getHeight() / 6 }\r\n    edgeWidth: number = 0\r\n    showLabel = true\r\n    hideBox = true\r\n\r\n    colorBase() { return this.color.darken(0.3); }\r\n\r\n    poly() { return this.aabbPoly() }\r\n\r\n    get floorY() {\r\n        return this.pos.y + this.getHeight() - this.floorHeight\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n\r\n\r\n        drawPatternedPoly(\r\n            ctx,\r\n            this.poly(),\r\n            this.backgroundPattern,\r\n            this.mainColor()\r\n        )\r\n\r\n        if (!this.isActive) {\r\n            let c = Color.Black.clone()\r\n            c.a = 0.6\r\n            drawPoly(ctx, this.poly(), c)\r\n        }\r\n\r\n        let floorEdgeHeight = 12 // 6\r\n        let floorColor = this.planet.color.darken(0.6)\r\n        let floorOff = -5\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorEdgeHeight,\r\n              width: this.getWidth(), height: floorEdgeHeight - floorOff },\r\n              0,\r\n              floorColor.lighten(0.4)\r\n        )\r\n\r\n        drawRect(\r\n            ctx,\r\n            { x: this.x, y: this.y + this.getHeight() - this.floorHeight - floorOff,\r\n              width: this.getWidth(), height: this.floorHeight + floorOff },\r\n              0,\r\n              floorColor\r\n        )\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n\r\n    slots() {\r\n        let theSlots = []\r\n        let slotY = this.getHeight() - this.floorHeight\r\n        let leftSlot: Slot = this.buildSlot(\r\n            this.pos.x,\r\n            this.pos.y + slotY,\r\n            Orientation.Left,\r\n        )\r\n        theSlots.push(leftSlot)\r\n\r\n        let rightSlot: Slot = this.buildSlot(\r\n            this.pos.x + this.getWidth(),\r\n            this.pos.y + slotY,\r\n            Orientation.Right,\r\n        )\r\n        theSlots.push(rightSlot)\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y,\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n        return theSlots;\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()-this.floorHeight\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n\r\n    graph(sg) {\r\n        let g = super.graph(sg)\r\n        let slots: Slot[] = this.slots()\r\n        let find = (s: Vector) => g.findOrCreate(s, measureDistance)\r\n        let leftSlot = find(slots[0].pos), rightSlot = find(slots[1].pos)\r\n        let devices = this.deviceInteractionPlaces().map(p => find(p))\r\n        g.edge(leftSlot, devices[0])\r\n        eachCons(devices, 2).forEach(([left, right]) => g.edge(left, right))\r\n        g.edge(devices[devices.length-1], rightSlot)\r\n\r\n        let node = this.nodes()[0]\r\n        devices.forEach(device => g.edge(device, find(node)))\r\n        return g\r\n    }\r\n  \r\n    reshape(cursor) {\r\n        this.alignToSlot(cursor);\r\n    }\r\n\r\n    devicePlaces() {\r\n        let w = this.getWidth()/2\r\n        let x = this.pos.x + w;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight - 10 \r\n        y -= getVisibleDeviceSize(this.devicePlaceSize) / 3.5 ///2\r\n\r\n        let ds = [\r\n            new Vector(x - w/2, y),\r\n            ...(this.devicePlaceCount > 2 ? [new Vector(x,y)] : []),\r\n            new Vector(x + w/2, y),\r\n        ]\r\n\r\n        return ds.map(d => new DevicePlace(d, this.devicePlaceSize)) \r\n        //DeviceSize.Small))\r\n    }\r\n\r\n    devicePlaceSize: DeviceSize = DeviceSize.Small\r\n    devicePlaceCount: number = 2\r\n}","import { Building } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\n\r\nexport class CorridorView extends Building {\r\n    edgeWidth: number = 0\r\n\r\n    pickingOrigin: boolean = true\r\n    facing: Orientation = Orientation.Left\r\n\r\n   nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()/2\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y))\r\n        ];\r\n    }\r\n    colorBase() { return this.color.darken(0.2); }\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = [];\r\n        let slotY = this.getHeight() / 2;\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n    \r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            this.reshape(this.constrainCursor(cursor))\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        let newCursor = cursor.clone();\r\n        if (this.pickingOrigin) {\r\n        } else {\r\n            newCursor.y = this.pos.y\r\n        }\r\n\r\n        return newCursor;\r\n    }\r\n\r\n    originX: number = 0\r\n    reshape(cursor: Vector) {\r\n\r\n        if (this.pickingOrigin) {\r\n            let theSlot = this.alignToSlot(cursor)\r\n            if (theSlot) {\r\n                this.facing = theSlot.facing\r\n\r\n                if (theSlot && this.facing === Orientation.Left) {\r\n                    this.originX = theSlot.pos.x\r\n                }\r\n            }\r\n\r\n        } else {\r\n            if (this.facing === Orientation.Left) {\r\n                this.setWidth(Math.abs(this.originX - cursor.x))\r\n                this.pos.x = this.originX - this.getWidth()\r\n            } else {\r\n                this.setWidth(Math.abs(this.pos.x - cursor.x))\r\n            }\r\n        }\r\n    }\r\n}","module.exports = __webpack_public_path__ + \"0a266eded2bf27831b18735ffc081448.png\";","module.exports = __webpack_public_path__ + \"2475589a97ba4901bfa7ab53b5487778.png\";","module.exports = __webpack_public_path__ + \"98240dde9344ac8d071d076ac951e15d.png\";","module.exports = __webpack_public_path__ + \"da31cf43235263c1c3e0ad45a46360a1.png\";","module.exports = __webpack_public_path__ + \"a6a38278ac501400c6199e0df9e1bf84.png\";","module.exports = __webpack_public_path__ + \"ece1d5d5858bc048d2d949ecc3f5e9bc.png\";","module.exports = __webpack_public_path__ + \"3654f0489813e0668743efde017c9653.png\";","module.exports = __webpack_public_path__ + \"3abbdabf07943966f102ac7345a59986.png\";","module.exports = __webpack_public_path__ + \"d1b4690b9f5fa4957f98602afc8cfdb6.png\";","module.exports = __webpack_public_path__ + \"0eb7a15ea04678b14a2b88b5965aabeb.png\";","module.exports = __webpack_public_path__ + \"490d8337dc1436fdb073e0ce7c1aa4e2.svg\";","module.exports = __webpack_public_path__ + \"9a1897cb324167653e7d23e377df09f7.svg\";","module.exports = __webpack_public_path__ + \"f74ccf77b74f12d78334366e7365d1ee.svg\";","module.exports = __webpack_public_path__ + \"d754bb375d83b60c875254997ad378af.svg\";","module.exports = __webpack_public_path__ + \"48be2487ecb6d75a112437662b61e05d.svg\";","module.exports = __webpack_public_path__ + \"c39dae9d5741e8fcd6c6a812b599a99c.svg\";","module.exports = __webpack_public_path__ + \"f91c0d7d285b0686ece2084cc3640bce.svg\";","module.exports = __webpack_public_path__ + \"824e22e59890ae78258b54985e42ca6d.svg\";","module.exports = __webpack_public_path__ + \"dfe6e4db2f0c22d18befa85c1e163369.svg\";","module.exports = __webpack_public_path__ + \"9a947d50110c1d1db07c76a4bba2e653.svg\";","module.exports = __webpack_public_path__ + \"4976b6042ef557ca6085c8d0168251f4.svg\";","module.exports = __webpack_public_path__ + \"46418cf15643d9b1b171c1b64160a5af.svg\";","module.exports = __webpack_public_path__ + \"36a02c2483b688be86ce07bea4bd7295.svg\";","module.exports = __webpack_public_path__ + \"29c5f1be64c99bbc14d5063eea2f0953.svg\";","module.exports = __webpack_public_path__ + \"502f86b65239e20806bbae8bc77a6116.svg\";","module.exports = __webpack_public_path__ + \"5289b20985e3c3a98081267a2da1772e.svg\";","module.exports = __webpack_public_path__ + \"1d893905e4eea3bbc48b0e129e318ea6.svg\";","module.exports = __webpack_public_path__ + \"bd556d00e484db4e52d198d0bf39d0f2.svg\";","module.exports = __webpack_public_path__ + \"650cd431226df0755357c71d61bef1f2.svg\";","module.exports = __webpack_public_path__ + \"f12c591f538ab3026bf13e93f3fa9485.svg\";","module.exports = __webpack_public_path__ + \"3aeb9dd24809ba3fbd4eeb31a28c3b19.svg\";","module.exports = __webpack_public_path__ + \"6cc6f6773bb6eb26fcef87b9629f7b87.svg\";","module.exports = __webpack_public_path__ + \"43062e54318df93f49e2be9a4281eb4a.svg\";","module.exports = __webpack_public_path__ + \"24611230ec712ba7ee38b99561aedd87.svg\";","module.exports = __webpack_public_path__ + \"c4ab2ceb2f61e18493fc776770c65654.svg\";","module.exports = __webpack_public_path__ + \"bbd50a175546bd70d21c5eadbc30d479.svg\";","module.exports = __webpack_public_path__ + \"7441c2ab240d0f733451d75204ac0792.svg\";","module.exports = __webpack_public_path__ + \"91a8cce06c3c05ce6e4b176afafd7b0a.svg\";","module.exports = __webpack_public_path__ + \"0ce4f9c3384680565b6bb16495b64233.svg\";","module.exports = __webpack_public_path__ + \"1db542acabeb82ec8da785e77afd4dca.svg\";","import { ResourceBlock } from \"./Economy\";\r\n\r\nexport type MechanicalOperation =\r\n    Recipe |\r\n    ResourceGenerator |\r\n    ResourceStorage |\r\n    SpawnClone |\r\n    AccelerateTime |\r\n    ExploreForResource |\r\n    Noop\r\n\r\nexport interface Noop {\r\n    type: 'noop'\r\n}\r\n\r\nexport interface Recipe {\r\n    type: 'recipe'\r\n    consumes: ResourceBlock[]\r\n    produces: ResourceBlock\r\n    workTime: number\r\n}\r\n\r\nexport interface ResourceGenerator {\r\n    type: 'generator'\r\n    generates: ResourceBlock\r\n    generationTime: number\r\n    capacity: number\r\n}\r\n\r\nexport interface ResourceStorage {\r\n    type: 'store'\r\n    stores: ResourceBlock[]\r\n    capacity: number\r\n}\r\n\r\nexport interface SpawnClone {\r\n    type: 'spawn'\r\n}\r\n\r\nexport interface AccelerateTime {\r\n    type: 'accelerate'\r\n    factor: number\r\n}\r\n\r\nexport interface ExploreForResource {\r\n    type: 'explore'\r\n    gathers: ResourceBlock\r\n    capacity: number\r\n}\r\n\r\nfunction store(res: ResourceBlock[], capacity: number = 10): ResourceStorage {\r\n    return {\r\n        type: 'store',\r\n        stores: res,\r\n        capacity\r\n    }\r\n}\r\n\r\nfunction generate(res: ResourceBlock, cap: number = 4): ResourceGenerator {\r\n    return {\r\n        type: 'generator',\r\n        generates: res,\r\n        generationTime: 1000,\r\n        capacity: cap\r\n    }\r\n}\r\n\r\nfunction recipe(input: ResourceBlock[], output: ResourceBlock): Recipe {\r\n    return {\r\n        type: 'recipe',\r\n        consumes: input,\r\n        produces: output,\r\n        workTime: 1000,\r\n    }\r\n}\r\n\r\nfunction spawn(): SpawnClone {\r\n    return {\r\n        type: 'spawn',\r\n    }\r\n}\r\n\r\nfunction accelerateTime(): AccelerateTime {\r\n    return {\r\n        type: 'accelerate',\r\n        factor: 2\r\n    }\r\n}\r\n\r\nfunction explore(block: ResourceBlock, cap: number = 4): ExploreForResource {\r\n    return {\r\n        type: 'explore',\r\n        gathers: block,\r\n        capacity: cap\r\n    }\r\n}\r\n\r\nexport const mechanicalOperations = {\r\n    store,\r\n    generate,\r\n    recipe,\r\n    spawn,\r\n    accelerateTime,\r\n    explore,\r\n}","import { Input, Scene, Timer, Vector, LockCameraToActorStrategy, Color } from \"excalibur\";\r\nimport { Building, structureViews } from \"../actors/Building\";\r\nimport { DevicePlace } from \"../actors/Building/Building\";\r\nimport { Device } from \"../actors/Device\";\r\nimport { Hud } from \"../actors/Hud/Hud\";\r\nimport { Planet } from \"../actors/Planet/Planet\";\r\nimport { Player } from \"../actors/player\";\r\nimport { Game } from \"../Game\";\r\nimport { Machine, allMachines } from \"../models/Machine\";\r\nimport { LivingQuarters, MissionControl, SolarArray, RoomRecipe, CloneReception, Kitchen, Workshop, Archive, Refinery, Mine } from \"../models/RoomRecipe\";\r\nimport { Corridor, HugeRoom, LargeRoom, MainTunnel, MediumRoomThree, SmallDome, SmallRoomThree, Structure, SurfaceRoad } from \"../models/Structure\";\r\nimport { flatSingle, zip, sample } from \"../Util\";\r\nimport { DeviceSize } from \"../values/DeviceSize\";\r\nimport { Orientation } from \"../values/Orientation\";\r\nimport { TechnologyRank } from \"../models/TechnologyRank\";\r\nimport { TechTree } from \"../models/TechTree\";\r\nimport { Citizen } from \"../actors/Citizen\";\r\nimport { GameController } from \"../GameController\";\r\n\r\n\r\nexport class Construct extends Scene {\r\n    private game: Game\r\n    private planet: Planet\r\n    private hud: Hud\r\n    private player: Player\r\n    private defaultMessage: string = 'Welcome to the Colony, Commander.'\r\n    private placingFunction: RoomRecipe = null\r\n    private time: number = Game.startHour*60\r\n    private hasActiveModal: boolean = false\r\n    private techTree: TechTree = new TechTree()\r\n    private firstBuilding: boolean = true\r\n    private followedCitizen: Citizen = null\r\n\r\n    static requiredStructuresAndFunctions: (typeof RoomRecipe | typeof Structure)[] = [\r\n        MissionControl,\r\n        SurfaceRoad,\r\n        SolarArray,\r\n        MainTunnel,\r\n        Corridor,\r\n        LivingQuarters,\r\n    ]\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n\r\n        let devices = this.planet.colony.findPoweredDevices()\r\n        let machines = allMachines.filter(machine => devices.some(device => device.machine instanceof machine))\r\n\r\n        let discipline = this.techTree.findDisciplineToRankUp(machines)\r\n        if (discipline) {\r\n            let rank = this.techTree.rankUp(discipline)\r\n            this.rankUp(rank)\r\n        }\r\n\r\n        // hmm!\r\n        this.hud.updateDetails(this.planet, this.techTree, this.followedCitizen, true, this.time)\r\n\r\n    }\r\n\r\n    public onInitialize(game: Game) {\r\n        this.game = game\r\n\r\n        let buildIt = (e) => this.startConstructing(e)\r\n        let followIt = (c) => this.toggleFollowing(c)\r\n\r\n        this.hud = new Hud(game, buildIt, buildIt, buildIt, followIt)\r\n        this.add(this.hud)\r\n\r\n        this.planet = new Planet(\r\n            game.world,\r\n            this.hud,\r\n            (b) => this.hud.showCard(b),\r\n            (d) => this.hud.showCard(d),\r\n            200000,\r\n            40000,\r\n            this\r\n        )\r\n\r\n        this.add(this.planet)\r\n  \r\n        this.player = new Player()\r\n        this.add(this.player)\r\n\r\n        this.prepareNextBuilding()\r\n        this.camera.pos.y = this.planet.getTop() - 1000\r\n        this.camera.zoom(0.05)\r\n        this.camera.zoom(0.5, 10000)\r\n\r\n        this.addTimer(\r\n            new Timer(() => { this.stepTime() }, this.timeStepIntervalMillis, true)\r\n        )\r\n\r\n        this.systemMessage(\r\n            \"Welcome to the Colony, sir... \"\r\n            + \"We are what is left of the crew of the Osiris. \"\r\n            + \"Can you help us build a functioning society? \"\r\n            + \"First, choose a location for the Command post. \"\r\n            + \"Then we'll lay out some infrastructure.\"\r\n        )\r\n    }\r\n\r\n    showTutorial: boolean = true\r\n    private systemMessage(message: string) {\r\n        this.hasActiveModal = true\r\n        this.hud.systemMessage(message, \"\", {\r\n            continue: () => { this.closeSystemMessage() },\r\n         })\r\n    }\r\n\r\n    private tutorialMessage(message: string) {\r\n        if (this.showTutorial) {\r\n        this.hasActiveModal = true\r\n            this.hud.systemMessage(message, \"\", {\r\n                continue: () => { this.closeSystemMessage() },\r\n                'i got this': () => {\r\n                    this.closeSystemMessage()\r\n                    this.showTutorial = false\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    private rankUp(rank: TechnologyRank) {\r\n        if (this.hasActiveModal) {\r\n            this.closeSystemMessage()\r\n        }\r\n\r\n        this.hasActiveModal = true\r\n        let rankUpMessage =\r\n            \"Your colony's mastery of a discipline has improved! \" +\r\n            \"The following new machines are now available for construction:\"\r\n\r\n        let okay = sample([ 'excellent!', 'great!', 'perfect', 'good work', 'cool', 'wonderful', 'brilliant', 'that is what i am talking about', 'keep up the good work', 'learning is fun!' ])\r\n\r\n        let modal = this.hud.systemMessage(\r\n            rankUpMessage,\r\n            \"rank up\",\r\n            { [okay]: () => { this.closeSystemMessage() }\r\n        })\r\n\r\n        modal.addHeading(rank.name, 28, Color.Orange)\r\n        modal.addHeading(rank.description, 12)\r\n\r\n        modal.addIconMatrix(\r\n            rank.unlocks.map(m => new m()).map(machine => { return {\r\n                image: machine.image,\r\n                label: machine.name\r\n            }})\r\n        )\r\n    }\r\n\r\n    private closeSystemMessage() {\r\n        this.hud.closeSystemMessage()\r\n        this.hasActiveModal = false\r\n    }\r\n\r\n\r\n    timeStepIntervalMillis: number = 50\r\n    private stepTime() { \r\n        this.time += this.timeStepIntervalMillis / Game.minuteTickMillis  /// this.timeStepIntervalMillis //  0.125 //.25\r\n        this.planet.setTime(this.time) \r\n    }\r\n\r\n    controller: GameController\r\n    public onActivate() {\r\n        this.addTimer(\r\n            new Timer(() => {\r\n                // this.systemMessage(\"raiding party incoming -- perimeter alert\")\r\n                this.planet.sendRaidingParty()\r\n            }, Game.raidingPartyFrequency, true)\r\n        )\r\n\r\n        this.controller = new GameController(this.game, this.camera)\r\n        this.controller.onCameraPan(() => this.stopFollowing())\r\n\r\n        this.controller.onMove((pos: Vector) => {\r\n            if (this.hasActiveModal) { return }\r\n            this.player.pos = pos\r\n\r\n            let currentlyBuilding = this.planet.currentlyConstructing\r\n            if (currentlyBuilding instanceof Building) {\r\n\r\n                let constrained = currentlyBuilding.constrainCursor(this.player.pos)\r\n                this.player.pos = constrained\r\n\r\n                currentlyBuilding.reshape(this.player.pos)\r\n            } else if (currentlyBuilding instanceof Device) {\r\n                currentlyBuilding.snap(this.planet, this.player.pos)\r\n            }\r\n        })\r\n\r\n        this.controller.onLeftClick((pos: Vector) => {\r\n            if (this.hasActiveModal) { return }\r\n            const currentlyBuilding = this.planet.currentlyConstructing\r\n                if (currentlyBuilding) {\r\n                    if (currentlyBuilding instanceof Building) {\r\n                        let buildingUnderConstruction = currentlyBuilding\r\n                        let placementValid = !buildingUnderConstruction.overlapsAny()\r\n                        if (buildingUnderConstruction && placementValid && buildingUnderConstruction.handleClick(pos)) {\r\n                            this.planet.placeBuilding(buildingUnderConstruction)\r\n                            if (this.firstBuilding){\r\n                                this.planet.sendRaidingParty()\r\n                            }\r\n\r\n                            if (this.placingFunction) {\r\n                                let fn = this.placingFunction\r\n                                zip(fn.machines, buildingUnderConstruction.devicePlaces()).forEach(([machine, place]: [typeof Machine, DevicePlace]) => {\r\n                                    let m = (new machine()).concretize()\r\n                                    let device = new Device(m, place.position)\r\n                                    buildingUnderConstruction.addDevice(device)\r\n                                })\r\n                                this.placingFunction = null\r\n                            }\r\n\r\n                            this.hud.setStatus(this.defaultMessage)\r\n                            this.planet.colony.currentlyConstructing = null\r\n                            this.prepareNextBuilding(pos)\r\n                        }\r\n                    } else {\r\n                        let deviceUnderConstruction = currentlyBuilding\r\n                        let placementValid = (deviceUnderConstruction.size === DeviceSize.Tiny) ||\r\n                            !deviceUnderConstruction.overlapsAny()\r\n                        let snapped = deviceUnderConstruction.snap(this.planet)\r\n                        if (snapped && placementValid) {\r\n                            if (deviceUnderConstruction.size === DeviceSize.Tiny) {\r\n                                let parent = deviceUnderConstruction.parentDevice\r\n                                parent.addTinyDevice(deviceUnderConstruction)\r\n                            } else {\r\n                                let bldg = deviceUnderConstruction.building\r\n                                bldg.addDevice(deviceUnderConstruction)\r\n                            }\r\n                            this.planet.colony.currentlyConstructing = null\r\n                            this.hud.setStatus(this.defaultMessage)\r\n                        }\r\n                    }\r\n                }\r\n        })\r\n\r\n        this.controller.onKeyPress((key) => {\r\n            if (this.hasActiveModal) { return }\r\n            if (key === Input.Keys.H) {\r\n                if (this.buildings && this.buildings[0]) {\r\n                    this.stopFollowing()\r\n                    this.camera.move(this.buildings[0].pos, 500)\r\n                    this.camera.zoom(0.5, 1000)\r\n                }\r\n            } else if (key === Input.Keys.Esc) {\r\n\r\n                    this.planet.colony.currentlyConstructing = null\r\n                    this.placingFunction = null\r\n                    this.stopFollowing(true)\r\n                    this.hud.setStatus(this.defaultMessage)\r\n            }\r\n        })\r\n\r\n        this.controller.activate()\r\n    }\r\n\r\n    public onDeactivate() {\r\n        this.game.input.pointers.primary.off('move')\r\n        this.game.input.pointers.primary.off('down')\r\n        this.game.input.pointers.primary.off('up')\r\n        this.game.input.pointers.primary.off('wheel')\r\n    }\r\n\r\n    get buildings() { return this.planet.colony.buildings }\r\n\r\n\r\n    private nextMissingStructureOrFunction(): Structure | RoomRecipe {\r\n        let reqs = Construct.requiredStructuresAndFunctions.map(req => new req())\r\n\r\n        let actualStructureNames = this.buildings.map(building => building.structure.name)\r\n        let actualFunctionNames = flatSingle(\r\n            this.buildings.map(building => building.spaceFunction && building.spaceFunction.name)\r\n        )\r\n        let actualNames = [...actualStructureNames, ...actualFunctionNames]\r\n        return reqs.find(req => !actualNames.includes(req.name))\r\n    }\r\n\r\n    protected prepareNextBuilding(pos: Vector = new Vector(0,0)) {\r\n        let structure = null;\r\n        let nextMissing = this.nextMissingStructureOrFunction()\r\n        if (nextMissing) { structure = nextMissing; }\r\n        if (structure) {\r\n            let congrats = sample([ 'Alright!', 'Perfect.', 'Great work!', 'Excellent!', 'Good.', 'That works.', 'Cool.', 'Fantastic!', 'Now we are cooking.', 'It looks good!' ])\r\n            let nextUp = sample([ \"Let's pick a location for a\", 'Next we will build a', 'Okay, time to make a', 'Get ready to place a'])\r\n            this.tutorialMessage(`${congrats} ${nextUp} ${structure.name}...`)\r\n            this.startConstructing(structure, pos)\r\n        } else {\r\n            this.hud.showPalettes()\r\n        }\r\n    }\r\n\r\n    toggleFollowing(citizen) {\r\n        if (this.followedCitizen === citizen) {\r\n            this.stopFollowing(true)\r\n        } else {\r\n            this.startFollowing(citizen)\r\n        }\r\n    }\r\n\r\n    cameraStrategy: LockCameraToActorStrategy\r\n    startFollowing(citizen) {\r\n        this.stopFollowing()\r\n        this.cameraStrategy = new LockCameraToActorStrategy(citizen)\r\n        this.camera.zoom(1.2, 1000)\r\n        this.camera.addStrategy(this.cameraStrategy)\r\n        this.followedCitizen = citizen\r\n\r\n    }\r\n\r\n    stopFollowing(resetZoom=false) {\r\n        if (this.cameraStrategy) {\r\n            this.camera.removeStrategy(this.cameraStrategy)\r\n            if (resetZoom) { \r\n                this.camera.zoom(0.5, 1000)\r\n            }\r\n            this.followedCitizen = null\r\n        }\r\n    }\r\n\r\n    startConstructing(structureOrMachine: Structure | Machine | RoomRecipe, pos: Vector = new Vector(0, 0)) {\r\n        this.hud.showCard(structureOrMachine)\r\n        \r\n        let theNextOne = null\r\n        if (structureOrMachine instanceof Structure) {\r\n            let structure = structureOrMachine\r\n            this.hud.setStatus(`Place ${structure.name} (${structure.description})`)\r\n            theNextOne = this.spawnBuilding(structure, pos)\r\n            if (this.firstBuilding) {\r\n                this.camera.zoom(structure.zoom, 250)\r\n                this.camera.pos = theNextOne.pos\r\n                this.firstBuilding = false\r\n            } \r\n        } else if (structureOrMachine instanceof Machine) {\r\n            let machine = structureOrMachine\r\n            this.hud.setStatus(`Install ${machine.name} (${machine.description})`)\r\n            theNextOne = this.spawnDevice(machine, pos)\r\n            // this.camera.zoom(1.5, 250)\r\n        } else if (structureOrMachine instanceof RoomRecipe) {\r\n            let fn: RoomRecipe = structureOrMachine\r\n            this.hud.setStatus(`Place ${fn.name} (${fn.description})`)\r\n            theNextOne = this.spawnFunction(fn, pos)\r\n            this.placingFunction = fn\r\n\r\n        }\r\n\r\n        this.planet.colony.currentlyConstructing = null\r\n        if (theNextOne) {\r\n            this.planet.colony.currentlyConstructing = theNextOne\r\n            // this.camera.pos = theNextOne.pos\r\n        }\r\n    }\r\n\r\n    protected spawnDevice(machine: Machine, pos: Vector): Device {\r\n        let device = new Device(machine, pos)\r\n        if (device.snap(this.planet)) {\r\n            this.camera.pos = device.pos\r\n \r\n        }\r\n        return device\r\n    }\r\n\r\n    protected spawnBuilding(structure: Structure, pos: Vector): Building {\r\n        let anotherBuilding = this.assembleBuildingFromStructure(structure, pos)\r\n        anotherBuilding.reshape(anotherBuilding.constrainCursor(pos))\r\n        return anotherBuilding\r\n    }\r\n    \r\n    private assembleBuildingFromStructure(structure: Structure, pos: Vector): Building {\r\n        let View = structureViews[structure.view]\r\n        let building = new View(pos, structure, this.planet)\r\n        return building;\r\n    }\r\n\r\n    protected spawnFunction(fn: RoomRecipe, pos: Vector): Building {\r\n        let theStructure: Structure = (fn.structure && new fn.structure()) // || new SmallRoomThree()\r\n        if (!theStructure) {\r\n            theStructure = new SmallRoomThree()\r\n            let machines = fn.machines.map(m => new m())\r\n\r\n            if (machines.some(m => m.size === DeviceSize.Medium)) {\r\n                theStructure = new MediumRoomThree()\r\n            }\r\n\r\n            if (machines.some(m => m.size === DeviceSize.Large)) {\r\n                theStructure = new LargeRoom()\r\n            }\r\n\r\n            if (machines.some(m => m.size === DeviceSize.Huge)) {\r\n                theStructure = new HugeRoom()\r\n            }\r\n\r\n            if (machines.some(m => m.forDome)) {\r\n                theStructure = new SmallDome()\r\n            }\r\n        }\r\n\r\n        // console.log(\"SPAWN FUNCTION\", { fn, structure: theStructure })\r\n        let building = this.assembleBuildingFromStructure(theStructure, pos)\r\n        building.reshape(building.constrainCursor(building.pos))\r\n        return building\r\n    }\r\n} \r\n","module.exports = __webpack_public_path__ + \"37914c496c3c503f7a53d7c9a1457b53.mp3\";","module.exports = __webpack_public_path__ + \"1b8e735649248c4c552a84996e61f241.mp3\";","module.exports = __webpack_public_path__ + \"1a607294aebce07746d6f25ffa517d80.mp3\";","module.exports = __webpack_public_path__ + \"22bdefc1e8515661fdeb8e8076820641.mp3\";","module.exports = __webpack_public_path__ + \"cf150ab26eba01503f4f6dc3d9ab47f7.mp3\";","module.exports = __webpack_public_path__ + \"94754f62e0ae4d23d386e246f5e0cb6e.png\";","import { Game } from './Game';\r\nimport { World } from './models/World';\r\nimport { Construct } from './scenes/Construct';\r\nimport { Resources } from './Resources';\r\nimport { Sound } from 'excalibur';\r\nimport { Arena } from './scenes/Arena';\r\nimport { Menu } from './scenes/Menu';\r\n\r\nconst theWorld = new World();\r\nconst game = new Game(theWorld);\r\n\r\nconst construct = new Construct(game);\r\ngame.add('construct', construct);\r\n\r\nconst arena = new Arena(game)\r\ngame.add('arena', arena)\r\n\r\nconst menu = new Menu(game)\r\ngame.add('menu', menu)\r\n\r\n\r\ngame.start().then(() => {\r\n  game.goToScene('menu')\r\n});\r\n"],"sourceRoot":""}