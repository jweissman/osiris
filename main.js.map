{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/models/Structure.ts","webpack:///./src/actors/Building/index.ts","webpack:///./src/values/Orientation.ts","webpack:///./src/Util.ts","webpack:///./src/actors/Building/Building.ts","webpack:///./src/models/Economy.ts","webpack:///./src/values/Graph.ts","webpack:///./src/Game.ts","webpack:///./src/actors/Building/RefineryView.ts","webpack:///./src/actors/Building/StudyView.ts","webpack:///./src/actors/Building/PowerPlantView.ts","webpack:///./src/actors/Building/KitchenView.ts","webpack:///./src/actors/Building/MessView.ts","webpack:///./src/actors/Building/MineView.ts","webpack:///./src/actors/Building/LabView.ts","webpack:///./src/actors/Building/SurfaceRoadView.ts","webpack:///./src/actors/Hud/ResourceListEntry.ts","webpack:///./src/actors/Hud/ResourcesList.ts","webpack:///./src/actors/Hud/Hud.ts","webpack:///./src/actors/Building/LivingQuartersView.ts","webpack:///./src/actors/Building/TunnelView.ts","webpack:///./src/actors/Building/MissionControlView.ts","webpack:///./src/actors/Building/DomeView.ts","webpack:///./src/actors/Building/CommonAreaView.ts","webpack:///./src/actors/Building/AccessTunnelView.ts","webpack:///./src/actors/player.ts","webpack:///./src/actors/Planet/NavigationTree.ts","webpack:///./src/actors/Planet/PlanetBackground.ts","webpack:///./src/values/Scale.ts","webpack:///./src/actors/Citizen.ts","webpack:///./src/actors/Planet/Planet.ts","webpack:///./src/scenes/Construct.ts","webpack:///./src/models/World.ts","webpack:///./src/images/sword.png","webpack:///./src/Resources.ts","webpack:///./src/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","p","jsonpArray","window","webpackJsonp","oldJsonpFunction","bind","slice","excalibur_1","Economy_1","Scale_1","Scale","minor","first","major","Structure","[object Object]","origin","Vector","this","description","view","width","height","zoom","consumes","produces","productionTime","MissionControl","third","MainTunnel","second","eighth","Dome","ResourceBlock","Food","sixth","AccessTunnel","fifth","CommonArea","LivingQuarters","SurfaceRoad","Laboratory","Hypothesis","Data","Kitchen","Meal","fourth","Mess","Mine","Ore","Study","Refinery","Mineral","PowerPlant","Building_1","Building","AccessTunnelView_1","AccessTunnelView","CommonAreaView_1","CommonAreaView","DomeView_1","DomeView","MissionControlView_1","MissionControlView","TunnelView_1","TunnelView","LivingQuartersView_1","LivingQuartersView","Orientation","Left","Up","Right","Down","flip","orientation","extremumBy","arr","pluck","extremum","reduce","best","next","pair","_ecRange","a","minBy","fn","Math","min","maxBy","max","sample","floor","random","range","Array","fill","map","_val","idx","closest","cursor","getVector","predicate","matching","filter","distanceToCursor","elem","distance","flatSingle","concat","deleteByValue","e","eachCons","measureDistance","b","ex","Orientation_1","Util_1","Graph_1","Actor","structure","planet","super","x","y","color","built","hover","showLabel","facing","edgeWidth","hideBox","childrenBuildings","product","capacity","step","anchor","setup","traits","trait","Traits","OffscreenCulling","on","collisionType","CollisionType","PreventCollision","label","Label","Color","White","ctx","delta","drawRect","aabb","forEach","produced","index","fillStyle","blockColor","desaturate","lighten","toRGBA","fillRect","pos","getCenter","measureText","draw","engine","update","produce","clone","getWidth","getHeight","supergraph","Graph","g","nodes","rootNode","findOrCreate","child","slot","parentSlot","edge","childNode","graph","citizen","carry","pop","carrying","progressBar","console","log","rectangle","edgeColor","main","mainColor","other","rect1","rect2","buildings","find","bldg","overlaps","processedColor","darken","clr","colorBase","overlapsAny","Red","validConnectingStructures","closestBuildingByType","slotList","building","slots","validConnectingDirections","includes","some","ourSlot","theSlot","findSlot","matchingSlot","offset","sub","addEqual","parent","blockColors","Green","Blue","Yellow","Violet","block","t","empty","edges","edgesInverse","size","newNode","contains","testNode","measure","tolerance","dfs","node","src","dst","indexOf","otherGraph","edgeList","theEdges","otherIndex","otherNode","adjacentIndices","testNodeIndex","es","esInv","root","visited","rIndex","dfsIndex","rootIndex","childIndex","cb","bfsIndex","halt","visitedNode","adj","adjacentNode","maxStep","prevStep","dstIndex","bfs","prev","curr","path","steps","srcIndex","reverse","Resources_1","Game","Engine","world","displayMode","DisplayMode","FullScreen","backgroundColor","skyColor","loader","Loader","key","Resources","addResource","start","citizenSpeed","_1","Structure_1","RefineryView","StudyView","PowerPlantView","theSlots","slotY","leftSlot","buildSlot","rightSlot","alignToSlot","KitchenView","MessView","MineView","floorHeight","LabView","SurfaceRoadView","ResourceListEntry","resourceBlock","icon","add","count","fontSize","amt","text","ResourceListEntry_1","ResourcesList","DarkGray","entries","resource","ry","entry","credit","ResourcesList_1","Hud","UIActor","game","message","onBuildingSelect","canvasHeight","_makePalette","resources","_paletteElement","left","canvas","offsetLeft","top","offsetTop","style","increment","document","createElement","position","border","body","appendChild","structuresForPalette","_paletteButton","buttonFactory","onclick","bg","fg","paletteButton","textContent","display","fontFamily","fontWeight","padding","textTransform","background","onmouseover","onmouseleave","setTimeout","populate","pickingOrigin","halfWidth","slotHeights","y0","y1","btm","right","slotCount","heights","getTop","setHeight","__awaiter","Promise","h","throw","done","then","drop","gather","flagX","flagY","beginPath","arc","PI","closePath","originX","reshape","constrainCursor","newCursor","setWidth","abs","Player","NavigationTree","dest","shortestPath","Mountains","peaks","xOff","peakDistance","times","heightRange","drift","baseColor","brightColor","saturate","yBase","peak","mtnWidth","moveTo","lineTo","majorUnit","seventh","minorUnit","minorScale","Game_1","Citizen","walkSpeed","workInProgress","now","Date","getTime","progress","workStarted","workDuration","pw","ph","px","py","strokeStyle","strokeRect","vel","actions","asPromise","duration","resolve","reject","pathBetween","all","glideTo","item","sinks","theSink","walkTo","interact","source","work","Citizen_1","PlanetBackground_1","NavigationTree_1","Planet","hud","depth","citizens","currentlyConstructing","createLayer","layerHeight","theLayer","resourceGathered","buildNavTree","afterConstruct","home","structureTypes","structureType","destination","navTree","srcNode","closestNode","destNode","seekPath","ctrl","Planet_1","player_1","Hud_1","SurfaceRoadView_1","LabView_1","MineView_1","MessView_1","KitchenView_1","PowerPlantView_1","StudyView_1","RefineryView_1","Construct","Scene","dragging","startConstructing","player","prepareNextBuilding","camera","input","pointers","primary","dragOrigin","currentBuilding","constrained","button","Input","PointerButton","placementValid","handleClick","placeBuilding","Middle","z","getZoom","deltaY","keyboard","Keys","H","move","off","requiredStructures","requiredStructureList","actualStructureNames","nextMissing","nextMissingRequiredStructure","theNextOne","spawnBuilding","anotherBuilding","assembleBuildingFromStructure","structureViews","Colony","structures","World","colors","Cyan","Vermillion","colony","sword","Sword","Texture","World_1","Construct_1","theWorld","construct","goToScene"],"mappings":"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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([36,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import { Vector } from 'excalibur';\r\nimport { ResourceBlock } from './Economy';\r\nimport { Scale } from '../values/Scale';\r\n\r\n// let sizeFactor = 0.85\r\n\r\nlet minorUnit = Scale.minor.first  //* sizeFactor\r\nlet majorUnit = Scale.major.first //* sizeFactor\r\n\r\n// let megaUnit = 16 * majorUnit\r\nconst { major, minor } = Scale\r\n\r\nexport class Structure {\r\n    name: string = '(structure name)';\r\n    description: string = '(structure description)';\r\n    view: string = '<structure (room) view>';\r\n    width: number = 10 //* sizeFactor\r\n    height: number = 10 //* sizeFactor\r\n    zoom: number = 1 // 0.1 //.25\r\n\r\n    consumes: ResourceBlock = null\r\n    produces: ResourceBlock = null\r\n    productionTime: number = 500\r\n\r\n    constructor(public origin: Vector = new Vector(0, 0)) { }\r\n}\r\n\r\nexport class MissionControl extends Structure {\r\n    name: string = 'Mission Control';\r\n    description: string = 'Keeping everything on track';\r\n    view: string = 'MissionControlView';\r\n    width: number = major.third // 10 * majorUnit\r\n    height: number = minor.third //3 * majorUnit\r\n    zoom = 0.1\r\n}\r\n\r\nexport class MainTunnel extends Structure {\r\n    name: string = 'Main Tunnel';\r\n    description: string = 'Elevating';\r\n    view: string = 'TunnelView';\r\n    width: number = major.second // 2 * majorUnit\r\n    height: number = major.eighth // 10 * majorUnit //150 // * sizeFactor\r\n    zoom = 0.25\r\n}\r\n\r\nexport class Dome extends Structure {\r\n    name: string = 'Biodome';\r\n    description: string = 'Biome sweet biome';\r\n    produces = ResourceBlock.Food\r\n\r\n    view: string = 'DomeView';\r\n    width: number = major.sixth // 10 * majorUnit\r\n    height: number = major.third //8 * majorUnit\r\n    zoom = 0.2\r\n    // productionTime = 500\r\n}\r\n\r\nexport class AccessTunnel extends Structure {\r\n    name: string = 'Corridor'\r\n    description: string = 'in the hallway'\r\n    view: string = 'AccessTunnelView'\r\n    width: number = minor.fifth // 10 * minorUnit\r\n    height: number = minor.third //1 * minorUnit\r\n    zoom = 0.5\r\n}\r\n\r\nexport class CommonArea extends Structure {\r\n    name: string = 'Commons'\r\n    description: string = 'hallway cap'\r\n    view: string = 'CommonAreaView'\r\n    width: number = major.eighth //8 * majorUnit\r\n    height: number = major.fifth //5 * majorUnit\r\n\r\n}\r\n\r\nexport class LivingQuarters extends Structure {\r\n    name: string = 'Quarters'\r\n    description: string = 'sleepy time'\r\n    view: string = 'LivingQuartersView'\r\n    width: number = major.third //minor.seventh // 3 * majorUnit\r\n    height: number = major.fifth //5 * majorUnit\r\n}\r\n\r\nexport class SurfaceRoad extends Structure {\r\n    name: string = 'Road'\r\n    description: string = 'go for a walk'\r\n    view: string = 'SurfaceRoadView'\r\n    width: number = minor.fifth // 5 * minorUnit\r\n    height: number = minor.first // 1 * minorUnit\r\n}\r\n\r\nexport class Laboratory extends Structure {\r\n    name: string = 'Lab'\r\n    description: string = 'learn some things'\r\n    consumes = ResourceBlock.Hypothesis\r\n    produces = ResourceBlock.Data\r\n    view: string = 'LabView'\r\n    width: number = major.sixth // 11 * majorUnit\r\n    height: number = major.fifth // 5 * majorUnit\r\n    productionTime = 6500\r\n}\r\n\r\n\r\nexport class Kitchen extends Structure {\r\n    name: string = 'Kitchen'\r\n    description: string = 'veg -> meals'\r\n    consumes = ResourceBlock.Food\r\n    produces = ResourceBlock.Meal\r\n    view: string = 'KitchenView'\r\n    width: number = major.fourth // 4 * majorUnit\r\n    height: number = major.fifth //5 * majorUnit\r\n    productionTime = 2000\r\n}\r\n\r\nexport class Mess extends Structure {\r\n    name: string = 'Mess'\r\n    description: string = 'consume meals'\r\n    view: string = 'MessView'\r\n    width: number = major.sixth //6 * majorUnit\r\n    height: number = major.fifth //5 * majorUnit\r\n}\r\n\r\n// a mine is maybe a wide structure that you\r\n// can gradually dig deeper??\r\nexport class Mine extends Structure {\r\n    name: string = 'Mine'\r\n    description: string = 'ore else'\r\n    produces = ResourceBlock.Ore\r\n    view: string = 'MineView'\r\n    width: number = major.eighth // 20 * majorUnit\r\n    height: number = 3 * major.sixth //20 * majorUnit\r\n}\r\n\r\nexport class Study extends Structure {\r\n    name: string = 'Study'\r\n    description: string = 'reflect'\r\n    view: string = 'StudyView'\r\n    width = major.third\r\n    height = major.fifth\r\n    produces = ResourceBlock.Hypothesis\r\n    productionTime = 1000\r\n}\r\n\r\nexport class Refinery extends Structure {\r\n    name = 'Refinery'\r\n    description = 'flotate'\r\n    consumes = ResourceBlock.Ore\r\n    produces = ResourceBlock.Mineral\r\n    view = 'RefineryView'\r\n    width = major.fifth\r\n    height = major.fifth\r\n    productionTime = 9000\r\n}\r\n\r\n//export class Workshop extends Structure {\r\n//    name: string = 'Workshop'\r\n//    description: string = 'manual'\r\n//    view: string = 'WorkshopView'\r\n//    width: number = 120 * sizeFactor\r\n//    height: number = 80 * sizeFactor\r\n//}\r\n//\r\n//export class Factory extends Structure {\r\n//    name: string = 'Factory'\r\n//    description: string = 'assembly'\r\n//    view: string = 'FactoryView'\r\n//}\r\n\r\n// lab, mine, warehouse/storage, kitchen, workshop, factory\r\n\r\n// huge octagonal generating station with four 'slots'\r\n// for sub-structures (add-ons) which auto-generate data/ore\r\n// for the central 'power' slot ...\r\n// ...you can build either...\r\n// ...a mini black hole or mini sun\r\n// (the sun takes ore and the hole takes data?)\r\nexport class PowerPlant extends Structure {\r\n    name: string = 'Power Plant'\r\n    description: string = 'sunny day'\r\n    view: string = 'PowerPlantView'\r\n    width: number = major.eighth //30 * majorUnit\r\n    height: number = major.eighth // 30 * majorUnit\r\n}","import { Building } from './Building';\r\n\r\nimport { AccessTunnelView } from './AccessTunnelView';\r\nimport { CommonAreaView } from './CommonAreaView';\r\nimport { DomeView } from './DomeView';\r\nimport { MissionControlView } from './MissionControlView';\r\nimport { TunnelView } from './TunnelView';\r\nimport { LivingQuartersView } from './LivingQuartersView';\r\n\r\nexport {\r\n    Building,\r\n\r\n    AccessTunnelView,\r\n    CommonAreaView,\r\n    DomeView,\r\n    MissionControlView,\r\n    TunnelView,\r\n    LivingQuartersView,\r\n}","\r\nexport enum Orientation { Left, Up, Right, Down } //, Angle }\r\n\r\nexport function flip(orientation: Orientation): Orientation {\r\n    switch (orientation) {\r\n        case Orientation.Left: return Orientation.Right\r\n        case Orientation.Right: return Orientation.Left\r\n        case Orientation.Up: return Orientation.Down\r\n        case Orientation.Down: return Orientation.Up\r\n    }\r\n}","import { Vector } from \"excalibur\";\r\n\r\nconst extremumBy = (arr, pluck, extremum) => {\r\n  return arr.reduce(function(best, next) {\r\n    var pair = [ pluck(next), next ];\r\n    if (!best) {\r\n       return pair;\r\n    } else if (extremum.apply(null, [ best[0], pair[0] ]) == best[0]) {\r\n       return best;\r\n    } else {\r\n       return pair;\r\n    }\r\n  },null)[1];\r\n}\r\n\r\nexport const minBy = (arr, fn) => extremumBy(arr, fn, Math.min)\r\nexport const maxBy = (arr, fn) => extremumBy(arr, fn, Math.max)\r\n\r\n\r\nexport const sample = (arr) => arr[Math.floor(Math.random() * arr.length)]\r\n\r\nexport const range = (n) => Array(n).fill(0).map((_val,idx) => idx)\r\n\r\nexport function closest<T>(cursor: Vector, arr: Array<T>, getVector: (T) => Vector, predicate?: (T) => boolean) {\r\n   let matching: Array<T> = arr;\r\n   if (predicate) { arr = arr.filter(predicate) }\r\n   if (matching) {\r\n      let distanceToCursor = (elem: T) => cursor.distance(getVector(elem)) //vec) => cursor.distance(vec)\r\n      return minBy(matching, distanceToCursor)\r\n   }\r\n}\r\n\r\nexport const flatSingle = arr => [].concat(...arr);\r\n\r\nexport const deleteByValue = (arr, elem) => arr.filter(e => e !== elem)\r\n\r\nexport function eachCons(a, n) {\r\n  var r = []\r\n  for (var i = 0; i < a.length - n + 1; i++) {\r\n    r.push(_ecRange(a, i, n))\r\n  }\r\n  return r\r\n}\r\n\r\nfunction _ecRange (a, i, n) {\r\n  var r = []\r\n  for (var j = 0; j < n; j++) {\r\n    r.push(a[i + j])\r\n  }\r\n  return r\r\n}\r\n\r\nexport const measureDistance = (a: Vector, b: Vector) => a.distance(b)","import { Actor, Vector, CollisionType, Color, Label } from \"excalibur\";\r\nimport { Planet } from \"../Planet/Planet\";\r\nimport { Structure } from \"../../models/Structure\";\r\nimport * as ex from 'excalibur';\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip } from \"../../values/Orientation\";\r\nimport { Citizen } from \"../Citizen\";\r\nimport { Game } from \"../../Game\";\r\nimport { Rectangle } from \"../../values/Rectangle\";\r\nimport { closest, flatSingle, measureDistance } from \"../../Util\";\r\nimport { Graph } from \"../../values/Graph\";\r\nimport { ResourceBlock, blockColor } from \"../../models/Economy\";\r\n\r\nexport class Building extends Actor {\r\n    label: Label\r\n    built: boolean = false\r\n    hover: boolean = false\r\n    showLabel: boolean = false\r\n    facing: Orientation = Orientation.Right\r\n    edgeWidth: number = 4\r\n    hideBox: boolean = false\r\n    parentSlot: Slot\r\n    childrenBuildings: Building[] = []\r\n    product: ResourceBlock[] = []\r\n    capacity: number = 4\r\n\r\n    constructor(public structure: Structure, protected planet: Planet) {\r\n        super(\r\n          structure.origin.x,\r\n          structure.origin.y,\r\n          structure.width,\r\n          structure.height,\r\n          planet.color\r\n        )\r\n        this.anchor = new ex.Vector(0,0)\r\n\r\n        this.setup();\r\n        this.traits = this.traits.filter(trait => !(trait instanceof ex.Traits.OffscreenCulling))\r\n\r\n        this.on('pointerenter', () => {\r\n            this.hover = true\r\n        })\r\n\r\n        this.on('pointerleave', () => {\r\n            this.hover = false\r\n        })\r\n\r\n        this.collisionType = CollisionType.PreventCollision\r\n\r\n        this.label = new Label(this.structure.name, 0, 0, 'Helvetica')\r\n        this.label.color = Color.White\r\n    }\r\n\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        if (!this.hideBox) {\r\n            this.drawRect(ctx, this.aabb(), this.edgeWidth)\r\n        }\r\n\r\n        this.product.forEach((produced, index) => {\r\n            ctx.fillStyle = blockColor(produced).desaturate(0.3).lighten(0.2).toRGBA();\r\n            ctx.fillRect(this.x + 20 * index, this.y - 20, 18, 18)\r\n        })\r\n\r\n        if (this.showLabel) {\r\n            this.label.pos = this.getCenter()\r\n            this.label.pos.x -= ctx.measureText(this.structure.name).width / 2\r\n            this.label.draw(ctx, delta)\r\n        }\r\n\r\n        let debug = false;\r\n        if (debug) {\r\n            if (this.slots().length > 0) {\r\n                // draw slots\r\n                this.slots().forEach((slot: Slot) => {\r\n                    let rect: Rectangle = { x: slot.pos.x, y: slot.pos.y, width: 3, height: 3 }\r\n                    this.drawRect(ctx, rect, 1, Color.Gray.lighten(0.5))\r\n                })\r\n            }\r\n            if (this.nodes().length > 0) {\r\n                // draw nodes\r\n                this.nodes().forEach((node: Vector) => {\r\n                    let rect: Rectangle = { x: node.x, y: node.y, width: 4, height: 4 }\r\n                    this.drawRect(ctx, rect, 1, Color.Yellow.lighten(0.5))\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    step: number = 0\r\n    update(engine: Game, delta: number) {\r\n        super.update(engine, delta)\r\n        // if (this.step % 100 === 0) {\r\n            let tryProduce = this.built && this.produces && this.product.length < this.capacity;\r\n            if (tryProduce) {\r\n                this.produce(this.step);\r\n            }\r\n        // }\r\n        this.step += 1\r\n    }\r\n\r\n    setup(): void {}\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        return cursor.clone();\r\n    } \r\n    reshape(cursor: Vector): void {\r\n        this.pos = cursor.clone()\r\n    }\r\n\r\n    afterConstruct(): void {}\r\n\r\n    handleClick(cursor: Vector): boolean { return true; }\r\n\r\n    slots(): Slot[] {\r\n        return []\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y)-4)\r\n        ];\r\n    }\r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph\r\n        // assemble subgraph\r\n        let nodes = this.nodes()\r\n        let rootNode = g.findOrCreate(nodes[0], measureDistance)\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            g.edge(rootNode, slot)\r\n\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(slot, childNode)\r\n\r\n            child.graph(g)\r\n        }\r\n        return g\r\n    }\r\n\r\n    get produces() { return this.structure.produces }\r\n    get consumes() { return this.structure.consumes }\r\n    get productionTime() { return this.structure.productionTime }\r\n\r\n    async interact(citizen: Citizen) {\r\n        if (this.product.length > 0) {\r\n            citizen.carry(this.produces)\r\n            this.product.pop()\r\n        } else {\r\n            if (this.consumes && citizen.carrying === this.consumes) {\r\n                await citizen.progressBar(this.productionTime)\r\n                citizen.carry(this.produces)\r\n            }\r\n        }\r\n    }\r\n\r\n    protected produce(step: number) {\r\n        if (this.produces && !this.consumes && step % this.productionTime === 0) {\r\n            let shouldProduce = true;\r\n            if (shouldProduce) {\r\n                this.product.push(this.produces)\r\n                console.log(\"PRODUCE\", { produces: this.produces, product: this.product })\r\n            }\r\n        }\r\n    }\r\n\r\n    protected drawRect(ctx: CanvasRenderingContext2D, rectangle: Rectangle, edgeWidth: number = 5, color: Color = null) {\r\n        let { x, y, width, height } = rectangle;\r\n\r\n        let edge = color || this.edgeColor();\r\n        ctx.fillStyle = edge.toRGBA();\r\n        ctx.fillRect(x, y, width, height)\r\n\r\n        let main = color || this.mainColor();\r\n        ctx.fillStyle = main.toRGBA();\r\n        ctx.fillRect(\r\n            x + edgeWidth,\r\n            y + edgeWidth,\r\n            width - edgeWidth*2,\r\n            height - edgeWidth*2\r\n        )\r\n    }\r\n\r\n    protected aabb(): Rectangle {\r\n        return {\r\n            x: this.pos.x,\r\n            y: this.pos.y,\r\n            width: this.getWidth(),\r\n            height: this.getHeight()\r\n        }\r\n    }\r\n\r\n    protected overlaps(other: Building): boolean {\r\n        let rect1 = this.aabb(), rect2 = other.aabb();\r\n        let doesOverlap = (\r\n            rect1.x < rect2.x + rect2.width &&\r\n            rect1.x + rect1.width > rect2.x &&\r\n            rect1.y < rect2.y + rect2.height &&\r\n            rect1.y + rect1.height > rect2.y\r\n        )\r\n        return(!!doesOverlap);\r\n    }\r\n\r\n    public overlapsAny(): boolean {\r\n        return !!this.planet.buildings.find(bldg => bldg !== this && this.overlaps(bldg))\r\n    }\r\n\r\n    protected edgeColor(): Color {\r\n        let edge = this.processedColor().lighten(0.85);\r\n        return edge;\r\n    }\r\n\r\n    protected mainColor(): Color {\r\n        let main = this.processedColor().darken(0.08);\r\n        return main;\r\n    }\r\n\r\n    protected colorBase(): Color {\r\n        return this.color;\r\n    }\r\n\r\n    protected processedColor(): Color {\r\n        let clr = this.colorBase().clone();\r\n        if (!this.built)  { \r\n            if (this.overlapsAny()) { clr = Color.Red }\r\n            clr.a = 0.8\r\n        }\r\n        if (this.hover) { clr.a = 0.5 }\r\n        return clr;\r\n    }\r\n\r\n    protected validConnectingStructures(): (typeof Structure)[] {\r\n        return [ ];\r\n    }\r\n\r\n    protected validConnectingDirections(): Orientation[] {\r\n        return [\r\n            Orientation.Up,\r\n            Orientation.Down,\r\n            Orientation.Left,\r\n            Orientation.Right\r\n        ]\r\n    }\r\n\r\n    protected findSlot(pos: Vector): Slot {\r\n        let buildings = this.validConnectingStructures().map(structure =>\r\n            this.planet.closestBuildingByType(pos, [structure])\r\n        )\r\n        let slotList = flatSingle(buildings.map(building => building ? building.slots() : []))\r\n\r\n\r\n        // select slots that COULD match one of our faces (and do so 'legally'...)\r\n        slotList = slotList.filter((slot: Slot) => \r\n            this.validConnectingDirections().includes(slot.facing) &&\r\n              this.slots().some((ourSlot: Slot) => slot.facing === flip(ourSlot.facing))\r\n        )\r\n        if (slotList.length > 0) {\r\n            return closest(pos, slotList, (slot) => slot.pos)\r\n        }\r\n    }\r\n\r\n    protected alignToSlot(cursor: Vector) {\r\n        let theSlot = this.findSlot(cursor)\r\n        if (theSlot) {\r\n            // position us so our slot lines up\r\n            let matchingSlot = this.slots().find(s => s.facing == flip(theSlot.facing))\r\n            if (matchingSlot) {\r\n                let offset = theSlot.pos.sub(matchingSlot.pos)\r\n                this.pos.addEqual(offset)\r\n\r\n                this.parentSlot = theSlot;\r\n                return theSlot;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected buildSlot(x: number, y: number, facing: Orientation = Orientation.Right): Slot {\r\n        return {\r\n            pos: new Vector(x,y),\r\n            facing,\r\n            parent: this\r\n        }\r\n    }\r\n}","import { Color } from \"excalibur\";\r\n\r\nexport enum ResourceBlock {\r\n    // base\r\n    Food = 'Food',\r\n    Ore = 'Ore',\r\n    Data = 'Data',\r\n    // derived\r\n    Meal = 'Meal',\r\n    Hypothesis = 'Hypothesis',\r\n    Mineral = 'Mineral'\r\n}\r\n\r\nconst blockColors: { [key in ResourceBlock]: Color } = {\r\n    Food: Color.Green,\r\n    Data: Color.Blue,\r\n    Mineral: Color.Red,\r\n\r\n    Meal: Color.Yellow.darken(0.2),\r\n    Hypothesis: Color.Violet.darken(0.4),\r\n    Ore: Color.Red.darken(0.5),\r\n\r\n}\r\n\r\nexport function blockColor(block: ResourceBlock) {\r\n    let baseColor = blockColors[block]\r\n    //Color.Violet\r\n    //switch(block) {\r\n    //    case ResourceBlock.Food: baseColor = Color.Green; break\r\n    //    case ResourceBlock.Ore:  baseColor = Color.Red; break\r\n    //    case ResourceBlock.Data: baseColor = Color.Blue; break\r\n    //    case ResourceBlock.Meal: baseColor = Color.Yellow; break\r\n    //}\r\n    return baseColor.desaturate(0.25).lighten(0.125)\r\n}\r\n\r\n","import { minBy } from \"../Util\";\r\n\r\nexport class Graph<T> {\r\n    private empty: boolean = true\r\n    public nodes: T[] = []\r\n    private edges: { [key: number]: number[] } = {}\r\n    private edgesInverse: { [key: number]: number[] } = {}\r\n\r\n    public isEmpty(): boolean {\r\n        return this.empty;\r\n    }\r\n\r\n    public get size() { return this.nodes.length }\r\n\r\n    public node(newNode: T) {\r\n        this.empty = false;\r\n        if (!this.contains(newNode)) {\r\n            this.nodes.push(newNode)\r\n        }\r\n    }\r\n\r\n    public contains(testNode: T) {\r\n        return this.nodes.includes(testNode)\r\n    }\r\n\r\n    public findOrCreate(testNode: T, measure: (a: T, b: T) => number, tolerance: number = 5): T {\r\n        let nodes = this.dfs();\r\n        let closest = minBy(nodes, (node: T) => measure(testNode, node))\r\n        if (closest && measure(closest, testNode) < tolerance) {\r\n            return closest;\r\n        }\r\n        return testNode;\r\n    }\r\n\r\n    public edge(src: T, dst: T) {\r\n        this.node(src)\r\n        this.node(dst)\r\n\r\n        let s = this.indexOf(src), d = this.indexOf(dst)\r\n        this.edges[s] = this.edges[s] || []\r\n        this.edges[s].push(d)\r\n\r\n        this.edgesInverse[d] = this.edgesInverse[d] || []\r\n        this.edgesInverse[d].push(s)\r\n    }\r\n\r\n    public union(otherGraph: Graph<T>) {\r\n       otherGraph.edgeList().forEach(([a,b]) => this.edge(a,b))\r\n    }\r\n\r\n    public edgeList(): [T,T][] {\r\n        let theEdges = []\r\n        for (let node of this.nodes) {\r\n            let index = this.indexOf(node)\r\n            if (this.edges[index]) {\r\n                for (let otherIndex of this.edges[index]) {\r\n                    let otherNode = this.nodes[otherIndex]\r\n                    if (!theEdges.includes([otherNode, node])) {\r\n                        theEdges.push([node, otherNode])\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return theEdges\r\n    }\r\n\r\n    public adjacent(testNode: T): T[] {\r\n        let index = this.indexOf(testNode)\r\n        let vertex = this.adjacentIndices(index)\r\n        return vertex.map((n) => this.nodes[n])\r\n    }\r\n\r\n    private adjacentIndices(testNodeIndex: number): number[] {\r\n        let es = this.edges[testNodeIndex] || []\r\n        let esInv = this.edgesInverse[testNodeIndex] || []\r\n        let vertex = [...es, ...esInv ]\r\n        return vertex\r\n    }\r\n\r\n    public dfs(root:T=null, visited=[]): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.dfsIndex(rIndex).map(n => this.nodes[n])\r\n    }\r\n\r\n    private dfsIndex(rootIndex:number=0, visited:number[]=[]) {\r\n        visited.push(rootIndex)\r\n        let children = this.adjacentIndices(rootIndex)\r\n        children.forEach((childIndex: number) => {\r\n            if (!visited.includes(childIndex)) {\r\n                this.dfsIndex(childIndex, visited)\r\n            }\r\n        })\r\n\r\n        return visited\r\n    }\r\n\r\n    public bfs(root:T=null, cb: (x: number,y: number)=>boolean = ()=>true): T[] {\r\n        let rIndex = root ? this.indexOf(root) : 0\r\n        return this.bfsIndex(rIndex, cb).map(n => this.nodes[n])\r\n    }\r\n\r\n    private bfsIndex(rootIndex:number=null, cb: (x: number, y: number) => boolean = () => true): number[] {\r\n        let halt = false;\r\n        let visited: number[] = []\r\n        visited.push(rootIndex)\r\n        while (visited.length < this.nodes.length) {\r\n            for (let visitedNode of visited) {\r\n                let adj: number[] = this.adjacentIndices(visitedNode)\r\n                for (let adjacentNode of adj) {\r\n                    if (!visited.includes(adjacentNode)) {\r\n                        if (!cb(visitedNode, adjacentNode)) {\r\n                            halt = true;\r\n                            break;\r\n                        }\r\n                        visited.push(adjacentNode)\r\n                    }\r\n                }\r\n                if (halt) break;\r\n            }\r\n            if (halt) break;\r\n        }\r\n        return visited\r\n    }\r\n\r\n    public shortestPath(src: T, dst: T, maxStep: number = 256): T[] {\r\n        let prevStep = {}\r\n        let dstIndex = this.indexOf(dst)\r\n        this.bfs(src, (prev, curr) => {\r\n            prevStep[curr] = prev;\r\n            return curr !== dstIndex\r\n        })\r\n        let path = []\r\n        let curr = dstIndex\r\n        let steps = 0\r\n        let srcIndex = this.indexOf(src)\r\n        while (!path.includes(srcIndex) && steps < maxStep) {\r\n            path.push(curr)\r\n            curr = prevStep[curr]\r\n            steps += 1\r\n        }\r\n        let pathNodes = path.map(n => this.nodes[n])\r\n        return pathNodes.reverse()\r\n    }\r\n\r\n    private indexOf(node: T) {\r\n        return this.nodes.indexOf(node)\r\n    }\r\n\r\n}","import { Engine, DisplayMode, Loader } from 'excalibur';\r\nimport { World } from './models/World';\r\nimport { Resources } from './Resources';\r\n\r\nexport class Game extends Engine {\r\n\r\n  static citizenSpeed: number = 100\r\n\r\n  constructor(public world: World) {\r\n    super({\r\n      width: 800,\r\n      height: 600,\r\n      displayMode: DisplayMode.FullScreen,\r\n      backgroundColor: world.skyColor\r\n    });\r\n  }\r\n  public start() { //loader: ex.Loader) {\r\n    let loader = new Loader();\r\n    for (let key in Resources) {\r\n      loader.addResource(Resources[key]);\r\n    }\r\n    return super.start(loader);\r\n  }\r\n}","import { CommonAreaView } from \".\";\r\nimport { AccessTunnel, Mine, Refinery } from \"../../models/Structure\";\r\n\r\nexport class RefineryView extends CommonAreaView {\r\n    validConnectingStructures() { return [ AccessTunnel, Mine, Refinery ]}\r\n\r\n}","import { CommonAreaView } from \".\";\r\n\r\nexport class StudyView extends CommonAreaView {}","import { Building } from \".\";\r\nimport { AccessTunnel } from \"../../models/Structure\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Vector } from \"excalibur\";\r\n\r\nexport class PowerPlantView extends Building {\r\n    showLabel = true\r\n\r\n    validConnectingStructures() { return [ AccessTunnel ]}\r\n\r\n    draw(ctx, delta) {\r\n        // octagon...\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    slots() {\r\n        let theSlots = []\r\n        let slotY = this.getHeight() / 2\r\n        let leftSlot: Slot = this.buildSlot(\r\n            this.pos.x,\r\n            this.pos.y + slotY,\r\n            Orientation.Left,\r\n        )\r\n        theSlots.push(leftSlot)\r\n\r\n        let rightSlot: Slot = this.buildSlot(\r\n            this.pos.x + this.getWidth(),\r\n            this.pos.y + slotY,\r\n            Orientation.Right,\r\n        )\r\n        theSlots.push(rightSlot)\r\n        return theSlots;\r\n    }\r\n\r\n   nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()/2 //-this.floorHeight\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y)) //-16)\r\n        ];\r\n    }\r\n\r\n    reshape(cursor) {\r\n        this.alignToSlot(cursor);\r\n    }\r\n\r\n\r\n}","import { CommonAreaView } from \".\";\r\nimport { Color } from \"excalibur\";\r\nimport { Citizen } from \"../Citizen\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\n\r\nexport class KitchenView extends CommonAreaView {\r\n}","import { Building, CommonAreaView } from \".\";\r\n\r\nexport class MessView extends CommonAreaView {\r\n\r\n}","import { CommonAreaView } from '.'\r\nimport { Color, Vector } from 'excalibur';\r\nimport { ResourceBlock } from '../../models/Economy';\r\nimport { AccessTunnel, Refinery, Mine } from '../../models/Structure';\r\n\r\nexport class MineView extends CommonAreaView {\r\n    floorHeight = 150\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight() - this.floorHeight\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y)-4)\r\n        ];\r\n    }\r\n\r\n    validConnectingStructures() { return [ AccessTunnel, Mine, Refinery ]}\r\n}","import { CommonAreaView } from \".\";\r\nimport { Color } from \"excalibur\";\r\nimport { Citizen } from \"../Citizen\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\n\r\nexport class LabView extends CommonAreaView {\r\n}","import { AccessTunnelView } from \".\";\r\nimport { MissionControl, Dome } from \"../../models/Structure\";\r\n\r\nexport class SurfaceRoadView extends AccessTunnelView {\r\n    edgeWidth: 0\r\n    // pickingOrigin: boolean = true\r\n    validConnectingStructures() {\r\n        return [ MissionControl, Dome ];\r\n    }\r\n}","import { Label, Color, Actor } from \"excalibur\";\r\nimport { ResourceBlock, blockColor } from \"../../models/Economy\";\r\nexport class ResourceListEntry extends Actor {\r\n    icon: Actor;\r\n    count: Label;\r\n    constructor(x: number, y: number, resourceBlock: ResourceBlock, protected value: number) {\r\n        super(x, y, 10, 10); // 10,10,blockColor(resourceBlock))\r\n        let icon = new Actor(x, y, 10, 10, blockColor(resourceBlock)); //ResourceBlock.Meal))\r\n        this.add(icon);\r\n        this.count = new Label(`x${value}`, x + 10, y + 8, 'Helvetica');\r\n        this.count.fontSize = 12;\r\n        this.count.color = Color.White;\r\n        this.add(this.count);\r\n    }\r\n    credit(amt: number) {\r\n        this.value += amt;\r\n        this.count.text = `x${this.value}`;\r\n    }\r\n}\r\n","import { Color, Actor } from \"excalibur\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\nimport { ResourceListEntry } from \"./ResourceListEntry\";\r\nexport class ResourcesList extends Actor {\r\n    entries: {\r\n        [block in ResourceBlock]: ResourceListEntry;\r\n    } = {\r\n            // non-accruable\r\n            [ResourceBlock.Food]: null,\r\n            [ResourceBlock.Hypothesis]: null,\r\n            [ResourceBlock.Ore]: null,\r\n            // displayed/accruable\r\n            [ResourceBlock.Meal]: null,\r\n            [ResourceBlock.Mineral]: null,\r\n            [ResourceBlock.Data]: null,\r\n        };\r\n\r\n    constructor(x: number, y: number) {\r\n        super(x, y, 60, 60, Color.DarkGray.darken(0.8));\r\n        let rx0 = -8, ry0 = -10;\r\n        let resources = [ResourceBlock.Meal, ResourceBlock.Data, ResourceBlock.Mineral];\r\n        resources.forEach((resource, index) => {\r\n            let rx = rx0, ry = ry0 + index * 10;\r\n            let entry = new ResourceListEntry(rx, ry, resource, 0);\r\n            this.add(entry);\r\n            this.entries[resource] = entry;\r\n        });\r\n    }\r\n\r\n    increment(resource: ResourceBlock) {\r\n        this.entries[resource].credit(1);\r\n    }\r\n}\r\n","import { Label, UIActor, Color } from \"excalibur\";\r\nimport { Dome, Structure, AccessTunnel, CommonArea, LivingQuarters, SurfaceRoad, Mine, Laboratory, Kitchen, Mess, PowerPlant, Study, Refinery } from \"../../models/Structure\";\r\nimport { Game } from \"../../Game\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\nimport { ResourcesList } from \"./ResourcesList\";\r\n\r\nexport class Hud extends UIActor {\r\n    label: Label\r\n    resources: ResourcesList\r\n    protected _paletteElement: HTMLDivElement\r\n    static structuresForPalette = [\r\n        AccessTunnel, CommonArea,\r\n        SurfaceRoad,\r\n\r\n        LivingQuarters, \r\n        Dome, Kitchen, Mess,\r\n\r\n        Study, Laboratory,\r\n        Mine, Refinery,\r\n        PowerPlant\r\n    ];\r\n    constructor(game: Game, message = 'welcome to osiris', protected onBuildingSelect = null) {\r\n        super(0, 0);\r\n        this.label = new Label(message, 20, game.canvasHeight - 64, 'Helvetica')\r\n        this.label.fontSize = 32\r\n        this.label.color = Color.White\r\n        this.add(this.label)\r\n\r\n        this._makePalette(onBuildingSelect)\r\n\r\n        this.resources = new ResourcesList(50, 40)\r\n        this.add(this.resources)\r\n    }\r\n\r\n\r\n    message(text: string) { this.label.text = text }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta)\r\n\r\n        if (this._paletteElement) {\r\n            let left = ctx.canvas.offsetLeft;\r\n            let top = ctx.canvas.offsetTop;\r\n            this._paletteElement.style.left = `${left + 20}px`;\r\n            this._paletteElement.style.top = `${top + 100}px`;\r\n        }\r\n    }\r\n\r\n    resourceGathered(resource: ResourceBlock) {\r\n        this.resources.increment(resource)\r\n    }\r\n\r\n\r\n    protected _makePalette(fn: (Structure) => any) {\r\n        this._paletteElement = document.createElement('div') \r\n        this._paletteElement.style.position = 'absolute'\r\n        this._paletteElement.style.border = '1px solid white'\r\n        document.body.appendChild(this._paletteElement)\r\n\r\n        Hud.structuresForPalette.forEach((structure: typeof Structure) => {\r\n            let s = new structure()\r\n            let _paletteButton = this.buttonFactory(s);\r\n            this._paletteElement.appendChild(\r\n                _paletteButton\r\n            )\r\n\r\n            _paletteButton.onclick = (e) => {\r\n                fn(s)\r\n                // e.stopPropagation()\r\n            }\r\n        });\r\n    }\r\n\r\n    private buttonFactory(s: Structure) {\r\n        let bg = Color.DarkGray.darken(0.8) //.desaturate(0.25) //.toRGBA()\r\n        bg.a = 0.6\r\n        let fg = Color.Blue.lighten(0.8).desaturate(0.55) //.toRGBA()\r\n        let paletteButton = document.createElement('button');\r\n        paletteButton.textContent = `${s.name}`;\r\n        paletteButton.style.display = 'block';\r\n        paletteButton.style.fontSize = '10pt';\r\n\r\n        paletteButton.style.fontFamily = 'Helvetica';\r\n        paletteButton.style.fontWeight = '600';\r\n        paletteButton.style.padding = '8px';\r\n        paletteButton.style.width = '130px';\r\n        paletteButton.style.textTransform = 'uppercase'\r\n        paletteButton.style.border = 'none' //0.1px solid blue'\r\n        paletteButton.style.background = bg.toRGBA(); //Color.Blue.darken(0.08).toRGBA();\r\n        paletteButton.style.color = fg.toRGBA() //Color.Blue.lighten(0.16).toRGBA();\r\n        paletteButton.onmouseover = () => {\r\n            paletteButton.style.background = bg.lighten(0.4).toRGBA()\r\n            paletteButton.style.color = fg.lighten(0.9).toRGBA() //Color.Blue.lighten(0.16).toRGBA();\r\n        }\r\n        paletteButton.onmouseleave = () => {\r\n            //paletteButton.style.background = bg.toRGBA()\r\n            paletteButton.style.background = bg.toRGBA(); //Color.Blue.darken(0.08).toRGBA();\r\n            paletteButton.style.color = fg.toRGBA() //Color.Blue.lighten(0.16).toRGBA();\r\n        } // Color.Blue.toRGBA() }\r\n\r\n        return paletteButton;\r\n    }\r\n}","import { CommonAreaView } from \".\";\r\n\r\nexport class LivingQuartersView extends CommonAreaView {\r\n    // edgeWidth: number = 2\r\n    afterConstruct() {\r\n        // console.log(\"AFTER CONSTRUCT LIVING QUARTERS\")\r\n        setTimeout(() => this.planet.populate(this.pos), 100)\r\n    }\r\n\r\n}","import { Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { MissionControl } from \"../../models/Structure\";\r\nimport { range, eachCons, measureDistance } from \"../../Util\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Orientation, flip } from \"../../values/Orientation\";\r\nimport { Graph } from \"../../values/Graph\";\r\n\r\nexport class TunnelView extends Building {\r\n    pickingOrigin: boolean = true\r\n    edgeWidth = 2\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y\r\n        return [\r\n            new Vector(Math.floor(x), y) //, Math.floor(y)-4)\r\n        ];\r\n    }\r\n\r\n    graph(supergraph: Graph<Vector> = new Graph()): Graph<Vector> {\r\n        let g = supergraph;\r\n\r\n        let halfWidth = this.getWidth()/2\r\n        let x = this.pos.x + halfWidth\r\n\r\n        // connect node to first slot...\r\n        let root = g.findOrCreate(this.nodes()[0], measureDistance)\r\n        let first = g.findOrCreate(new Vector(x,this.slotHeights()[0]), measureDistance)\r\n        g.edge(root,first)\r\n\r\n        eachCons(this.slotHeights(), 2).forEach(([y0,y1]: [number,number]) => {\r\n            let top = g.findOrCreate(new Vector(x,y0), measureDistance)\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n            g.edge(top, btm)\r\n        })\r\n        this.slotHeights().forEach(y1 => {\r\n            let btm = g.findOrCreate(new Vector(x,y1), measureDistance)\r\n\r\n            let left = g.findOrCreate(new Vector(x-halfWidth,y1), measureDistance)\r\n            g.edge(left,btm)\r\n\r\n            let right = g.findOrCreate(new Vector(x+halfWidth,y1), measureDistance)\r\n            g.edge(btm,right)\r\n        });\r\n\r\n        for (let child of this.childrenBuildings) {\r\n            let slot = g.findOrCreate(child.parentSlot.pos, measureDistance)\r\n            let childNode = g.findOrCreate(child.nodes()[0], measureDistance)\r\n            g.edge(childNode, slot)\r\n\r\n            child.graph(g)\r\n        }\r\n\r\n        return g;\r\n    }\r\n\r\n    private slotHeights() {\r\n        let slotSize = 40\r\n        let slotCount = Math.floor((this.getHeight()-60) / slotSize)\r\n        let heights = []\r\n        for (let i of range(slotCount)) {\r\n            heights.push(\r\n                100 + this.pos.y + i * slotSize,\r\n            )\r\n        }\r\n        return heights\r\n    }\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y,\r\n                Orientation.Up\r\n            )\r\n        )\r\n\r\n        for (let y of this.slotHeights()) {\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x, y,\r\n                    Orientation.Left\r\n                )\r\n            )\r\n\r\n            theSlots.push(\r\n                this.buildSlot(\r\n                    this.pos.x + this.getWidth(),\r\n                    y,\r\n                    Orientation.Right,\r\n                )\r\n            )\r\n        }\r\n        return theSlots;\r\n    } \r\n\r\n    validConnectingStructures() { return [ MissionControl ] }\r\n    validConnectingDirections() { return [ Orientation.Down ] }\r\n\r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        if (this.pickingOrigin) {\r\n            this.alignToSlot(cursor)\r\n        } else {\r\n            // we're determining depth of tunnel\r\n            cursor.y = Math.max(this.planet.getTop() + 100, cursor.y)\r\n        }\r\n        return cursor;\r\n    }\r\n\r\n    // expand\r\n    reshape(cursor: Vector) {\r\n        this.pos.y = this.planet.getTop() + 2\r\n        if (!this.pickingOrigin) {\r\n          this.setHeight(cursor.y - this.planet.getTop())\r\n        }\r\n    }\r\n\r\n    colorBase() { return this.color.darken(0.2); }\r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { Citizen } from \"../Citizen\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { Slot } from \"../../values/Slot\";\r\n\r\nexport class MissionControlView extends Building {\r\n    hideBox = true\r\n\r\n    slots() {\r\n        let theSlots: Slot[] = []\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth()/2,\r\n                this.pos.y + this.getHeight(),\r\n                Orientation.Down\r\n            )\r\n        )\r\n\r\n        let slotY = this.getHeight();\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n           \r\n\r\n        return theSlots;\r\n    }\r\n\r\n    constrainCursor(cursor: Vector): Vector {\r\n        cursor.y = this.planet.getTop();\r\n        return cursor;\r\n    }\r\n\r\n    reshape(cursor: Vector) {\r\n        this.pos = cursor\r\n        this.pos.y -= this.getHeight() - 2 // + 1\r\n    }\r\n\r\n    async interact(citizen: Citizen) {\r\n        let resource = citizen.drop()\r\n        if (resource) {\r\n            this.planet.gather(resource)\r\n        }\r\n    }\r\n\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color = this.mainColor();\r\n\r\n        ctx.fillStyle = color.toRGBA()\r\n        // y is going to be surface height\r\n        ctx.fillRect(this.pos.x, this.pos.y, this.getWidth(), this.getHeight())\r\n\r\n        // could draw a little flag :)\r\n        let flagpoleHeight = 18\r\n        let flagX = this.pos.x + 3*(this.getWidth()/4)\r\n        let flagY = this.pos.y - flagpoleHeight\r\n        ctx.fillRect(flagX, flagY, 2, flagpoleHeight)\r\n        ctx.fillRect(flagX, flagY, 10, 5)\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White; }\r\n}","import { Color, Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { Citizen } from \"../Citizen\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { SurfaceRoad } from \"../../models/Structure\";\r\nimport { ResourceBlock } from \"../../models/Economy\";\r\n\r\n// we're constrained to the surface, so...\r\nexport class DomeView extends Building {\r\n    hideBox = true\r\n\r\n    slots() {\r\n        // left slot -- right slot\r\n        let theSlots = [];\r\n        let slotY = this.getHeight(); // / 2;\r\n\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n\r\n    reshape(cursor: Vector) {\r\n        this.alignToSlot(cursor)\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let color: Color = this.mainColor()\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(\r\n            this.pos.x + this.getWidth()/2,\r\n            this.pos.y + this.getHeight(),\r\n            this.getHeight()/1.5, // / 2,\r\n            0,\r\n            Math.PI,\r\n            true\r\n        )\r\n        ctx.closePath()\r\n        ctx.fillStyle = color.toRGBA()\r\n        ctx.fill()\r\n\r\n        super.draw(ctx, delta)\r\n    }\r\n\r\n    colorBase() { return Color.White.darken(0.05); } // this.baseColor; }\r\n\r\n    validConnectingStructures() { return [ SurfaceRoad ]; }\r\n}","import { Building } from \"./Building\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { AccessTunnel, Structure, CommonArea, Laboratory, LivingQuarters, Mine, Kitchen, Mess, Study } from \"../../models/Structure\";\r\nimport { Slot } from \"../../values/Slot\";\r\nimport { Vector } from \"excalibur\";\r\n\r\nexport class CommonAreaView extends Building {\r\n    floorHeight: number = 8\r\n    edgeWidth: number = 1\r\n    showLabel = true\r\n    // maybe you can set height AND width of common area view??\r\n\r\n    slots() {\r\n        let theSlots = []\r\n        let slotY = this.getHeight() - this.floorHeight\r\n        let leftSlot: Slot = this.buildSlot(\r\n            this.pos.x,\r\n            this.pos.y + slotY,\r\n            Orientation.Left,\r\n        )\r\n        theSlots.push(leftSlot)\r\n\r\n        let rightSlot: Slot = this.buildSlot(\r\n            this.pos.x + this.getWidth(),\r\n            this.pos.y + slotY,\r\n            Orientation.Right,\r\n        )\r\n        theSlots.push(rightSlot)\r\n        return theSlots;\r\n    }\r\n\r\n    nodes(): Vector[] {\r\n        let x = this.pos.x + this.getWidth()/2;\r\n        let y = this.pos.y + this.getHeight()-this.floorHeight\r\n        return [\r\n            new Vector(Math.floor(x), Math.floor(y)) //-16)\r\n        ];\r\n    }\r\n  \r\n    reshape(cursor) {\r\n        this.alignToSlot(cursor);\r\n    }\r\n\r\n    protected validConnectingStructures(): (typeof Structure)[] {\r\n        return [\r\n            AccessTunnel,\r\n            CommonArea,\r\n            Laboratory,\r\n            LivingQuarters,\r\n            Mess,\r\n            Kitchen,\r\n            Study,\r\n        ];\r\n    }\r\n}","import { Building } from \"./Building\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Orientation } from \"../../values/Orientation\";\r\nimport { MainTunnel, CommonArea, LivingQuarters, Laboratory, Mine, PowerPlant } from \"../../models/Structure\";\r\nimport { Slot } from \"../../values/Slot\";\r\n\r\nexport class AccessTunnelView extends Building {\r\n    edgeWidth: number = 0.4\r\n\r\n    pickingOrigin: boolean = true\r\n    facing: Orientation = Orientation.Left\r\n\r\n    slots() {\r\n        // left slot -- right slot\r\n        let theSlots: Slot[] = [];\r\n        let slotY = this.getHeight() / 2;\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x, this.pos.y + slotY,\r\n                Orientation.Left\r\n            )\r\n        )\r\n\r\n        theSlots.push(\r\n            this.buildSlot(\r\n                this.pos.x + this.getWidth(),\r\n                this.pos.y + slotY,\r\n                Orientation.Right\r\n            )\r\n        )\r\n\r\n        return theSlots;\r\n    } \r\n\r\n    \r\n    handleClick(cursor: Vector) {\r\n        if (this.pickingOrigin) {\r\n            this.pickingOrigin = false;\r\n            this.reshape(this.constrainCursor(cursor))\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    // picking a depth for a tunnel first?\r\n    constrainCursor(cursor: Vector): Vector {\r\n        let newCursor = cursor.clone();\r\n        if (this.pickingOrigin) {\r\n        } else {\r\n            newCursor.y = this.pos.y\r\n        }\r\n\r\n        return newCursor;\r\n    }\r\n\r\n    originX: number = 0\r\n    // expand\r\n    reshape(cursor: Vector) {\r\n\r\n        if (this.pickingOrigin) {\r\n            let theSlot = this.alignToSlot(cursor)\r\n            this.facing = theSlot.facing\r\n\r\n            if (theSlot && this.facing === Orientation.Left) {\r\n               this.originX = theSlot.pos.x\r\n            }\r\n\r\n        } else {\r\n            if (this.facing === Orientation.Left) {\r\n               this.setWidth(Math.abs(this.originX - cursor.x))\r\n               this.pos.x = this.originX - this.getWidth()\r\n            } else {\r\n                this.setWidth(Math.abs(this.pos.x - cursor.x))\r\n            }\r\n        }\r\n    }\r\n\r\n    validConnectingStructures() {\r\n        return [\r\n            MainTunnel,\r\n            CommonArea,\r\n            LivingQuarters,\r\n            Laboratory,\r\n            Mine,\r\n            PowerPlant\r\n        ];\r\n    }\r\n\r\n}","import * as ex from 'excalibur';\r\n\r\nexport class Player extends ex.Actor {\r\n  constructor() {\r\n    super();\r\n    this.setWidth(5);\r\n    this.setHeight(5);\r\n    this.x = 5;\r\n    this.y = 5;\r\n    this.color = new ex.Color(255, 255, 255);\r\n  }\r\n}\r\n","import { Graph } from \"../../values/Graph\";\r\nimport { Vector } from \"excalibur\";\r\nimport { Building } from \"../Building\";\r\nimport { minBy } from \"../../Util\";\r\n\r\nexport class NavigationTree {\r\n   graph: Graph<Vector>\r\n\r\n   constructor(root: Building) {\r\n       this.graph = root.graph()\r\n   }\r\n\r\n   seekPath(origin: Vector, dest: Vector): Vector[] {\r\n      return this.graph.shortestPath(origin, dest)\r\n   }\r\n\r\n   closestNode(testNode: Vector) {\r\n       let nodes = this.graph.dfs()\r\n       let closest = minBy(nodes,\r\n           (node: Vector) => Math.abs(testNode.distance(node))\r\n       )\r\n       if (closest) {\r\n           return closest\r\n       }\r\n       return false\r\n   }\r\n}","import { Actor, Color } from 'excalibur';\r\nimport { range } from '../../Util';\r\n\r\nclass PlanetBackground extends Actor {\r\n    constructor(y: number, width: number, color: Color) {\r\n        super(0, y, width, 500, color); // y + size, size, layerSize, color.darken(0.2))\r\n    }\r\n}\r\n\r\nexport class Mountains extends PlanetBackground {\r\n    peaks: {\r\n        x: number;\r\n        height: number;\r\n    }[] = [];\r\n    onInitialize() {\r\n        let peakCount = 20; // Math.floor(this.getWidth() / 2000)\r\n        let peakHeight = 3000;\r\n        // let mtnWidth = 180\r\n        // figure out mountain peaks?\r\n        // let yBase = this.pos.y //-1000 //this.pos.y //this.getHeight()\r\n        let xOff = this.getWidth() / 2;\r\n        let peakDistance = this.getWidth() / peakCount;\r\n        for (let times of range(5)) {\r\n            let heightRange = 100*times;\r\n            let drift = 3 * times * (peakDistance / 2);\r\n            for (let i of range(peakCount)) { //} / 2)) {\r\n                this.peaks.push({\r\n                    x: -xOff + i * peakDistance + ((Math.random() * drift) - (drift / 2)),\r\n                    height: Math.max(10, 1000 + (Math.random()*peakHeight) + ((Math.random() * heightRange)-(heightRange/2))) //(Util.randomIntInRange(-160,160))\r\n                    // y = yBase - peakHeight\r\n                });\r\n            }\r\n        }\r\n        // console.log({ peaks: this.peaks });\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        let baseColor = this.color.desaturate(0.25); //.toRGB\r\n        // baseColor.a = 0.6\r\n        let brightColor = this.color.saturate(0.2).lighten(0.5)\r\n        // super.draw(ctx, delta)\r\n        ctx.fillStyle = baseColor.toRGBA() // this.color.desaturate(0.45).lighten(0.15).toRGBA();\r\n        //let peakHeight = 250\r\n        // let mtnWidth = 180\r\n        let yBase = this.pos.y-3; //-1000 //this.pos.y //this.getHeight()\r\n        // let xOff = this.getWidth() / 2\r\n        this.peaks.forEach(peak => {\r\n            let y0 = yBase - peak.height;\r\n            let mtnWidth = peak.height * 3.4;\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x - mtnWidth, yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n\r\n            ctx.fillStyle = baseColor.toRGBA() // this.color.desaturate(0.45).lighten(0.15).toRGBA();\r\n            ctx.fill();\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(peak.x, y0);\r\n            ctx.lineTo(peak.x + 3*(mtnWidth/4), yBase);\r\n            ctx.lineTo(peak.x + mtnWidth, yBase);\r\n            ctx.fillStyle = brightColor.toRGBA() // this.color.desaturate(0.45).lighten(0.15).toRGBA();\r\n            ctx.fill();\r\n\r\n        });\r\n    }\r\n}","const majorUnit = 16\r\nconst minorUnit = 4\r\n\r\nconst majorScale = {\r\n    first: majorUnit,\r\n    second: majorUnit * 2,\r\n    third: majorUnit * 3,\r\n    fourth: majorUnit * 4,\r\n    fifth: majorUnit * 5,\r\n    sixth: majorUnit * 6,\r\n    seventh: majorUnit * 7,\r\n    eighth: majorUnit * 8,\r\n}\r\n\r\nconst minorScale = {\r\n    first:   minorUnit,\r\n    second:  minorUnit * 2,\r\n    third:   minorUnit * 3,\r\n    fourth:  minorUnit * 4,\r\n    fifth:   minorUnit * 5,\r\n    sixth:   minorUnit * 6,\r\n    seventh: minorUnit * 7,\r\n    eighth:  minorUnit * 8,\r\n}\r\n\r\nexport const Scale = {\r\n    major: majorScale,\r\n    minor: minorScale\r\n}","import { Actor, Color, Traits, Vector } from \"excalibur\";\r\nimport { Building } from \"./Building\";\r\nimport { Planet } from \"./Planet/Planet\";\r\nimport { Structure, MissionControl, Laboratory, Mine, Dome, Kitchen, Study, Refinery } from \"../models/Structure\";\r\nimport { ResourceBlock, blockColor } from \"../models/Economy\";\r\nimport { Game } from \"../Game\";\r\n\r\nexport class Citizen extends Actor {\r\n    walkSpeed: number = Game.citizenSpeed\r\n    carrying: ResourceBlock = null\r\n    path: Vector[] = []\r\n\r\n    workInProgress: boolean = false\r\n    workStarted: number\r\n    workDuration: number\r\n    progress: number\r\n\r\n    constructor(building: Building, protected planet: Planet) {\r\n        super(building.nodes()[0].x,building.nodes()[0].y,4,10,Color.White)\r\n        this.traits = this.traits.filter(trait => !(trait instanceof Traits.OffscreenCulling))\r\n    }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n        // check wip\r\n        if (this.workInProgress) {\r\n            let now = (new Date()).getTime()\r\n            this.progress = (now - this.workStarted) / this.workDuration //0.5\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n        super.draw(ctx, delta)\r\n        if (this.carrying) {\r\n            ctx.fillStyle = blockColor(this.carrying).toRGBA()\r\n            ctx.fillRect(this.x+4, this.y-3, 5, 5)\r\n        }\r\n\r\n        if (this.workInProgress) {\r\n            let pw = 10, ph = 3\r\n            let px = this.x - pw/2, py = this.y - 10;\r\n            // draw progress bar?\r\n            ctx.strokeStyle = Color.White.toRGBA()\r\n            // ctx.stroke(20)\r\n            ctx.strokeRect(px, py, pw, ph)\r\n\r\n            ctx.fillStyle = Color.Violet.darken(0.9).toRGBA()\r\n            ctx.fillRect(px, py, pw, ph)\r\n            ctx.fillStyle = Color.Violet.toRGBA()\r\n            ctx.fillRect(px, py, this.progress * pw, ph)\r\n\r\n            this.vel.x += (Math.random())-0.5 // * 10.0)\r\n        }\r\n    }\r\n\r\n    carry(c: ResourceBlock) { //c: Color) {\r\n        this.carrying = c;\r\n    }\r\n\r\n    drop(): ResourceBlock {\r\n        if (this.carrying) {\r\n            let c = this.carrying; //.clone();\r\n            this.carrying = null;\r\n            return c\r\n        }\r\n        return null\r\n    }\r\n\r\n    glideTo(pos: Vector) {\r\n        return this.actions.moveTo(pos.x, pos.y, this.walkSpeed).asPromise()\r\n    }\r\n\r\n    async progressBar(duration: number) {\r\n        // console.log(\"PROGRESS BAR\")\r\n        this.workInProgress = true\r\n        this.workStarted = (new Date()).getTime()\r\n        this.workDuration = duration\r\n        await new Promise((resolve, reject) => setTimeout(resolve, duration));\r\n        // console.log(\"PROGRESS BAR DONE!\")\r\n        this.workInProgress = false\r\n    }\r\n\r\n    async walkTo(building: Building) { //}, onArrival: (Building) => any) {\r\n        // let building = this.planet.closestBuildingByType(this.pos, structure)\r\n\r\n        let path = this.planet.pathBetween(this.pos.clone(), building)\r\n\r\n        if (path.length > 0) {\r\n            this.path = path\r\n            await Promise.all(\r\n                path.map(step => this.glideTo(step))\r\n            )\r\n            this.path = null\r\n            // onArrival(building);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n    async work() {\r\n        if (this.carrying) {\r\n            // console.log(\"carrying\", this.carrying)\r\n            let item: ResourceBlock = this.carrying;\r\n            let sinks = []\r\n\r\n            // what structure consumes what i'm carrying?\r\n            // could check in a list\r\n            if (ResourceBlock[item] === 'Food') {\r\n                sinks = [Kitchen]\r\n            } else if (ResourceBlock[item] === 'Hypothesis') {\r\n                sinks = [Laboratory]\r\n            } else if (ResourceBlock[item] === 'Ore') {\r\n                sinks = [Refinery]\r\n            } else {\r\n                sinks = [MissionControl]\r\n            }\r\n\r\n            if (sinks.length > 0) {\r\n                let theSink = this.planet.closestBuildingByType(this.pos, sinks)\r\n                if (theSink) {\r\n                    await this.walkTo(theSink)\r\n                    await theSink.interact(this)\r\n                }\r\n            } else {\r\n                console.log(\"nowhere to deliver it\", this.carrying)\r\n            }\r\n        } else {\r\n            let source = this.planet.closestBuildingByType(this.pos,\r\n                [Dome, Mine, Study],\r\n                (building) => building.product.length > 0\r\n            )\r\n\r\n            if (source) {\r\n                await this.walkTo(source)\r\n                await source.interact(this)\r\n            } else {\r\n                console.log(\"i guess i can try again? (sleep for a bit first)\")\r\n        await new Promise((resolve, reject) => setTimeout(resolve, 3000));\r\n                //etTimeout(() => this.work(), 500)\r\n            }\r\n        }\r\n\r\n        // console.log(\"DONE WORK\")\r\n        // this.work()\r\n        setTimeout(() => this.work(), 100)\r\n        // await new Promise((resolve, reject) => setTimeout(resolve, 500));\r\n        // await this.work()\r\n    }\r\n}","import * as ex from 'excalibur';\r\nimport { Actor, Color, Vector, Util, EdgeArea } from 'excalibur';\r\nimport { Building } from '../Building';\r\nimport { minBy, range } from '../../Util';\r\nimport { Citizen } from '../Citizen';\r\nimport { Mountains } from './PlanetBackground';\r\nimport { Structure, MissionControl, LivingQuarters } from '../../models/Structure';\r\nimport { NavigationTree } from './NavigationTree';\r\nimport { Hud } from '../Hud/Hud';\r\nimport { ResourceBlock } from '../../models/Economy';\r\n\r\nexport class Planet extends Actor {\r\n    \r\n    buildings: Building[] = []\r\n    citizens: Citizen[] = []\r\n    navTree: NavigationTree\r\n    currentlyConstructing: Building = null\r\n\r\n    constructor(\r\n        public hud: Hud,\r\n        // public effectiveY: number,\r\n        public color: Color,\r\n        public width: number = 2000000,\r\n        public depth: number = 1000000,\r\n        ) {\r\n        super(0, depth/2, width, depth, color)\r\n        this.traits = this.traits.filter(trait => !(trait instanceof ex.Traits.OffscreenCulling))\r\n\r\n        let yBase = -depth/2 // effectiveY + size/2\r\n        // crust\r\n        let crustHeight = 20\r\n        this.createLayer(yBase, crustHeight, this.color.lighten(0.25))\r\n\r\n\r\n        let layerCount = 10\r\n        let layerHeight = depth / layerCount \r\n        for (let i of range(layerCount)) {\r\n            this.createLayer(\r\n                yBase + crustHeight + (layerHeight/2) + (layerHeight * (i+1)),\r\n                layerHeight,\r\n                this.color.darken(0.05 + 0.01 * i)\r\n            )\r\n        }\r\n\r\n        this.add(new Mountains(-depth/2, this.getWidth(), this.color.lighten(0.15)))\r\n    }\r\n\r\n    private createLayer(y: number, size: number, color: Color) {\r\n        let theLayer = new Actor(0, y, this.getWidth(), size, color);\r\n        this.add(theLayer);\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, delta) {\r\n        super.draw(ctx, delta)\r\n       if (this.currentlyConstructing) {\r\n           this.currentlyConstructing.draw(ctx, delta)\r\n       }\r\n        this.buildings.forEach(building => building.draw(ctx, delta))\r\n\r\n        this.citizens.forEach(citizen => citizen.draw(ctx, delta))\r\n    }\r\n\r\n    update(engine, delta) {\r\n        super.update(engine, delta)\r\n\r\n        this.buildings.forEach(building => building.update(engine, delta))\r\n        this.citizens.forEach(citizen => citizen.update(engine, delta))\r\n    }\r\n\r\n    gather(resource: ResourceBlock): any {\r\n        this.hud.resourceGathered(resource)\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    placeBuilding(building: Building) {\r\n        building.built = true\r\n        // whew\r\n        if (building.parentSlot) {\r\n            building.parentSlot.parent.childrenBuildings.push(building)\r\n            // rebuild nav?\r\n            this.buildNavTree()\r\n        }\r\n        this.buildings.push(building);\r\n        building.afterConstruct()\r\n    }\r\n\r\n    populate(pos: Vector) {\r\n        let home = this.closestBuildingByType(pos, [LivingQuarters])\r\n        // console.log(\"populating\", { home })\r\n        let citizen = new Citizen(home, this)\r\n        citizen.work()\r\n        this.citizens.push(citizen)\r\n    }\r\n\r\n\r\n    closestBuildingByType(cursor: Vector, structureTypes: (typeof Structure)[], predicate: (Building) => boolean = ()=>true): Building {\r\n        let matching = this.buildings.filter(building => \r\n            structureTypes.some(structureType => (building.structure instanceof structureType)) &&\r\n              predicate(building)\r\n        )\r\n\r\n        if (matching && matching.length > 0) {\r\n            let distanceToCursor = (building) => cursor.distance(building.nodes()[0])\r\n            return minBy(matching, distanceToCursor)\r\n        }\r\n    }\r\n\r\n    pathBetween(origin: Vector, destination: Building): Vector[] {\r\n        if (!this.navTree) { this.buildNavTree() }\r\n        let srcNode = this.navTree.closestNode(origin)\r\n        let dest = destination.nodes()[0]\r\n        let destNode = this.navTree.closestNode(dest)\r\n        let path = this.navTree.seekPath(srcNode, destNode)\r\n        return path\r\n    }\r\n\r\n    private buildNavTree() {\r\n        let ctrl = this.buildings.find(building => building.structure instanceof MissionControl);\r\n        if (ctrl) {\r\n            this.navTree = new NavigationTree(ctrl)\r\n        }\r\n    }\r\n\r\n}","import { Scene, Input, UIActor, Label, Vector, LockCameraToActorStrategy } from \"excalibur\";\r\nimport { Game } from \"../Game\";\r\nimport { Planet } from \"../actors/Planet/Planet\";\r\nimport { Player } from \"../actors/player\";\r\nimport { Structure, MissionControl, MainTunnel, Dome, AccessTunnel, CommonArea, LivingQuarters, SurfaceRoad, Kitchen, Mess } from \"../models/Structure\";\r\nimport { Building, DomeView, AccessTunnelView, CommonAreaView, TunnelView, MissionControlView, LivingQuartersView } from \"../actors/Building\";\r\nimport { Hud } from \"../actors/Hud/Hud\";\r\nimport { SurfaceRoadView } from \"../actors/Building/SurfaceRoadView\";\r\nimport { LabView } from \"../actors/Building/LabView\";\r\nimport { MineView } from \"../actors/Building/MineView\";\r\nimport { MessView } from \"../actors/Building/MessView\";\r\nimport { KitchenView } from \"../actors/Building/KitchenView\";\r\nimport { PowerPlantView } from \"../actors/Building/PowerPlantView\";\r\nimport { StudyView } from \"../actors/Building/StudyView\";\r\nimport { RefineryView } from \"../actors/Building/RefineryView\";\r\n\r\n\r\nexport class Construct extends Scene {\r\n    game: Game\r\n    planet: Planet\r\n    hud: Hud\r\n    player: Player\r\n    // buildings: Building[] = []\r\n    // people: Citizen[] = []\r\n\r\n    dragging: boolean = false\r\n    dragOrigin: Vector\r\n\r\n    // currentlyBuilding?: Building\r\n\r\n    static structureViews: { [key: string]: typeof Building } = {\r\n        TunnelView,\r\n        MissionControlView, //: new MissionControlView()\r\n        DomeView,\r\n        AccessTunnelView,\r\n        CommonAreaView,\r\n        LivingQuartersView,\r\n        SurfaceRoadView,\r\n        LabView,\r\n        MineView,\r\n        KitchenView,\r\n        MessView,\r\n        PowerPlantView,\r\n        StudyView,\r\n        RefineryView,\r\n    }\r\n    ////\r\n    static requiredStructureList: Array<typeof Structure> = [\r\n        MissionControl,\r\n\r\n        SurfaceRoad,\r\n        Dome,\r\n        MainTunnel,\r\n        AccessTunnel,\r\n        Kitchen,\r\n        Mess,\r\n        LivingQuarters,\r\n        \r\n        //CommonArea,\r\n    ]\r\n\r\n    public onInitialize(game: Game) {\r\n        this.game = game\r\n\r\n\r\n        this.hud = new Hud(game, 'hi', (structure) => {\r\n            //if (this.currentlyBuilding) {\r\n            //    this.remove(this.currentlyBuilding)\r\n            //}\r\n            this.startConstructing(structure)\r\n        });\r\n        this.add(this.hud)\r\n\r\n        this.planet = new Planet(this.hud, game.world.color);\r\n        this.add(this.planet)\r\n  \r\n        this.player = new Player()\r\n        this.add(this.player)\r\n\r\n        this.prepareNextBuilding()\r\n        this.camera.zoom(0.001)\r\n        this.camera.zoom(2, 10000)\r\n        // this.camera.y = 0 //-this.planet.depth/2\r\n    }\r\n\r\n    public onActivate() {\r\n        this.game.input.pointers.primary.on('move', (e: Input.PointerMoveEvent) => {\r\n            if (this.dragging) {\r\n                this.camera.pos = this.camera.pos.add(\r\n                    this.dragOrigin.sub(e.pos)\r\n                )\r\n            } else {\r\n                this.player.pos = e.pos\r\n\r\n                let currentBuilding = this.planet.currentlyConstructing\r\n                if (currentBuilding) {\r\n                    // constrain...\r\n                    let constrained = currentBuilding.constrainCursor(this.player.pos)\r\n                    this.player.pos = constrained\r\n\r\n                    currentBuilding.reshape(this.player.pos)\r\n                } else {\r\n                    // show pluses where you could expand?\r\n                }\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('up', (e: Input.PointerUpEvent) => {\r\n            if (this.dragging) { this.dragging = false; }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('down', (e: Input.PointerDownEvent) => {\r\n            if (e.button == Input.PointerButton.Left) {\r\n                const currentBuilding: Building = this.planet.currentlyConstructing\r\n                if (currentBuilding) {\r\n                    let placementValid = !currentBuilding.overlapsAny()\r\n                    // console.log(\"placement valid?\", { placementValid, currentBuilding })\r\n                    if (currentBuilding && placementValid && currentBuilding.handleClick(e.pos)) {\r\n                        // console.log(\"placed!\")\r\n                        this.planet.placeBuilding(currentBuilding)\r\n                        this.planet.currentlyConstructing = null\r\n                        this.prepareNextBuilding(e.pos)\r\n                    } else {\r\n                        // console.log(\"couldn't place?\")\r\n                    }\r\n                }\r\n            } else if (e.button === Input.PointerButton.Middle) {\r\n                this.dragging = true;\r\n                this.dragOrigin = e.pos\r\n            }\r\n        })\r\n\r\n        this.game.input.pointers.primary.on('wheel', (e: Input.WheelEvent) => {\r\n            let z = this.camera.getZoom()\r\n            let step = 0.05\r\n            let min = 0.05, max = 8\r\n            if (e.deltaY < 0) {\r\n                this.camera.zoom(Math.min(z + step, max))\r\n            } else if (e.deltaY > 0) {\r\n                this.camera.zoom(Math.max(z - step, min))\r\n            }\r\n        })\r\n\r\n        this.game.input.keyboard.on('press', (e: Input.KeyEvent) => {\r\n            if (e.key === Input.Keys.H) {\r\n                if (this.buildings && this.buildings[0]) {\r\n                    this.camera.move(this.buildings[0].pos, 500)\r\n                    this.camera.zoom(0.5, 1000)\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    public onDeactivate() {\r\n        this.game.input.pointers.primary.off('move')\r\n        this.game.input.pointers.primary.off('down')\r\n        this.game.input.pointers.primary.off('up')\r\n        this.game.input.pointers.primary.off('wheel')\r\n    }\r\n\r\n\r\n    get buildings() { return this.planet.buildings }\r\n\r\n\r\n    private nextMissingRequiredStructure(): Structure {\r\n        let requiredStructures: Structure[] = Construct.requiredStructureList.map(s => new s())\r\n        let actualStructureNames: string[] = this.buildings.map(building => building.structure.name)\r\n\r\n        // console.log({ actualStructureNames, requiredNames: requiredStructures.map(s => s.name) })\r\n        return requiredStructures.find(structure => !actualStructureNames.includes(structure.name))\r\n    }\r\n\r\n    protected prepareNextBuilding(pos: Vector = new Vector(0,0)) {\r\n        // let structure = Construct.structureList[this.currentBuildingListIndex % Construct.structureList.length]; \r\n        let structure = null;\r\n        let nextMissing = this.nextMissingRequiredStructure();\r\n        if (nextMissing) { structure = nextMissing; }\r\n        // else { this.currentBuildingListIndex += 1 }\r\n        if (structure) {\r\n            this.startConstructing(structure, pos)\r\n        } else {\r\n            this.hud.message(`Welcome to OSIRIS`)\r\n        }\r\n    }\r\n\r\n    startConstructing(structure: Structure, pos: Vector = new Vector(0, 0)) {\r\n        structure.origin = pos\r\n        this.hud.message(`Place ${structure.name}`)\r\n        let theNextOne = this.spawnBuilding(structure)\r\n        this.planet.currentlyConstructing = theNextOne\r\n        this.camera.pos = theNextOne.pos\r\n        this.camera.zoom(structure.zoom, 250)\r\n\r\n    }\r\n\r\n    protected spawnBuilding(structure: Structure): Building {\r\n        let anotherBuilding = this.assembleBuildingFromStructure(structure)\r\n        anotherBuilding.reshape(anotherBuilding.constrainCursor(anotherBuilding.pos))\r\n        return anotherBuilding\r\n    }\r\n    \r\n    private assembleBuildingFromStructure(structure: Structure): Building {\r\n        let View = Construct.structureViews[structure.view]\r\n        let building = new View(structure, this.planet)\r\n        return building;\r\n    }\r\n} \r\n","import { Color } from 'excalibur';\r\nimport { Structure } from './Structure';\r\nimport { sample } from '../Util';\r\n\r\nexport class Colony {\r\n    // origin: Vector\r\n    structures: Structure[] = []\r\n    // build(structure) ...\r\n}\r\n\r\n\r\nexport class World {\r\n  static colors = [Color.Red, Color.Blue, Color.Green] // Color.Viridian, Color.Magenta, Color.Chartreuse];\r\n\r\n  color: Color = sample(World.colors).\r\n      darken(0.1).\r\n      desaturate(0.8);\r\n  skyColor: Color = sample([ Color.Cyan, Color.Vermillion ] ). // Color.Rose //World.colors).\r\n        lighten(0.15).\r\n        desaturate(0.65) // sample([Color.Blue, Color.Rose,Color.Blue]).lighten(0.1).desaturate(0.8)\r\n  colony: Colony = new Colony()\r\n}","module.exports = __webpack_public_path__ + \"94754f62e0ae4d23d386e246f5e0cb6e.png\";","import * as ex from 'excalibur';\r\nconst sword = require('./images/sword.png');\r\n\r\nlet Resources = {\r\n    Sword: new ex.Texture(sword)\r\n}\r\n\r\nexport { Resources }\r\n","import { Game } from './Game';\r\nimport { World } from './models/World';\r\nimport { Construct } from './scenes/Construct';\r\n\r\nconst theWorld = new World();\r\nconst game = new Game(theWorld);\r\n\r\n// scenes\r\nconst construct = new Construct(game);\r\ngame.add('construct', construct);\r\n\r\ngame.start().then(() => {\r\n  game.goToScene('construct');\r\n});\r\n"],"sourceRoot":""}